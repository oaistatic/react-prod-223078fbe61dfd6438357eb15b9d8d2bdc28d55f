const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j3a1atuf3o5l1jac.js","assets/b8ijctzpgh0s7wpx.js","assets/krbmwir12ubt4od1.js","assets/citrwydz0bgriwlc.js","assets/root-gxczc0vy.css","assets/conversation-small-dfayqh3x.css","assets/kcrhrkba74367sn7.js","assets/djwj8991hj8nrjhl.js","assets/ku4zsoy6w4wkp690.js","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js","assets/d6hcvbgoukhbynvf.js","assets/dbalwdodzoo02ru2.js","assets/nvghija6qp2cunds.js","assets/djd85tifm57yisqi.js","assets/cb2t82g498wwhuc2.js","assets/ndwtlsjk3xm27wkq.js"])))=>i.map(i=>d[i]);
import{i as K,j as e,f as on,M as B,e as Se,r as d,a5 as se,a6 as nt,u as Zi,q as ec,L as tc,am as sc,c as an,p as nc,D as oc}from"./b8ijctzpgh0s7wpx.js";import{u as Ve,e as ha}from"./nvghija6qp2cunds.js";import{ko as rn,vq as cn,aX as we,vr as ot,c5 as ln,rS as os,jd as un,cn as Jt,qZ as Fo,vs as ac,vt as xa,ft as rc,d$ as Sa,dv as dn,pa as ya,dw as Xt,f5 as ic,vu as mn,vv as pn,vw as cc,or as Ue,eg as as,vx as $s,ok as qs,gd as rs,vy as ba,vz as Ca,e_ as _a,ot as wa,e$ as va,qX as lc,eh as uc,qa as dc,d as ka,kr as mc,ku as pc,ks as Aa,B as wt,vA as Ma,cJ as ja,kp as fn,qF as bt,am as ue,al as le,kq as at,ik as X,gA as fc,iB as Ho,u9 as Ra,vB as gc,vC as hc,vD as xc,da as Sc,vE as yc,vF as bc,vG as Cc,vH as _c,vI as wc,vJ as Oo,vK as vc,vL as kc,vM as Ac,vN as Mc,u3 as Is,ao as Ea,ap as Pa,od as jc,pZ as Rc,fN as Ec,vO as Pc,i1 as Tc,i3 as Nc,lF as me,vP as Bc,sS as _t,vQ as Dc,nP as Lc,vR as Ic,vS as L,vT as Ta,vU as Fc,vV as Hc,vW as Oc,vX as Uc,vY as Gc,vZ as zc,v_ as Wc,v$ as Vc,w0 as Kc,w1 as $c,w2 as qc,w3 as Yc,w4 as Jc,w5 as Xc,w6 as Qc,w7 as Zc,w8 as el,w9 as tl,wa as sl,cs as gn,km as nl,wb as ol,wc as al,wd as rl,we as il,pj as Vt,au as xe,rt as cl,X as hn,wf as ll,l1 as st,e as Na,wg as ul,wh as dl,po as Ys,lJ as ml,p8 as pl,jz as is,wi as fl,o3 as Ba,o5 as gl,wj as hl,wk as xl,rA as Sl,wl as yl,wm as bl,kn as Da,dH as Cl,Y as cs,hW as _l,wn as wl,bR as vl,fX as kl,aK as La,wo as Ia,wp as Fa,gw as Js,im as Al,dY as H,gv as xn,iy as Ha,wq as Ml,cx as jl,gy as Sn,gz as yn,wr as Rl,ws as El,wt as bn,wu as Zt,wv as Cn,ww as Oa,eO as Pl,wx as Tl,wy as Nl,gB as _n,qJ as wn,wz as Ua,gU as Bl,wA as Dl,wB as Ga,wC as Ll,wD as za,y as Il,dI as Wa,wE as Fl,wF as Hl,wG as Ol,gt as Ul,wH as Gl,g6 as zl,at as ls,E as Va,wI as Wl,wJ as Vl,V as Ka,ec as Kl,wK as $a,ia as $l,wL as ql,wM as Yl,wN as Jl,wO as Xl,wP as Ql,wQ as Zl,wR as eu,wS as tu,wT as su,wU as nu,wV as ou,wW as au,wX as ru,wY as iu,wZ as cu,w_ as lu,w$ as uu,x0 as du,x1 as mu,iC as pu,px as qa,qm as fu,x2 as gu,tj as hu,ds as xu,x3 as Ya,x4 as xt,x5 as Su,x6 as yu,nY as Ja,nX as Xa,x7 as bu,x8 as Cu,x9 as _u,xa as wu,xb as vu,xc as ku,xd as Au,xe as Mu,xf as ju,M as Qa,lg as Ru,xg as Eu,f_ as Pu,f$ as Tu,g0 as Za,g1 as Nu,xh as er,g2 as Bu,ix as Du,xi as tr,sj as Lu,xj as Uo,fw as Iu,xk as Fu,G as Hu,H as Ou,xl as sr,xm as nr,pn as Uu,xn as Xs,xo as Gu,gb as zu,bT as Wu,lG as Vu,v as Ku,xp as $u,gT as qu,cP as Yu,xq as Ju,sD as Xu,iu as Go,qb as Kt,xr as Qu,xs as Fs,xt as Zu,xu as ed,xv as td,nr as sd,ns as nd,Z as od,ly as ad,xw as rd,kc as id,mo as cd,xx as ld,qh as ud,xy as dd,xz as md,xA as pd,mu as fd,xB as gd,cR as hd,cS as xd,xC as Sd,N as yd,U as zo,gu as bd,dq as or,ei as Cd,xD as _d,xE as wd,xF as vd,xG as kd,fZ as Ad,xH as Wo,xI as Vo,xJ as Ko,xK as Md,xL as jd,xM as Rd,xN as Ed,f0 as Pd,kB as Td,dd as Nd,xO as Bd,kN as Dd,jc as Ld,p7 as Id,jb as Fd,sB as Hd,rb as Hs,o_ as Os,xP as Od,ja as Ud}from"./krbmwir12ubt4od1.js";import{m as Z,aq as Ne,cY as be,R as Gd,T as zd,P as Wd,C as Vd,e as N,hH as te,B as Ce,n as ee,hI as us,F as vn,j as pe,dm as ar,ad as rt,au as ve,dn as es,aM as j,al as vt,gr as ts,a as Kd,b1 as ze,a$ as Me,hJ as Us,hK as Gs,hL as $o,a_ as _e,E as $d,aD as kn,aE as rr,c as $,hM as qd,aS as An,cb as ir,ak as Mn,hb as Yd,ch as Jd,hN as cr,aY as Ge,hO as jn,ew as lr,aL as Pe,l as Te,cD as qo,c0 as Xd,f as ur,dE as dr,bi as Qd,aF as Re,dL as mr,Q as Rn,_ as En,aI as Qt,ab as pr,a7 as Qs,a6 as Pn,cT as Tn,g as Zd,dp as em,af as fr,aJ as Ee,be as tm,z as sm,b as nm,d as om,gh as Nn,hP as gr,gF as Zs,O as Bn,h as Dn,bS as am,d3 as rm,gY as Ln,hm as hr,aj as je,ai as Yo,hQ as In,dT as xr,e9 as im,cQ as cm,u as en,cj as lm,dr as Sr,bX as yr,ca as um,hR as dm,e8 as mm,bc as pm,ao as St,b0 as Jo,hS as Xo,hT as Qo,y as fm,cc as gm,bL as hm,b$ as xm,bj as yt,bl as Zo,gP as Sm,ei as ym,cU as bm,k as Cm,hU as _m,hV as wm,hW as vm,ed as km,dU as Am,s as Mm,N as jm,g2 as Rm,g3 as Em,fc as Pm,e_ as Tm}from"./citrwydz0bgriwlc.js";import{a as it,d as fe,n as Nm,t as tn,c as Bm,o as br,q as Fn,r as ds,v as Dm,l as Lm,w as Im,x as Fm,y as $t,z as Hm,P as Om,A as Um,B as Gm,D as zm,E as ea,F as zs,G as Wm,C as Vm,H as Km,I as $m}from"./ku4zsoy6w4wkp690.js";import{u as Cr}from"./megablgldkh4lap1.js";import{g as _r,h as wr,i as qm,p as Ym,P as Jm,b as vr,d as Xm,a as Qm}from"./jekpe1ukp5thtucq.js";import{u as ms,b as Ke,a as We}from"./exvo283q5zxd2q6r.js";import{P as Zm,u as ep}from"./izdon3syh095bs23.js";import{g as tp,A as sp,C as np}from"./i7jya7stlyvnzya0.js";import{u as op}from"./dweroubxngal4vlb.js";import{b as ap}from"./cb2t82g498wwhuc2.js";import{G as kr}from"./dcml6fn13vfm1zv2.js";import{P as Ar}from"./hbpbckirom363mgh.js";import{u as Mr}from"./o0ebhsapkoy5qkg1.js";import{F as rp}from"./k7nub2yuxq70se07.js";import{u as ip}from"./k6ccgr4wxcppeg93.js";import{u as jr,a as cp,I as lp,R as up,C as dp,H as ta,B as sa,F as mp,b as pp,S as fp,c as na,d as gp}from"./dbalwdodzoo02ru2.js";const Rr=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:o,highlightTooltip:r=!1,disabledReason:a,currentModelName:i})=>{const c=K(),l=Z(t,ee.getIsNewConversation),u=Ne(),m=g=>{s!=null&&g&&N.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:u?.planType??"unknown"})},p=rn(be.signUpButtonText),{isEligible:f}=ip(t),x=!!s;return e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"h-8",children:e.jsxs(Gd,{delayDuration:150,onOpenChange:m,children:[e.jsx(zd,{asChild:!0,children:n}),e.jsx(Wd,{children:e.jsx(cn,{$as:Vd,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(hp,{isNewConversation:l,rateLimitPopup:s,signUpButtonText:p})})})]})}):!o&&f?e.jsx(rp,{clientThreadId:t,children:n}):e.jsx(we,{label:Er(c,o,a,i),className:"flex",open:r?!0:void 0,side:"bottom",children:n})})};function Er(t,s,n,o){if(!s)return t.formatMessage({id:"composer.add.label",defaultMessage:"Add photos and files"});switch(n){case ot.ModelNotSupported:if(!o)break;return t.formatMessage({id:"xPEzDr",defaultMessage:"Add files disabled for {modelName}"},{modelName:o??"model"});case ot.ThinkModeInUse:return t.formatMessage({id:"s8j69s",defaultMessage:"Add files disabled in Reason mode"})}return t.formatMessage({id:"MeW0HZ",defaultMessage:"Add files is unavailable"})}const hp=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const o=Ne(),r=on(),a=ln(),i=os(),c=un();if(s==null)return null;const{call_to_action:l,description:u}=s,m=u||e.jsx(B,{...oa.defaultDescription}),p=l?.includes(te.GET_PLUS),f=l?.includes(te.AUTHENTICATE),x=f&&c;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:m}),p?e.jsx(Ce,{size:"small",color:"secondary",onClick:()=>{Jt(r,"Rate limited file upload popover"),N.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:o?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(B,{...oa.getPlus})}):null,f?e.jsx(Ce,{size:"small",color:"primary",onClick:()=>{a({authType:i?"login":"signup",callback:g=>{i?N.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g}):N.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:i?e.jsx(B,{...be.logInButtonText}):e.jsx(B,{...n})}):null,x?e.jsx(Ce,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{a({authType:i?"signup":"login",callback:g=>{i?N.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g}):N.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:i?e.jsx(B,{...n}):e.jsx(B,{...be.logInButtonText})}):null]})},oa=Se({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function xp({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:o,icon:r,isDisabled:a=!1,isSmall:i=!1,showLabel:c=!1,showUpsell:l=!1,hideBorder:u=!1,highlightTooltip:m=!1,disabledReason:p,currentModelName:f,visualTreatment:x}){const g=K(),S=us();a=(a||!!S)&&!l;const v=e.jsxs(ac,{disabled:a,$showLabel:c,$hideBorder:u,$isSmall:i,$visualTreatment:x,onClick:y=>{if(y.preventDefault(),l){N.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}N.logEvent("Open File Viewer",{intent:o.toString()}),n()},"aria-label":a?p===ot.ModelNotSupported?g.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${f}`}):p===ot.ThinkModeInUse?g.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):g.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):g.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[r,c&&e.jsx(xa,{})]}),k=e.jsx("input",{disabled:a,...s({className:"hidden"})}),b=e.jsxs("div",{className:"flex",children:[v,k]});return l?e.jsx(we,{label:e.jsx(B,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(rc,{triggerButton:b,sideOffset:0,alignOffset:0,children:e.jsx(Sa,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Rr,{disabled:a,clientThreadId:t,rateLimitPopup:S,highlightTooltip:m,children:b})}function Sp({code:t,message:s}){switch(t){case Fo.FileTooLarge:return aa.errorFileTooLarge;case Fo.TooManyFiles:return N.logEvent("Uploaded Max Files Error"),aa.errorTooManyFiles;default:return s}}const aa=Se({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),ra=Se({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function yp(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function ih(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:r,noKeyboard:a}=t,i=K(),c=rt(),l=as(o),u=ms(),m=$s(r,l,u),p=m!==Ue.None,f=qs(R=>R.files),x=(m===Ue.Multimodal?mn:pn)-f.length,g=x<=0,{getGizmoId:S}=rs(),{handleFileAccepted:v}=Tr(i,m,Ca(r,l),"drag",S,ba(r,l)?.attachments),k=us(),b=_a(wa(r,l)),{getRootProps:y,isDragActive:_}=Mr({maxFiles:x,disabled:!p||g||k!=null,noClick:!0,noKeyboard:a,onDropAccepted:v,onDropRejected:R=>Pr(R,i,c,m),multiple:!0,maxSize:va,...b}),w=yp(b);return e.jsxs("div",{...y({className:s}),children:[n,_&&e.jsxs(bp,{children:[e.jsx(lc,{}),e.jsx("h3",{children:e.jsx(B,{...ra.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:w.length>0?w.join(", "):e.jsx(B,{...ra.dragAllAccepted})})]})]})}function Pr(t,s,n,o){const{errors:r}=t[0];r.forEach(a=>{const i=Sp(a);typeof i=="string"?n.danger(i,{hasCloseButton:!0}):n.danger(s.formatMessage(i,{size:cc,maxNum:o===Ue.Multimodal?mn:pn}),{hasCloseButton:!0})})}function Tr(t,s,n,o,r,a){const i=pe(),c=ar(i).flags,l=rt(),u=dn(),m=ya(),{isUnauthenticated:p}=ve(),f=c?.includes(es.NoAuthEnableFileUploads);return{handleFileAccepted:d.useCallback(async(g,S)=>{N.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()}),m.fileUploadAccepted();const v=r!=null?await r():void 0;g.length>0&&g.forEach(k=>{Xt.uploadFile(u,ic(k),k,s,n,t,l,{gizmoId:v,...f&&{isUnauthenticated:p}},a)})},[o,s,r,u,m,n,t,l,a,f,p])}}const bp=vn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Cp=({clientThreadId:t})=>{"use forget";const s=pe(),{activeSystemHints:n}=Ke(t),o=it(),r=n.some(g=>g.systemHint===j.Slurm)&&(o.size===0||o.has(j.Slurm)||o.has(j.Research)),a=vt(s,"463092697").value,c=!!a?.softmentionEnabled&&r,{connectedTypes:l}=_r({enabled:c}),{connectedTypes:u}=wr({enabled:c}),{data:m}=Cr(),{filteredKeywords:p,connectorToKeywordsMap:f,keywordsConnectorMap:x}=d.useMemo(()=>{let g=l;o.has(j.Research)?g=u:o.has(j.Slurm)&&(g=l);const S=a?.connectorConfig||{},v=m?.connection_statuses.reduce((_,w)=>(["activated","partially_activated"].includes(w.user_connection_details.activation_status)&&_.add(w.user_connection_details.connection_type),_),new Set)??new Set,{keywordSet:k,connectorToKeywordsMap:b,keywordsConnectorMap:y}=Object.entries(S).reduce((_,[w,R])=>{if(g.has(w)||v.has(w)){const M=(R?.keywords||[]).map(E=>E.toLowerCase());_.connectorToKeywordsMap[w]=M,M.forEach(E=>{_.keywordSet.add(E),_.keywordsConnectorMap[E]=w})}return _},{keywordSet:new Set,connectorToKeywordsMap:{},keywordsConnectorMap:{}});return{filteredKeywords:c?Array.from(k):[],connectorToKeywordsMap:c?b:{},keywordsConnectorMap:c?y:{}}},[a?.connectorConfig,u,c,o,l,m?.connection_statuses]);return{enabled:c,keywords:p,connectorToKeywordsMap:f,keywordsConnectorMap:x}},_p=({clientThreadId:t})=>{"use forget";const{connectedTypes:s,isLoading:n}=_r(),{connectorConfigMap:o}=Nr({clientThreadId:t}),{connectedTypes:r,isLoading:a}=wr(),{data:i,isLoading:c}=Cr(),l=n||a||c;return{availableConnectorTypes:d.useMemo(()=>{const m=[...s].filter(g=>g!==ts.MCP_CONNECTOR&&(!o.has(g)||!o.get(g)?.disabled)),p=[...[...r].filter(g=>g!==ts.MCP_CONNECTOR),"web"],f=i?.connection_statuses.filter(g=>["partially_activated","activated"].includes(g.user_connection_details.activation_status)).map(g=>g.user_connection_details.connection_type)??[];return new Map([[j.Research,new Set(p)],[j.Slurm,new Set([...m,...f])],[void 0,new Set(f)]])},[r,s,o,i?.connection_statuses]),isLoading:l}},Nr=({clientThreadId:t})=>{"use forget";const s=pe(),n=uc(t),o=K(),r=vt(s,"463092697").value;return{connectorConfigMap:d.useMemo(()=>{const i=r?.connectorConfig||{};return Object.entries(i).reduce((c,[l,u])=>{const m=l,p=u.enabledModels&&n?!u.enabledModels.includes(n.id):!1;return c.set(m,{disabled:p,disabledText:p?o.formatMessage({id:"Fk33UU",defaultMessage:"Switch to {model} model to use beta connectors"},{model:u.enabledModels.join(", ")}):void 0,hasBetaTag:u.beta}),c},new Map)},[n,o,r?.connectorConfig])}},Br=t=>ze(t,"3544641259")||!!vt(t,"463092697")?.value?.enabled,wp=(t,s)=>[...t].filter(n=>s.includes(n)),tt=t=>{N.logEventWithStatsig("chatgpt_connectors_toggled_sources","chatgpt_connectors_toggled_sources",t)};function ct(t){const s=pe(),{session:n}=Kd(),o=ze(s,"4059945251"),r=Br(s),a=[...it()][0],{availableConnectorTypes:i}=_p({clientThreadId:t}),c=Z(t,b=>b?.selectedSources?.get(a)??[]),l=Z(t,b=>[...b?.mentionedSources??[]]),u=Z(t,b=>new Set(b?.mentionedSources??[])),m=d.useMemo(()=>new Set([...wp([...c],[...i.get(a)??[]]),...l]),[i,l,a,c]),p=Z(t,b=>b?.selectedMCPSources?.get(a)??new Set),f=d.useMemo(()=>new Set(p),[p]),x=d.useCallback(b=>{t&&Me(t,y=>{const _=y.selectedSources?.get(a)??new Set,w=new Set([...y.selectedSources?.get(a)??[],...y.mentionedSources??[]]),R=y.mentionedSources??new Set;let M,E;if(!Us(b))E="platform",w.has(b)?(M="remove",_.delete(b),R.has(b)&&(tt({source:"mentions",action:M,type:E,systemHint:a,selectedSource:b,extra:"removed_by_toggle_source"}),R.delete(b))):(M="add",_.add(b),!o&&b!=="web"&&_.has("web")&&!y.hasRemovedWebSource&&(_.delete("web"),y.hasRemovedWebSource=!0));else{E="mcp";const A=y.selectedMCPSources?.get(a)??new Set;A.has(b)?(M="remove",A.delete(b)):(M="add",A.add(b)),!o&&_.has("web")&&!y.hasRemovedWebSource&&(_.delete("web"),y.hasRemovedWebSource=!0),y.selectedMCPSources??=new Map,y.selectedMCPSources.set(a,A)}y.selectedSources??=new Map,y.selectedSources.set(a,_),y.mentionedSources=R,tt({source:"toggle",action:M,type:E,systemHint:a,selectedSource:b}),Gs({selectedSourcesMap:y.selectedSources,selectedMCPSourcesMap:y.selectedMCPSources,scope:{userId:n?.user?.id,workspaceId:n?.account?.id}})})},[t,a,n?.user?.id,n?.account?.id,o]),g=d.useCallback(b=>{t&&Me(t,y=>{let _;if(Us(b)){_="mcp";const w=y.selectedMCPSources?.get(a)??new Set;w.add(b),y.selectedMCPSources??=new Map,y.selectedMCPSources.set(a,w)}else{_="platform";const w=y.selectedSources?.get(a)??new Set;w.add(b),y.selectedSources??=new Map,y.selectedSources.set(a,w)}tt({source:"toggle",action:"add",type:_,systemHint:a,selectedSource:b}),Gs({selectedSourcesMap:y.selectedSources,selectedMCPSourcesMap:y.selectedMCPSources,scope:{userId:n?.user?.id,workspaceId:n?.account?.id}})})},[t,a,n?.account?.id,n?.user?.id]),S=d.useCallback(b=>{t&&Me(t,y=>{const _=y.mentionedSources??new Set;_.add(b),y.mentionedSources=_,tt({source:"mentions",action:"add",type:"platform",systemHint:a,selectedSource:b})})},[t,a]),v=d.useCallback(b=>{t&&Me(t,y=>{const _=y.mentionedSources??new Set;_.delete(b),y.mentionedSources=_,tt({source:"mentions",action:"remove",type:"platform",systemHint:a,selectedSource:b})})},[t,a]),k=d.useCallback(b=>{t&&Me(t,y=>{let _;if(Us(b)){_="mcp";const w=y.selectedMCPSources?.get(a)??new Set;w.delete(b),y.selectedMCPSources??=new Map,y.selectedMCPSources.set(a,w)}else{_="platform";const w=y.selectedSources?.get(a)??new Set;w.delete(b),y.selectedSources??=new Map,y.selectedSources.set(a,w);const R=y.mentionedSources??new Set;R.has(b)&&R.delete(b),y.mentionedSources=R}tt({source:"toggle",action:"add",type:_,systemHint:a,selectedSource:b}),Gs({selectedSourcesMap:y.selectedSources,selectedMCPSourcesMap:y.selectedMCPSources,scope:{userId:n?.user?.id,workspaceId:n?.account?.id}})})},[t,a,n?.account?.id,n?.user?.id]);return r?{selectedSources:m,selectedMCPSources:f,mentionedSources:u,toggleSource:x,addSource:g,deleteSource:k,addMentionedSource:S,deleteMentionedSource:v}:{selectedSources:void 0,selectedMCPSources:void 0,mentionedSources:void 0,toggleSource:()=>{},addSource:()=>{},deleteSource:()=>{},addMentionedSource:()=>{},deleteMentionedSource:()=>{}}}const vp=({clientThreadId:t,composerController:s})=>{const{mentionedSources:n,addMentionedSource:o,deleteMentionedSource:r}=ct(t),a=it(),{setThreadSystemHintMode:i}=fe(),{keywords:c,connectorToKeywordsMap:l,keywordsConnectorMap:u}=Cp({clientThreadId:t});d.useEffect(()=>{s.resetTrackingKeywords(c)},[s,c]);const m=d.useRef(a);d.useEffect(()=>{const x=m.current;m.current=a,(x.has(j.Slurm)||x.has(j.Research))&&a.size===0&&s.removeKeywordDecorations(s.getKeywords())},[a,s]);const p=d.useRef(n);d.useEffect(()=>{const x=p.current;if(p.current=n,!x)return;const g=Array.from(x).filter(v=>!(n??new Set).has(v)),S=[];g.forEach(v=>{S.push(...l[v]??[])}),s.removeKeywordDecorations(S)},[s,l,n]);const f=d.useRef([]);d.useEffect(()=>{const x=S=>{if(f.current.length===0&&S.length>0&&a.size===0){const b={clientThreadId:t};i(j.Slurm,!0,b)}const v=S.filter(b=>!f.current.includes(b)),k=f.current.filter(b=>!S.includes(b));v.forEach(b=>o(b)),k.forEach(b=>r(b)),f.current=S},g=()=>s.getKeywords().map(S=>u[S.toLowerCase()]);return x($o(g())),s.subscribe("change",()=>{x($o(g()))})},[o,t,s,r,u,a.size,i])},kp=({clientThreadId:t,currentModelId:s,isCompletionInProgress:n,composerController:o})=>{const r=dc(),a=it(),i=o.useState(v=>v.getSystemHint()),c=_e(t);vp({clientThreadId:t,composerController:o});const l=d.useMemo(()=>a.size>0?Array.from(a):i?[i]:[],[i,a]),u=d.useRef(n);d.useEffect(()=>{u.current=n},[n]);const m=d.useCallback(v=>{u.current?Me(t,k=>{k.conduitToken=null,k.prepareState=null}):Me(t,k=>{k.conduitToken=v,k.prepareState="success"})},[t]),p=d.useRef(null);p.current=()=>Nm(t,s,l,m);const f=d.useCallback(()=>p.current?.(),[]),x=d.useCallback(ka(()=>f(),5e3,{leading:!0,trailing:!0}),[]),g=d.useRef(!1),S=$d();return d.useEffect(()=>{if(S){if(!g.current){g.current=!0;return}f()}},[S,t,s,l,c?.effortMode]),d.useEffect(()=>{x.cancel()},[n,x]),d.useEffect(()=>o.subscribe("change",()=>{n||r&&x()}),[n,o,x,r]),null};function Ap(){const t=K(),s=()=>{Dr.setState({lastSeenUpsellBannerAt:Date.now()})};d.useEffect(()=>{N.logEventWithStatsig("Contextual Answers User Nux Banner Shown","chatgpt_contextual_answers_user_nux_banner_shown")},[]);const[n,o]=d.useState("nux"),{gDriveOAuthConnectionId:r,refetch:a}=mc(),i=d.useCallback(()=>{N.logEventWithStatsig("Contextual Answers User Nux Banner Confirmation Button Clicked","chatgpt_contextual_answers_user_nux_banner_confirmation_button_clicked"),r?o("gDriveOauth"):pc()},[r]);return e.jsxs(e.Fragment,{children:[n==="gDriveOauth"&&r&&e.jsx(Aa,{onClose:s,isAdminFlow:!1,connectionId:r,location:"user_nux_banner",onSuccess:a}),n==="nux"&&e.jsx(wt,{primaryCtaText:t.formatMessage(Ws.connectLabel),onPrimaryCtaClick:i,onDismiss:s,content:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ma,{size:18,icons:[e.jsx(ja,{className:"icon-md"},"gDrive")]}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"flex items-center gap-2 font-bold",children:t.formatMessage(Ws.title)}),e.jsx("span",{className:"text-token-text-secondary",children:t.formatMessage(Ws.description)})]})]})})]})}const Mp=1,jp="oai/apps/caUserUpsellBanner",Dr=kn()(rr(()=>({lastSeenUpsellBannerAt:void 0}),{name:jp}));function Rp(t){const s=fn(),n=Dr(m=>m.lastSeenUpsellBannerAt?bt(Date.now(),m.lastSeenUpsellBannerAt)>=Mp:!0),o=ue(le.hasSeenComposerContextualAnswerTooltip),{activeSystemHints:r}=Ke(t),a=d.useMemo(()=>r.some(m=>m.systemHint===j.ContextualAnswers),[r]),{connectionInstanceData:i,isLoading:c}=at({skip:!a}),l=i&&i.connection_statuses.length>0,u=i?.connection_statuses.every(m=>m.user_connection_details.auth_status==="not_connected")??!1;return!s&&n&&a&&!c&&l&&u&&!o.isLoading&&!o.eligible}const Ws=Se({connectLabel:{id:"ContextualAnswersUserUpsellBanner.connectLabel",defaultMessage:"Connect"},title:{id:"ContextualAnswersUserUpsellBanner.title",defaultMessage:"Connect Google Drive to get more relevant answers"},description:{id:"ContextualAnswersUserUpsellBanner.description",defaultMessage:"ChatGPT can use your Google Drive files to provide more relevant answers. Connect your Google Drive to get started."}}),Ep=({className:t,children:s})=>e.jsx(se.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Pp({canContinue:t,onContinueGenerating:s}){const n=d.useCallback(r=>{s(r),tn()},[s]);let o=null;return t&&(o=e.jsx(Np,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function Tp({className:t}){return e.jsx(fc,{className:$("-rotate-180",t)})}const Np=({onHandleContinueGenerating:t})=>e.jsx(Ep,{children:e.jsx(Ce,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:Tp,size:"small",children:e.jsx(B,{...X.continueGenerating})})}),Lr=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:r})=>{const{name:a,title:i,call_to_action:c,description:l}=s,u=Ne(),m=Ho(!0),{updateSystemHint:p}=fe(),f=Ve(),x=Ho(!1),g=qd(),S=Z(t,ee.getIsNewConversation),v=u?.planType??"unknown",k=un(),b=g&&"block_reason"in g?g.block_reason:null,y="banner_description",_=d.useMemo(()=>({type:a||"unknown",location:y,plan_type:v,is_new_conversation:S,is_hard_block:!!g,hard_block_reason:b??"",call_to_action:c}),[a,y,v,S,g,b,c]),w=on(),R=ln(),M=pe(),E=!An(M),A=os(),P=rn(be.signUpButtonText),I=Bm({clientThreadId:t}),O=ir(M,"1368081792"),h=J=>{switch(J){case te.AUTHENTICATE:return{text:A?be.logInButtonText:P,onClick:()=>{R({authType:A?"login":"signup",callback:V=>{A?N.logLogInButtonClicked({location:`Rate limit banner - ${a}`,provider:V}):N.logSignUpButtonClicked({location:`Rate limit banner - ${a}`,provider:V})}})}};case te.AUTHENTICATE_SECONDARY:return{text:A?P:be.logInButtonText,onClick:()=>{R({authType:A?"signup":"login",callback:V=>{A?N.logSignUpButtonClicked({location:`Rate limit banner - ${a}`,provider:V}):N.logLogInButtonClicked({location:`Rate limit banner - ${a}`,provider:V})}})}};case te.GET_PLUS:return{text:Oe.getPlusButton,onClick:()=>{N.logRateLimitGetPlusButtonClicked(_),E?R({authType:A?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:V=>{A?N.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:V}):N.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:V})}}):Jt(w,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:Oe.newChatButton,onClick:()=>{m({modelId:"",location:y})}};case te.PAID_USER_O3_MINI_HIGH:{const V=ee.getCurrentLeafId(_e(t)),G=()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:O.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:_}),O.get("should_change_model_picker",!0)&&x({modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}),I({sourceEvent:new Event("click"),nodeId:V,requestedModelId:"o4-mini-high"})};return{text:Oe.tryItButton,onClick:G}}case te.FREE_USER_O3_MINI_HIGH:return{text:Oe.getPlusButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:_}),Jt(w,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const V=ee.findNode(_e(t),ae=>Yd(ae.message)),G=V?Jd(V.message):void 0;return{text:Oe.tryItButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:_}),p(j.Research,{clientThreadId:t}),f.focus(),f.setText(G??"")}}}case te.GET_PRO:return{text:Oe.getProButton,onClick:()=>{N.logRateLimitUpgradePlanButtonClicked({..._,upgrade_plan_tye:"pro"}),E?R({authType:A?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:V=>{A?N.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:V}):N.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:V})}}):Jt(w,"Prompt textarea rate limit banner")}};case te.TRY_CODEX:return{text:Oe.tryCodexButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:_}),w("/codex")}};default:return}};Ra(()=>{!O.get("should_change_model_picker",!0)&&_.type==="o3-mini-high-in-context-upsell-plus"&&(_.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),N.logRateLimitBannerShown(_),r?.()});const[T,D]=c??[];let F=D;T===te.AUTHENTICATE&&k&&(F=te.AUTHENTICATE_SECONDARY);const U=ze(M,"2861925050");let q={};if(U&&(T===te.NOTIFY_ADMIN_FOR_CREDITS||T===te.ADD_CREDITS))if(T===te.ADD_CREDITS)q={customActions:e.jsx(sp,{trigger:"prompt-textarea-rate-limit-banner"})},N.logEventWithStatsig("ChatGPT Credits: Rate Limit Banner Shown - Add Credits","chatgpt_credits_rate_limit_banner_shown_add_credits",{location:y,type:a,plan_type:v,is_new_conversation:S.toString()});else{const J=tp(a);J?T===te.NOTIFY_ADMIN_FOR_CREDITS&&(q={customActions:e.jsx(np,{creditConsumingProduct:J,trigger:"prompt-textarea-rate-limit-banner"})},N.logEventWithStatsig("ChatGPT Credits: Rate Limit Banner Shown - Notify Admin","chatgpt_credits_rate_limit_banner_shown_notify_admin",{location:y,type:a,plan_type:v,is_new_conversation:S.toString()})):Mn.addError("RateLimitBanner: notify admin action is not available for this rate limit banner")}else q={primaryAction:h(T),secondaryAction:h(F)};return e.jsx(gc,{onDismiss:n,title:i,description:l,actions:q,onInteract:o})},Oe=Se({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Bp=({clientThreadId:t,composerController:s})=>{const n=cr(),o=Ge(s.store,g=>g.rateLimitBannerFeature),r=jn(),a=n??Ir(o,r),i=Z(t,ee.getRequestId),c=Z(t,ee.getCurrentLeafId),l=lr(i),{layer:u}=Pe("1368081792"),m=a?.name?()=>{switch(a.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":hc(c);break}}:void 0,{value:p}=Te("3612584454");d.useEffect(()=>{l&&!(a?.name==="gpt-4l"&&p)&&(qo.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,a?.name,p,s]);const f=a?.is_dismissible?()=>{N.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!u.get("should_change_model_picker",!0)&&a?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":a?.name}),qo.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,x=()=>{switch(a?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":xc({interactedInPeriod:!0});break}};return e.jsx(nt,{children:a&&e.jsx(se.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Lr,{clientThreadId:t,rateLimitInfo:a,onDismiss:f,onInteract:x,onMount:m})})})};function Ir(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function Dp(t,s,n,o,r,a,i,c,l,u,m,p){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(y=>y.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||c&&i&&bt(Date.now(),i)<Oo)return!1;const x=o==null||bt(Date.now(),o)>=vc,g=r===u,S=i==null||a==null||bt(Date.now(),i)>=Oo||a<kc;if(!(x&&S||g))return!1;switch(t.name){case"deep-research-in-context-upsell":return m("should_show_deep_research_upsell_banner",!1);case"deep-research-in-context-upsell-free":return m("should_show_deep_research_upsell_banner_free",!1);case"o3-mini-high-in-context-upsell-free":return m("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return m("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return p("should_show_codex_upsell_banner",!1);default:return!1}}function Lp(t,s){const n=Xd(),o=Sc(t),r=Z(t,ee.getRequestId),a=Z(t,ee.getCurrentLeafId),i=lr(r),c=yc(w=>w.lastSeenInContextUpsellBannerAt),l=bc(w=>w.inContextUpsellBannerPeriodExposureCount),u=Cc(w=>w.inContextUpsellBannerPeriodStartAt),m=_c(w=>w.inContextUpsellBannerLastSeenId),p=wc(w=>w.inContextUpsellBannerInteractedInPeriod),{layer:f}=Pe("1368081792"),{layer:x}=Pe("1738106734"),g=Ge(s.store,w=>w.rateLimitBannerFeature),S=pe(),v=ze(S,"2861925050"),k=cr(),b=jn(),y=v?k:k??Ir(g,b);let _=!1;switch(y?.name){case null:case void 0:_=g!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":_=Dp(y,n,o,c,m,l,u,p,i,a,f.get,x.get);break;default:_=!0}return!i&&_}const ss="month",Fr="year";function Ip(){const t=ur(),s=K(),n=rt(),{markAsViewed:o}=ue(Ac),{initialBillingDetails:r}=op(t,!0),a=d.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await jc(t?.features??[],s,n,r,a)}catch{}}const{shouldShowBanner:c,discountValue:l,discountDuration:u}=Mc();if(d.useEffect(()=>{c&&l&&u&&Is.logShowReferrerRedemptionBanner()},[c,l,u]),!c||!l||!u)return null;const m=Fp(s,r,l,u),p=Hp(s,r,l,u),f=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:m}),e.jsx("span",{className:"text-token-text-secondary",children:p})]});return e.jsx(wt,{onPrimaryCtaClick:()=>{o(),Is.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(B,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{o(),Is.logCloseReferrerRedemptionBanner()},content:f})}function Fp(t,s,n,o){const{currencySymbol:r}=Ea(Pa(),s.currency),a=o?o.period:ss,i=o?o.num_periods:1,c=r.code.defaultMessage?.toString()??dr,l=t.formatNumber(n.value,{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:2});let u;return a===ss?u=i===1?e.jsx(B,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(B,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):a===Fr&&(u=i===1?e.jsx(B,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(B,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),u}function Hp(t,s,n,o){const{currencySymbol:r}=Ea(Pa(),s.currency),a=o?o.period:ss,i=o?o.num_periods:1,c=r.code.defaultMessage?.toString()??dr,l=t.formatNumber(n.value,{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:2});let u;return a===ss?u=i===1?e.jsx(B,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(B,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:i}}):a===Fr&&(u=i===1?e.jsx(B,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(B,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:i}})),u}const sn=window.sessionStorage,nn=kn(Qd(()=>({memoryFullBannerDismissed:!!sn?.getItem(Re.MemoryFullBannerDismissed)}))),Hr={dismissBanner(){nn.setState(t=>{t.memoryFullBannerDismissed=!0}),sn?.setItem(Re.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){nn.setState(t=>{t.memoryFullBannerDismissed=!1}),sn?.removeItem(Re.MemoryFullBannerDismissed)}};function Op(t){const s=mr(t),n=Tc(),{data:o}=Nc(s,!1,n),r=o!=null,a=r&&o.memoryFullPct>=100,[i,c]=d.useState(!1);d.useEffect(()=>{!a&&r&&(c(!0),Hr.clearDismissedBanner())},[a,r]);const l=nn(u=>u.memoryFullBannerDismissed);return a&&i&&!l}function Up(){const t=K(),{openSettings:s}=Rc();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(wt,{title:t.formatMessage(qt.memoryFullTitle),content:t.formatMessage(qt.memoryFullTooltip,qt.memoryFullTooltip.values),primaryCtaText:t.formatMessage(qt.memoryManageButton),onPrimaryCtaClick:()=>s(Ec.Personalization),onDismiss:()=>Hr.dismissBanner()})})}const qt=Se({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories won’t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Pc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}});function Gp(){const t=K(),s=()=>{Or.setState({lastSeenUpsellBannerAt:Date.now()})};d.useEffect(()=>{N.logEventWithStatsig("Contextual Answers Admin Nux Banner Shown","chatgpt_contextual_answers_admin_nux_banner_shown")},[]);const n=d.useCallback(()=>{N.logEventWithStatsig("Contextual Answers Admin Nux Banner Confirmation Button Clicked","chatgpt_contextual_answers_admin_nux_banner_confirmation_button_clicked"),window.location.href="/admin/ca"},[]);return e.jsx(wt,{primaryCtaText:t.formatMessage(Vs.connectLabel),onPrimaryCtaClick:n,onDismiss:s,content:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ma,{size:18,icons:[e.jsx(ja,{className:"icon-md"},"gDrive")]}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"flex items-center gap-2 font-bold",children:t.formatMessage(Vs.title)}),e.jsx("span",{className:"text-token-text-secondary",children:t.formatMessage(Vs.description)})]})]})})}const zp=7,Wp="oai/apps/caUpsellBanner",Or=kn()(rr(()=>({lastSeenUpsellBannerAt:void 0}),{name:Wp}));function Vp(t){const s=fn(),n=Or(u=>u.lastSeenUpsellBannerAt?bt(Date.now(),u.lastSeenUpsellBannerAt)>=zp:!0),{activeSystemHints:o}=Ke(t),r=d.useMemo(()=>o.some(u=>u.systemHint===j.ContextualAnswers),[o]),{connectionInstanceData:a,isLoading:i}=at({skip:!r}),c=ur(),l=!!c?.isAdminOfAccount()||!!c?.isOwnerOfAccount();return!s&&n&&r&&l&&!i&&a?.connection_statuses.length===0}const Vs=Se({connectLabel:{id:"ContextualAnswersAdminUpsellBanner.connectLabel",defaultMessage:"Connect"},title:{id:"ContextualAnswersAdminUpsellBanner.title",defaultMessage:"Connect Google Drive to help your team unblock work"},description:{id:"ContextualAnswersAdminUpsellBanner.description",defaultMessage:"Bring your internal knowledge into ChatGPT — secure and admin-controlled"}}),Kp=Rn(()=>En(()=>import("./j3a1atuf3o5l1jac.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Ur=d.memo(function({className:s}){const{store:n}=me(),o=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:$(s??"absolute start-0 end-0 bottom-full",Dc.PromptTextareaHeader),children:e.jsx(Bc,{shouldRender:o,contentArea:_t.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx($p,{}),e.jsx(qp,{})]})})})});function $p(){const{store:t}=me(),s=t.useSharedProps(c=>c?.clientThreadId),n=t.useContentAreaId(_t.HeaderTop),o=Lc(),r=Z(s,c=>c?.modelId),a=Ic.useStore();let i;switch(n){case L.ProjectConversationTaskNoFileAccess:i=e.jsx(Qp,{});break;case L.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Qc,{clientThreadId:s});break;case L.S09KM1:i=null;break;case L.BannerSignup:i=e.jsx(Xp,{});break;case L.BannerTermsDisclaimer:i=e.jsx(Zp,{});break;case L.PromptTextareaAction:i=e.jsx(ef,{});break;case L.BannersRateLimit:i=e.jsx(tf,{});break;case L.BannerSidekickAnnouncement:i=e.jsx(Xc,{});break;case L.SearchBrowserExtensionAnnouncement:i=e.jsx(Jc,{});break;case L.MoonshineAnnouncement:i=e.jsx(Yc,{});break;case L.CustomizeChatGPTAnnouncement:i=e.jsx(qc,{});break;case L.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx($c,{});break;case L.BannerMemoryFull:i=e.jsx(Up,{});break;case L.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case L.JawboneAnnouncement:o?i=e.jsx(Kp,{}):i=null;break;case L.JawboneMaxActiveAnnouncement:o?i=e.jsx(Kc,{}):i=null;break;case L.PromoRedemptionAnnouncement:i=e.jsx(Zm,{});break;case L.OperatorAnnouncement:i=e.jsx(Vc,{});break;case L.BannerPlusUpsell:i=e.jsx(Wc,{});break;case L.ContextualAnswersAdminUpsell:i=e.jsx(Gp,{});break;case L.ContextualAnswersUserUpsell:i=e.jsx(Ap,{});break;case L.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(Ip,{});break;case L.RefereeRedemptionAvailableAnnouncement:i=e.jsx(zc,{});break;case L.ReferralProgramUpsellAnnouncement:i=e.jsx(Gc,{});break;case L.TatertotIntakeFormAnnouncement:i=!1;break;case L.StudentsUpsellAnnouncement:i=e.jsx(Uc,{});break;case L.ModelDeprecationBanner:i=Oc(r);break;case L.TeamsContextualAnswersUpsell:i=e.jsx(Hc,{});break;case L.KanziConfig:i=!1;break;case L.LanguageUpsellBanner:i=e.jsx(Fc,{onDismissSideEffect:()=>{N.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),a.closeBanner()},onPrimaryCtaClickSideEffect:()=>{N.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),a.closeBanner()}});break;default:i=null;break}return i}function qp(){const{store:t}=me(),s=t.useContentAreaId(_t.HeaderBottom);let n;switch(s){case Ta.DallePromptControls:n=e.jsx(Jp,{});break;default:n=null;break}return n}const Yp=Rn(()=>En(()=>import("./djwj8991hj8nrjhl.js"),__vite__mapDeps([7,1,2,3,4,5,8,9,10,11])).then(t=>t.default));function Jp(){const{store:t}=me(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Yp,{composerController:s}):null}function Xp(){const{store:t}=me(),s=t.useSharedProps(r=>r?.clientThreadId),n=os(),o=el();return s?n?e.jsx(tl,{threadId:s,showSignUp:o}):e.jsx(sl,{threadId:s,showLogin:o}):null}function Qp(){return d.useEffect(()=>()=>{Qt.getItem(Re.TasksHasSeenProjectDisclaimerBanner)||Qt.setItem(Re.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(wt,{icon:e.jsx(gn,{}),title:e.jsx(B,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(B,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{Qt.setItem(Re.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Zp(){const{store:t}=me(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Zc,{threadId:s}):null}function ef(){const{store:t}=me(),s=t.useSharedProps();return s?e.jsx(Pp,{...s}):null}function tf(){const{store:t}=me(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(Bp,{clientThreadId:s,composerController:n})}const sf="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",Hn=()=>rl(Re.HasSeenNoAuthImagegenNux,!1,il),ch=()=>{const{isUnauthenticated:t}=ve(),s=nl(),[n]=Hn(),o=ap(),r=pe(),a=ir(r,"2118136551");return!t||s||n||o?"hide":a.get("should_show_imagegen_nux",!1)?"show":"hide"},lh=({onClose:t})=>{const n=ol()?"bottom":"center",o=ln(),[r,a]=d.useState(!1),i=pe(),c=vt(i,"2604379743").value,l=typeof c.nux_video_url=="string"?c.nux_video_url:sf,u=typeof c.nux_image_url=="string"?c.nux_image_url:"",[,m]=Hn(),p=()=>{m(!0),Qt.setItem(Re.HasSeenNoAuthImagegenNux,!0)},f=os(),{layer:x}=Pe("2118136551"),g=x.get("sign_up_button_has_the_word_free",!0),S=rn(g?al.signUpForFreeCta:be.signUpButtonText),v=e.jsx(Ce,{as:"button",size:"large",color:f?"secondary":"primary",onClick:()=>{p(),o({authType:"signup",callback:y=>{N.logSignUpButtonClicked({provider:y,location:"No Auth Imagegen Nux Modal"})}})},fullWidth:!0,children:e.jsx(B,{...S})}),k=e.jsx(Ce,{as:"button",size:"large",color:f?"primary":"secondary",fullWidth:!0,onClick:()=>{p(),o({authType:"login",callback:y=>{N.logLogInButtonClicked({provider:y,location:"No Auth Imagegen Nux Modal"})}})},children:e.jsx(B,{...be.logInButtonText})}),b=()=>{t(),p(),N.logEventWithStatsig("chatgpt_no_auth_imagegen_nux_modal_dismissed","chatgpt_no_auth_imagegen_nux_modal_dismissed")};return d.useEffect(()=>{N.logEventWithStatsig("chatgpt_no_auth_imagegen_nux_modal_shown","chatgpt_no_auth_imagegen_nux_modal_shown")},[]),e.jsxs(pr,{testId:"modal-no-auth-imagegen-nux",isOpen:!0,noPadding:!0,onClose:b,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",position:n,children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!r&&e.jsx("img",{src:u,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:l,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>a(!0)}),e.jsx("div",{className:"absolute end-4 top-4",children:e.jsx(Qs,{onClick:b})})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-8 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(B,{id:"OxVK72",defaultMessage:"Bring your ideas to life with images"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(B,{id:"bVWvdX",defaultMessage:"Create a free account to make illustrations, charts, comics, and more."})}),e.jsx("div",{className:"mt-4 mb-2 flex w-full flex-col gap-3",children:f?[k,v]:[v,k]}),e.jsx(Ce,{color:"ghost",className:"text-token-text-secondary font-semibold underline hover:bg-transparent",onClick:b,children:e.jsx(B,{...be.stayLoggedOut})})]})]})},nf="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",of="https://help.openai.com/en/articles/8932459",uh=()=>{const{isLoading:t,eligible:s}=ue(le.hasSeenShibaHomeNux),{isUnauthenticated:n}=ve(),[o]=Hn(),a=Ne()?.isQuorum(),i=d.useContext(Pn),c=Tn(i),{value:l}=Te("2781425969");return n||!l||o||a||c?"hide":t?"loading":s?"show":"hide"};function Gr(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:xe.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"}),theme:Vt.Image},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:xe.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"}),theme:Vt.Image},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:xe.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"}),theme:Vt.Image},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:xe.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"}),theme:Vt.Image}]}const dh=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=ue(le.hasSeenShibaHomeNux),o=Ve(),r=on(),a=Zd("2604379743").config.value,i=typeof a.nux_video_url=="string"?a.nux_video_url:nf,c=typeof a.nux_image_url=="string"?a.nux_image_url:"",[l,u]=d.useState(!1),m=br(o,s),{activeSystemHints:p}=Ke(s),f=p.find(k=>k.systemHint===j.PictureV2);d.useEffect(()=>{N.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const x=K(),g=Gr(x),S=()=>{n(),t(),N.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},v=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{f&&m({hint:f,enable:!0}),o.focus()})}),o.setAutocompletions(g)};return e.jsx(e.Fragment,{children:e.jsxs(pr,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:em,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!l&&e.jsx("img",{src:c,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:i,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>u(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(B,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(B,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:k=>e.jsx("a",{href:of,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:k})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(B,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(Ce,{color:"secondary",onClick:S,className:"flex-1",children:e.jsx(B,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(Ce,{color:"primary",onClick:()=>{v(),r("/?model=gpt-4o"),N.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(B,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})};function af({suggestions:t,composerController:s,onSelect:n,onChange:o}){const r=ha(),a=d.useCallback((f,x,g,S)=>{n?.(x,g,S),r(f,x,g,S)},[n,r]),[i,c]=d.useState(()=>t.length>0),[l,u]=d.useState(-1),[m,p]=d.useState(!1);return d.useEffect(()=>{const f=x=>{if(!x.isComposing)if(x.key==="ArrowDown"){const g=l===t.length-1?0:l+1;u(g),o?.(g,!0,t[g])}else if(x.key==="ArrowUp"){x.preventDefault();const g=l<=0?t.length-1:l-1;u(g),o?.(g,!0,t[g])}else x.key==="Enter"&&!x.shiftKey&&t[l]&&a(x,t[l],t,l)};return s.subscribe("keydown",f)},[t,l,o,a,s]),d.useEffect(()=>s.subscribe("blur",()=>{u(-1),c(!1),o?.(-1,!1)}),[s,o]),d.useEffect(()=>s.subscribe("focus",()=>c(!0)),[s]),d.useEffect(()=>{if(!m){const f=()=>{p(!0),window.removeEventListener("mousemove",f)};return window.addEventListener("mousemove",f),()=>{window.removeEventListener("mousemove",f)}}},[m]),d.useEffect(()=>{u(-1),o?.(-1,!1),p(!1)},[t,o]),e.jsx(se.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:$("w-full flex-col p-2.5 max-lg:flex-col-reverse",i?"flex":"hidden"),children:t.map((f,x)=>e.jsxs(se.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:x*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[x>0&&e.jsx("div",{className:$("h-[1px] opacity-60 max-lg:hidden",l===x||l===x-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),e.jsxs("button",{className:$("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",l===x?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),a(g,f,t,x)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{m&&(u(x),o?.(x,!1,f))},onMouseLeave:()=>{u(-1),o?.(-1,!1,f)},children:[f.icon?e.jsx("span",{className:"text-token-text-secondary icon me-2 flex-none",children:f.icon}):null,e.jsx("span",{className:"text-sm whitespace-pre-wrap",children:f.autocompletionChunks&&f.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:f.autocompletionChunks.map((g,S)=>e.jsx("span",{className:$(g.className??(g.isMatched?"text-token-text-tertiary":"text-token-text-primary")),children:g.text},S))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:$(f.type===xe.Starter||f.type===xe.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:f.title}),e.jsx("span",{className:"text-token-text-primary",children:f.body})]})})]}),x>0&&e.jsx("div",{className:$("h-[1px] opacity-60 lg:hidden",l===x||l===x-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},f.id??x))})}function rf(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const o=[];let r=0;for(let c=0;c<s.length&&(r<t.length&&t[r]===s[c]&&(o.push(c),r++),r!==t.length);c++);const a=[];let i=0;if(o.forEach(c=>{if(c>i){const l=n.slice(i,c);l&&a.push({text:l,isMatched:!1})}a.push({text:n[c],isMatched:!0}),i=c+1}),i<s.length){const c=n.slice(i);c&&a.push({text:c,isMatched:!1})}return cf(a)}function cf(t){if(t.length===0)return t;const s=[t[0]];for(let o=1;o<t.length;o++){const r=s[s.length-1],a=t[o];r.isMatched===a.isMatched?r.text+=a.text:s.push(a)}const n=s.filter(o=>o.isMatched).reduce((o,r)=>o+r.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}async function lf(t=8,s=null){const n=await nm.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:s}},authOption:om.SendIfAvailable});return Mn.addFirstTiming("load.promptStarters"),n}function uf(t=8,s=null){return ec({queryKey:["promptStarters",t,s],queryFn:()=>lf(t,s)})}function ia(t){return(cl(t)?t.promptStarters:t.gizmo.display.prompt_starters)?.map(s=>({type:xe.Starter,title:"",body:s,prompt:s}))}const df=()=>{const t=pe(),s=tm(t),n=Na(),o=ul(dl),r=An(t),a=r?s.getLayer("4031588851"):s.getLayer("3533083032"),i=r?s.getLayer("4031588851",{disableExposureLog:!0}):s.getLayer("3533083032",{disableExposureLog:!0});return r?n==null?!1:Date.now()/1e3-n.created<i.get("new-user-age-seconds",14*24*60*60)&&a.get("web-enable-for-new-users",!1):o<i.get("new-user-message-count",20)&&a.get("web-enable-for-new-users",!1)},zr=({clientThreadId:t,limit:s,shouldBeEnabledForDefaultAssistant:n,isModelLoaded:o,modelSlug:r})=>{const a=Ve(),i=fr(),c=K(),{clearAllSystemHintModeTriggers:l}=fe(),u=Z(t,A=>A?.mode),m=hn(u?.kind===Ee.GizmoInteraction?u.gizmo_id:void 0).data,{gizmoEditorData:p,mode:f}=rs(),x=df(),g=ll(u),S=Ne(),v=x&&n&&!g&&!S?.isEnterprisey(),{data:k,isSuccess:b}=Zi({...uf(s,r),enabled:v});if(i==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&p)return{promptStarters:ia(p)??[],isLoading:!1,isSuccess:!0};if(m!=null)return{promptStarters:ia(m),isLoading:!1,isSuccess:!0};if(!v)return{promptStarters:[],isLoading:!1,isSuccess:!0};const y=k?.items.map(A=>({type:xe.Starter,id:A.id,title:A.title,body:A.description,prompt:A.prompt,category:A.category,oneliner:A.oneliner,theme:A.theme,requires_file_upload:A.requires_file_upload}))??[],_=(A,P,I,O)=>{if(P.type===xe.Starter&&P.category==="dalle"){requestAnimationFrame(()=>{l(),a.addSystemHint(j.PictureV2,c.formatMessage({id:"rh3NHv",defaultMessage:"Create image"})),a.focus()}),a.setAutocompletions(Gr(c));return}const h=P.title;a.setAutocompletions([]),a.focus(),a.setText(h),requestAnimationFrame(()=>{const T=y.filter(D=>D.theme===P.theme).map(D=>{const F=sm(D.oneliner),U=F.startsWith(D.title);return{...D,title:U?`${D.title} `:"",body:U?D.body:F,autocompletionChunks:rf(h,F),type:xe.Autocomplete}});a.setAutocompletions(T),T.length>0&&Ys(T,t),ml(P,O,t)})},w=y?.reduce((A,P)=>(P.theme&&!A[P.theme]&&(A[P.theme]=P),A),{}),R=[];if(w)for(const A in w)A!=="For you"&&R.push(w[A]);const M=R.length>0,E=!!(b&&M&&o);return st.markStart("StarterPromptChips",st.NS_COMPOSER),E&&st.markRendered("StarterPromptChips",st.NS_COMPOSER),{onSelectStarterPrompt:_,shouldShowStarterPrompts:E,promptStarters:R}};function ca({clientThreadId:t,onClick:s}){d.useEffect(()=>{hl(t)},[t]);const n=K();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Ba,{onClick:()=>{xl(t),s()},label:n.formatMessage(hf.moreStarterPrompts)})})}function mf({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:r}){const a=t.theme??t.title,i=ha(),{mutate:c}=fl(),l=t.category==="onboarding"?u=>{c({key:le.hasUsedConversationalOnboardingStarterPrompt}),i(u,t,s,n)}:u=>r?.(u,t,s,n);return e.jsx(Ba,{disabled:o,onClick:l,icon:e.jsx(gl,{category:t.category,useV2Colors:!0}),label:a})}const pf=5,ff=3;function Wr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:r,mobileLayout:a=!1}){const i=a?ff:pf,[c,l]=d.useState(i),[u,m]=d.useState(!1),p=d.useRef(null),f=t.length<=c;d.useEffect(()=>{Ys(t.slice(0,i),o)},[o]),d.useEffect(()=>{if(!u&&!f&&p.current){const g=p.current,S=g.getBoundingClientRect(),v=S.width,k=Array.from(g.children);let b=0;for(let y=0;y<k.length&&k[y].getBoundingClientRect().right-S.left<=v;y++)b++;l(b),m(!0)}},[t,f,u]);const x=()=>{const g=t.slice(c,t.length).map(S=>({...S,isAdditional:!0}));g.length>0&&Ys(g,o),l(t.length),r()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:$("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",u&&t.length>0?"opacity-100":"opacity-[0.01]",a?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:$("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",f||a?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:p,children:[t.slice(0,c).map((g,S)=>e.jsx(se.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(mf,{starterPrompt:g,starterPrompts:t,index:S,disabled:n,onSelectStarterPrompt:s})},g.id??S)),a&&t.length>c&&e.jsx(ca,{clientThreadId:o,onClick:x})]}),!a&&t.length>c&&e.jsx(ca,{clientThreadId:o,onClick:x})]})}const mh=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,r]=d.useState(!1),a=Nn(),{prospectiveModelId:i}=is(t),c=n?s:i??"auto",{promptStarters:l,shouldShowStarterPrompts:u,onSelectStarterPrompt:m}=zr({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:c});return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:$(!o&&"h-[116px]"),children:u&&l&&e.jsx(Wr,{starterPrompts:l,onSelectStarterPrompt:m,disabled:a,clientThreadId:t,onExpand:()=>r(!0),mobileLayout:!0})})},gf=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=ve(),[r,a]=d.useState(!1),i=pl(),c=Nn(),{prospectiveModelId:l}=is(s),u=n?t:l??"auto",{promptStarters:m,shouldShowStarterPrompts:p,onSelectStarterPrompt:f}=zr({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:u});return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:$("hidden min-h-[108px] max-w-full",i?"@lg/thread:block":"lg:block",o&&r?"":"h-[70px]"),children:p&&m&&e.jsx(Wr,{starterPrompts:m,onSelectStarterPrompt:f,disabled:c,clientThreadId:s,onExpand:()=>a(!0)})})},hf=Se({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),la=vn.div`m-8 flex flex-col items-center`;function ua(t){return e.jsx(se.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function xf({clientThreadId:t}){const n=Z(t,r=>r?.promptGptRating)?.gizmoId,{data:o}=hn(n);return n==null||o==null||!Sl(o)?null:e.jsx(Sf,{gizmoId:n})}function Sf({gizmoId:t}){const[s,n]=d.useState(!1),[o,r]=d.useState(!1),a=yl(t),i=async l=>{n(!0),setTimeout(()=>{r(!0)},5e3),N.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await a.mutateAsync({rating:l})},c=async()=>{r(!0),N.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await a.mutateAsync({})};return d.useEffect(()=>{o||N.logEvent("Show Inline Rating",{gizmo_id:t})},[o,t]),o?null:s?e.jsx(la,{children:e.jsxs(ua,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(B,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Qs,{onClick:()=>{r(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(B,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(la,{children:e.jsxs(ua,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(B,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Qs,{onClick:c})]}),e.jsx(bl,{rating:void 0,onRating:i})]})})}const Vr=vn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function yf(){const{data:t,isLoading:s}=_l({cutId:"recent",limit:8}),{data:n,isLoading:o}=wl();return{isLoading:s||o,recent:t,pinned:n}}function bf({query:t,onSelectGizmo:s,selectedIdx:n},o){const r=Da(),a=d.useRef([]),{isLoading:i,recent:c,pinned:l}=yf();d.useImperativeHandle(o,()=>({handleEnterOnIndex:p=>{if(!m[p])return p<u.length?u[p].resource:"create"},getResultsLength:()=>u.length+1,scrollToItem:p=>{const f=a.current[p];f&&f.scrollIntoView({behavior:"instant",block:"nearest"})}}));let u=[];if(i)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Bn,{})});c&&u.push(...c.pages.flatMap(p=>p.list.items).map(p=>({resource:p.resource,from:"recent"}))),l&&u.push(...l.items.map(p=>({resource:p,from:"pinned"}))),u=Cl(u,p=>p.resource.gizmo.id);const m=u.map(p=>p.resource.gizmo.tags?.includes(cs.WorkspaceDisabled));return t&&t!==""&&(u=u.filter(p=>(p.resource.gizmo.display.name.toLowerCase()+p.resource.gizmo.display.description?.toLowerCase()+p.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[u.map((p,f)=>e.jsx("div",{ref:x=>{a.current[f]=x},tabIndex:f,onClick:()=>{m[f]||s(p.resource)},children:e.jsx(vf,{gizmoResource:p.resource,from:p.from,showDescription:r,isSelected:n===f,grayedOut:m[f]})},p.resource.gizmo.id)),e.jsx("div",{ref:p=>{a.current[u.length]=p},tabIndex:u.length,onClick:()=>{s("create")},children:e.jsx(_f,{isSelected:n===u.length})},"create")]})}const Cf=d.forwardRef(bf),_f=({isSelected:t})=>e.jsx(Vr,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(tc,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(La,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(B,{...Kr.dropdownCreateLabel})})]})}),wf=({onClick:t,onClose:s})=>{const[n,o]=d.useState(null),r=d.useRef(null),a=d.useRef(null),[i,c]=d.useState(0),l=K(),u=m=>{N.logEvent("Mentions Click Gizmo",{gizmo_id:m==="create"?"create":m.gizmo.id}),m!=="create"&&t(m)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(Kr.searchPlaceholder),ref:r,onKeyDown:m=>{if(m.nativeEvent.isComposing)return;const p=a.current?.getResultsLength()??0;if((m.key==="Escape"||m.key==="Backspace"&&!n)&&(m.preventDefault(),s()),m.key==="Enter"||m.key==="Tab"){m.preventDefault();const f=a.current?.handleEnterOnIndex(i);if(!f)return;f==="create"?(window.open("/gpts/editor","_blank"),s()):u(f)}if(m.key==="ArrowDown"&&i<p-1){m.preventDefault();const f=i+1;a.current?.scrollToItem(f),c(f)}if(m.key==="ArrowUp"&&i>0){m.preventDefault();const f=i-1;a.current?.scrollToItem(f),c(f)}},onChange:m=>{o(m.target.value),c(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Cf,{ref:a,query:n,selectedIdx:i,onSelectGizmo:u})]})},da=({onClick:t,onClose:s})=>{const n=gr(),o=!!n;return Ra(()=>{N.logEvent("Mentions Opened",{gizmo_selector_disabled:o})}),o?e.jsx(Lr,{clientThreadId:Zs,rateLimitInfo:n}):e.jsx("div",{onBlur:r=>{r.currentTarget.contains(r.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(wf,{onClick:t,onClose:s})})};function vf({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:r}){const a=!!t.gizmo.tags?.includes(cs.FirstParty);return e.jsxs(Vr,{className:$(o?"bg-token-main-surface-secondary":"",r&&"opacity-50"),children:[e.jsx(kr,{isFirstParty:a,src:t.gizmo.display.profile_picture_url,className:$("icon-xl h-7 w-7 shrink-0",r&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(vl,{className:"icon-sm"}):e.jsx(kl,{className:"icon-sm"})})]})]})}const Kr=Se({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function ns(t){const n=it().has(j.Research),o=Ia();return Z(t,a=>{if(!n||!o)return{state:"disabled",shouldShowResearchText:!1};const i=ee.getConversationTurns(a),c=i.filter(p=>p.role===Dn.User),l=am(c);let u=0;for(let p=c.length-1;p>=0&&c[p].messages.some(x=>x.metadata?.system_hints?.includes(j.Research));p--)u++;const m=c.some(p=>p.messages.some(f=>f.metadata?.system_hints?.includes(j.Research)));if(i.length===0||!m)return{state:"initial",shouldShowResearchText:!0};if(l?.messages.some(p=>p.metadata?.system_hints?.includes(j.Research))){const p=i.findIndex(x=>x===l);return i.filter((x,g)=>g>p&&x.messages.some(S=>S.metadata?.b1de6e2_rm)).length>0?{state:"recurrent",shouldShowResearchText:!0}:u%2===0?{state:"running",shouldShowResearchText:!1}:{state:"clarify",shouldShowResearchText:!1}}return{state:"recurrent",shouldShowResearchText:!0}})}const On=({as:t="div",children:s,isSelected:n=!1,...o})=>{const r=t==="div"?se.div:se.button;return e.jsx(r,{"data-is-selected":n||void 0,"data-pill":!0,className:"composer-btn",...o,children:s})};function kf({systemHints:t,composerController:s,clientThreadId:n}){const o=Fn(s),r=t.find(({systemHint:c})=>c===o),{isUnauthenticated:a}=ve(),{setThreadSystemHintMode:i}=fe();return d.useEffect(()=>{o&&!t.some(({systemHint:c})=>c===o)&&!a&&i(o,!1,{clientThreadId:n})},[n,i,o,t,a]),r?e.jsxs("div",{"data-testid":"active-system-hint-pill",className:"[view-transition-name:var(--vt-composer-active-system-hint-pill) flex items-center gap-1.5 ps-0.5",children:[e.jsx("div",{"data-separator":!0,className:"bg-token-border-default h-[13px] w-px"}),e.jsx(Af,{activeSystemHint:r,onClick:()=>{i(r.systemHint,!1,{clientThreadId:n})}})]},"active-hint-tag"):null}const Af=({activeSystemHint:t,onClick:s})=>e.jsx($r,{systemHint:t,onClick:s,showCloseButton:!0,isSelected:!0});function $r({systemHint:t,onClick:s,showCloseButton:n=!0,isSelected:o=!1}){const r=K();return e.jsxs(On,{as:"button",onClick:s,spacing:"compact",isSelected:o,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Fa,{hint:t,isNextToLabel:!0}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:t.shortLabel??t.name}),n&&e.jsx(rm,{className:"icon-sm -ms-0.5 mt-px @max-[521px]/thread:ms-1","aria-label":r.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.shortLabel??t.name})})]})}const Un=({pressed:t,disabled:s,icon:n,label:o,ariaLabel:r,animatedLabel:a,showLabel:i,onClick:c,splitButtonDropdownContent:l,showSplitButton:u=!0,dropdownContent:m,dataTestid:p,splitSecondaryButton:f,tooltip:x,as:g="popover"})=>{const[S,v]=d.useState(!1),[k,b]=d.useState(!1),y=sc(),_=!s&&t,w=o&&e.jsx("div",{className:$("[display:var(--force-hide-label)] ps-1 pe-1 whitespace-nowrap"),children:o}),R=e.jsxs("button",{className:$("flex h-full min-w-8 items-center justify-center p-2",{"pe-1.5":!!l}),"data-testid":p,"aria-pressed":t,"aria-label":r,disabled:s,onTransitionEnd:()=>b(!1),onClick:D=>{m||(b(!0),c(D))},children:[n,!a&&i?w:null,a&&e.jsx(nt,{initial:!1,children:i&&e.jsx(se.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:y?0:.15},children:w})})]}),M=x?x(R):R,E=S?e.jsx(Ml,{className:"icon"}):e.jsx(jl,{className:"icon"}),P=y?Al:{opacity:{delay:.1},default:{type:"tween",duration:.15,ease:"easeInOut"}},I=l||m?g==="popover"?e.jsx(Sn,{children:e.jsx(cn,{className:"p-0",$as:yn,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:m??l})}):e.jsx(H.Portal,{children:e.jsx(H.Content,{children:m??l})}):null,O=g==="popover"?e.jsx(Js,{asChild:!0,children:M}):e.jsx(H.Trigger,{asChild:!0,children:M}),h=g==="popover"?e.jsx(Js,{asChild:!0,children:e.jsx("button",{className:"border-token-border-default border-s p-2",style:{borderColor:_?"#0285FF0D":void 0},disabled:s,children:E})}):e.jsx(se.div,{initial:{width:0,opacity:0,padding:0},animate:{width:"auto",opacity:1,padding:"0.5rem"},exit:{width:0,opacity:0,padding:0,borderInlineStart:"unset"},transition:P,style:{overflow:"hidden",border:"unset",borderInlineStart:"solid 1px",borderColor:_?"#0285FF0D":"var(--border-default)"},children:e.jsx(H.Trigger,{asChild:!0,children:e.jsx("button",{style:{padding:0,backgroundColor:"transparent",height:"100%",borderRadius:"unset",color:_?"var(--interactive-label-accent-default)":void 0},disabled:s,children:E})})}),T=e.jsxs("div",{className:$("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",{"duration-75 motion-safe:transition-all":k,"text-token-text-secondary":!t,"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!_,"border-token-border-default can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white":!_,"opacity-30":s}),children:[m?O:M,e.jsx(nt,{children:!m&&l&&u?h:null}),f]});return l||m?g==="popover"?e.jsxs(xn,{onOpenChange:D=>v(D),children:[e.jsx(Ha,{asChild:!0,children:T}),I]}):e.jsxs(H.Root,{onOpenChange:D=>v(D),children:[T,I]}):T};var ye=(t=>(t.Hover="hover",t.Enable="enable",t.Disable="disable",t))(ye||{});function Mf(t){const s=bn(),n=ue(t);return!n.isLoading&&n.eligible&&!s}function jf(t,s){const n=Rl(),o=El(),r=ds(s);return Mf(t)&&!n&&!r&&!o}const Rf=new Map([[j.Search,{hover:["Composer Search Button Hovered","composer_search_button_hovered"],enable:["Composer Search Button Clicked","composer_search_button_clicked"],disable:["Composer Search Button Clicked","composer_search_button_clicked"]}],[j.Think,{hover:["Composer Think Button Hovered","composer_think_button_hovered"],enable:["Composer Think Button Enabled","composer_think_button_enabled"],disable:["Composer Think Button Disabled","composer_think_button_disabled"]}],[j.Research,{hover:["Composer Research Button Hovered","composer_research_button_hovered"],enable:["Composer Research Button Enabled","composer_research_button_enabled"],disable:["Composer Research Button Disabled","composer_research_button_disabled"]}],[j.PictureV2,{hover:["Composer Create Image Button Hovered","composer_create_image_button_hovered"],enable:["Composer Create Image Button Enabled","composer_create_image_button_enabled"],disable:["Composer Create Image Button Disabled","composer_create_image_button_disabled"]}]]);function Ef(t,s,n){const[o,r]=Rf.get(t)?.[s]??[];o&&r&&N.logEventWithStatsig(o,r,{clientThreadId:n})}const qr=({text:t})=>e.jsx("span",{children:t}),Pf=({remaining:t,reset_date:s,text:n})=>{const{locale:o}=K(),r=Dm(s,o);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(B,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:r}})}),e.jsx(qr,{text:n})]})};function ma({children:t,isDisabled:s,disabledReason:n,logEvent:o}){const r=K(),a=Ln(),i=hr(m=>m.bySystemHint(j.Research)),c=r.formatMessage({id:"SpX/tG",defaultMessage:"Get a detailed report"});let l=null;i&&i.remaining?l=e.jsx(Pf,{remaining:i.remaining,reset_date:i.reset_after,text:c}):l=e.jsx(qr,{text:c});const u=n===Zt.DeepResearchHighLoad?r.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===Zt.RateLimitReached&&a?r.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:a.resets_after_text}):void 0;return e.jsx(we,{className:"inline-block",label:s?u:l,side:"bottom",onOpenChange:m=>{m&&o(ye.Hover)},children:t})}function Tf({clientThreadId:t,repoSelectorOpen:s,linkId:n,triggerButton:o,setRepoSelectorOpen:r}){const{selectedRepos:a,setSelectedRepos:i}=Cn(t),{addSource:c}=ct(t),[l,u]=d.useState(""),m=f=>{let x=[],g=!1;f==="$all_accessible_repos"?(g=!a?.selectedAllRepos,i({selectedRepos:[],selectedAllRepos:g})):a?.selectedRepos?.includes(f)?(x=a.selectedRepos?.filter(S=>S!==f),i({selectedRepos:x,selectedAllRepos:!1})):(x=[...a?.selectedRepos??[],f],i({selectedRepos:x,selectedAllRepos:!1})),(g||x.length>0)&&c(je.GITHUB_CONNECTOR)};if(!n)return null;const p=Oa(a);return e.jsxs(H.Sub,{open:p?s:!0,onOpenChange:f=>{p&&r(f)},children:[e.jsx(H.SubMenuTrigger,{className:"ps-4",icon:Pl,children:o}),e.jsx(H.Portal,{children:e.jsx(H.SubContent,{children:e.jsx(Tl,{searchTerm:l,setSearchTerm:u,selectedRepos:{selectedRepos:a.selectedRepos?[...a.selectedRepos]:[],selectedAllRepos:a.selectedAllRepos},handleSelectRepo:m,linkId:n})})})]})}const Nf=30,Bf=25,Ks=6,Df=t=>{const n=t.some(o=>!o.disabled)?t.filter(o=>!o.disabled):[...t];return n.sort((o,r)=>o.connected&&!r.connected?-1:!o.connected&&r.connected?1:o.type==="web"&&r.type!=="web"?-1:o.type!=="web"&&r.type==="web"?1:o.name.localeCompare(r.name)),n},Yr=t=>If[t.user_connection_details.connection_type]??t.connection_display_info.display_name,Jr=t=>`${Yr(t)} || ${t.connection_display_info.display_name}`,Xr=({isLoading:t=!1,clientThreadId:s,enabledConnectors:n,includeWebSearch:o=!0,includeSyncConnectors:r=!1,connectorConfigMap:a,fetchValidLinksOnly:i})=>{"use forget";const c=K(),{selectedSources:l,selectedMCPSources:u,toggleSource:m}=ct(s),{connectorLinks:p,isLoading:f}=Bl({fetchValidLinksOnly:i}),{connectionInstanceData:x,refetch:g,isLoading:S}=at({skip:!r}),v=d.useMemo(()=>x?.connection_statuses??[],[x]),k=d.useMemo(()=>new Set(v.map(A=>A.user_connection_details.connection_type).filter((A,P,I)=>I.indexOf(A)!==P)),[v]),{enabledConnectors:b,connectorConfigMap:y,connectorLinks:_}=d.useMemo(()=>{if(!r)return{enabledConnectors:n,connectorConfigMap:a,connectorLinks:p};const A=Yo[je.GDRIVE_ACTION_CONNECTOR],P=p.has(A),I=v.some(D=>D.user_connection_details.connection_type==="gdrive_sync_connector"),O=[...n],h=new Map(a),T=new Map(p);return P&&!O.some(D=>D.type===je.GDRIVE_ACTION_CONNECTOR)&&!I&&(O.push({id:Yo[je.GDRIVE_ACTION_CONNECTOR],type:je.GDRIVE_ACTION_CONNECTOR,name:"Google Drive",description:"",logo_url:Dl,connector_type:"SERVICE",service:"",base_url:null,actions:[],supported_auth:[],owners:[],access_list:[]}),h.set(je.GDRIVE_ACTION_CONNECTOR,{disabled:!0,disabledText:c.formatMessage(Ct.contactAdmin),hasBetaTag:!1}),T.delete(A)),{enabledConnectors:O,connectorConfigMap:h,connectorLinks:T}},[r,p,v,n,a,c]),{connectedRows:w,disconnectedRows:R}=d.useMemo(()=>{const A=[];o&&A.push({connected:!0,type:"web",name:"web",element:e.jsx(H.CheckboxItem,{icon:_n,checked:l?.has("web"),onCheckedChange:()=>{m("web")},children:c.formatMessage(Ct.webSearch)})}),r&&v.forEach(h=>{A.push({connected:h.user_connection_details.auth_status!=="not_connected"&&h.user_connection_details.activation_status!=="inactive",type:"sync",name:Jr(h),element:e.jsx(Hf,{connection:h,isSelectedInSource:l?.has(h.user_connection_details.connection_type)??!1,toggleSource:m,location:"user_dropdown",refetch:g,showDetails:k.has(h.user_connection_details.connection_type),disabled:y?.get("sync_connector")?.disabled,disabledText:y?.get("sync_connector")?.disabledText},h.user_connection_details.connection_instance_id)})}),l&&b.forEach(h=>{const D=!!_.get(h.id)?.[0];if(h.type===ts.MCP_CONNECTOR)A.push({connected:D,type:"access",name:h.name,element:e.jsx(Ff,{connector:h,connectorLinks:_,selectedMCPSources:u,toggleSource:m})});else{let F=y?.get(h.type)?.disabled,U=y?.get(h.type)?.disabledText;h.status==="DISABLED_BY_ADMIN"&&(F=!0,U=c.formatMessage(Ym.disabledByAdmin)),A.push({connected:D,disabled:F,type:"access",name:h.name,element:e.jsx(Lf,{connector:h,connectorLink:_.get(h.id)?.[0],isSelectedInSource:l.has(h.type)??!1,toggleSource:m,clientThreadId:s,disabled:F,disabledText:U,hasBetaTag:y?.get(h.type)?.hasBetaTag})})}});const P=Df(A),[I,O]=P.reduce(([h,T],D)=>D.connected?[[...h,D],T]:[h,[...T,D]],[[],[]]);return{connectedRows:I,disconnectedRows:O}},[o,r,l,c,m,v,g,k,y,b,_,u,s]);if(!s||!l)return null;if(S||f||t)return e.jsx("div",{className:"w-50 px-4",children:e.jsx(Ar,{lines:5,size:"lg",widthVariance:0,width:100})});const M=Ks-w.length,E=w.length>Ks;return e.jsxs("div",{className:"w-70",children:[e.jsx("div",{className:$(E&&"border-token-border-secondary mb-1.5 border-b","overflow-y-auto"),style:E?{maxHeight:`calc(2.25rem * ${Ks+.5})`}:void 0,children:w.map(({element:A})=>e.jsx(e.Fragment,{children:A}))}),R.length>0&&M>0&&e.jsx(e.Fragment,{children:R.slice(0,M).map(({element:A})=>e.jsx(e.Fragment,{children:A}))}),e.jsx(H.Item,{icon:Ga,onSelect:()=>{N.logEventWithStatsig("chatgpt_connectors_dropdown_connect_more_clicked","chatgpt_connectors_dropdown_connect_more_clicked"),window.location.hash="#settings/ConnectorSettings"},children:c.formatMessage(Ct.connectApps)})]})},pa=({isLoading:t=!1,clientThreadId:s,enabledConnectors:n,trigger:o,includeWebSearch:r,includeSyncConnectors:a=!1,connectorConfigMap:i,fetchValidLinksOnly:c})=>{const{deleteSource:l}=ct(s);return e.jsxs(H.Root,{"data-testid":"sources-pill",onOpenChange:u=>{u||(Oa(Nl(_e(s)))||l(je.GITHUB_CONNECTOR),_e(s)?.selectedSources?.size===0&&Me(s,f=>{f.selectedSources=void 0}))},children:[o,e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-7,size:"auto",children:e.jsx(Xr,{isLoading:t,clientThreadId:s,enabledConnectors:n,includeWebSearch:r,includeSyncConnectors:a,connectorConfigMap:i,fetchValidLinksOnly:c})})})]})},Yt=3,fa=t=>{"use forget";const s=an.c(30),{clientThreadId:n,includeSyncConnectors:o,includeWebSearch:r}=t,{selectedSources:a}=ct(n),{availableConnectors:i}=qm(),c=!o;let l;s[0]!==c?(l={skip:c},s[0]=c,s[1]=l):l=s[1];const{connectionInstanceData:u}=at(l);let m;s[2]!==r||s[3]!==a?(m=r&&a?.has("web")?e.jsx(_n,{className:"icon-md"}):void 0,s[2]=r,s[3]=a,s[4]=m):m=s[4];const p=m;let f;s[5]!==a?(f=a??[],s[5]=a,s[6]=f):f=s[6];let x;if(s[7]!==i||s[8]!==u?.connection_statuses||s[9]!==o||s[10]!==a||s[11]!==f){const E=[...f].filter(Of).map(P=>{const I=i.find(O=>O.type===P);return I?{name:I.name,icon:e.jsx(wn,{connector:I,size:"xsmall"})}:null}).filter(Uf),A=o?Array.from(new Map((u?.connection_statuses??[]).filter(P=>["activated","partially_activated"].includes(P.user_connection_details.activation_status)&&a?.has(P.user_connection_details.connection_type)).map(Gf)).values()):[];x=[...E,...A],x.sort(zf),s[7]=i,s[8]=u?.connection_statuses,s[9]=o,s[10]=a,s[11]=f,s[12]=x}else x=s[12];let g;s[13]!==p?(g=p?[p]:[],s[13]=p,s[14]=g):g=s[14];let S;s[15]!==x?(S=x.map(Wf),s[15]=x,s[16]=S):S=s[16];let v;s[17]!==g||s[18]!==S?(v=[...g,...S],s[17]=g,s[18]=S,s[19]=v):v=s[19];const k=v;let b;s[20]!==k?(b=k.length>Yt?[...k.slice(0,Yt-1),e.jsx("span",{className:"text-token-text-secondary bg-token-bg-secondary text-caption-regular flex h-4.5 w-4.5 items-center justify-center rounded-full",children:k.length-Yt+1},"more")]:k,s[20]=k,s[21]=b):b=s[21];const y=b;let _;s[22]!==y?(_=y.length>0?e.jsx("div",{className:"flex items-center gap-1",children:y.map(Vf)}):e.jsx(Ua,{className:"icon-md"}),s[22]=y,s[23]=_):_=s[23];let w;s[24]!==y.length?(w=y.length<Yt&&e.jsx("span",{"data-label":!0,className:"ms-1.5",children:y.length===0?e.jsx(B,{id:"UjEzZf",defaultMessage:"Add sources"}):e.jsx(B,{id:"DhW8Wx",defaultMessage:"Sources"})}),s[24]=y.length,s[25]=w):w=s[25];let R;s[26]===Symbol.for("react.memo_cache_sentinel")?(R=e.jsx(Wa,{className:"icon-sm ms-1.5 @max-[521px]/thread:ms-1"}),s[26]=R):R=s[26];let M;return s[27]!==w||s[28]!==_?(M=e.jsx(H.BasicTrigger,{asChild:!0,children:e.jsxs(On,{as:"button",spacing:"compact",children:[_,w,R]})}),s[27]=w,s[28]=_,s[29]=M):M=s[29],M},Lf=({connector:t,clientThreadId:s,connectorLink:n,isSelectedInSource:o,toggleSource:r,disabled:a=!1,disabledText:i="",hasBetaTag:c=!1})=>{const l=K(),{selectedRepos:u}=Cn(s),[m,p]=d.useState(!1),f=d.useMemo(()=>{if(u?.selectedRepos?.length&&u?.selectedRepos?.length>=1){const w=u.selectedRepos;let R=w[0];if(R.length>Nf){const E=(Bf-3)/2;R=R.slice(0,Math.floor(E))+"..."+R.slice(Math.floor(-11))}const M=w.length-1;return M>0?`${R} +${M}`:R}},[u.selectedRepos]);if(t.type===ts.MCP_CONNECTOR)return null;const x=!!n,g=o&&x,S=t.type===je.GITHUB_CONNECTOR&&x&&g,v=Jm[t.type]?.title,k=v?l.formatMessage(v):t.name,b=e.jsx(wn,{connector:t,size:"xsmall"}),y=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:k}),c&&e.jsx(Il,{})]}),_=x?e.jsx(H.CheckboxItem,{disabled:a,label:y,icon:b,checked:g,onCheckedChange:()=>{r(t.type)}}):e.jsx(H.Item,{disabled:a,onSelect:()=>{window.location.hash=`#settings/ConnectorSettings?connector=${t.id}&add-connector-link=true`},label:y,icon:b,trailing:a?void 0:e.jsx("div",{className:"text-token-text-tertiary",children:l.formatMessage(Ct.connect)})});return e.jsxs(e.Fragment,{children:[a&&i?e.jsx(we,{label:i,side:"right",align:"center",contentClassName:"w-50",children:_}):_,S&&e.jsx(Tf,{clientThreadId:s,setRepoSelectorOpen:p,repoSelectorOpen:m,linkId:n?.id,triggerButton:f??l.formatMessage({id:"sDCihQ",defaultMessage:"Repositories"})},t.type)]})},If={github_sync_connector:"GitHub",gdrive_sync_connector:"Google Drive",notion_sync_connector:"Notion",slack_sync_connector:"Slack",merge_file_storage_sync_connector:"Merge File Storage"},Ff=({connector:t,connectorLinks:s,selectedMCPSources:n,toggleSource:o})=>{const r=K(),i=!!s.get(t.id)?.[0],c=n.has(t.id)&&i,l=t.name,u=e.jsx(wn,{connector:t,size:"xsmall"});return e.jsx(e.Fragment,{children:i?e.jsx(H.CheckboxItem,{icon:u,checked:c,label:l,onCheckedChange:()=>{o(t.id)}}):e.jsx(H.Item,{onSelect:()=>{window.location.hash=`#settings/ConnectorSettings?connector=${t.id}&add-connector-link=true`},icon:u,label:l,trailing:e.jsx("div",{className:"text-token-text-tertiary",children:r.formatMessage(Ct.connect)})})})},Hf=({connection:t,refetch:s,location:n,isSelectedInSource:o,toggleSource:r,showDetails:a,disabled:i=!1,disabledText:c=""})=>{const l=K(),[u,m]=d.useState(!1),[p,f]=d.useState(),x=()=>{r(t.user_connection_details.connection_type)},g=t.user_connection_details.connection_instance_id,S=rt(),v=fn(),k=t.user_connection_details.knowledge_connector_type,b=k==="google_drive_oauth",y=d.useCallback(async()=>{try{m(!0),await Ll({connectorType:k,connectionId:g,location:n,intl:l})}catch(T){T instanceof Error?S.danger(T.message):S.danger(l.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}finally{m(!1),s?.()}},[g,k,l,n,s,S]),[_,w]=d.useState(!1),R=()=>b?w(!0):y(),M=t.user_connection_details.activation_status==="inactive"&&t.user_connection_details.auth_status==="not_connected",E=["activating","partially_activated"].includes(t.user_connection_details.activation_status),A=M&&!v||E,P=e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"}),I=T=>{if(T.stopPropagation(),T.preventDefault(),M){R();return}if(E){f(t);return}},O={key:t.connection_display_info.display_name,disabled:i,icon:P,contentClassName:"flex-1 overflow-hidden",label:Yr(t),secondary:a?e.jsx("div",{className:"truncate",children:t.connection_display_info.display_name}):void 0};let h=null;switch(t.user_connection_details.activation_status){case"activated":h=e.jsx(H.CheckboxItem,{...O,checked:o,onCheckedChange:x});break;case"partially_activated":h=e.jsx(H.CheckboxItem,{...O,checked:o,onCheckedChange:x,trailing:e.jsxs("div",{className:"group-radix-disabled:opacity-50 flex items-center gap-1.5",children:[e.jsx(Ol,{connection:t,ignoreLabel:!0}),e.jsx(Ul,{checked:o,"aria-hidden":!0,size:"small"})]})});break;case"activating":h=e.jsx(H.Item,{...O,style:{cursor:A?void 0:"default"},onSelect:I,trailing:e.jsx("div",{className:"group-radix-disabled:opacity-50",children:e.jsx(Hl,{connection:t})})});break;case"inactive":h=e.jsx(H.Item,{...O,style:{cursor:A?void 0:"default"},onSelect:I,trailing:e.jsx("div",{className:"group-radix-disabled:opacity-50",children:u?e.jsx(Bn,{className:"icon-md"}):e.jsx(Fl,{connection:t,refetch:s,location:"user_dropdown"})})});break}return e.jsxs(e.Fragment,{children:[p&&e.jsx(za,{connection:p,onClose:()=>f(void 0)}),_&&e.jsx(Aa,{isAdminFlow:!1,onClose:()=>w(!1),connectionId:g,location:n,onSuccess:s}),i&&c?e.jsx(we,{label:c,side:"right",align:"center",contentClassName:"w-50",children:h}):h]})},Ct=Se({contactAdmin:{id:"JGCH/x",defaultMessage:"Contact your admin to enable Google Drive for chat"},allRepositories:{id:"EzHFPp",defaultMessage:"All Repositories"},connect:{id:"OODbh3",defaultMessage:"Connect"},sourcesEnabled:{id:"aEIPI+",defaultMessage:"On"},webSearch:{id:"XoUbAe",defaultMessage:"Web search"},sourcesDisabled:{id:"j32+iI",defaultMessage:"Off"},connectApps:{id:"wwlf43",defaultMessage:"Connect more"}});function Of(t){return t!=="web"}function Uf(t){return!!t}function Gf(t){return[t.user_connection_details.connection_type,{name:Jr(t),icon:e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"})}]}function zf(t,s){return t.name.localeCompare(s.name)}function Wf(t){return t.icon}function Vf(t,s){return e.jsx("div",{className:"icon flex items-center justify-center",children:t},s)}function Kf({clientThreadId:t,gizmoId:s,showLabel:n=!1,isDisabled:o,renderAsPill:r=!1}){const a=Gl(t,s),i=Ve(),c=ds(j.Research),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:u}=fe(),m=!!Ln(),{value:p}=Te("1416952492"),f=p?Zt.DeepResearchHighLoad:m?Zt.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${j.Research}-action)`},children:e.jsx($f,{composerController:i,isThreadInSystemHintMode:c,setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:u,clientThreadId:t,showLabel:n,isDisabled:o||!!f,disabledReason:f,renderAsPill:r})},`system-hint-${j.Research}`):null}function $f({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:o,clientThreadId:r,showLabel:a=!1,isDisabled:i=!1,disabledReason:c,renderAsPill:l=!1}){const u=K(),m={clientThreadId:r},{systemHints:p}=Ke(r),f=p.filter(_=>_.systemHint==="research"),x=u.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),g=_=>{_===ye.Hover?N.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",m):_===ye.Enable?N.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",m):_===ye.Disable&&N.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",m)},S=()=>{o(),n(j.Research,!s,m),s||(t.removeSystemHints(),t.focus()),g(s?ye.Disable:ye.Enable)},v=Te("3544641259")?.value,{availableConnectors:k,isLoading:b}=vr(),y=_=>e.jsx(ma,{disabledReason:c,isDisabled:i,logEvent:g,children:_});return l&&f.length===0?null:l&&f.length>0?e.jsx(ma,{disabledReason:void 0,isDisabled:!1,logEvent:g,children:e.jsx($r,{systemHint:f[0],onClick:S,showCloseButton:!1,isSelected:!1})}):e.jsx(Un,{pressed:s,disabled:i,icon:e.jsx(zl,{className:"icon"}),label:x,animatedLabel:!a,showLabel:a||s,onClick:S,ariaLabel:x,dataTestid:"composer-button-deep-research",splitButtonDropdownContent:v?e.jsx(Xr,{isLoading:b,clientThreadId:r,enabledConnectors:k,includeSyncConnectors:!1,includeWebSearch:!0,fetchValidLinksOnly:!0}):void 0,showSplitButton:s&&v,tooltip:y,as:v?"dropdown":"popover"})}const qf="https://openai.com/news/";function Yf({children:t,isDisabled:s,clientThreadId:n}){const o=K(),r=le.hasSeenPhoenixFreeNux,a=ue(r),i=jf("oai/apps/hasSeenPhoenixFreeNux",j.Think),c=Da(),l=pe(),u=vt(l,"3287425176").value,m=String(u?.blog_post_link??qf);return i?e.jsx(ls,{announcementKey:r,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",className:"xs:max-w-xs! max-w-2xs!",title:e.jsx(B,{id:"eQH8Xp",defaultMessage:"Upgraded to o4-mini"}),description:Jf(m),onDismiss:()=>{i&&a.markAsViewed()},sideOffset:0,align:c?"center":"start",alignOffset:c?0:-102,children:t}):e.jsx(we,{className:"inline-block",label:s?o.formatMessage({id:"Z1UTb8",defaultMessage:"Reason is unavailable"}):o.formatMessage({id:"JoBzEW",defaultMessage:"Think before responding"}),side:"bottom",onOpenChange:p=>{p&&N.logEventWithStatsig("Composer Think Button Hovered","composer_think_button_hovered",{clientThreadId:n})},children:t})}function Jf(t){return e.jsx(B,{id:"/9NlBr",defaultMessage:"Our latest reasoning model can search the web, use memory, write better code, and analyze images. {learnMore}",values:{learnMore:e.jsx(Va,{href:t,className:"underline",children:e.jsx(B,{id:"vRi34o",defaultMessage:"Learn more"})})}})}function Xf({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:o}){return Wl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${j.Think}-action)`},children:e.jsx(Qf,{clientThreadId:t,composerController:n,isDisabled:o})},`system-hint-${j.Think}`):null}function Qf({clientThreadId:t,composerController:s,isDisabled:n}){const o=K(),r=!!In();n=n||r;const a=o.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:c}=fe(),l=ds(j.Think),u=We.useStore(),m=ms(),{isUnauthenticated:p}=ve();d.useEffect(()=>{n&&m.has(j.Think)&&i(j.Think,!1,{clientThreadId:t})},[n,m,i,t]);const f=S=>{if(S.stopPropagation(),S.preventDefault(),p)return;let v=!0;u.getState().persistedSystemHints.has(j.Search)&&(v=!1),v&&c(),i(j.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?N.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):N.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},x=p?e.jsx(Sa,{location:j.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,g=e.jsx(Un,{pressed:l,disabled:n,icon:e.jsx(Vl,{className:"icon"}),label:a,ariaLabel:a,animatedLabel:!0,showLabel:!0,onClick:f,dropdownContent:x,dataTestid:"composer-button-reason"});return e.jsx(Yf,{isDisabled:n,clientThreadId:t,children:g})}const Zf=["o1","o1-pro","gpt-4"];function eg(t){"use forget";const s=an.c(15),{account:n,clientBootstrapFlags:o,features:r,clientThreadId:a,currentModelConfig:i,composerController:c,isDisabled:l,gizmoId:u}=t,{prospectiveModelId:m}=is(a),p=as(a),f=Ka(u),{userIsInSearchHoldoutWithWebDisabled:x}=Kl();let g;s[0]!==i?.enabledTools?(g=i?.enabledTools?.includes(xr.Search),s[0]=i?.enabledTools,s[1]=g):g=s[1];const S=g,v=p==null||p?.kind===Ee.PrimaryAssistant||p?.kind===Ee.GizmoInteraction&&f,{isUnauthenticated:k}=ve(),b=im(j.Search),y=!k&&(n==null||n.isFree());if(S===!1||k&&o?.includes(es.AnonSearchHoldout)||y&&(o?.includes(es.FreeSearchHoldout)||x)||!b||!k&&(n==null||n.isEnterprisey())&&!r?.includes(cm.BrowsingAvailable)||!v)return null;let w;s[2]===Symbol.for("react.memo_cache_sentinel")?(w={viewTransitionName:`var(--vt-composer-${j.Search}-action)`},s[2]=w):w=s[2];let R;s[3]!==n||s[4]!==k||s[5]!==S||s[6]!==m?(R=S??(k||n?.isFree()||!!m&&!Zf.includes(m)),s[3]=n,s[4]=k,s[5]=S,s[6]=m,s[7]=R):R=s[7];const M=S?void 0:$a.ModelNotSupported,E=i?.title??"";let A;return s[8]!==a||s[9]!==c||s[10]!==l||s[11]!==R||s[12]!==M||s[13]!==E?(A=e.jsx("div",{"data-testid":"system-hint-search",style:w,children:e.jsx(tg,{clientThreadId:a,composerController:c,modelSupportsSearch:R,isDisabled:l,disabledReason:M,currentModelName:E})},`system-hint-${j.Search}`),s[8]=a,s[9]=c,s[10]=l,s[11]=R,s[12]=M,s[13]=E,s[14]=A):A=s[14],A}function tg({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:o,currentModelName:r,modelSupportsSearch:a}){"use forget";const i=K(),c=Lm(),l=i.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=fe(),p=We.useStore(),f=ms();n=n||!a,d.useEffect(()=>{n&&f.has(j.Search)&&u(j.Search,!1,{clientThreadId:t})},[n,f,u,t]);const x=g=>{g.stopPropagation(),g.preventDefault();let S=!0;p.getState().persistedSystemHints.has(j.Think)&&(S=!1),S&&m(),u(j.Search,!c,{clientThreadId:t}),c||(s.removeSystemHints(),s.focus()),N.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),c&&s.trimLeadingText(/^search\b/i)};return e.jsx(ng,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:c,isDisabled:n,disabledReason:o,currentModelName:r,children:e.jsx(Un,{pressed:c,disabled:n??!1,icon:e.jsx(_n,{className:"icon"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:x,dataTestid:"composer-button-search"})})}function sg(){"use forget";const t=bn(),s=ue(le.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function ng(t){"use forget";const s=an.c(17),{children:n,analyticsMetadata:o,isThreadUsingSearchMode:r,isDisabled:a,disabledReason:i,currentModelName:c}=t,l=sg()&&!r,u=ue(le.hasSeenComposerSearchButtonTooltip);if(!l){let g;s[0]!==c||s[1]!==i||s[2]!==a?(g=a?i===$a.ModelNotSupported?e.jsx(B,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${c}`}}):e.jsx(B,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(B,{id:"c+4o2s",defaultMessage:"Search the web"}),s[0]=c,s[1]=i,s[2]=a,s[3]=g):g=s[3];let S;s[4]!==o?(S=k=>{k&&N.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",o)},s[4]=o,s[5]=S):S=s[5];let v;return s[6]!==n||s[7]!==g||s[8]!==S?(v=e.jsx("div",{children:e.jsx(we,{className:"inline-block",label:g,side:"bottom",onOpenChange:S,children:n})}),s[6]=n,s[7]=g,s[8]=S,s[9]=v):v=s[9],v}let m;s[10]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsx(B,{id:"Yjduqi",defaultMessage:"Search the web"}),s[10]=m):m=s[10];let p;s[11]===Symbol.for("react.memo_cache_sentinel")?(p=e.jsx(B,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Va,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(B,{id:"stA7F4",defaultMessage:"Learn more"})})}}),s[11]=p):p=s[11];let f;s[12]!==n?(f=e.jsx("div",{children:n}),s[12]=n,s[13]=f):f=s[13];let x;return s[14]!==f||s[15]!==u.markAsViewed?(x=e.jsx(ls,{announcementKey:le.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:m,onDismiss:u.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:p,children:f}),s[14]=f,s[15]=u.markAsViewed,s[16]=x):x=s[16],x}const og=5,ag=d.memo(function(s){return rg(s),ig(s),cg(),null});function rg(t){const{store:s}=me(),n=s.useSetSharedProps();en(()=>{n(t)},[t,n])}function ig(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=me(),r=d.useRef({top:o.useContentAreaApi(_t.HeaderTop),bottom:o.useContentAreaApi(_t.HeaderBottom)}).current,a=$l(s),{shouldShowBannerSignup:i,shouldShowBannerTermsDisclaimer:c}=lg(s),l=Lp(s,t.composerController),u=ql(t),m=Yl(t),p=bn(),f=Jl(),x=Xl(t),g=Op(s),S=Ql(t),v=Zl(s),k=eu(s),b=ep(),{eligible:y}=ue(tu),_=su(),w=nu(),R=ou(),M=au(),E=ru(s),A=iu(s),P=cu(),I=Vp(s),O=Rp(s),h=lu(s),T=Z(s,U=>U?.modelId),D=as(s),F=it();en(()=>{T&&D?.kind===Ee.GizmoInteraction&&D.gizmo&&uu(T,D.gizmo)?r.top.set(L.ProjectConversationTaskNoFileAccess):S.eligible?r.top.set(L.AdvancedVoiceOnMobileAnnouncement):c?r.top.set(L.BannerTermsDisclaimer):l?r.top.set(L.BannersRateLimit):P?r.top.set(L.BannerPlusUpsell):I?r.top.set(L.ContextualAnswersAdminUpsell):O?r.top.set(L.ContextualAnswersUserUpsell):v?r.top.set(L.JawboneAnnouncement):k?r.top.set(L.JawboneMaxActiveAnnouncement):u.eligible?r.top.set(L.BannerSidekickAnnouncement):p?r.top.set(L.MoonshineAnnouncement):f?r.top.set(L.CustomizeChatGPTAnnouncement):m?r.top.set(L.SearchBrowserExtensionAnnouncement):x?r.top.set(L.SearchBrowserExtensionReactiveAnnouncement):b?r.top.set(L.PromoRedemptionAnnouncement):y?r.top.set(L.OperatorAnnouncement):R?r.top.set(L.ReferralProgramUpsellAnnouncement):n?r.top.set(L.PromptTextareaAction):i?r.top.set(L.BannerSignup):g?r.top.set(L.BannerMemoryFull):_?r.top.set(L.ReferrerRedemptionAvailableAnnouncement):w?r.top.set(L.RefereeRedemptionAvailableAnnouncement):M?r.top.set(L.StudentsUpsellAnnouncement):E?r.top.set(L.ModelDeprecationBanner):A?r.top.set(L.TeamsContextualAnswersUpsell):h?r.top.set(L.LanguageUpsellBanner):r.top.set(null)},[r,F,n,c,i,l,u,g,S]),en(()=>{a&&r.bottom.set(Ta.DallePromptControls)},[r,a])}function cg(){const{store:t}=me();d.useEffect(()=>()=>{t.reset()},[t])}function lg(t){const{isUnauthenticated:s}=ve(),{layer:n}=Pe("3637408529",{shouldLogExposure:!1}),{layer:o}=Pe("3637408529"),r=o.get("no_auth_banner_signup_rate_limit",og),a=n.get("should_show_no_auth_signup_banner",!0),i=du(p=>p.bannerDisclaimerClientThreadId),c=mu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[u,m]=Z(t,p=>[ee.getConversationTurns(p).filter(f=>f.role===Dn.User).length,ug(ee.getCurrentNode(p)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=m&&s&&u===1&&!c&&(i==null||i===t),l.shouldShowBannerSignup=a&&m&&s&&u>0&&u%r===0),l}function ug(t){return t?.author.role===Dn.Assistant&&lm(t)}const dg=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of dm)s.push({category:n,systemHints:t.filter(o=>o.category===n)});return s};function mg({composerController:t,clientThreadId:s,onHintSelected:n}){const o=Sr(s),[r]=Z(s,T=>[T?.modelId]),{data:a}=yr(),i=r??pu(void 0).id,c=qa(a?.models,i),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:u}=fe(),{viewableSystemHints:m,persistedSystemHints:p,locked:f}=We.useState(({availableHints:T,persistedSystemHints:D,locked:F})=>({viewableSystemHints:T,persistedSystemHints:D,locked:F})),[x,g]=d.useState([]),[S,v]=d.useState(void 0),[k,b]=d.useState(0);d.useEffect(()=>{if(!S)g([]);else{const T=S.text.toLocaleLowerCase(),D=m.filter(U=>{const q=U.name.toLocaleLowerCase().startsWith(T),J=U.systemHint.toLocaleLowerCase().startsWith(T);let V=!1;return U.regexMatches&&U.regexMatches.length>0&&(V=U.regexMatches.some(G=>G.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(T))),q||J||V}).filter(U=>U.requiredFeatures.every(q=>c?.enabledTools?.includes(q))),F=dg(D).map(U=>U.systemHints).flat();g(F)}},[S]),d.useEffect(()=>{t.view.dispatch(Im(t.view.state.tr,{onHintMatch(T){v(D=>um(D,T)?D:T)}}))},[t]);const y=!m.length||!x.length||f||!S;d.useEffect(()=>{b(0)},[y]);const _=x.length,w=d.useCallback(T=>{b(D=>(T(D)%_+_)%_)},[_]),R=d.useCallback(()=>{b(-1)},[]),M=x[k],E=d.useCallback(()=>{S?.range&&t.delete(S.range.from,S.range.to)},[S,t]),A=({hintToSave:T=M,expectPerfectMatch:D})=>{if(!S||!M||D&&T.name.toLowerCase()!==S.text.toLowerCase())return!1;N.logEvent("System Hint Selected",{system_hint:T.systemHint,conversation_id:o??Zs});const F={clientThreadId:s};$t(t.view),p.size>0&&u();const U=T.systemHint===j.Search;return l(T.systemHint,!0,F,U?fu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),E(),t.removeSystemHints(),!0},P=d.useRef(A);P.current=A;const I=d.useRef(w);I.current=w;const O=d.useRef(S);O.current=S;const h=t.view;return d.useEffect(()=>(y||Fm(h,T=>{if(T==="up")I.current(D=>D-1);else if(T==="down")I.current(D=>D+1);else if(T==="cancel")$t(h),Hm(h);else if(T==="submit")if(n)E(),n(M.systemHint);else return $t(h),P.current({expectPerfectMatch:!1});else if(T==="checkMatch")return P.current({expectPerfectMatch:!0})}),()=>$t(h)),[y,h,M,n,E]),d.useEffect(()=>{y||N.logEvent("System Hint List Opened",{conversation_id:o??Zs})},[y]),{suggestorClosed:y,systemHintSuggestions:x,hintMatch:S,selectedIndex:k,resetSelectedIndex:R,setSelectedIndex:b,saveHint:A}}function pg({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:o,suggestorClosed:r,setSelectedIndex:a,saveHint:i}=mg({composerController:t,clientThreadId:s});return r?null:e.jsx(gu,{className:"max-w-60",onMouseDown:c=>{c.preventDefault()},children:o.map((c,l)=>e.jsx(hu,{as:"div",autoFocus:!1,className:"rounded-lg px-1 py-2",highlighted:l===n,onMouseOver:()=>a(l),onClick:()=>{i({hintToSave:c,expectPerfectMatch:!1}),t.focus()},children:e.jsx(fg,{title:c.name,description:c.description,logo:c.logo})},c.systemHint))})}function fg({title:t,description:s,logo:n,checked:o,badge:r}){const a=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(mm,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,r&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":a.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(B,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),o&&e.jsx(xu,{className:$("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function ga({composerController:t,clientThreadId:s}){return t instanceof Om?e.jsx(pg,{composerController:t,clientThreadId:s}):null}function gg({children:t,className:s,showBackground:n,showGlowingBorder:o}){return e.jsxs("div",{className:$("relative",o&&"overflow-clip rounded-full p-0.5"),children:[t,o&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx(se.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:$("pointer-events-none absolute inset-0 rounded-full",s)})]})}function hg(){const{connectorConfig:t}=Ya(),s=Qa(),[,n]=Ja(Xa([...t.values()],r=>!!r.access_token),r=>!!r.access_token);return{unconnectedConnectors:s?[]:n}}function xg({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:r,onOauthRedirect:a,uploadType:i,getInputProps:c,openFileDialog:l,isDisabled:u=!1,highlightTooltip:m=!1,showLabel:p,disabledReason:f,currentModelName:x,showMenuForNoAuth:g=!1}){const S=pm().locale,v=K(),k=rt(),b=dn(),y=us(),{connectorConfig:_,isLoading:w}=Ya(),R=ue(le.ContextConnectors),{getGizmoId:M}=rs(),E=Xm()?.enabled??!1,[A,P]=d.useState();d.useEffect(()=>{M?M().then(W=>P(W)):P(void 0)},[M]);const I=d.useRef(null),[O,h]=d.useState(!1),T=d.useRef(!1),D=d.useCallback(()=>{const W=I.current?.files;Array.from(W??[]).forEach(ge=>xt.uploadFile(b,ge,o,v,k,r))},[b,o,v,k,r]),[F,U]=d.useState(null),q=d.useCallback(()=>U(null),[U]),J=d.useCallback((W,ge)=>xt.uploadPickedFile(b,W,ge,o,n,r,A,v,k),[b,o,n,r,A,v,k]),{openMenu:V,confirmMenuOpened:G}=Su();d.useEffect(()=>{V&&(h(!0),G())},[V,G,h]);const[ae,Be]=d.useState(),$e=d.useCallback(W=>{if(W.type===St.GDRIVE&&E&&!ae){Be(W);return}xt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,W,a,Jo.Picker),a()},[E,ae,a]),kt=d.useCallback(W=>{xt.uploadPickedFile(b,W,St.GDRIVE,o,n,r,A,v,k)},[b,o,n,r,A,v,k]),De=d.useCallback(async W=>{const{access_token:ge}=W;if(!ge){$e(W);return}switch(xt.logAttemptIfAccessTokenIsExpired(W,Jo.Picker),W.type){case St.GDRIVE:yu(S,W.type,ge,Mt=>Mt.forEach(kt));break;case St.O365_PERSONAL:case St.O365_BUSINESS:U(W.type);break}},[kt,$e,U,S]),qe=()=>{N.logEvent("Open File Viewer",{intent:i.toString()}),l()},lt=W=>{if(!W&&T.current&&!w)qe();else if(W&&Ie&&!w&&!g){qe();return}h(W),W&&(R.eligible&&R.markAsViewed(),N.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),T.current=!0,setTimeout(()=>{T.current=!1},250))},[Le]=Ja(Xa([..._.values()],W=>!!W.access_token),W=>!!W.access_token);Sg(Le,De);const{unconnectedConnectors:ut}=hg(),{desktopConnectors:dt}=bu(o),mt=[...Le,...ut],Ie=!mt.length&&!dt.length,ps=e.jsxs(e.Fragment,{children:[mt.length>0&&e.jsx(Cu,{connectorEntries:mt,onConnectorClick:De,onOauthRedirect:$e}),w&&e.jsx(H.Item,{icon:e.jsx(Bn,{className:"text-token-text-secondary"})}),dt.map(W=>e.jsx(_u,{entry:W},W.key)),e.jsx(wu,{modelSupportedImageMimeTypes:o}),e.jsx(vu,{handleLocalFileUploadClick:qe,showMenuForNoAuth:g})]}),re=u||y!=null,Ye=d.useRef(!1),At=e.jsxs(H.Root,{open:O,onOpenChange:lt,children:[e.jsx(Rr,{clientThreadId:t,rateLimitPopup:y,highlightTooltip:m,disabled:re,disabledReason:f,currentModelName:x,children:e.jsxs(H.BasicTrigger,{className:"composer-btn",disabled:re,id:"upload-file-btn","aria-label":Er(v,re,f,x),children:[s,p&&e.jsx(xa,{})]})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-8,onEscapeKeyDown:()=>{Ye.current=!0},side:"bottom",size:"small",onCloseAutoFocus:W=>{Ye.current||W.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:ps})})]});return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(ku,{type:F,onClose:q,uploadPickedFile:J}),e.jsx("input",{onChange:D,...c({className:"hidden"})}),At,e.jsx(Au,{hasConnectors:!w&&!Ie}),ae&&e.jsx(Mu,{onClose:()=>Be(void 0),onContinue:()=>$e(ae)})]})}function Sg(t,s){const{connector:n,clearParam:o}=ju(),r=t.find(a=>a.type===n&&!!a.access_token);d.useEffect(()=>{r&&(s(r),o())},[r,s,o])}function yg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:r,getInputProps:a,openFileDialog:i,onOauthRedirect:c,historyDisabled:l,isDisabled:u,highlightTooltip:m,disabledReason:p,currentModelName:f,showLabel:x,showUpsell:g,hideBorder:S,isSmall:v,showMenuForNoAuth:k,visualTreatment:b,showGlowingBorder:y}){const _=Qa(),{gdriveStatus:w,o365Status:R}=Ru(),{isUnauthenticated:M}=ve(),E=l?"text-white":m?"text-brand-blue-800":"",A=!g&&(k||w!=="false"||R!=="false"||_),P=M?Eu:La,I=e.jsx(P,{"aria-label":"",className:$("icon-md",E)}),O=A?e.jsx(xg,{clientThreadId:t,icon:I,showLabel:M&&x,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:r,onOauthRedirect:c,uploadType:s,openFileDialog:i,getInputProps:a,isDisabled:u,highlightTooltip:m,disabledReason:p,currentModelName:f,showMenuForNoAuth:k}):e.jsx(xp,{isSmall:v,hideBorder:S,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:a,showLabel:x,showUpsell:g,icon:I,isDisabled:u,highlightTooltip:m,disabledReason:p,currentModelName:f,visualTreatment:b});return e.jsx(gg,{showBackground:m,showGlowingBorder:y,className:"bg-brand-blue-800/20",children:O})}const bg=d.forwardRef(function({type:s,placeholder:n,replyRegions:o,state:r,renderFiles:a,leftSideActions:i,topRightAction:c,onSubmit:l,setIsComposerOverflowing:u,inputState:m,composerController:p,clientThreadId:f,gizmoId:x,disableReason:g,matchaData:S},v){const k=Pu();let b=null;const{isLoading:y}=k;y||(b=k.modelId),d.useEffect(()=>{y||Tu()||p.focus()},[b,p,y]);const{state:_,shouldShowResearchText:w}=ns(f),R=d.useCallback(()=>e.jsx(Za,{useStartButtonText:_==="clarify"||!1,inputState:m,state:r,onSubmit:l,composerController:p,clientThreadId:f,gizmoId:x,disableReason:g}),[m,r,l,p,f,x,g,S,_]),{whisperControls:M,waveContainerRef:E}=jr({composerController:p,renderInComposer:R,composerType:"legacy"}),{controlsDisabled:A,waveformData:P,waveWidth:I}=Ge(p.store),O=h=>{Cg({target:h.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||p.focus()};return e.jsx(Nu,{id:"composer-background",ref:v,className:$("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:O,style:{viewTransitionName:"var(--vt-composer)"},children:e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(nt,{initial:!1,children:o.length>0&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(er,{replyRegions:o})})})}),e.jsxs(e.Fragment,{children:[a,e.jsx(nt,{initial:!1,children:e.jsx(cp,{enabled:w,composerController:p,children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:E,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:A?P?e.jsx(Bu,{waveform:P,containerWidth:I,scaleFactor:10,initialValue:lp}):null:e.jsx(up,{composerController:p,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:h=>{if(!("ResizeObserver"in window))return;const T=new AbortController;let D=window.innerWidth;const F=Du({axis:"width",debounce:!0,target:h,onChange:()=>{if(!h)return;h.scrollWidth>h.clientWidth?u?.(!0):Math.abs(D-window.innerWidth)>40&&(u?.(!1),D=window.innerWidth)}});return()=>{F?.(),T.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:i}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:M})]})]})]})})});function Cg({target:t,rootId:s,additonalInteractiveIds:n}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||n.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const _g=["o3-mini","o3-mini-high","o1-pro"];j.Search,j.Research;const wg=5,vg=({composerController:t,clientThreadId:s,disabled:n,isFinchEnabled:o})=>{const{prospectiveModelId:r}=is(s),{systemHints:a,activeSystemHints:i,isLoading:c}=Ke(s),l=hr(P=>P.bySystemHint(j.Research)),u=In(),m=Ln(),{value:p}=Te("1416952492"),f=Ne(),x=f?.isFree(),g=f?.isTeam()||f?.isBusiness(),S=i.filter(P=>!!(x||P.systemHint!==j.Think));if(x&&!S.find(P=>P.systemHint===j.Think)){const P=a.find(I=>I.systemHint===j.Think);P&&S.push(P)}const v=Fn(t),k=br(t,s),{clearAllSystemHintModeTriggers:b}=fe(),y=r&&_g.includes(r);if(S.length===0&&!c||y)return null;const w={clientThreadId:s};function R(){N.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",w)}function M(){N.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",w)}const E=P=>{switch(P){case j.Research:return!!m;case j.Think:return!!u;default:return!1}},A=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})};return e.jsx(Ag,{systemHints:S,selectedHint:v??void 0,disabled:n,onHover:R,onOpen:M,onSelect:k,isTeamOrBusiness:g,isFinchEnabled:o,clientThreadId:s,isDeepResearchHighLoad:p,getFeatureRateLimitIndicator:P=>{switch(P){case j.Research:return jg(l,g);case j.Think:return u?e.jsx(gn,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):null;default:return null}},hasFeatureRateLimit:E,setRateLimitBannerFeature:P=>{switch(P){case j.Research:case j.Think:E(P)?(b(),t.setRateLimitBannerFeature(P===j.Research?Xo.DEEP_RESEARCH:Xo.REASON)):t.setRateLimitBannerFeature(null);break;default:t.setRateLimitBannerFeature(null);break}},restoreFocus:A})},kg=[j.Slurm],Ag=({systemHints:t,selectedHint:s,disabled:n,isTeamOrBusiness:o,isFinchEnabled:r,onHover:a,onOpen:i,onSelect:c,clientThreadId:l,getFeatureRateLimitIndicator:u,isDeepResearchHighLoad:m,hasFeatureRateLimit:p,setRateLimitBannerFeature:f,restoreFocus:x})=>{const g=K(),[S,v]=d.useState(!1),k=tr(),b=!k&&s==null,y=s===j.Slurm,_=jn(),w=d.useRef(!1);d.useEffect(()=>{if(!S)return()=>{requestAnimationFrame(()=>{w.current=!1})}},[S]);const R=d.useRef(!1);return d.useEffect(()=>{r&&s!=null&&o&&_.find(M=>M.name===Qo(s))&&f(s)},[_,r,o,s,f]),e.jsxs(H.Root,{open:S,onOpenChange:M=>{v(M),M?i?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{w.current&&x()})})},children:[e.jsx(Mg,{disabled:!!n,skip:b||y,children:e.jsxs(Lu,{className:"composer-btn","data-opened":Uo(S),"data-pill":Uo(b),"aria-label":g.formatMessage({id:"mJYhKI",defaultMessage:"Choose tool"}),id:"system-hint-button",disabled:n,onPointerOver:a,onClick:M=>{M.preventDefault()},onFocusCapture:M=>{M.stopPropagation()},children:[e.jsx(Iu,{"aria-label":"",className:"icon-md"}),b&&e.jsx("span",{className:"ms-1.5 me-0.5",children:e.jsx(B,{id:"mNL7WC",defaultMessage:"Tools"})})]})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{size:"auto",alignOffset:-7,onEscapeKeyDown:()=>{R.current=!0},onCloseAutoFocus:M=>{if(!R.current||w.current){M.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:e.jsxs(H.RadioGroup,{value:s,onValueChange:M=>{const E=t.find(A=>A.systemHint===M);E&&(Ef(E.systemHint,E.systemHint===s?ye.Disable:ye.Enable,l),s===M?c?.({hint:E,enable:!1}):p(E.systemHint)||(w.current=!0,c?.({hint:E,enable:!0}),f(E.systemHint)))},children:[!b&&e.jsx(H.Label,{children:e.jsx(B,{id:"KSn3Jr",defaultMessage:"Tools"})}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{})]}):e.jsx(e.Fragment,{children:t.map(M=>{const E=M.actionLabel??M.name,A=u(M.systemHint),P=M.systemHint===j.Research&&m,I=P,O=k&&M.systemHint==="research",h=P?e.jsx(B,{id:"composer.skills.unavailable",defaultMessage:"Temporarily unavailable"}):void 0,T=kg.includes(M.systemHint),D=M.systemHint===s;if(O)return null;let F;r&&(F=_.find(q=>q.name===Qo(M.systemHint)&&o));const U=e.jsxs(H.RadioItem,{value:M.systemHint,disabled:I||!!F,color:D?"selected":"default",icon:e.jsx(Fa,{hint:M,isNextToLabel:!0}),trailing:!P&&!D&&A?e.jsx("span",{className:"text-token-text-secondary",children:A}):e.jsx(H.RadioItemCheck,{}),secondary:h,children:[E,T&&e.jsx("span",{className:"bg-token-interactive-bg-accent-default text-token-interactive-label-accent-default rounded-lg px-1.5 text-[0.625rem] leading-[1.6] font-semibold uppercase",children:e.jsx(B,{id:"composer.skills.new",defaultMessage:"New"})})]},M.systemHint);return F?e.jsx(we,{withArrow:!0,side:"right",labelTextAlign:"left",label:F.title,secondaryLabel:F.description,children:U},M.systemHint):U})})]})})})]})},Mg=({disabled:t,children:s,skip:n})=>{const o=ue(le.hasSeenComposerSystemHintButtonTooltip),a=!t&&!o.isLoading&&o.eligible?{announcementKey:le.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(B,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,description:e.jsx(B,{id:"Kgb5fv",defaultMessage:"Create an image, research report, and more."})}:void 0;if(n)return s;if(a)return e.jsx(ls,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...a,children:s});let i;return t?i=e.jsx(B,{id:"uw9x80",defaultMessage:"Tools unavailable"}):i=e.jsx(B,{id:"Yr1zf1",defaultMessage:"Choose tool"}),e.jsx(we,{side:"bottom",label:i,children:s})};function jg(t,s){return s||!t||t.remaining>wg?null:t.remaining===0?e.jsx(gn,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):e.jsx(B,{id:"m6JsYD",defaultMessage:"{remaining} left",values:{remaining:t.remaining}})}const Rg=({clientThreadId:t})=>{const s=fm(),{setThreadSystemHintMode:n}=fe(),o=s?.location.search;d.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){n(j.ContextualAnswers,!0,{clientThreadId:t});const a=new URLSearchParams(window.location.search);a.delete("enable-internal-knowledge");const i=a.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[o,t,n])},Eg=()=>{const[t,s]=d.useState(),{connectionInstanceData:n,isLoading:o}=at(),r=d.useMemo(()=>[...n?.connection_statuses??[]].sort(Fu),[n]),a=r.some(i=>i.user_connection_details.activation_status==="activating"||i.user_connection_details.activation_status==="partially_activated"||i.user_connection_details.activation_status==="inactive"&&i.user_connection_details.auth_status==="user_connected");return d.useEffect(()=>{N.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),o?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Ar,{lines:4,size:"lg"})}):e.jsxs(nt,{children:[t&&e.jsx(za,{connection:t,onClose:()=>s(void 0)}),e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[r.map(i=>{const c=i.user_connection_details.activation_status,l=c==="partially_activated"||c==="activating";return e.jsx("div",{className:$("__menu-item",i.user_connection_details.activation_status==="activating"?"grayscale":void 0,l?"":"cursor-default"),onClick:u=>{l&&s(i),u.stopPropagation()},children:e.jsx(Hu,{title:i.connection_display_info.display_name,icon:e.jsx("img",{src:i.connection_display_info.icon_url??"",alt:i.connection_display_info.display_name,className:"icon-md"}),statusIndicator:e.jsx(Ou,{connection:i,location:"user_dropdown"})})},i.user_connection_details.connection_instance_id)}),e.jsx("div",{className:"__menu-item",onClick:i=>{window.location.hash="#settings/ConnectorSettings",i.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx(Ga,{className:"icon-md"}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:a?e.jsx(B,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(B,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})]})};function Pg({systemHints:t,composerController:s,clientThreadId:n,connectionStatuses:o}){Rg({clientThreadId:n});const r=Fn(s),a=t.find(({systemHint:S})=>S===r),{availableConnectors:i,isLoading:c,enabled:l}=vr(),{availableConnectors:u,enabled:m,isLoading:p}=Qm({includeDisabledByAdmin:!0}),{connectorConfigMap:f}=Nr({clientThreadId:n});if(!a)return null;const x=r===j.Research,g=!1;return l&&(x||g)?e.jsx(pa,{isLoading:c,clientThreadId:n,enabledConnectors:i,fetchValidLinksOnly:x||g,trigger:e.jsx(fa,{clientThreadId:n,includeSyncConnectors:!1,includeWebSearch:!0})}):r===j.Slurm&&(o&&o.length>0||m&&u.length>0)?e.jsx(pa,{clientThreadId:n,isLoading:p,enabledConnectors:u,includeWebSearch:!1,includeSyncConnectors:!0,connectorConfigMap:f,trigger:e.jsx(Ng,{children:e.jsx(fa,{clientThreadId:n,includeSyncConnectors:!0,includeWebSearch:!1})})}):r===j.ContextualAnswers?e.jsx("div",{"data-testid":"sources-pill",className:"flex items-center gap-1.5 ps-0.5 [view-transition-name:var(--vt-composer-sources-pill)]",children:e.jsx(Tg,{dropdownContent:e.jsx(Eg,{}),as:"popover"})},"sources-tag"):null}function Tg({dropdownContent:t,as:s}){const n=e.jsxs(On,{as:"button",spacing:"compact",children:[e.jsx(Ua,{className:"icon-md mx-1","aria-label":""}),e.jsx("span",{"data-label":!0,children:e.jsx(B,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx("div",{className:"me-0.5 flex items-center",children:e.jsx(Wa,{className:"icon-sm pointer-events-auto!"})})]}),o=s==="popover"?e.jsx(Sn,{children:e.jsx(cn,{className:"p-0",$as:yn,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:t})}):e.jsx(H.Portal,{children:e.jsx(H.Content,{children:t})});return s==="popover"?e.jsxs(xn,{children:[e.jsx(Js,{asChild:!0,children:n}),o]}):e.jsxs(H.Root,{children:[e.jsx(H.Trigger,{asChild:!0,children:n}),o]})}function Ng({children:t}){const{eligible:s,markAsViewed:n}=ue(le.hasSeenConnectorsSourcesPillTooltip);return e.jsx(ls,{announcementKey:le.hasSeenConnectorsSourcesPillTooltip,badge:"new",className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(B,{id:"bJE6uS",defaultMessage:"Get insights across Google Drive, SharePoint, Dropbox, and more."}),dismissOnOutsideClick:!0,onDismiss:n,show:s,side:"bottom",sideOffset:0,theme:"bright",title:e.jsx(B,{id:"O73vya",defaultMessage:"Connect your apps for smarter chats"}),children:t})}const Bg=({clientThreadId:t,composerController:s,pendingFiles:n,hasFiles:o,placeholder:r,isTemporaryChat:a,state:i,inputState:c,disableReason:l,gizmoId:u,replyRegions:m,keepExpanded:p=!1,onSubmit:f,legacyFooterActions:x,legacySuggestionsPopoverContent:g,isNewThread:S=!1,modelSupportedSystemHints:v,contextualAnswerUserConnectionData:k,shouldUseBigComposer:b})=>{const y=We.useState(({persistedSystemHints:G})=>G),_=Array.from(y)[0],w=We.useState(({locked:G})=>G),{state:R}=ns(t),E=R==="clarify"||!1,A=d.useCallback(G=>e.jsx(Za,{inputState:c,state:i,onSubmit:f,composerController:s,clientThreadId:t,gizmoId:u,disableReason:l,useStartButtonText:E,disableTooltip:G}),[c,i,f,s,t,u,l,E]),{whisperControls:P}=jr({composerController:s,renderInComposer:A,composerType:"composer-btn"}),I=We.useState(({availableHints:G})=>G),O=sr(G=>G.selectedApps),h=nr()&&O.length>0,T=o||h,D=p||!!_||m&&m.length>0||T||I.length<3,F=ds(j.ContextualAnswers)&&!!S,{shouldShowResearchText:U}=ns(t),q=Ia(),J=Uu({exposed:F})==="bigbox",V=q&&U||J&&F;return e.jsxs(dp,{isBigBoxModeActive:V,isTemporaryChat:a,placeholder:r,composerController:s,isExpandedByDefault:D,onSubmit:f,shouldUseBigComposer:b,children:[m&&m.length>0&&e.jsx(ta,{children:e.jsx(er,{replyRegions:m})}),T&&e.jsx(ta,{children:e.jsx(Xs,{files:n,fullBleed:!0,selectedApps:O,className:"no-scrollbar horizontal-scroll-fade-mask -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto py-1.5 ps-2 pe-4 [--edge-fade-distance:1rem]"})}),x?.map((G,ae)=>e.jsx(sa,{children:G},`legacy-footer-action-${ae}`)),!w&&e.jsx(mp,{children:e.jsx(kf,{clientThreadId:t,composerController:s,systemHints:v})},"active-hint-tag"),e.jsx(sa,{children:e.jsx(Pg,{clientThreadId:t,composerController:s,systemHints:v,connectionStatuses:k?.connection_statuses})},"sources-tag"),e.jsx(pp,{children:g},"legacy-suggestions-popover"),e.jsx(fp,{children:P}),q&&U?e.jsx(na,{children:e.jsx(gp,{composerController:s})}):J&&F?e.jsx(na,{children:e.jsx(Gu,{composerController:s})}):null]})},Dg=Rn(()=>En(()=>import("./d6hcvbgoukhbynvf.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,8,9,10,11,15,16,17])).then(t=>t.ImageGenComposer)),Lg=1,Ig=3e3,Fg=()=>null;function Hg({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:r,disableDraftPersistence:a=!1,areModelsLoading:i,clientThreadId:c,isNewThread:l,isCompletionInProgress:u,className:m,disabled:p=!1,disabledReason:f,canPause:x=!1,canContinue:g=!1,isInteractableSharedThread:S,onComposerInput:v,onComposerChange:k,onAutocompleteSelect:b,headerClassName:y,hideHeader:_,onTaggingDropdownOpen:w,onTaggingDropdownClose:R,onlyAllowImageUploads:M,shouldUseBigComposer:E}){st.markStart("PromptTextarea"),st.markRendered("PromptTextarea");const A=d.useContext(Pn),P=Tn(A),I=pe(),O=d.useRef(null),h=Ve(),T=ya(),D=gm(T.showUploadSuggestion$),F=Na(),U=n?.isTeam(),q=An(I),J=K(),V=rt(),G=dn(),ae=zu.useStore(),[Be,$e,kt]=Z(c,C=>[ee.getCurrentLeafId(C),ee.getRequestId(C),ee.findNode(C,z=>!!z.message.metadata?.b1de6e2_s)]),[De,qe]=nc(),{gizmoEditorData:lt,mode:Le,getGizmoId:ut}=rs(),dt=fr(),mt=un(),Ie=hm(),ps=Wu(),re=Sr(c),Ye=!!gr(),At=!!In(),W=Vu.useIsEnabled(c),ge=!!Nn(),{clearAllSystemHintModeTriggers:Mt,setThreadSystemHintMode:jt}=fe(),ne=ms(),{state:fs}=ns(c),Gn=ne.has(j.Search),Qr=ne.has(j.Think),Zr=ne.has(j.Research),{activeSystemHints:Rt}=Ke(c),ei=We.useState(({locked:C})=>C),ti=Rt.length>0,si=Ku(),{connectionInstanceData:ni,isLoading:oi}=at({skip:!si}),{selectedSources:zn,selectedMCPSources:Et}=ct(c),Wn=Br(I);$u({skip:!Wn});const{platformConnectors:Vn}=qu(Wn&&(Et?.size??0)>0),ai=d.useMemo(()=>Array.from(Et??[]).map(C=>Vn.get(C)).filter(C=>C!==void 0),[Vn,Et]),gs=d.useRef(0),hs=d.useRef(!1),ri=Fg();let Y=as(c),Pt=Y&&"gizmo"in Y?Y.gizmo:void 0;const ii=xm(),Fe=Pt?.gizmo.id??ii,xs=Ka(Fe),{name:ci}=Yu(),li=ci?hd:xd,ui=Ju(),Kn=Xu(),[de,Tt]=d.useState(null);de!==null&&(Y={gizmo:de,gizmo_id:de.gizmo.id,kind:Ee.GizmoInteraction},Pt=de);const pt=$s(r,Y,ne),di=us(),$n=ar(I).flags,Nt=$n?.includes(es.NoAuthEnableFileUploads),Bt=Go(C=>C.setThreadModelSelection),qn=Go(C=>C.threads[c]?.modelSelection),Yn=qn?.type===Kt.EFFORT_MODE?qn.effortMode:null,Jn=!!Yn&&Yn!=="default";Qu(d.useCallback(()=>{Jn&&Fs(c,Bt,{type:Kt.EFFORT_MODE,effortMode:"default"})},[Jn,c,Bt])),Um({serverThreadId:re,clientThreadId:c,composerController:h,currentModelId:o,account:n,getIsDisabled:d.useCallback(()=>!1,[]),onReset:()=>{Fs(c,Bt,{type:Kt.EFFORT_MODE,effortMode:"default"})},onInfer:C=>{Fs(c,Bt,{type:Kt.EFFORT_MODE,effortMode:C})},isInferEnabledForModel:r?.enableInfer});const Xn=!p&&(pt!==Ue.None||i)&&(q||Nt),ke=Ca(r,Y),Ss=wa(r,Y);let ie=qs(C=>C.files);const[Dt]=d.useState(()=>Zu());Le==="magic"?ie=ie.filter(C=>C.gizmoId!=null):ie=ie.filter(C=>C.gizmoId==null);const Qn=ed(),Je=ie.length>0||Qn,Zn=qs(Rd.hasUploadInProgress),ys=sr(C=>C.selectedApps),eo=nr()&&ys.length>0,mi=Je||eo,pi=td(c),bs=h.useState(C=>{const z=Gm(C);return typeof r?.maxTokens=="number"&&z>r.maxTokens}),to=h.useState(C=>!C.isEmpty()),Lt=!bs&&!Zn&&(to||Je),so=(pt===Ue.Multimodal?mn:pn)-ie.length,no=so<=0,fi=zm(),gi=!1,hi=Te("3544641259")?.value,{selectedRepos:Cs}=Cn(c),oo=(fi||gi)&&hi&&zn?.size===0&&Et?.size===0,_s=ze(I,"2007855518"),ao=kt?.message.metadata?.async_task_id,ws=sd(C=>ao?C.tasks[ao]:null),vs=ws?.status===nd.RUNNING,ro=od(yt(c)||c)?.value,xi=ro===Zo.STREAMING,Si=ro===Zo.REALTIME,ks=u&&x||xi||Si||vs&&_s,Xe=Lt&&!p&&!ge&&(!ks||Kn)&&!oo,[io,yi]=d.useState(!1),{targetedContent:co,setTargetedContent:It}=ad(),he=co?.isFocusedViewContent&&!ps?void 0:co;d.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>h.focus()))},[he]);const lo=Y==null||Y?.kind===Ee.PrimaryAssistant||Y?.kind===Ee.GizmoInteraction&&xs,{getUpsellLabelType:bi,getUpsellShowsAttach:Ci}=rd(),As=ti&&lo,[_i,wi]=d.useState(!1),vi=q&&lo&&!ei&&(!U||!oi),ft=Ge(h.store,C=>C.controlsDisabled);d.useEffect(()=>{if(!F?.id)return;const C=ea.getAndReset(F.id,re);C&&h.setText(C.inputText)},[F?.id,re,h]),d.useEffect(()=>{const C=De.get("prompt")??"";h.getCurrentText().length===0&&C.length>0&&h.setText(C)},[h,De]),d.useEffect(()=>{if(ne.size)return;const C=De.getAll("system_hints");if(!C.length)return;const z=Rt.map(Q=>Q.systemHint);C.filter(Q=>z.includes(Q)).forEach(Q=>jt(Q,!0,{clientThreadId:c})),qe(Q=>{const ce=new URLSearchParams(Q);return ce.delete("system_hints"),ce})},[h,De,c,Rt,ne,jt,qe]),d.useEffect(()=>{io!==Xe&&(yi(Xe),Xe&&Sm(!0).then(C=>{id.startEnforcement(C),ym.startEnforcement(C)}))},[Xe,io,Y?.kind,dt]);const Ft=ba(r,Y),{handleFileAccepted:uo}=Tr(J,$s(r,Y,ne),ke,"mouse",ut,Ft?.attachments),ki=d.useCallback((C,z)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{h.focus()})}),uo(C,z)),[h,uo]),{getInputProps:Ai,open:Ms,inputRef:mo}=Mr({disabled:p||!Xn||no,noClick:!0,onDropAccepted:ki,onDropRejected:C=>Pr(C,J,V,pt),multiple:!0,maxSize:va,maxFiles:so,..._a(!q||M?ke:Ss)}),po=Ge(Dt),fo=d.useCallback(()=>{h.eraseContent(),po.clearMessages(),h.resize(Lg),h.usedDictation=!1,h.dictationEdited=!1,h.dictationAssetPointer=null,h.dictationAssetTTL=null;for(const z of ie)Xt.remove(G,z.tempId,"none");if(cd.markAllAsSent(),bm(I)){const z=Cm(I,"269676899"),oe=z.get("skip_search",!1);if(z.get("clear_all",!1)){const ce=[j.Slurm,j.Tatertot];oe&&ce.push(j.Search),Mt({skip:ce})}}},[h,po,Mt,I,ie,G]),Ht=Ge(h.store,C=>C.isInReasonMode),js=d.useMemo(()=>zs(Ht,h,ne)[0],[Ht,h,ne]),go=async(C,z)=>{if(C.preventDefault(),p||!Lt||!Y)return;const oe=h.getContentToSend(),Q=$m(oe.content),ce=zs(Ht,h,ne),{content:Ds,attachments:Ls}=Ed(G,Q,r,Y,ne);ui(),t({sourceEvent:C,attachments:Ls,content:Ds,contentToSend:oe,conversationMode:Y,hasSelectedApps:eo,isAuraSidebar:P,isMessageFollowupsEnabled:W,selectedApps:ys,selectedGizmoTag:de,selectedRepos:{selectedAllRepos:Cs.selectedAllRepos,selectedRepos:Cs.selectedRepos?[...Cs.selectedRepos]:null},selectedSources:zn,selectedMCPConnectors:ai,systemHints:ce,usedDictation:h.usedDictation,dictationEdited:h.dictationEdited,dictationAssetPointer:h.dictationAssetPointer,dictationAssetTTL:h.dictationAssetTTL}),he?.onCreateCompletion?.({serverThreadId:re,currentLeafId:Be}),he?.shouldPersistAcrossMessages!==!0&&It(void 0),zo.hideThreadHeader();for(const Io of ie)Io.status===Pd.Ready&&ae.addFile(Io);fo()},Mi=C=>{It(C.targetedReply),C.targetedReply&&N.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:re,sourceMessageId:C.messageId})},{maybeSetWaitingForRealtimeOnAbort:ho,isWatingForRealtimeStatusChange:ji}=ld(c),Rs=d.useCallback(C=>{ho(),ud(C)},[ho]),xo=d.useCallback(()=>{he?.onCleared?.({serverThreadId:re,currentLeafId:Be}),It(void 0),h.focus()},[Be,re,he,It,h]),So={Enter:{validator:C=>{const z=C.isComposing||C.keyCode===229;return!(Ut&&hs.current)&&(C.metaKey||(mt||km||Am())&&!C.shiftKey&&!z)},handler:C=>{if(!Xe){bs&&V.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}C.preventDefault(),go(C)}},Escape:{validator:C=>!C.isComposing,handler:C=>{x&&u&&(Rs(c),N.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:yt(c),currentLeafId:ee.getCurrentNode(_e(c)).message.id,eventSource:"keyboard"})),C.target.value===""&&xo()}}},gt=d.useRef(So);gt.current=So;const Ot=dd(r?.tags,Y?.kind),{showTaggingDropdown:Es,isFocused:Ri,autocompletions:Ae,matchaData:Ei}=Ge(h.store),Ut=Ri&&Ae.length>0,Qe=Ot&&Es&&!xs,yo=h.isReady();d.useEffect(()=>h.subscribe("keydown",C=>{h.acceptLegacyKeydown()&&gt.current[C.key].validator(C)&&gt.current[C.key].handler(C);const oe=h.getCurrentText();if(C.key==="@"){const Q=h.getSelectionStart(),ce=oe.substring(0,Q);(!ce||/\s$/.test(ce)||Q===0)&&setTimeout(()=>h.setShowTaggingDropdown(!0),10)}else Es&&h.setShowTaggingDropdown(!1);C.key==="Escape"&&(Tt(null),h.setAutocompletions([])),Gn&&C.key==="Escape"&&jt(j.Search,!1,{clientThreadId:c})}),[h,yo,Es,ne,Gn,jt,c]),d.useEffect(()=>{const C=Object.fromEntries(Object.keys(gt.current).map(z=>[z,Q=>{const ce=gt.current[z];if(!ce||h.acceptLegacyKeydown())return!1;const{validator:Ds,handler:Ls}=ce;return Ds(Q)?(Ls(Q),!0):!1}]));h.registerKeyHandlers(C),h.registerFileInput({openFileDialog:Ms,inputRef:mo})},[h,Ms,mo,yo]),d.useEffect(()=>h.subscribe("paste",C=>{md({filePickerStore:G,event:C,intl:J,toaster:V,clientThreadId:c,conversationMode:Y,currentModelConfig:r,getEditorGizmoId:ut,modelSupportedImageMimeTypes:ke,persistedSystemHints:ne})}),[J,c,Y,r,ut,ke,h,V,G,ne]);const bo=C=>{Ye||Tt(C),h.trimLeadingText("@"),tn(),h.setShowTaggingDropdown(!1)},Pi=pd(c,Dt,ke,Ft?.attachments),Ti=d.useCallback(C=>{C.preventDefault(),Rs(c),N.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:yt(c),currentLeafId:ee.getCurrentNode(_e(c)).message.id,eventSource:"mouse"}),tn()},[c,Rs]),Ps=d.useCallback(()=>{ea.set(F?.id,re,h.getCurrentText())},[re,F?.id,h]);d.useEffect(()=>{lt||fd()||h.focus()},[h]),d.useEffect(()=>{if(ke.length>0)for(const z of ie)Wm(z.fileSpec?.mimeType,Ss)||Xt.remove(G,z.tempId,"none");else Xt.reset(G)},[o,G]),d.useEffect(()=>{(!Ot&&de||Ye)&&Tt(null)},[Ot,de,Ye]),d.useEffect(()=>{At&&h.setReasonMode(!1)},[At,h]);const{layer:Ni}=Pe("4031588851"),{layer:Co}=Pe("3637408529"),Bi=Co.get("is_in_composer_text_exp",!1),Di=Co.get("composer_text","MESSAGE_CHATGPT"),Li=Ni.get("composer_text","MESSAGE_CHATGPT"),Ii=Bi?Di:Li,[Gt,Fi]=(()=>{switch(f){case"workspaceDisallowsGizmo":return[X.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[X.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[X.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[X.loading,!0];case"noTestGizmoId":return[X.noTestGizmoId,!0];default:{if(S)return[X.placeholderWithName,!1];if(he?.placeholderTextOverride!=null)return[he.placeholderTextOverride,!1];if(fs==="initial"||fs==="recurrent")return[X.deepResearchPlaceholder,!1];if(fs==="clarify")return[X.researchSuggestionInitial,!1];if(js)switch(js){case j.Search:return[X.searchPlaceholder,!1];case j.Think:return[X.thinkPlaceholder,!1];case j.Slurm:return[X.connectorPlaceholder,!1];case j.Research:return[X.researchPlaceholder,!1];case j.Canvas:return[X.canvasPlaceholder,!1];case j.Picture:return[X.picturePlaceholder,!1];case j.PictureV2:return[X.pictureV2Placeholder,!1];case j.ContextualAnswers:return[gd.caSuggestionInitial,!1]}switch(Ii){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[X.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[X.placeholderAskNameAnythingVariant,!1];default:return[X.placeholderWithName,!1]}}}})(),Ts=xs?l?J.formatMessage(li.newChatInProject,{projectName:Pt?.gizmo.display.name??"this project"}):Gt?J.formatMessage(Gt,{name:"ChatGPT"}):"​":Gt?J.formatMessage(Gt,{name:lt!=null?Le==="magic"?Sd:lt.name||"GPT":Pt?.gizmo.display.name??"ChatGPT"}):"​";d.useEffect(()=>h.subscribe("input",()=>{yd.getState().isThreadHeaderVisible&&zo.hideThreadHeader()}),[h]),d.useEffect(()=>h.subscribe("input",()=>{gs.current=performance.now(),v?.()}),[h,v]),d.useEffect(()=>{if(k)return h.subscribe("change",()=>{k()})},[h,k]);const _o=bd()&&!!Ae.find(C=>!!C.requires_file_upload),Hi={clientThreadId:c,uploadType:pt,modelAcceptedMimeTypes:Ss,modelSupportedImageMimeTypes:ke,attachmentsProductFeature:Ft?.attachments,getInputProps:Ai,openFileDialog:Ms,historyDisabled:Ie,onOauthRedirect:Ps,highlightTooltip:_o&&!Je},He=[],wo=[],vo=!p&&!no&&(Xn||di!=null),ko=Ci(),Oi=q||ko||Nt,Ao=pt===Ue.None?ot.ModelNotSupported:Qr?ot.ThinkModeInUse:void 0;if(Oi){const C=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(yg,{...Hi,showGlowingBorder:D,showLabel:bi()==="all",showUpsell:ko&&!Nt,showMenuForNoAuth:Nt,isDisabled:!vo||ft,disabledReason:Ao,currentModelName:r?.title??"",visualTreatment:q?"composer-btn":"legacy"})},"file-upload-button");He.push(C),wo.push(C)}const Ui=or(),Gi=ze(I,"2861925050");if(q?vi&&He.push(e.jsx(vg,{composerController:h,clientThreadId:c,disabled:ft,isFinchEnabled:Gi})):(He.push(e.jsx(eg,{account:n,clientBootstrapFlags:$n,features:dt,currentModelConfig:r,isDisabled:!!ft,clientThreadId:c,composerController:h,gizmoId:Fe})),P||He.push(e.jsx(Xf,{clientThreadId:c,gizmoId:Fe,composerController:h,isDisabled:ft}))),tr()&&js==null){const C=e.jsxs("div",{className:"[view-transition-name:var(--vt-composer-active-system-hint-pill) flex items-center gap-1.5 ps-0.5",children:[e.jsx("div",{"data-separator":"true",className:"bg-token-border-default h-[13px] w-px"}),e.jsx(Kf,{clientThreadId:c,gizmoId:Fe,showLabel:!0,isDisabled:ft,renderAsPill:!0},"deep-research")]});He.push(C)}const[zi,Mo]=d.useState(!1),Ns=Fi||ji?"disabled":"default",Wi=_m(),Vi=!Xe||Wi,Bs=Km(Zn,to,bs,pi,!oo,vs,_s),Ze=ks?"streaming":Vi?"disabled":"idle",ht=d.useRef(null),et=d.useRef(null),{value:Ki}=Te("222560275"),$i=Ki||o&&!o.startsWith("o1")&&!o.startsWith("o3");d.useEffect(()=>{const C=()=>{ht.current!=null&&Mn.addAction("composer_state_disabled",{threadId:yt(c),disabledReason:ht.current})};if(Lt&&Ze==="disabled"){let z="unknown";p?z=f??"component_disabled_unknown":u?z="completion_in_progress":ge&&(z="thread_hard_blocked"),ht.current!==z&&(et.current&&clearTimeout(et.current),et.current=setTimeout(C,Ig)),ht.current=z}else ht.current=null;return()=>{et.current&&(clearTimeout(et.current),et.current=null)}},[c,Lt,Ze,p,f,u,ge]);const zt=[];if(he?.label&&zt.push({type:he.type,value:he.label,onRemoveRegion:xo}),de!==null){const C=!!de.gizmo.tags?.includes(cs.FirstParty);zt.push({type:"mention",value:de.gizmo.display.name,icon:e.jsx(kr,{isFirstParty:C,src:de.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Tt(null),h.focus()}})}d.useEffect(()=>{(!Ae||Ae.length===0||!Ut)&&(hs.current=!1)},[Ae,Ut]);const qi=d.useCallback((C,z,oe)=>{hs.current=C>=0,z&&h.setText(oe?`${oe.title}${oe.body}`:"")},[h]),jo=Ut&&Ae&&Ae.length>0&&!Qe&&!Zr&&!h.hasMultipleLines()&&h.canShowAutocompletion();d.useEffect(()=>{Qe?w?.():R?.()},[Qe,w,R]);const Wt=C=>{if(C.preventDefault(),C.stopPropagation(),gs.current>0){const z=performance.now()-gs.current;Mm.hist(jm.DEFAULT,"final_user_input_to_submit_ms",[],z)}Ze==="streaming"&&(!Kn||h.isEmpty())?vs&&_s?Mo(!0):Ti(C):go(C)},Yi=Cd(r,xr.Canvas),Ji=_d(),Xi=Yi&&!Ji&&!Qn&&!Ui;d.useEffect(()=>{},[ri,h]),d.useEffect(()=>{const C=yt(c),z=n?.normalizedAccountUserId;if(!z||a)return;const oe=ka(()=>{const Q=h.getContentToSend().content;Q===""?wm(C):vm(C,Q,z)},1e3);return h.subscribe("change",oe)},[n,c,h,a,re]);const Ro=e.jsx(ag,{canUseInlineTagging:Ot,isDisabled:p,clientThreadId:c,currentLeafId:Be,currentRequestId:$e,canContinue:g,composerController:h,isNewThread:l,onContinueGenerating:C=>s({event:C,conversationMode:_e(c)?.mode,systemHints:zs(Ht,h,ne)}),onResetState:fo,conversationMode:Y,isShowingAutocomplete:!!jo,shouldUseBigComposer:E}),Eo=!ks&&Y!=null&&$i&&wd.includes(Y.kind)&&e.jsx(vd,{clientThreadId:c,onTargetedReply:Mi}),Po=jo&&e.jsx("div",{className:"bg-token-main-surface-primary absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",children:e.jsx(af,{suggestions:Ae,composerController:h,onSelect:b,onChange:qi})}),To=e.jsx(jd,{composerController:h,parsedDocumentHandler:Pi}),No=!_&&e.jsx(Ur,{className:y}),Bo=e.jsx(kd,{modelSupportedImageMimeTypes:ke,uploadType:Ue.Multimodal,attachmentsProductFeature:Ft?.attachments}),Qi=e.jsxs(e.Fragment,{children:[Qe&&e.jsx(da,{onClick:C=>bo(C),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()}}),As&&e.jsx(ga,{composerController:h,clientThreadId:c})]}),{isImageGenEditor:Do}=Ad(),Lo=ze(I,"3760395675");return Do?e.jsxs(Wo.Provider,{value:Dt,children:[e.jsx(Ko,{onOauthRedirect:Ps,children:e.jsx(Vo,{defaultOpen:Lo,children:e.jsx("form",{id:"prompt",className:m,onSubmit:Wt,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[No,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":_i?"none":"block"},children:[e.jsxs(xn,{open:Qe||As,children:[e.jsx(Ha,{className:"w-full",children:Do?e.jsx(Dg,{type:Ie?"temporary":"default",ref:O,placeholder:Ts,inputState:Ns,composerController:h,leftSideActions:wo,state:Ze,onSubmit:Wt,renderFiles:Je&&e.jsxs(e.Fragment,{children:[Le==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(B,{...X.gizmoKnowledgeWarning})}),e.jsx(Xs,{files:ie,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:c,gizmoId:Fe,disableReason:Bs,modelId:o}):e.jsx(bg,{type:Ie?"temporary":"default",ref:O,replyRegions:zt,placeholder:Ts,inputState:Ns,setIsComposerOverflowing:wi,composerController:h,matchaData:Ei,leftSideActions:He,topRightAction:Xi&&e.jsx(Md,{composerRef:O,composerController:h,clientThreadId:c}),state:Ze,onSubmit:Wt,renderFiles:mi&&e.jsxs(e.Fragment,{children:[Le==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(B,{...X.gizmoKnowledgeWarning})}),e.jsx(Xs,{files:ie,selectedApps:ys,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:c,gizmoId:Fe,disableReason:Bs,modelId:o})}),e.jsx(Sn,{children:e.jsxs(yn,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:C=>C.preventDefault(),children:[Qe&&e.jsx(da,{onClick:C=>bo(C),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()}}),As&&e.jsx(ga,{composerController:h,clientThreadId:c})]})})]}),Po]}),To,Bo]})})})}),Ro,Eo]}):e.jsx(Wo.Provider,{value:Dt,children:e.jsxs(Vo,{defaultOpen:Lo,children:[e.jsx(Ko,{onOauthRedirect:Ps,children:e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[No,ws&&zi&&e.jsx(Vm,{taskId:ws.taskId,clientThreadId:c,onClose:()=>Mo(!1)}),e.jsx(Bg,{hasFiles:Je,pendingFiles:ie,isUploadDisabled:!vo,isNewThread:l,clientThreadId:c,highlightUploadTooltip:_o&&!Je,disableReason:Bs,uploadButtonDisabledReason:Ao,currentModel:r,conversationMode:Y,state:Ze,inputState:Ns,gizmoId:Fe,isTemporaryChat:Ie,placeholder:Ts,composerController:h,onSubmit:Wt,replyRegions:zt,keepExpanded:!0,legacyFooterActions:He,legacySuggestionsPopoverContent:Qi,modelSupportedSystemHints:Rt,contextualAnswerUserConnectionData:ni,shouldUseBigComposer:E}),Po]})}),To,Ro,Eo,Bo]})})}const ph=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:r,currentModelId:a,onRequestCompletion:i,shouldUseUnifiedComposer:c,shouldUseBigComposer:l,onlyAllowImageUploads:u})=>{const m=Ve(),{pageType:p}=Ld(),f=p?.type==="landing-page",x=d.useContext(Pn),g=Pm(x),S=or();Ne(),Id(m);const v=async R=>{if(_e(t)?.isLoading!==!1)return;const M=await Ud(R);i(M)},k=d.useCallback(R=>{N.logEvent("Continue Completion"),i(Fd(R))},[i]),b=Hd.useState(R=>R.isReplayEnabled),y=Tn(x),_=e.jsxs(e.Fragment,{children:[e.jsx(xf,{clientThreadId:t}),e.jsx(Hs,{verticalMargin:"none",verticalPadding:g?"last-standard":"none",horizontalPadding:y?"none":"standard",children:e.jsx(Os,{children:b?e.jsx(Od,{clientThreadId:t},t):e.jsx(Og,{clientThreadId:t,currentModelId:a,isNewThread:s,hideHeader:s,onRequestCompletion:v,onContinueGenerating:k,onAutocompleteSelect:m.onAutocompleteSelect,onlyAllowImageUploads:u,shouldUseBigComposer:l})})})]}),w=s&&e.jsx("div",{className:$("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Hs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Os,{children:e.jsx(Ur,{className:"block flex-1"})})})});return c?e.jsxs(e.Fragment,{children:[S&&w,e.jsx("div",{id:"thread-bottom",children:_}),!S&&w,s&&!f&&!n&&!0&&!o&&e.jsx(Hs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Os,{children:e.jsx(gf,{clientThreadId:t,currentModelId:a,isModelLoaded:r})})})]}):_};function Og({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:r,onContinueGenerating:a,onComposerInput:i,onComposerChange:c,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:p,onTaggingDropdownOpen:f,onlyAllowImageUploads:x,shouldUseBigComposer:g}){const{data:S,isLoading:v}=yr(),[k,b,y,_,w]=Z(t,G=>{const ae=ee.getCurrentNode(G);return[ae.message.clientMetadata?.errType!=null&&ae.message.clientMetadata.errType!=="info",Tm(ee.getCurrentNode(G).message),G?.mode,G?.continuingFromSharedConversationId!=null,!!G?.continuingFromSharedPostId]}),R=Ne(),M=Ve(),E=Rm({clientThreadId:t}),{isOpen:A,onClose:P}=Td({type:"just-hit-rate-limit"}),I=d.useMemo(()=>E?!1:!k&&b,[k,b,E]),O=E,h=mr(t),T=hn(h).data,D=Em(),F=T?.gizmo.tags?.includes(cs.WorkspaceDisabled)&&!D?"workspaceDisallowsGizmo":S?.models.size===0?"noModelsAvailable":y?.kind===Ee.GizmoTest&&y.gizmo_id==null?"noTestGizmoId":null,U=oc(),q=Nd(),J=U.action==="moderate",{value:V}=Te("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(kp,{composerController:M,clientThreadId:t,currentModelId:s,isCompletionInProgress:E}),e.jsx("div",{className:"flex justify-center empty:hidden",children:q&&J&&V?e.jsx(Bd,{}):null}),A?e.jsx(Dd,{onClose:P}):null,e.jsx(Hg,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:r,onContinueGenerating:a,currentModelId:s,account:R,currentModelConfig:qa(S?.models,s),areModelsLoading:v,isNewThread:o,isCompletionInProgress:E,className:"w-full",canContinue:I,disabled:!!F,disabledReason:F??void 0,canPause:O,isInteractableSharedThread:_||w,onComposerInput:i,onComposerChange:c,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:p,onTaggingDropdownOpen:f,onlyAllowImageUploads:x,shouldUseBigComposer:g},t)]})}export{bp as D,ih as F,dh as I,mh as M,lh as N,Og as P,ph as T,ch as a,Dg as b,yp as c,ia as d,Gr as g,Pr as h,uh as u};
//# sourceMappingURL=jkznwfhp8ahnvlot.js.map
