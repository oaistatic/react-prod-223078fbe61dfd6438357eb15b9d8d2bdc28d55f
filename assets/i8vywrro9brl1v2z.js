import{r as s,i as Y,j as e,M as o,a as pe,b as fe}from"./b8ijctzpgh0s7wpx.js";import{B as D,an as he,f as te,ad as ie,e as G,eq as Q,at as xe,aQ as se,b as ve,F as be,c as ne}from"./citrwydz0bgriwlc.js";import{bX as V,bJ as Ee,aI as A,bY as Ce,bZ as Se,b_ as je,b$ as we,c0 as Me,aX as ke,c1 as Ie,aK as Ne,c2 as ye}from"./krbmwir12ubt4od1.js";import{V as Z}from"./d3y72ugnrmac5z1v.js";import{E as Re}from"./c3pyruu10yojvm55.js";const Pe=`email,role
user1@company.com,member
admin@company.com,admin
it@company.com,owner`,le=25,ee=[],oe=({workspace:i,onSuccess:n,setStep:m,isNewTeamsPurchaseUxEnabled:g,seatCount:E})=>{const t=te(),h=i.isOwnerOfAccount(),[b,p]=s.useState(!1),d=s.useRef(null),r=Y(),c=ie(),[l,x]=s.useState(!1),[C,R]=s.useState(!0),[F,B]=s.useState(!1),[f,k]=s.useState([]),[O,P]=s.useState([]),[H,W]=s.useState(E?Array(E).fill(""):[]),{mutateAsync:j}=Be(i.id,n),U=je(),S=we()??!0,[w,L]=s.useState(ee),M=s.useMemo(()=>t?.subscriptionAnalyticsParams,[t]);s.useEffect(()=>{if(!f?.length||!U?.length||S){L(ee);return}const v=U.map(u=>"@"+u.hostname.toLowerCase()),N=f.map(({email:u})=>u.toLowerCase()).filter(u=>!v.some(y=>u.endsWith(y)));L(N)},[U,S,f]);const z=_e(h),X=s.useCallback(v=>{const N={numEmailsAdded:v,uploadType:"Bulk"};G.logEvent("Account Pay: Collaborator Emails Added",{...M,...N})},[M]),I=s.useCallback(async v=>{x(!0);const N=v.target.files?.[0];if(N){const u=await Le(N,z,b);u.status==="success"?(k(u.newRows),g?P(u.newRows.map(y=>({label:y.email,value:y.email,isValid:Z.test(y.email)}))):m?.(1),p(u.hasWarning),X(u.newRows.length),v.target.files=null):u.reason==="file_too_large"?c.danger(r.formatMessage(a.fileTooLargeWarning,{maxSize:`${le}MB`}),{duration:5}):u.reason==="invalid_file_type"&&c.danger(r.formatMessage(a.fileIncorrectTypeWarning),{duration:5})}},[z,r,g,m,b,c,X]),_=(v,N,u)=>{const y=[...f];y[v]={...y[v],[N]:u},k(y)},T=s.useCallback(v=>{G.logEvent("Account Pay: Add Collaborators Modal Clicked",{...M,...v})},[M]),q=s.useCallback(()=>{G.logEvent("Account Pay: Add Collaborators Upload Clicked",M)},[M]),de=s.useCallback(()=>{G.logEvent("Account Pay: Collaborator Email Removed",M)},[M]),me=v=>{const N=[...f.slice(0,v),...f.slice(v+1)];k(N),de()},$=s.useCallback(()=>{k([]),m?.(0),B(!1),P([])},[m]),ce=s.useCallback(async()=>{B(!0);try{f.length>5&&c.info(r.formatMessage(a.inviteMessageLoading,{numRows:f.length}),{hasCloseButton:!0});const v=[["admin",Q.ADMIN],["owner",Q.OWNER],["member",Q.STANDARD]],u=(await Promise.all(xe(v.map(([y,ge])=>{const J=f.filter(K=>K.role===y).map(K=>K.email);return J.length>0&&j({emails:J,role:ge,resendEmails:C})})))).flat().length;u>0&&c.success(r.formatMessage(a.inviteSuccessToast,{numRows:u,userStr:u===1?"user":"users",workspaceName:Me(r,i)})),se.logEvent("chatgpt_invite_users_to_workspace",f.length,{action:"SubmitEmails",location:"modal-submit-button",text:"Submit",step:"AdminModal-CollectEmails-Submit"}),n?.(),$()}finally{B(!1)}},[j,f,C,n,c,r,i,$]),ue=s.useCallback(()=>{d.current?.value&&(d.current.value=""),d.current?.click(),q()},[d,q]);return{INVITE_ROLES:z,clearState:$,emailInputList:H,emailTableRows:f,emailTextAreaValue:O,emailsOutsideOfDomain:w,fileInputRef:d,handleClickImportCSV:ue,handleDeleteRow:me,handleInputChange:_,handleSubmit:ce,handleUploadCSV:I,hasUploadedCsv:l,isInviting:F,resendEmails:C,setEmailInputList:W,setEmailTableRows:k,setEmailTextAreaValue:P,setResendEmails:R,shouldShowWarning:b,trackNavigationClick:T,trackUploadClick:q}};function Ue({workspace:i,canResendInviteEmails:n,onCancel:m,cancelButtonText:g,onSuccess:E,fullWidthButtons:t=!1}){const[h,b]=s.useState(!1),p=Y(),[d,r]=s.useState(0),{handleUploadCSV:c,handleInputChange:l,handleDeleteRow:x,clearState:C,handleSubmit:R,shouldShowWarning:F,emailTableRows:B,isInviting:f,resendEmails:k,setResendEmails:O,emailTextAreaValue:P,emailsOutsideOfDomain:H,trackNavigationClick:W,INVITE_ROLES:j,setEmailTableRows:U,setEmailTextAreaValue:S,fileInputRef:w,handleClickImportCSV:L}=oe({workspace:i,onSuccess:E,setStep:r}),M=()=>{const I=new Set,_=P.reduce((T,q)=>(I.has(q.value)||T.push(q.value),I.add(q.value),T),[]);U(_.map(T=>({email:T,role:j.member}))),r(1),se.logEvent("chatgpt_invite_users_to_workspace",0,{action:"CollectEmails",location:"modal-next-button",text:"Next",step:"AdminModal-CollectEmails-Next"})},z=e.jsx(D,{color:"primary",size:t?"large":"medium",disabled:i.isDeactivated()||f||B.length===0||H.length>0,onClick:()=>{R(),W({buttonType:"Send"})},children:f?p.formatMessage(a.inviteMemberInviteSubmitButtonLoading):p.formatMessage(a.inviteMemberInviteSubmitButton)}),X=e.jsx(D,{color:"primary",size:t?"large":"medium",disabled:P.length===0,onClick:M,children:p.formatMessage(a.inviteMemberInviteNextButton)});return e.jsxs("div",{className:"flex flex-col gap-2",children:[d===0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"upload-csv",id:"upload-csv-label",children:e.jsx(o,{...a.importCSVLabel})}),e.jsxs("span",{className:"text-token-text-tertiary text-sm",children:[e.jsx(o,{...h?a.helperCSVFormatHide:a.helperCSVFormatShow,values:{link:I=>e.jsx("button",{className:"underline",onClick:()=>{b(!h)},children:I})}}),h&&e.jsx("pre",{className:"mt-4",children:Pe})]})]}),e.jsx("input",{ref:w,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:c}),e.jsx(D,{color:"secondary",onClick:L,children:e.jsx(o,{...a.importCSVButtonLegacy})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",children:e.jsx(o,{...a.addEmailsFieldName})}),e.jsx(re,{value:P,onChange:S})]})]}),d===1&&e.jsxs(e.Fragment,{children:[F&&e.jsxs("div",{className:"flex w-full items-center bg-yellow-100 p-4",children:[e.jsx(he,{className:"icon-sm me-2 text-yellow-700"}),e.jsx("div",{className:"grow text-yellow-700",children:e.jsx(o,{...a.unspecifiedRoleDescription})})]}),H.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(o,{...a.prohibitedExternalEmailDescription}),e.jsx("pre",{className:"my-1",children:H.join(", ")}),e.jsx(o,{...a.prohibitedExternalEmailResolution})]})}),e.jsxs(V.Root,{size:"normal",children:[e.jsxs(V.Header,{children:[e.jsx(V.HeaderCell,{children:e.jsx(o,{...a.inviteTableHeaderEmail})}),e.jsx(V.HeaderCell,{className:"ps-3 dark:bg-gray-900",children:e.jsx(o,{...a.inviteTableHeaderRole})}),e.jsx(V.HeaderCell,{})]}),e.jsx(V.Body,{children:B.map((I,_)=>e.jsxs(V.Row,{children:[e.jsx(V.Cell,{children:e.jsx(Ee,{ariaLabel:p.formatMessage(a.inviteTableHeaderEmail),name:"email",type:"email",value:I.email,onChange:T=>l(_,"email",T.target.value),color:"neutral"})}),e.jsx(V.Cell,{children:e.jsxs(A.Root,{value:I.role,onValueChange:T=>l(_,"role",T),children:[e.jsxs(A.Trigger,{children:[e.jsx(A.Value,{}),e.jsx(A.Icon,{})]}),e.jsx(A.Portal,{children:e.jsxs(A.Content,{className:"border-token-main-surface-secondary border",children:[e.jsx(A.Item,{value:j.member,children:e.jsx(o,{...a.inviteRoleMember})}),j.admin&&e.jsx(A.Item,{value:j.admin,children:e.jsx(o,{...a.inviteRoleAdmin})}),j.owner&&e.jsx(A.Item,{value:j.owner,children:e.jsx(o,{...a.inviteRoleOwner})})]})})]})}),e.jsx(V.Cell,{textAlign:"right",children:e.jsx(Ce,{onClick:()=>x(_),className:"icon-sm text-token-text-secondary me-2 cursor-pointer"})})]},_))})]})]}),n&&O&&e.jsx("div",{className:"text-token-text-secondary mt-2 flex items-center text-start",children:e.jsx(Se,{id:"resend-emails",checked:k,onChange:I=>O(I.currentTarget.checked),label:p.formatMessage(a.resendEmailsFieldName)})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{color:"secondary",size:t?"large":"medium",onClick:()=>{d!==0?r(0):(C(),m(),W({buttonType:"Skip"}))},children:d===0?g:p.formatMessage(a.inviteMemberInviteBackButton)}),d===0?X:z]})]})}const Te=be.input`flex w-full rounded-lg bg-token-main-surface-primary ps-4 placeholder:text-token-text-tertiary focus:ring-2 border focus:ring-token-text-primary focus:border-token-border-medium border-token-border-medium focus:border-token-border-medium `,Ve=({email:i,index:n,emailInputList:m,setEmailInputList:g,setEmailTableRows:E})=>{const t=Y(),[h,b]=s.useState(!1),p=!!i&&!h&&n>0&&m.indexOf(i)<n;return e.jsxs("div",{className:"flex w-full flex-col gap-1",children:[e.jsx(Te,{className:ne((h||p)&&"border-token-text-error"),type:"email",value:i,onBlur:()=>{b(!!i&&!Z.test(i))},placeholder:t.formatMessage(a.emailInputPlaceholder),onChange:d=>g(r=>{const c=[...r];return c[n]=d.target.value,E(c.filter(Boolean).map(l=>({email:l,role:"member"}))),c})},n),h&&e.jsx("div",{className:"text-token-text-error ms-1 flex text-xs",children:e.jsx(o,{...a.invalidEmailWarning})}),p&&e.jsx("div",{className:"text-token-text-error ms-1 flex text-xs",children:e.jsx(o,{...a.duplicateEmailWarning})})]})},ae=25,Ae=10;function ze({workspace:i,onCancel:n,cancelButtonText:m,onSuccess:g,fullWidthButtons:E=!1,seatCount:t}){const h=Y(),[b,p]=s.useState(t>Ae),{clearState:d,emailInputList:r,emailTableRows:c,emailTextAreaValue:l,emailsOutsideOfDomain:x,fileInputRef:C,handleClickImportCSV:R,handleSubmit:F,handleUploadCSV:B,hasUploadedCsv:f,isInviting:k,setEmailInputList:O,setEmailTableRows:P,setEmailTextAreaValue:H,trackNavigationClick:W}=oe({workspace:i,onSuccess:g,seatCount:t,isNewTeamsPurchaseUxEnabled:!0}),j=e.jsx(ke,{label:h.formatMessage(a.importCSVTooltip),contentClassName:"w-[280px]",side:"top",delayDuration:200,children:e.jsx(D,{className:"ms-auto",color:"secondary",icon:Ie,onClick:R,children:e.jsx(o,{...f?a.reimportCSVButton:a.importCSVButton})})}),U=S=>{const w=S.filter((L,M,z)=>z.findIndex(X=>X.value===L.value)===M);H(w),P(w.map(L=>({email:L.value,role:"member"})))};return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("input",{ref:C,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:S=>{B(S),p(!0)}}),x.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(o,{...a.prohibitedExternalEmailDescription}),e.jsx("pre",{className:"my-1",children:x.join(", ")}),e.jsx(o,{...a.prohibitedExternalEmailResolution})]})}),b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 flex w-full items-center gap-3",children:[t<=ae&&e.jsx("div",{className:"bg-token-main-surface-secondary flex h-2 grow overflow-hidden rounded-3xl",children:Array(ye(t,0,ae)).fill(0).map((S,w)=>e.jsx("div",{className:ne("border-token-main-surface-primary h-full grow border-e-2 last-of-type:border-0",w<l.length&&"bg-black dark:bg-white")},w))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(o,{...a.seatsInvited,values:{seatCount:t,enteredCount:l.length}})})]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",className:"text-base font-medium",children:e.jsx(o,{...a.addEmailsFieldName})}),j]}),e.jsx(re,{value:l,onChange:U})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4",children:[e.jsx("div",{className:"text-base font-medium",children:e.jsx(o,{...a.addEmailsFieldName})}),r.map((S,w)=>e.jsx(Ve,{email:S,index:w,emailInputList:r,setEmailInputList:O,setEmailTableRows:P},w))]}),e.jsxs("div",{className:"align-center flex justify-between",children:[e.jsx(D,{color:"secondary",onClick:()=>{O(S=>[...S,""])},icon:Ne,children:e.jsx(o,{...a.addEmailButton})}),j]})]}),c.length-t>0&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(o,{...a.seatsExceeded,values:{exceeded:c.length-t}})})]}),e.jsxs("div",{className:"mt-8 flex w-full flex-col gap-2",children:[e.jsx(D,{color:"primary",size:E?"large":"medium",loading:k,disabled:k||c.length===0||x.length>0,onClick:()=>{F(),W({buttonType:"Send"})},children:h.formatMessage(k?a.inviteMemberInviteSubmitButtonLoading:a.inviteMemberInviteSubmitButton)}),e.jsx(D,{color:"ghost",size:E?"large":"medium",onClick:()=>{d(),n(),W({buttonType:"Skip"})},children:m})]})]})}function re(i){const n=te(),m=s.useMemo(()=>n?.subscriptionAnalyticsParams,[n]),g=s.useCallback(t=>{G.logEvent("Account Pay: Collaborator Emails Added",{...m,...t})},[m]),E=s.useCallback(t=>{G.logEvent("Account Pay: Collaborator Email Removed",{...m,...t})},[m]);return e.jsx(Re,{trackEmailsAdded:g,trackEmailRemoved:E,...i})}function Be(i,n){const m=Y(),g=ie(),E=pe();return fe({mutationFn:async({emails:t,role:h,resendEmails:b})=>{const p=[],d=Math.max(5,Math.round(t.length/10));for(let l=0;l<t.length;l+=d)p.push(t.slice(l,l+d));const r=async l=>ve.safePost("/accounts/{account_id}/invites",{parameters:{path:{account_id:i}},requestBody:{email_addresses:l,role:h,resend_emails:b}}).then(x=>(x.errored_emails.length>0&&g.danger(m.formatMessage(a.inviteMessageFailure,{emailsStr:x.errored_emails.map(({email_address:C,error:R})=>`${C}: ${R}`).join(", ")})),x.account_invites)).catch(x=>{throw g.danger(x.message),x});return(await Promise.all(p.map(l=>r(l)))).flat()},onSuccess:()=>{E.invalidateQueries({queryKey:["workspace","invites",i]}),n?.()}})}function Le(i,n,m){return new Promise(g=>{if(i.size/1048576>le)g({status:"error",reason:"file_too_large"});else if(i.type!=="text/csv")g({status:"error",reason:"invalid_file_type"});else{const t=new FileReader;t.readAsText(i),t.onload=function(h){let b=m;const d=(h.target?.result).split(`
`),r=new Set,c=d.reduce((l,x)=>{const[C,R]=x.split(",").map(F=>F.trim());return Z.test(C)&&!r.has(C)&&(n[R]===void 0&&!b&&(b=!0),l.push({email:C,role:n[R]??n.member})),r.add(C),l},[]);g({status:"success",newRows:c,hasWarning:b})}}})}const _e=i=>{const n={member:"member"};return i&&(n.admin="admin",n.owner="owner"),n},a={importCSVLabel:{id:"adminPage.importCSVLabel",defaultMessage:"Import from CSV",description:"Name of label for import from CSV button"},helperCSVFormatHide:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Hide Example</link>',description:"Instructions for formatting the import CSV, with a link to hide the example"},helperCSVFormatShow:{id:"adminPage.helperCSVFormat",defaultMessage:'The file must include email and an optional role on each line. Roles can be "member", "admin", or "owner". <link>Show Example</link>',description:"Instructions for formatting the import CSV, with a link to show an example"},importCSVButtonLegacy:{id:"adminPage.importCSVButtonLegacy",defaultMessage:"Upload",description:"Name of upload from CSV button"},addEmailsFieldName:{id:"adminPage.addEmailsFieldName.0",defaultMessage:"Emails",description:"Name of input for adding emails to workspace"},unspecifiedRoleDescription:{id:"adminPage.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member.",description:"Description text for defaulting invite roles to member"},prohibitedExternalEmailDescription:{id:"adminPage.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:",description:"Description text for error message"},prohibitedExternalEmailResolution:{id:"adminPage.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.',description:"Description text for error message"},inviteTableHeaderEmail:{id:"adminPage.inviteTableHeaderEmail",defaultMessage:"Email",description:"Label for email column of invite table header"},inviteTableHeaderRole:{id:"adminPage.inviteTableHeaderRole",defaultMessage:"Role",description:"Label for role column of invite table header"},inviteRoleMember:{id:"adminPage.inviteRoleMember",defaultMessage:"Member",description:"Member role for workspace invite"},inviteRoleAdmin:{id:"adminPage.inviteRoleAdmin",defaultMessage:"Admin",description:"Admin role for workspace invite"},inviteRoleOwner:{id:"adminPage.inviteRoleOwner",defaultMessage:"Owner",description:"Owner role for workspace invite"},fileTooLargeWarning:{id:"adminPage",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}.",description:"Error when uploading a file that is too large"},fileIncorrectTypeWarning:{id:"adminPage",defaultMessage:"Please upload a CSV file.",description:"Error when uploading a file that is not a CSV"},resendEmailsFieldName:{id:"adminPage.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites",description:"Name of checkbox input for resending emails to workspace"},teamInviteModalNote:{id:"adminPage.teamInviteModalNote",defaultMessage:"Users that accept invites will be included as additional seats on your next invoice.",description:"Note for team plan invites that additional seats will be charged"},teamInviteModalNoteBeforeLink:{id:"adminPage.teamInviteModalNoteBeforeLink",defaultMessage:"Learn more about ",description:"Note for team plan invites that additional seats will be charged"},teamInviteModalNoteBillingLink:{id:"adminPage.teamInviteModalNoteBillingLink",defaultMessage:"billing",description:"billing word that will be a link to the billing help page"},inviteMessageLoading:{id:"adminPage.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute...",description:"Loading message when invites are being sent"},inviteSuccessToast:{id:"adminPage.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}",description:"Message on successfully sending out invites"},inviteMemberInviteNextButton:{id:"adminPage.inviteMemberInviteNextButton",defaultMessage:"Next",description:"The title of the invite member modal next button"},inviteMemberInviteSubmitButton:{id:"adminPage.inviteMemberInviteSubmitButton",defaultMessage:"Send invites",description:"The title of the invite member modal submit button"},inviteMemberInviteSubmitButtonLoading:{id:"adminPage.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites...",description:"Button label while inviting members"},inviteMemberInviteBackButton:{id:"adminPage.inviteMemberInviteBackButton",defaultMessage:"Back",description:"The title of the invite member modal back button"},inviteMessageFailure:{id:"adminPage.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}",description:"Message that shows which emails were unsuccessful at being invited"},importCSVButton:{id:"adminPage.importCSVButton",defaultMessage:"Upload CSV",description:"Name of upload from CSV button"},reimportCSVButton:{id:"adminPage.reimportCSVButton",defaultMessage:"Re-upload CSV",description:"Name of re-upload from CSV button"},importCSVTooltip:{id:"adminPage.importCSVTooltip",defaultMessage:"Upload a CSV file. Your file must include an email on each line.",description:"Tooltip for import from CSV button"},seatsInvited:{id:"adminPage.seatsInvited",defaultMessage:"{enteredCount} of {seatCount} users",description:"Label for number of users invited"},seatsExceeded:{id:"adminPage.seatsExceeded",defaultMessage:"Inviting these users will bill {exceeded} additional {exceeded, plural, one {user} other {users}} on your workspace.",description:"Label for exceeding number of users invited"},emailInputPlaceholder:{id:"adminPage.emailInputPlaceholder",defaultMessage:"Email",description:"Placeholder for email input"},addEmailButton:{id:"adminPage.addEmailButton",defaultMessage:"Add more",description:"Button to add another email input"},duplicateEmailWarning:{id:"adminPage.duplicateEmailWarning",defaultMessage:"This email is a duplicate.",description:"Warning for duplicate email"},invalidEmailWarning:{id:"adminPage.invalidEmailWarning",defaultMessage:"Please enter a valid email address.",description:"Warning for invalid email"}};export{Ue as A,ze as a};
//# sourceMappingURL=i8vywrro9brl1v2z.js.map
