const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dlsoz00g3d1kx3ut.js","assets/citrwydz0bgriwlc.js","assets/b8ijctzpgh0s7wpx.js","assets/root-gxczc0vy.css","assets/ku4zsoy6w4wkp690.js","assets/krbmwir12ubt4od1.js","assets/conversation-small-dfayqh3x.css","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js","assets/nvghija6qp2cunds.js","assets/djd85tifm57yisqi.js","assets/jkznwfhp8ahnvlot.js","assets/megablgldkh4lap1.js","assets/hbpbckirom363mgh.js","assets/izdon3syh095bs23.js","assets/dweroubxngal4vlb.js","assets/i7jya7stlyvnzya0.js","assets/cb2t82g498wwhuc2.js","assets/ndwtlsjk3xm27wkq.js","assets/dcml6fn13vfm1zv2.js","assets/o0ebhsapkoy5qkg1.js","assets/k7nub2yuxq70se07.js","assets/k6ccgr4wxcppeg93.js","assets/dbalwdodzoo02ru2.js","assets/pc9qsszhmtx9pu7o.js","assets/dera5bljhpg5ja89.js","assets/hs2fsda156wfk7fz.js"])))=>i.map(i=>d[i]);
import{c as B,j as re,k as oe,F as pe,ah as xe,au as ve,ak as ee,m as Ie,ew as we,e as Se,n as te,a_ as be,b as _e,a$ as je,cx as Re,dr as Ce,he as Me,b1 as ye,ab as ke,Q as Ne,_ as Ee}from"./citrwydz0bgriwlc.js";import{j as a,a5 as q,i as K,r as n,a6 as Ae,a as Ge,p as Pe}from"./b8ijctzpgh0s7wpx.js";import{I as X,D as Te,a as ce,u as De}from"./ckwntmn7hqzclvef.js";import{i8 as Oe,f1 as ze,bt as Le,b6 as Ue,bx as W,b5 as He,bH as Be,bw as Fe,pR as $e,pS as qe,bv as We,go as Ke,jN as le,jP as Ve,pT as S,pU as Z,pV as Qe,pW as Ye,pX as Xe,pY as Je}from"./krbmwir12ubt4od1.js";import{C as de}from"./nfkxdwnvdjy1s4sn.js";import{I as Ze}from"./oyzab3j7hun2568h.js";import{b as et}from"./cn5tk4t34ulr2va8.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./dera5bljhpg5ja89.js";import"./hs2fsda156wfk7fz.js";import"./o6iizogkfybkxcpa.js";import"./e1z6gbtwznbmtc6u.js";import"./h3axfhhn58bmthc9.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./eg629yaevviy8e7x.js";const ue=({children:e,isDimensionsUnknown:t})=>a.jsxs(q.div,{className:B(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]}),tt=({children:e,isDimensionsUnknown:t,width:s,height:i,setHasAnimated:r})=>a.jsxs(q.div,{layout:!0,transition:{duration:.3,ease:"easeInOut"},exit:{opacity:0,transition:{duration:.1,ease:"easeInOut"}},className:B(["relative max-w-[480px] overflow-hidden rounded-2xl",t&&"aspect-square"]),style:{width:s??"auto",height:i??"auto"},onLayoutAnimationComplete:()=>r?.(!0),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]});function at(){const[t,s]=n.useState(new Date);n.useEffect(()=>{s(new Date)},[]);const i=Oe(+t,12e4);return a.jsx(ze,{percentage:i,sizeOverride:30,thickness:1/10,className:"text-white",backgroundStrokeClassName:"stroke-white/20",transitionDuration:`${(100-i)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}const ge=({isGettingStarted:e})=>{const t=K(),s=n.useMemo(()=>e?t.formatMessage({id:"SxQKjt",defaultMessage:"Getting started"}):t.formatMessage({id:"Y3ETLn",defaultMessage:"Creating image"}),[e,t]),i=re(),r=oe(i,"3019066937").get("should_show_cot_header",!1),l=n.useMemo(()=>e?a.jsx(de,{size:30,arcPercentage:.2,strokeWidth:3}):a.jsx(at,{}),[e]);return a.jsx("div",{className:B("absolute inset-0 flex items-end justify-between px-6 py-6"),children:a.jsxs(Ae,{mode:"popLayout",children:[r&&a.jsx(q.span,{className:B("flex items-center gap-1 align-middle text-lg",!e&&"text-white"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.1,ease:"easeInOut"},children:s},s),a.jsx("div",{className:"flex flex-1 items-center justify-end",children:l})]})})},ae=pe.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,nt=({imageUrl:e})=>{const[t,s]=n.useState(void 0),i=K(),r=Le(),l=n.useCallback(()=>{const o=new Date;return`${i.formatDate(o,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[i]);return a.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[a.jsxs(ae,{$alwaysVisible:!0,children:[t!==!1&&a.jsx(X,{icon:Ue,selected:t===!0,variant:"large",onClick:o=>{o.stopPropagation(),W.paragenImageRated({liked:!0,analyticsContext:r}),s(!0)}}),t!==!0&&a.jsx(X,{icon:He,selected:t===!1,variant:"large",onClick:o=>{o.stopPropagation(),W.paragenImageRated({liked:!1,analyticsContext:r}),s(!1)}})]}),a.jsx(ae,{$alwaysVisible:!0,$rightAlign:!0,children:a.jsx(X,{icon:Be,variant:"large",onClick:o=>{o.stopPropagation(),W.paragenDownload({analyticsContext:r}),Fe({url:e,fileName:l()})}})})]})};function me({withLottie:e}){const s=K().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return a.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:a.jsx(de,{size:40,arcPercentage:.2,children:a.jsx(Te,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const fe=300,st=1.3,ne=.05,it=/blur\(([\d.]+)px\)/,rt={duration:fe/1e3,ease:"linear"};function J(e,t,s){e.sort((o,c)=>o.lastSrcReceivedTime-c.lastSrcReceivedTime);const i=new Array(e.length).fill(0);for(let o=0;o<=e.length;o+=1){const c=o-1,m=o,u=e[c]?.availablePercentComplete??0,g=e[m]?.availablePercentComplete??1;if(t>=u&&t<=g&&u!==g){const v=(t-u)/(g-u);i[c]=1-v,i[m]=v}}const r=i[i.length-1],l=i[i.length-2];return r===1&&l===0&&(i[i.length-2]=.01),s&&t<=e[0]?.availablePercentComplete&&(i[0]=1),i}const ot=({alt:e,src:t,availablePercentComplete:s,onAnimationUpdate:i,ignoreFirstChunk:r=!1,isTransparent:l=!1,dimensions:o,onError:c,unconstrainedWidth:m=!1,progressLoaderProps:u})=>{const g=xe(),v=n.useMemo(()=>`url(${g?$e:qe})`,[g]),[h,j]=n.useState(!1),[p,R]=n.useState(1e3),[b,N]=n.useState(s??0),[d,w]=n.useState(0),y=n.useRef(performance.now()),x=n.useRef(0),I=n.useRef([]),[A,C]=n.useState([0]),[z,G]=n.useState(!1),O=n.useRef(!1),P=n.useRef(null),T=b===1,M=s===1&&z,D=o?o.width/o.height:1;n.useEffect(()=>{!h&&s&&(j(!0),x.current=performance.now())},[h,s]),n.useEffect(()=>{const _=I.current[I.current.length-1]?.src;if(t&&t!==_){const f=I.current.findIndex(k=>k.availablePercentComplete===s);f!==-1?I.current[f]={src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:I.current.push({src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),C(J(I.current,b,r))}},[t,b,r,s]);const F=n.useCallback(()=>{P.current&&s&&(R(M?fe:(performance.now()-y.current)*st),(!r||O.current||s>=ne)&&s!==1&&w(s),O.current=!0,y.current=performance.now(),u?.setHasImageReady(!0))},[s,M,r,u]),V=n.useCallback(_=>{const f=parseFloat(_.height)/100;i?.(f),N(f),C(J(I.current,parseFloat(_.height)/100,r))},[i,r]),$=n.useCallback(_=>{const f=_.filter.toString().match(it)?.[1]??"0",H=(16-parseFloat(f))/16,he=1-d,Y=d+he*H;i?.(Y),N(Y),C(J(I.current,Y,r))},[r,d,i]);if(!h)return a.jsx(ue,{isDimensionsUnknown:!0,children:a.jsx(me,{withLottie:!0})});const E={duration:p/1e3,ease:"linear"},U=s!==1||!l;return a.jsxs("div",{className:B("relative z-0 cursor-pointer overflow-hidden",D<1?"max-w-[400px]":"max-w-[480px]",!T&&"pointer-events-none",!O.current&&"bg-token-main-surface-secondary",m&&"max-w-full"),"aria-label":e,style:{aspectRatio:D},children:[!u?.shouldHideDiagonalShimmer&&s&&s<ne&&a.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:a.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:a.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),a.jsxs(q.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:M?!1:{height:"0%"},animate:T?{height:"100%"}:{height:`${d*100}%`},onUpdate:M?void 0:V,transition:M?{duration:0,ease:"linear"}:E,style:T?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&a.jsx("img",{ref:P,src:t,onLoad:F,onError:c,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:D}}),l&&a.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:a.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:v,backgroundSize:"auto"}})})]}),a.jsx(q.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:M?{filter:"blur(0px)"}:void 0,transition:M?rt:void 0,onUpdate:M?$:void 0,style:{aspectRatio:D},children:I.current.map((_,f)=>{const k=A[f],H=_.availablePercentComplete===1;return k!==0||H?a.jsx("img",{src:_.src,alt:e,style:{opacity:k,willChange:"opacity",aspectRatio:D},className:!M&&u?.shouldShowPulseAnimation?"bg-scale-pulse":"",onLoad:H?()=>G(!0):void 0},_.src):null})}),a.jsx(q.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:D},children:U&&I.current.filter((_,f)=>A[f]!==0).map(_=>a.jsx("img",{src:_.src,alt:e,className:"absolute top-0 w-full"},_.src))})]})},se=2,Q=({pointer:e,altLabel:t,isEditorAvailable:s,onPercentageRendered:i,messageId:r,imageIndex:l,clientThreadId:o,serverThreadId:c,onEditorClick:m,compact:u,progressLoaderProps:g})=>{const v=Ge(),[h,j]=n.useState(void 0),p=n.useRef(void 0),R=e.metadata?.generation?.gen_id,b=e.metadata?.generation?.height??void 0,N=e.height,d=(b??0)/N,w=n.useRef({}),[y]=Pe(),{isUnauthenticated:x}=ve(),[I,A]=n.useState(!1),C=n.useContext(ce),z=e.width/e.height,G=We({imageAssetPointer:e,serverThreadId:c}),P=n.useCallback((f=!1)=>{!f&&p.current===e.asset_pointer||(p.current=e.asset_pointer,Ke.fetch(v,{asset:e,conversationId:c,force:f,isUnauthenticated:x}).then(k=>{j(k)}).finally(()=>{p.current=void 0}))},[e,v,c,x,null]);n.useEffect(()=>{const f=e.asset_pointer!==h?.asset_pointer;(!h||f)&&P()},[h,e.asset_pointer,P]);const T=n.useMemo(()=>le({pointer:h,conversationId:c,messageId:r,source:C?"paragen":"chat",imageIndex:l.toString()}),[h,c,r,C,l]),M=n.useRef(d);n.useEffect(()=>{d===1&&M.current<1&&W.renderingComplete({analyticsContext:T})},[d,T]);const D=n.useCallback(()=>{h&&m?.({image:h,messageId:r,analyticsContext:T})},[h,r,m,T]),F=n.useMemo(()=>({width:e.width,height:e.height}),[e]),V=n.useCallback(()=>{const f=(w.current[e.asset_pointer]??0)+1;if(w.current[e.asset_pointer]=f,w.current[e.asset_pointer]>se)return ee.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:c,asset_pointer:e.asset_pointer,max_retries:se});ee.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:c,asset_pointer:e.asset_pointer,current_retry:f}),w.current[e.asset_pointer]=f,P(!0)},[e.asset_pointer,P,c]),$=n.useCallback(f=>{f===1&&A(!0),i?.(f)},[i]),L=n.useRef(null),E=n.useRef(null);n.useEffect(()=>{if(L.current&&g?.setContainerSize){const f=L.current.getBoundingClientRect(),k={width:f.width,height:f.height},H=E.current;(!H||H.width!==k.width||H.height!==k.height)&&(E.current=k,g.setContainerSize(k))}},[g]);const U=h?.url,_=G??U;return a.jsx(Ve.Provider,{value:T,children:a.jsxs("div",{ref:L,className:B("group/imagegen-image relative w-full overflow-hidden",z<1?"max-w-[400px]":"max-w-[480px]",u?"rounded-lg":"rounded-2xl",C&&"max-w-full",r===y.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${r}`,style:{aspectRatio:z},onClick:s?D:void 0,tabIndex:0,children:[G&&a.jsx("img",{alt:t,className:"absolute inset-0 z-1 opacity-0",src:G}),a.jsx(ot,{alt:t,src:U,availablePercentComplete:d,onAnimationUpdate:$,isEditorAvailable:s,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:F,onError:V,unconstrainedWidth:C,progressLoaderProps:g},R),g?.state&&g?.state!==S.Complete&&!I&&g?.hasImageReady&&a.jsx(ge,{isGettingStarted:!1}),I&&!u&&(C?a.jsx(nt,{imageUrl:U??""}):a.jsx(Ze,{imageAssetPointer:U,imageUrl:_,messageId:r,clientThreadId:o,serverThreadId:c,shouldShowOverflow:G!==void 0}))]},R)})},ct=({imageGenerationState:e,isInterrupted:t,asyncMessage:s,imageAssetPointer:i,altLabel:r,clientThreadId:l,serverThreadId:o,onEditorClick:c,isEditorAvailable:m,setAnimationPercentage:u,messageId:g})=>{const[v,h]=n.useState(null),j=v==null,[p,R]=n.useState(!0),[b,N]=n.useState(!0),d=e===S.Thinking||e===S.AsyncGenerating&&!s?.metadata?.is_visually_hidden_from_conversation,w=e===S.Generating||e===S.Complete;return n.useEffect(()=>{d&&(R(!1),N(!1))},[d]),t?null:a.jsxs(a.Fragment,{children:[(d||!b||!p)&&a.jsx(tt,{isDimensionsUnknown:j,width:v?.width,height:v?.height,setHasAnimated:N,children:j&&a.jsx(ge,{isGettingStarted:!0})}),w&&a.jsx(q.div,{className:"pb-2",variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:p&&b?"visible":"hidden",exit:"hidden",children:i&&a.jsx(Q,{pointer:i,altLabel:r,isEditorAvailable:m,onPercentageRendered:u,messageId:g,clientThreadId:l,serverThreadId:o,imageIndex:0,onEditorClick:c,progressLoaderProps:{state:e,setContainerSize:h,hasImageReady:p,setHasImageReady:R,shouldHideDiagonalShimmer:!0,shouldShowPulseAnimation:!0}})})]})};function lt({title:e,description:t,shimmer:s}){return!e&&!t?null:a.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&a.jsx("p",{className:B("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!t&&"mb-1"),children:e}),!!t&&a.jsx("p",{children:t})]})}const dt=({cotMessages:e,visualPercentComplete:t,isInterrupted:s=!1,state:i})=>{const l=K().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),o=i===S.Complete||t===1,c=n.useMemo(()=>{if(s)return l;if(!e)return;if(o)return e.complete;if(t){const m=Object.keys(e.generating);for(let u=0;u<m.length;u+=1){const g=parseFloat(m[u]);if(t<g)return e.generating[m[u]]}}else return e.thinking;return e.complete},[e,l,s,o,t]);return c&&a.jsx(et,{latestHeadline:c,isComplete:o||s,isExpandDisabled:!0})},ut=({pointersToRender:e,altLabel:t,isEditorAvailable:s,updatePercentageRendered:i,toolCallMessage:r,toolOutputMessageIds:l,clientThreadId:o,serverThreadId:c,handleEditorClick:m})=>{const u=Z.useStore(),g=Z.useSelectedIndex();n.useEffect(()=>{u.setSelectedIndex(Math.max(l.findIndex(d=>d===r?.metadata?.selected_image_message_id),0))},[]);const v=n.useRef({}),h=n.useCallback(d=>w=>{v.current[d]=w;const y=Object.keys(v.current).length,x=Object.values(v.current).reduce((I,A)=>I+A,0);i?.(x/y)},[i]),[j,p]=n.useState(null),R=Ie(o,te.getRequestId),b=we(R);n.useEffect(()=>{!b&&j!=null&&r!=null&&c!=null&&(ie(r.id,l[j],o,c),p(null))},[b]);const N=n.useCallback(d=>{u.setSelectedIndex(d);const w=Object.values(v.current);Se.logEventWithStatsig("chatgpt_image_switched","chatgpt_image_switched",{conversationId:c,messageId:l[d],imageIndex:d.toString(),isLoading:(w.length===0||w.some(I=>I<1)).toString()}),te.getConversationLastTurn(be(o))?.messages.find(I=>I.id===r?.id)!=null&&r!=null&&c!=null&&(b?p(d):ie(r.id,l[d],o,c))},[r,l,o,c,u,b,p]);return a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Q,{pointer:e[g],altLabel:t,isEditorAvailable:s,messageId:l[g],imageIndex:g,clientThreadId:o,serverThreadId:c,onEditorClick:m}),a.jsx("div",{className:"flex flex-col gap-2",children:e.map((d,w)=>a.jsx(gt,{pointer:d,altLabel:t,isSelected:w===g,onClick:()=>N(w),onPercentageRendered:d.metadata?.generation?.gen_id?h(d.metadata.generation.gen_id):void 0,messageId:l[w],imageIndex:w,clientThreadId:o,serverThreadId:c},d.metadata?.generation?.gen_id))})]})},gt=({pointer:e,altLabel:t,isSelected:s,onClick:i,onPercentageRendered:r,messageId:l,imageIndex:o,clientThreadId:c,serverThreadId:m})=>a.jsxs("button",{type:"button",onClick:i,className:"relative w-14 rounded-lg p-1",children:[a.jsx("div",{className:B(s&&"opacity-70"),children:a.jsx(Q,{pointer:e,altLabel:t,isEditorAvailable:!1,onPercentageRendered:r,messageId:l,imageIndex:o,clientThreadId:c,serverThreadId:m,compact:!0})}),s&&a.jsx("div",{className:"border-token-border-default pointer-events-none absolute inset-0 rounded-xl border-2"})]});async function ie(e,t,s,i){const r=await _e.safePost("/image-gen/message-select",{requestBody:{message_id:e,selected_image_message_id:t,conversation_id:i}}),l=r.id;l!=null&&je(s,o=>{Re.updateTree(o,c=>{c.updateNodeMessage(l,r)})})}const mt=({pointersToRender:e,altLabel:t,isEditorAvailable:s,updatePercentageRendered:i,toolOutputMessageIds:r,clientThreadId:l,serverThreadId:o,handleEditorClick:c})=>{const m=n.useRef({}),u=n.useCallback(g=>v=>{m.current[g]=v;const h=Object.keys(m.current).length,j=Object.values(m.current).reduce((p,R)=>p+R,0);i?.(j/h)},[i]);return a.jsx("div",{className:"grid grid-cols-2 gap-2",children:e.map((g,v)=>{const h=g.metadata?.generation?.gen_id;return a.jsx(Q,{pointer:g,altLabel:t,isEditorAvailable:s,onPercentageRendered:h?u(h):void 0,messageId:r[v],imageIndex:v,clientThreadId:l,serverThreadId:o,onEditorClick:c},h)})})};function ft(e){const t=e.find(o=>o.author.role==="tool"&&o.author.name===Qe&&o.content.content_type==="text"),[s,...i]=t?.content.content_type==="text"?t.content.parts:[],r=i.pop(),l=i.length;return s&&r&&i.length>0?{thinking:s,complete:r,generating:i.reduce((o,c,m)=>{const u=(m+1)/l;return o[u.toFixed(2)]=c,o},{})}:void 0}const ht=e=>{const t=K(),{size:s="image",count:i=1}=e||{};return i>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},pt=Ne(async()=>Ee(()=>import("./dlsoz00g3d1kx3ut.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(e=>e.ImageGenNewEditor)),xt=[S.Empty,S.Errored],Ot=({messages:e,clientThreadId:t,isLastTurnInConversation:s,disableClickThru:i=!1})=>{const r=Ce(t),l=K(),o=l.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[c,m]=n.useState(!1),[u,g]=n.useState(null),[v,h]=n.useState(null),{messageIds:j,imageAssetPointers:p}=n.useMemo(()=>Ye(e),[e]),R=e.find(Xe),b=Z.useSelectedIndex(),N=p?.[b]?.metadata?.generation?.gen_size,d=ht({size:N??"image",count:p?.length??1}),w=n.useMemo(()=>ft(e)??d,[e,d]),y=e.find(E=>E.metadata?.image_gen_async),x=n.useMemo(()=>Je(e,s),[e,s]),I=n.useRef(!1),A=n.useRef(!1),C=n.useRef(null),z=n.useMemo(()=>le({pointer:p[b],conversationId:r,messageId:j[b],source:i?"paragen":"chat",imageIndex:b.toString()}),[p,j,b,r,i]);n.useEffect(()=>{if(!I.current&&(x===S.Thinking||x===S.Generating))I.current=!0,C.current=performance.now();else if(I.current&&!A.current)if(x===S.Complete){const E=C.current?performance.now()-C.current:void 0;W.generationSuccess({analyticsContext:z,durationMs:E}),A.current=!0}else x===S.Errored&&(W.generationFailure({analyticsContext:z,errorReason:"assistant_error"}),A.current=!0)},[x,z]);const G=e[e.length-1],O=n.useMemo(()=>G&&Me(G),[G]),P=re(),M=ye(P,"1215568378")?ut:mt,D=oe(P,"3019066937").get("should_use_new_ui",!1),F=De({clientThreadId:t})&&x===S.Complete,[V,$]=n.useState(0),L=n.useCallback(({image:E,messageId:U,analyticsContext:_})=>{g(E),h(U),m(!0),W.editorClick({sourceOperation:E.metadata?.dalle?.edit_op??"none",analyticsContext:_})},[]);return xt.includes(x)?null:a.jsxs(ce.Provider,{value:i,children:[a.jsx("div",{className:"flex flex-col",children:D?a.jsx(ct,{imageGenerationState:x,isInterrupted:O,asyncMessage:y,imageAssetPointer:p[0],altLabel:o,clientThreadId:t,serverThreadId:r,onEditorClick:L,setAnimationPercentage:$,isEditorAvailable:F,messageId:j[0]}):a.jsxs(a.Fragment,{children:[x!==S.Unavailable&&x!==S.AsyncGenerating&&x!==S.AsyncHanging&&a.jsx("div",{className:"pb-3",children:a.jsx(dt,{cotMessages:w,visualPercentComplete:V,isInterrupted:O,state:x})}),x===S.Thinking&&!O&&a.jsx(ue,{isDimensionsUnknown:!0,children:a.jsx(me,{withLottie:!0})}),x===S.AsyncGenerating&&!y?.metadata?.is_visually_hidden_from_conversation&&a.jsx(lt,{shimmer:!0,title:y?.metadata?.ui_card_title,description:y?.metadata?.ui_card_description}),(x===S.Generating||x===S.Complete)&&!O&&a.jsx("div",{className:"pb-2",children:p.length>1?a.jsx(M,{pointersToRender:p,altLabel:o,isEditorAvailable:F,updatePercentageRendered:$,toolCallMessage:R,toolOutputMessageIds:j,clientThreadId:t,serverThreadId:r,handleEditorClick:L}):a.jsx(Q,{pointer:p[0],altLabel:o,isEditorAvailable:F,onPercentageRendered:$,messageId:j[0],imageIndex:0,clientThreadId:t,serverThreadId:r,onEditorClick:L})})]})}),a.jsx(ke,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:c,onClose:()=>m(!1),title:l.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:u&&a.jsx(pt,{image:u,isLoadingNewImage:!1,clientThreadId:t,onClose:()=>m(!1),messageId:v??""})})]})};export{Ot as ImageGenMessage};
//# sourceMappingURL=lc6y9pvlxdqce2f7.js.map
