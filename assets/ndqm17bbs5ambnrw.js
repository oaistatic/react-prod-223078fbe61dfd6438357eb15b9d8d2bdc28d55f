import{e as $,k as b,f as F,r as g,i as L,u as x,a as Q,c as j,b as J}from"./b8ijctzpgh0s7wpx.js";import{ao as d,b as C,gj as V,gn as W,go as Y,gp as z,gq as X,ai as G,ad as P,aq as Z,aj as ee,b6 as ne,aU as te}from"./citrwydz0bgriwlc.js";import{M as oe,gP as se,gQ as R,gR as ae,v as re,gS as D,gT as y,gU as A,gV as ce,gW as ie}from"./krbmwir12ubt4od1.js";import{u as ue}from"./megablgldkh4lap1.js";import{u as le}from"./jekpe1ukp5thtucq.js";const B=()=>{const e=oe(),{connectorConfig:n,isLoading:t,error:o,refetch:a}=se(),s=n.has(d.CONFLUENCE)&&!e,r=n.has(d.GDRIVE)&&!e,i=n.has(d.JIRA)&&!e,c=n.has(d.NOTION_OPEN_CONNECTOR)&&!e,u=(n.has(d.O365_PERSONAL)||n.has(d.O365_BUSINESS))&&!e,l=n.has(d.SLACK_OPEN_CONNECTOR)&&!e;return{isConfluenceEnabled:s,isGdriveEnabled:r,isJiraEnabled:i,isNotionOpenConnectorEnabled:c,isO365Enabled:u,isSlackOpenConnectorEnabled:l,connectorConfig:n,isLoading:t,hasContextConnectorEnabled:s||r||i||c||u||l,error:o,refetch:a}},Pe=()=>{const e=F();return n=>{const t=window.location.hash,[o,a]=t.split("?"),s=new URLSearchParams(a);n?s.set(R,"true"):s.delete(R);const r=s.toString()?`${o}?${s.toString()}`:o;e(r,{replace:!0})}},ye=()=>{const{hash:e}=b(),n=e.indexOf("?");return n===-1?!1:new URLSearchParams(e.substring(n+1)).get(R)==="true"},Ae=()=>{const{hash:e}=b(),n=e.indexOf("?");return n===-1?!1:new URLSearchParams(e.substring(n+1)).get(ae)==="true"},Ie=()=>{const e=F();return n=>{const t=window.location.hash,[o,a]=t.split("?"),s=new URLSearchParams(a);n?s.set("connector",n):s.delete("connector");const r=s.toString()?`${o}?${s.toString()}`:o;e(r,{replace:!0})}},I=e=>{const{hash:n}=b();return g.useMemo(()=>{const t=n.indexOf("?");return t===-1?void 0:new URLSearchParams(n.slice(t+1)).get(e)??void 0},[n,e])},Te=()=>I("redirectAfter"),ke=()=>I("productSku"),we=()=>I("connector"),de=e=>e.supported_auth.some(n=>n.type==="OAUTH")?"OAUTH":"NONE",fe=e=>C.safePost("/aip/connectors/links/noauth",{requestBody:{connector_id:e.id,name:e.name,action_names:e.actions.map(n=>n.name)}}),Ce=async({connector:e,redirectAfter:n,shouldRedirectToConnectorDetails:t=!1,onError:o,openPopup:a,toaster:s,intl:r,productSku:i})=>{const c=V[e.id],u={connectorId:e.id,name:e.name,actionNames:e.connector_type==="MCP"||e.connector_type==="OPEN_API"?e.actions.map(l=>l.name):Y[c],oauthClientId:W(c),oauthClientScopes:null};await z({redirectUri:X,connectorPlatformParams:u,redirectTo:n||(t?`${D}?connector=${e.id}`:D),onError:o,openPopup:a,toaster:s,intl:r,productSku:i})},he=async({connector:e,shouldRedirectToConnectorDetails:n=!1,openPopup:t,toaster:o,intl:a})=>{switch(de(e)){case"OAUTH":return await Ce({connector:e,redirectAfter:void 0,shouldRedirectToConnectorDetails:n,openPopup:t,toaster:o,intl:a}),null;case"NONE":return await fe(e)}},Se=(e,n)=>C.safePost("/accounts/{account_id}/connectors/{connector_id}/publish",{parameters:{path:{account_id:n,connector_id:e}}}),Me=()=>{const e=re(),n=ue(),t=g.useMemo(()=>n.data?.connection_statuses.filter(r=>["google_drive_oauth","google_drive_dwd"].includes(r.user_connection_details.knowledge_connector_type)),[n.data]),o=B(),a=o.connectorConfig.get(d.GDRIVE),s=o.isGdriveEnabled&&!!a;return{isLoading:n.isLoading||o.isLoading,fileUploadConfig:s?a:null,internalKnowledgeEnabled:e,internalKnowledgeConfigs:e&&t?.length?t:null}},Ue=()=>{const e=B(),n=e.connectorConfig.get(d.O365_PERSONAL),t=e.connectorConfig.get(d.O365_BUSINESS);return{isLoading:e.isLoading,personalConfig:e.isO365Enabled&&n?.access_token?n:null,businessConfig:e.isO365Enabled&&t?.access_token?t:null}};async function ve(e){return(await C.safeGet("/aip/connectors/mcp/oauth_config",{parameters:{query:{mcp_url:e}}})).oauth_config}function qe(e){return C.safePost("/aip/connectors/mcp/refresh_actions",{requestBody:{link_id:e}})}function H(e){return C.safeGet("/aip/connectors/{connector_id}/conformance",{parameters:{path:{connector_id:e}}})}function ge(e){return C.safeDelete("/aip/connectors/{connector_id}",{parameters:{path:{connector_id:e}}})}const me=$({gdriveBrandName:{id:"81dp6y",defaultMessage:"Google Drive"}}),De=(e,n)=>e==="gdrive_action_connector"?n.formatMessage(me.gdriveBrandName):e;function pe(e){const{isLoading:n,error:t,refetch:o,platformConnectors:a}=y(),s=a.get(e);return{enabled:!!s&&s.status!=="DISABLED_BY_ADMIN",isLoading:n,error:t,refetch:o}}function Fe(){return pe(G[ee.GITHUB_CONNECTOR])}function _e(e,n,t){const o=ce(),a=L(),s=P(),{data:r,isLoading:i,error:c,refetch:u}=x({queryKey:["connector-client-data",e],queryFn:async()=>{const l=await C.safeGet("/aip/connectors/oauth_clients",{parameters:{query:{service:n}},additionalHeaders:{[ne]:t}});return l.oauth_clients?l.oauth_clients:(s.danger(a.formatMessage({id:"OfpT7B",defaultMessage:"Request error fetching oauth clients"}),{id:"fetch-oauth-clients-error",duration:3,hasCloseButton:!0}),[])},enabled:o});return{oAuthClients:r,isLoading:i,error:c,refetch:u}}function xe(e,n,t="/",o,a,s){const{platformConnectors:r,isLoading:i,error:c,refetch:u}=y(!0,o),{connectorLinks:l,isLoading:h,error:O,refetch:f}=A({productSku:o}),{oAuthClients:p,isLoading:T,error:K,refetch:k}=_e(e,n,o),w=Ee(),_=g.useCallback(()=>{u(),f(),k()},[u,f,k]),m=G[e],S=r.get(m),M=l.has(m),N=l.get(m)?.[0]?.id,U=g.useCallback(()=>{N&&w(N,()=>{_()},o)},[w,_,N,o]),v=c??O??K,E=i||h||T,q=g.useCallback(()=>{if(!E){if(!S){a?.();return}if(!p?.length){s?.();return}window.location.hash=`#settings/ConnectorSettings?connector=${m}&add-connector-link=true&redirectAfter=${t}&productSku=${o}`}},[E,S,p,m,a,s,t,o]);return g.useMemo(()=>({isLoading:E,isConnected:M,openGithubModal:q,error:v,refetch:_,handleDisconnect:U}),[E,M,q,v,_,U])}function Ge(){"use forget";const e=j.c(14),n=L(),t=P(),o=le(),{refetch:a}=y(),{refetch:s}=A();let r;e[0]!==n||e[1]!==o||e[2]!==t?(r=async l=>{const{supported_auth:h,...O}=l,{connector:f}=await C.safePost("/aip/connectors/mcp",{requestBody:{...O,auth_request:{supported_auth:h,oauth_client_params:null}}});if(f.supported_auth.length===0&&!(await H(f.id)).implements_retrievable)return await ge(f.id),{connector:null,link:null,implementsRetrievable:!1};const p=await he({connector:f,shouldRedirectToConnectorDetails:!0,openPopup:o,toaster:t,intl:n});return{connector:f,link:p,implementsRetrievable:!0}},e[0]=n,e[1]=o,e[2]=t,e[3]=r):r=e[3];let i;e[4]!==n||e[5]!==t?(i=l=>{const h=l instanceof te&&l.status===409?n.formatMessage({id:"Tedt6I",defaultMessage:"Connector name already exists"}):n.formatMessage({id:"9J7rOY",defaultMessage:"Error creating connector"});t.danger(h)},e[4]=n,e[5]=t,e[6]=i):i=e[6];let c;e[7]!==a||e[8]!==s?(c=()=>{a(),s()},e[7]=a,e[8]=s,e[9]=c):c=e[9];let u;return e[10]!==r||e[11]!==i||e[12]!==c?(u={mutationFn:r,onError:i,onSettled:c},e[10]=r,e[11]=i,e[12]=c,e[13]=u):u=e[13],J(u)}function Ee(){const e=L(),n=P(),t=Z(),o=A(),a=Q();return async(r,i,c)=>{try{await ie(r,c),a.invalidateQueries({queryKey:["fetchConnectorLinkData",t?.normalizedAccountUserId]}),await o.refetch(),i?.()}catch{n.danger(e.formatMessage({id:"Gmong7",defaultMessage:"Error disconnecting connector"}))}}}function Be(e,n=!0){return x({queryKey:["checkConnectorConformance",e],queryFn:async()=>(await H(e)).implements_retrievable,enabled:n})}export{Fe as a,xe as b,B as c,Ie as d,Ee as e,Me as f,Ue as g,ge as h,de as i,fe as j,Be as k,De as l,we as m,Ce as n,Te as o,Se as p,ke as q,qe as r,Ge as s,ve as t,pe as u,ye as v,Ae as w,Pe as x};
//# sourceMappingURL=ndqm17bbs5ambnrw.js.map
