import{ej as m,gz as f,fa as v,ed as p,gK as g}from"./citrwydz0bgriwlc.js";import{ju as D}from"./krbmwir12ubt4od1.js";import{r as u}from"./b8ijctzpgh0s7wpx.js";const y=300,I=async(a=1)=>{let e=0,s;return new Promise(t=>{const i=r=>(s||(s=r),r-s<a*1e3?(e+=1,requestAnimationFrame(i)):t(Math.floor(e/a)));requestAnimationFrame(i)})},_=a=>{const e=u.useRef(a),s=u.useCallback(t=>{(e.current[0]!==t.width||e.current[1]!==t.height)&&(e.current=[t.width,t.height])},[]);return{canvasSizeRef:e,handleCanvasSizeUpdate:s}},E=a=>{const{voiceSessionId:e,server:s,voiceMode:t,audioInputDevice:i,voiceStatus:r}=a;return{voice_session_id:e??"(none)",server_messages:s.messages.map(n=>n.type).join(","),rate_limit_message:JSON.stringify(s.usage?.rate_limit_message)??"(none)",audio_s:s.usage?.audio_s??"(none)",tool_update:s.toolUpdate?.type??"(none)",voice_connection_quality:s.voiceConnectionQuality??"(none)",voice_mode:t??"(none)",audio_input_device:i?.label??"(none)",voice_status:JSON.stringify(r)??"(none)"}};function d(a){return a instanceof DOMException&&a.name==="NotAllowedError"?(m.permissions.denied({message:a.message}),!0):!1}class c{static instance=new c;userMediaPromiseMap=new Map;constructor(){}static getLocalDevices(e,s=!0){return c.instance.getDevices(e,s)}async getDevices(e,s=!0){if(this.userMediaPromiseMap.size>0)try{e?await this.userMediaPromiseMap.get(e):await Promise.all(Array.from(this.userMediaPromiseMap.values()))}catch(i){console.warn("error waiting for media permissions",i)}let t=await navigator.mediaDevices.enumerateDevices();if(s&&!(f()&&this.hasDeviceInUse(e))&&(t.filter(r=>r.kind===e).length===0||t.some(r=>{const n=r.label==="",o=e?r.kind===e:!0;return n&&o}))){const r={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"},n=await navigator.mediaDevices.getUserMedia(r);t=await navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(o=>{o.stop()})}return e&&(t=t.filter(i=>i.kind===e)),t}hasDeviceInUse(e){return e?this.userMediaPromiseMap.has(e):this.userMediaPromiseMap.size>0}}async function P(a){let e;try{e=await c.getLocalDevices(a)}catch(i){d(i),D.debug("Error fetching local devices",i);return}const s={};for(const i of e)i.kind===a&&(s[i.groupId]||(s[i.groupId]=[]),s[i.groupId].push(i));for(const i in s){const r=s[i];if(r.length>1&&r.find(o=>o.deviceId==="default")){const o=r.find(l=>l.deviceId!=="default");if(o)return o}}let t;for(const i of e)if(i.kind===a){if(i.deviceId==="default")return i;t||(t=i)}return t}const A=()=>{const a=v()&&p;return async()=>{if(a)return await g();try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),s=await navigator.mediaDevices.enumerateDevices();return e.getTracks().forEach(i=>i.stop()),s.some(i=>i.kind==="audioinput"&&i.label!=="")}catch(e){if(!d(e))throw e;return!1}}};export{c as D,y as T,_ as a,E as e,P as g,I as m,A as u};
//# sourceMappingURL=ew4qkwsudvfaa6ws.js.map
