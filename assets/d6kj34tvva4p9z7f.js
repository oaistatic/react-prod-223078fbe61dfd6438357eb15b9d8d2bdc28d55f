const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gcji6npparneeh7f.js","assets/b8ijctzpgh0s7wpx.js","assets/krbmwir12ubt4od1.js","assets/citrwydz0bgriwlc.js","assets/root-gxczc0vy.css","assets/conversation-small-dfayqh3x.css","assets/grmx1v2b0e1c1pfw.js","assets/jy1u8exw8iz2slve.js","assets/m4qet7ipn6ha09it.js","assets/hbpbckirom363mgh.js","assets/by50z05oxjtbvc0n.js","assets/eq7m7kpdgo83dcz8.js","assets/hu7jamjectvubclw.js","assets/m27qwee0va0l7e3n.js","assets/eqsdgkbw87fpj3r7.js","assets/f76gy0b8ieo4s693.js","assets/gy64pge8qevmvg7e.js","assets/ku4zsoy6w4wkp690.js","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js","assets/bhqc37jb73aufzkm.js","assets/n8y79r98tvk4ovf6.js","assets/noq8k3whf0dyc5h2.js","assets/fl25v7yedm9z0cyb.js","assets/n4e94a1v0wut7i04.js","assets/5l7gzqkfu3rktsj8.js","assets/h6aag2lelyp3pu40.js","assets/j2zbz2jpl151yhf4.js","assets/h3axfhhn58bmthc9.js","assets/eg629yaevviy8e7x.js","assets/hf1qeqo8wh44t1id.js","assets/nv8u6v964bkr3z82.js","assets/bt7o8eyltdx74vk0.js","assets/c23qlyb7rng4ydyc.js","assets/k00srulxk3kjmgxy.js","assets/iki1bxy2syl3zwuv.js","assets/b4v20hsjdnh8a64d.js","assets/dcml6fn13vfm1zv2.js","assets/nvghija6qp2cunds.js","assets/djd85tifm57yisqi.js","assets/h3krx8dg2s8o2yh5.js","assets/cfe0bfy5asp94vp2.js","assets/jkznwfhp8ahnvlot.js","assets/megablgldkh4lap1.js","assets/izdon3syh095bs23.js","assets/dweroubxngal4vlb.js","assets/i7jya7stlyvnzya0.js","assets/cb2t82g498wwhuc2.js","assets/ndwtlsjk3xm27wkq.js","assets/o0ebhsapkoy5qkg1.js","assets/k7nub2yuxq70se07.js","assets/k6ccgr4wxcppeg93.js","assets/dbalwdodzoo02ru2.js","assets/c2d9eukr2hh7n3q0.js","assets/k5qjx4jdow04k7d2.js","assets/ocq21rw37s5jtm4i.js","assets/kwgbehxqut2f64bk.js","assets/btagl6w1gub4aw61.js","assets/bwynn45z6zc8ip0h.js","assets/gwv677ulwq7fl4zg.js","assets/mzkxlhrlmxhntkvn.js","assets/l3rtpckh3mar95pc.js","assets/l2tp0nqi0x7r5660.js","assets/bzpm2hv3f3hhm416.js","assets/oyzab3j7hun2568h.js","assets/dera5bljhpg5ja89.js","assets/hs2fsda156wfk7fz.js","assets/pfex3j43xcablmav.js","assets/pc9qsszhmtx9pu7o.js","assets/be0n9593bbjhdouz.js","assets/gbxx25eoj7wtyna0.js","assets/bzsolvz1ulyrc61b.js","assets/pc2givv05uuq8g6l.js","assets/nhujhl3wh6ze4xx0.js","assets/dm5mep2m6tn7mvrw.js","assets/f1me09ge0a4pvkug.js","assets/mw39pbo6szk09iqp.js","assets/ga473l12pn4idd7t.js","assets/otl51en3t0ec5n7s.js","assets/eigi8l95ddhoqirr.js","assets/etmxhiuvgu79utu0.js","assets/ct6yhczwft8t5t9k.js"])))=>i.map(i=>d[i]);
import{h6 as ne,ca as Fe,n as oe,a_ as de,aN as Oe,aO as Be,ak as ze,d7 as et,a as st,bK as tt,aJ as te,ct as at,at as We,cw as it,bX as hs,ha as xs,bW as vs,a$ as De,c8 as nt,hb as ot,h as rt,cs as lt,cx as ct,cy as dt,j as He,ad as ie,c7 as O,af as $e,l as ae,ab as qe,B as pe,F as Ve,c as re,f as ut,aR as js,O as Qe,aK as Se,e as ys,aq as Ye,cQ as he,S as mt,aU as ft,de as Ms,Q as bs,_ as ws,fI as gt,cZ as xe,bj as pt,fN as Ps,db as ht,cp as xt,aI as as,aF as is,h1 as vt,d5 as jt,d6 as yt,eP as Mt,fH as bt,gP as wt,ei as Pt}from"./citrwydz0bgriwlc.js";import{R as Ts,r as d,j as e,i as H,a as ks,e as le,M as u,f as ue,ac as Tt,a6 as kt,a5 as Ss,D as St,p as _t}from"./b8ijctzpgh0s7wpx.js";import{eu as It,ok as Ct,f0 as W,ol as _s,bS as Is,om as Cs,on as Ns,b as Gs,bL as ye,bM as As,m8 as Ke,fk as Nt,fr as Gt,fa as At,bk as zt,f8 as Re,cr as z,fb as be,fc as ee,cu as zs,fm as Xe,fu as ve,fh as je,oo as Rt,id as Rs,aX as Ze,cv as Ls,cw as Lt,ds as Ut,gn as Et,op as Ft,ft as Je,dY as J,aL as Us,o1 as Ot,bY as Bt,l8 as se,ad as Wt,oq as Le,fd as Dt,fn as Ht,fo as $t,aN as qt,e_ as Es,f2 as Vt,e$ as Fs,or as Qt,os as Yt,f1 as Kt,aK as Xt,f4 as Zt,f5 as Ue,f6 as Jt,ot as ea,nY as ns,ou as _e,ov as sa,ih as os,ow as Os,ox as ta,fy as Bs,l9 as Y,la as K,lb as Ie,oy as aa,oz as ia,lc as na,oA as oa,oB as ra,fz as la,le as ca,li as da,oC as rs,cs as ua,T as ma,gA as fa,oD as ga,oE as pa,jU as ha,dI as xa,U as ls,ld as va,oF as ja,e as ya,m6 as Ma,mk as cs,X as ba,oG as wa,oH as Pa,d as Ta,oI as ka,oJ as ds,oK as us,oL as Sa,r as _a,kc as Ia,e7 as ms,F as Ca}from"./krbmwir12ubt4od1.js";import{G as Na,A as ce,M as Ws,a as Ga,b as fs,s as Aa,S as za,c as Ra,g as La,d as Ua}from"./l2tp0nqi0x7r5660.js";import{a as Ea}from"./cfe0bfy5asp94vp2.js";import{M as Ds}from"./bzpm2hv3f3hhm416.js";import{u as Hs}from"./ku4zsoy6w4wkp690.js";import{i as Ee}from"./dm5mep2m6tn7mvrw.js";import{S as Fa}from"./c23qlyb7rng4ydyc.js";import{G as $s}from"./dcml6fn13vfm1zv2.js";import{G as Oa}from"./f1me09ge0a4pvkug.js";import{S as Ba}from"./mw39pbo6szk09iqp.js";import{u as qs}from"./o0ebhsapkoy5qkg1.js";import{h as Wa}from"./jkznwfhp8ahnvlot.js";import{G as Da}from"./ga473l12pn4idd7t.js";import{b as Ha}from"./otl51en3t0ec5n7s.js";import{T as $a}from"./c2d9eukr2hh7n3q0.js";import{c as qa,f as Va}from"./b4v20hsjdnh8a64d.js";function Qa(s,t){const a=de(s),i=oe.getTree(a),n=[];let o=oe.getCurrentNode(a);for(;o!=null&&(t==null||o.id!==t);)n.unshift(o.message),o=o.parentId!==""?i.getNodeByIdOrMessageId(o.parentId):void 0;return n}function Ya(s){return s.filter(i=>i.recipient==="gizmo_editor.update_behavior").flatMap(i=>i.content.content_type==="text"?i.content.parts:i.content.content_type==="code"?[i.content.text]:[]).map(i=>JSON.parse(i)).reduce((i,n)=>({...i,...n}),{})}async function Ka(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const i=at.getImageAssetPointers(a);i.length>0&&(t=i.at(-1))}if(t!=null){const a=It(t.asset_pointer),i=await Oe.getFileDownloadLink(a);if(i.status===Be.Success)return{id:a,permalink:i.download_url}}}async function Xa(s,t,a,i){const n=Qa(t,i),o=Ya(n);let l=await Ka(n);if(Ee(o)&&l==null)return;const{name:m,context:c,description:v,profile_pic_file_id:r,prompt_starters:b}=o;if(r!=null)try{const f=await Oe.getFileDownloadLink(r,s.id);f.status===Be.Success&&(l={id:r,permalink:f.download_url})}catch(f){ze.addError(new Error("Error while retrieving profile pic in update",{cause:f})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const j={name:typeof m=="string"?m:void 0,description:typeof v=="string"?v:void 0,instructions:typeof c=="string"?c:void 0,promptStarters:Array.isArray(b)?b:void 0,profilePictureId:l?.id,profilePictureUrl:l?.permalink};return et(j,f=>f!=null)}function Za(s){const t=new Set;for(const c of s.tools)t.add(c.type);const a=s.name??"",i=s.description??"",n=s.instructions??"",o=Array.from(t).join(","),l=a===""&&i===""&&n==="",m=s.profilePictureUrl!=null;return l?`The GPT you are about to has the following abilities: ${o}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${i}

context: ${n}

abilities: ${o}

${m?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const Ja=10;function Vs(s,t){const a=s.current,i=t.current;if(Fe(a,i))return;const n={};a.name!==i?.name&&(n.name=a.name),(a.description??"")!==(i?.description??"")&&(n.description=a.description??""),a.instructions!==(i?.instructions??"")&&(n.context=a.instructions??"");const o=new Set(i?.files?.map(r=>r.file_id)??[]),l=new Set(a.files?.map(r=>r.file_id)??[]),m=(a.files??[]).filter(r=>!o.has(r.file_id)),c=(i?.files??[]).filter(r=>!l.has(r.file_id));if(Ee(n)&&m.length===0&&c.length===0)return;const v=[];if(!Ee(n)){const r=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;v.push(ne(r))}if(c.length>0&&v.push(ne(`The user has removed the following files from the GPT. You can no longer reference these files: ${c.map(r=>r.file_id).join(", ")}`)),m.length>0){const r=m.slice(0,Ja);v.push(ne(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${r.map(b=>b.file_id).join(", ")}`,{attachments:r.map(b=>({id:b.file_id,name:b.name,size:b.size}))}))}return v}function ei(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(a=>`"${a.fileId}"`).join(", ")}`;return[ne(t)]}function si(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!oe.findNode(de(s),i=>i.message.content.content_type==="text"&&i.message.content.parts[0]===t))return[ne(t)]}function ti(s,t){const{session:a}=st();tt.initThread({clientThreadId:s,conversationMode:{kind:te.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t},userId:a?.user?.id,accountId:a?.account?.id});const i=Hs(s);return async(o,l,m,c)=>{i({sourceEvent:o,promptMessage:ne(c),prependMessages:Vs(l,m),completionMetadata:{conversationMode:{kind:te.GizmoMagicCreate,gizmo_id:l.current.id,behavior_overrides:t}}})}}const ai="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.";function ii(s,t){d.useEffect(()=>{oe.findNode(de(s),i=>ot(i.message)||i.message.author.role===rt.System&&i.message.content.content_type===lt.Text)||De(s,i=>{ct.updateTree(i,(n,o)=>{const l=n.findNode(m=>m.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,o);return l&&(l.id===o&&(o=n.rootId),n.deleteNode(l.id)),t?n.addMessageNode(o,dt(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):o})})},[s,t])}function ni(s,t,a){const{data:i}=hs(),n=i?.models.get(xs)??(i&&Ns(i.models.values(),l=>l.tags.includes(vs.GPT_4o)));Gs(s,{kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a},{forcedModelId:n?.id}),d.useEffect(()=>{De(s,l=>{l.mode={kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:nt(a)},l.modelId=n?.id??l.modelId})},[s,t.id,a,n]);const[o]=d.useState(()=>{const l=t.id==null,m=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return l?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:m?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});ii(s,o)}function oi({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:l}){const m=d.useRef(l);m.current=l;const c=d.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:m.current}),[s,n]),v=Ct(b=>b.files.filter(j=>j.status===W.Ready&&j.gizmoId!=null)),r=d.useCallback(b=>{if(t(j=>({...j,files:[...j.files??[],...We(v.map(f=>f.fileId!=null&&{file_id:f.fileId,name:f.file.name,size:f.file.size,type:_s(f.file),last_modified:f.file.lastModified,file_size_tokens:f.fileSpec?.fileTokenSize}))]})),o.current=Is(i.current),!b.completionType||b.completionType===it.Next){const j=oe.getCurrentNode(de(a)),f=j.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?j.message:void 0;f&&(b.existingMessages=[f]),b.prependMessages=[...ei(v)??[],...Vs(i,o)??[],...si(a)??[],...b.prependMessages??[]]}return b},[a,v,i,o,t]);return e.jsx(Cs.Provider,{value:c,children:e.jsx("div",{className:"relative flex h-full grow overflow-auto",children:e.jsx("div",{className:"grow",children:e.jsx(Ds,{clientThreadId:a,getGizmosCompletionParams:r,hideHeader:!0})})})})}const ri=Ts.memo(oi);function li({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,showActionsModal:l,shareOnly:m,onClose:c}){const[v,r]=d.useState({type:"privacy"});return v.type==="privacy"?e.jsx(di,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,setStep:r,showActionsModal:l,shareOnly:m,onClose:c}):e.jsx(ui,{publishedGizmo:v.publishedGizmo,onClose:c})}function ci(s){return s?z.Workspace:z.Link}function di({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:o,setStep:l,showActionsModal:m,shareOnly:c,onClose:v}){const r=He(),[b,j]=d.useState(!1),f=ye(As.isBusinessWorkspace),M=H(),k=ie(),[h,S]=d.useState(Ke(s)?ci(!!f):s.sharingRecipient),I=ks(),w=Nt(h,s.sharingTargets),{data:_,isLoading:x}=Gt(),g=At(),[P,N]=d.useState(t!=null&&t.gizmo.display.categories.length>0?g.data?.categories.find(y=>y.id===t.gizmo.display.categories[0])?.id:void 0);d.useEffect(()=>{N(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[E,G]=d.useState(void 0),U=d.useRef(zt((y,A)=>Re.generateCategory(y,A),1e3)),F=_?.is_verified?void 0:M.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});h===z.Marketplace&&F!=null&&!x&&S(z.Link);const B=f&&!s.sharingTargets?.some(y=>y.recipient===z.Link),R=be(s,h,P),$=R.includes(ee.MissingPublicActionPrivacyPolicyURL),we=s.tools.find(y=>y.type===O.JIT_PLUGIN&&!y.metadata.privacy_policy_url),q=ye(y=>y.currentWorkspace),Q=$e();d.useEffect(()=>{let y=!0;return(async()=>{try{if(P!=null)return;const A=await U.current(s.name,s.instructions);y&&P==null&&(A?N(A.id):G(!0))}catch{y&&P==null&&G(!0)}})(),()=>{y=!1}},[s.instructions,s.name,Q,P]);const{value:me}=ae("4226692983");return e.jsx(qe,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:v,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:w?e.jsx(pe,{color:"primary",disabled:R.length>0,loading:b,onClick:async()=>{try{if(j(!0),c){if(!t?.gizmo.id){k.danger(M.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const y=await Re.shareGizmo(t.gizmo.id,P?{sharing:ve(h,[],je),categories:[P]}:{sharing:ve(h,[],je)});y.error?(k.warning(M.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:y.sharing_targets}),o({gizmoId:t.gizmo.id,sharingRecipient:h,categories:t.gizmo.display.categories,moderationType:Ws.PublishBlocked,sharingTargets:y.sharing_targets,showModal:ce.AppealAvailable})):(I.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],A=>y.resource),a(A=>({...A,sharingRecipient:h})),k.success(M.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),v())}else{const y=await i({recipient:h,subjects:ve(h,[],je)},P);y?(l({type:"published",publishedGizmo:y}),a(A=>({...A,id:y.gizmo.id,sharingRecipient:h})),y.gizmo.live_version!=null&&a({liveVersion:y.gizmo.live_version}),k.success(M.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(k.warning(M.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),v())}}finally{j(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):me?e.jsx(e.Fragment,{children:e.jsx(pe,{color:"primary",onClick:async()=>{await n(h,P)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(pe,{color:"secondary",onClick:y=>Xe(r,t,k,y,M.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(zs,{value:h,onValueChange:y=>S(y),children:[s.sharingTargets&&s.sharingTargets.map((y,A)=>e.jsx(Ce,{value:y.recipient,disabled:y.recipient===z.Marketplace&&F!=null,tooltipText:y.recipient===z.Marketplace?F??M.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:y.recipient},A)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{value:z.Link,disabled:!0,tooltipText:M.formatMessage(gs.workspaceDisabledHint),shareLevel:z.Link,workspaceName:q?.name}),e.jsx(Ce,{value:z.Link,disabled:!0,tooltipText:M.formatMessage(gs.workspaceDisabledHint),shareLevel:z.Marketplace,workspaceName:q?.name})]})]})}),$&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:y=>e.jsx("button",{onClick:()=>{m(we?.metadata.action_id)},className:"underline",children:y})}})}),h!==z.Private&&e.jsx(Na,{gizmo:s,category:P,categories:h===z.Marketplace?g.data?.categories??[]:void 0,onCategoryChange:h===z.Marketplace?y=>N(y.id):void 0}),h===z.Marketplace&&(E?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!w&&me&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ui({publishedGizmo:s,onClose:t}){const a=He(),i=Rt(a,s),n=H(),o=ie();return e.jsx(qe,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:t,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(pe,{color:"primary",as:"link",to:i,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:i}),e.jsx("button",{onClick:l=>{Xe(a,s,o,l,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Rs,{className:"icon-sm"})})]})})})}const gs=le({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ce({shareLevel:s,workspaceName:t,value:a,disabled:i=!1,tooltipText:n}){const o=d.useId();return e.jsx(Ze,{disabled:n==null,label:n,side:"top",triggerAs:null,children:e.jsxs(Ls,{id:o,value:a,disabled:i,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:o,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Ga,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Lt,{children:e.jsx(Ut,{className:"icon-lg me-1"})})]})})}function Me(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Qs(s){window.history.length>1?s(-1):s(Ft())}function mi({gizmo:s,publishedGizmo:t,isUpsertLoading:a,isPromoteLoading:i,isUploadingProfilePic:n,isGeneratingProfilePic:o,updateGizmo:l,promoteGizmo:m,appealGizmo:c,setAppealState:v,showActionsModal:r}){const b=ut(),j=s!=null?be(s):[];(s==null||i||a)&&j.push(ee.Loading),n&&j.push(ee.UploadingProfilePic),o&&j.push(ee.GeneratingProfilePic);const f=Ke(s),[M,k]=d.useState(!1),[h,S]=d.useState(!1),I=s.sharingRecipient?fs[s.sharingRecipient]:fs.private,w=i||a;return e.jsxs(e.Fragment,{children:[f?e.jsx(se,{color:"primary",onClick:()=>k("promote"),loading:a,disabled:w||s.id===void 0||j.length>0,tooltip:j.length>0?j.map(Le).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(u,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"secondary",loading:i||!t,disabled:w,icon:I,onClick:()=>k("share"),children:e.jsx(u,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(se,{color:"primary",onClick:async()=>{let _=s.sharing.subjects.map(Aa);const x=Dt(s.sharing.subjects);_=ve(s.sharing.recipient,_,x?.capabilities??je);const g=t&&Me(t)?t.gizmo.display.categories[0]:void 0;await m({recipient:s.sharing.recipient,subjects:_},g)&&S(!0)},loading:a||!t,disabled:w||j.length>0,tooltip:j.length>0?j.map(Le).join(`
`):void 0,children:e.jsx(u,{id:"84QVoj",defaultMessage:"Update"})})]}),M&&(b?.getWorkspaceId()==null?e.jsx(li,{gizmo:s,publishedGizmo:t,promoteGizmo:m,appealGizmo:c,setAppealState:v,showActionsModal:r,updateGizmo:l,shareOnly:M==="share",onClose:()=>k(!1)}):e.jsx(za,{gizmo:s,publishedGizmo:t,promoteGizmo:m,appealGizmo:c,setAppealState:v,showActionsModal:r,updateGizmo:l,onClose:()=>k(!1),shareOnly:M==="share"})),h&&t&&e.jsx(Ra,{publishedGizmo:t,sharing:Me(t)?t.gizmo.sharing:void 0,onClose:()=>S(!1),workspaceName:b?.data.name??""})]})}function fi({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const i=He(),n=H(),o=ie(),l=ue(),[m,c]=d.useState(!1),v=$e(),{value:r}=ae("3645668434"),b=t&&Me(t)?t.gizmo.current_user_permission?.can_delete:!1;return!(t||a||s?.id&&r&&s.liveVersion>0||b||v?.includes("debug"))?null:e.jsxs(e.Fragment,{children:[e.jsxs(Je,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(se,{color:"ghost",icon:Wt}),children:[t!=null&&e.jsxs(J.Item,{onClick:f=>{Xe(i,t,o,f)},children:[e.jsx(Us,{className:"icon-sm"}),e.jsx(u,{...V.copyLink})]}),a!=null&&e.jsxs(J.Item,{onClick:()=>{window.confirm(n.formatMessage(V.revertConfirm))&&a()},children:[e.jsx(Ot,{className:"icon-sm"}),e.jsx(u,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&r&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(J.Item,{onClick:()=>{l(`/g/${s.id}/view`)},children:[e.jsx(Fa,{className:"icon-sm"}),e.jsx(u,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(J.Item,{onClick:async()=>{const f=await Re.copyGizmo({gizmoId:s.id});f.gizmo.id&&l(`/gpts/editor/${f.gizmo.id}`)},children:[e.jsx(Rs,{className:"icon-sm"}),e.jsx(u,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&Me(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(J.Item,{color:"danger",onClick:()=>{c(!0)},children:[e.jsx(Bt,{className:"icon-sm"}),e.jsx(u,{id:"tNrOLG",defaultMessage:"Delete GPT"})]})]}),m&&e.jsx(Oa,{gizmoId:s?.id||"",onSuccess:()=>Qs(l),onClose:()=>{c(!1)}})]})}const ge=Ve.div`flex items-center gap-1`;function gi({gizmoEditorData:s}){const t=ye(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case z.Private:return e.jsxs(ge,{children:[e.jsx(qt,{className:"icon-xs"}),e.jsx(u,{...V.onlyMe})]});case z.Link:return e.jsxs(ge,{children:[e.jsx(Us,{className:"icon-xs"}),e.jsx(u,{...V.anyoneWithLink})]});case z.Workspace:return e.jsxs(ge,{children:[e.jsx($t,{className:"icon-xs"}),t]});case z.Marketplace:return e.jsxs(ge,{children:[e.jsx(Ht,{className:"icon-xs"}),e.jsx(u,{...V.public})]});default:return e.jsx("div",{})}}function pi({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx($s,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(u,{...V.newGPT})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:Ke(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),e.jsx(u,{...V.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),s.sharingRecipient===z.Marketplace?e.jsx(u,{...V.published}):e.jsx(u,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(u,{...V.dotSeparator,tagName:"span"}),e.jsx(gi,{gizmoEditorData:s})]})})]})]})}const hi=Ve.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function xi({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,publishedGizmo:o,updateGizmo:l,promoteGizmo:m,appealGizmo:c,setAppealState:v,revertDraft:r,draftMessage:b,className:j,hasUnpublishedChanges:f,showActionsModal:M}){const k=ue();return e.jsxs("div",{className:re("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",j),children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Qs(k),children:e.jsx(Et,{className:"icon"})}),e.jsx(pi,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&(o?.gizmo?.live_version??0)>1&&e.jsx(hi,{onClick:()=>k(`/g/${s.id}/view`),children:e.jsx(u,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(Tt,{value:o.gizmo.updated_at,day:"numeric",month:"short",year:new Date(o.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),b,e.jsx(fi,{gizmoEditorData:s,publishedGizmo:o,revertDraft:r}),e.jsx(mi,{gizmo:s,publishedGizmo:o,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,updateGizmo:l,promoteGizmo:m,appealGizmo:c,setAppealState:v,hasUnpublishedChanges:f,showActionsModal:M})]})]})}const V=le({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),vi=512;function ji(){return e.jsx("div",{className:"border-token-border-medium relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Qe,{className:"h-1/4 w-1/4"})})}function yi({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:i,setIsGeneratingProfilePic:n}){const o=H(),l=ie(),[m,c]=d.useState(void 0),v=d.useRef(t);d.useEffect(()=>{v.current=t});async function r(f){if(f.length>0){n(!1);const M=await Zt(f[0],vi),k=Ue(M);c({tempId:k,file:M,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),v.current("uploading"),Jt(k,M,o,l,js.ProfilePicture,{onFileCreated(h,S,I){c(w=>w!=="initial"&&w?.tempId===h&&w.status===W.Uploading?{...w,progress:10,fileId:S,cdnUrl:I}:w)},onFileUploadProgress(h,S){c(I=>I!=="initial"&&I?.tempId===h&&I.status===W.Uploading?{...I,progress:S}:I)},onFileUploaded(h,S,I){c(w=>w!=="initial"&&w?.tempId===h?(v.current(w),{...w,status:W.Ready,progress:100,fileSpec:{name:w.file.name,id:w.fileId,size:w.file.size,...I??{}}}):w)},onError(h){c(S=>{if(S!=="initial"&&S?.tempId===h){v.current(void 0);return}return S})}})}}const{open:b,getInputProps:j}=qs({disabled:!1,noClick:!0,onDropAccepted:r,onDropRejected:f=>Wa(f,o,l,Qt.ProfilePicture),multiple:!0,maxSize:Fs,...Es(Vt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Je,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:i?e.jsx(ji,{}):m!=null&&m!="initial"&&m.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Yt,{file:m.file}),m.status===W.Uploading&&m.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Kt,{percentage:m.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx($s,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Xt,{className:"text-4xl"})})}),children:[e.jsx(J.Item,{onClick:b,children:e.jsx(u,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(J.Item,{onClick:a,children:e.jsx(u,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...j()})]})}function Mi({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:i}){const n=H(),o=ie(),[l,m]=d.useState(0),c=d.useRef(new Map),v=ea(a,void 0),r=async g=>{ys.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const P=await t();g.length>0&&await Promise.all(g.map(N=>{const E=Ue(N);c.current.set(E,{tempId:E,gizmoId:P,file:N,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),sa(Ue(N),N,n,o,{kind:js.Gizmo,gizmoId:P},{onFileUploaded:(G,U,F,B)=>{const R=c.current.get(G);R==null||R.fileId==null||(i($=>({...$,files:[...$.files??[],{file_id:R.fileId,name:R.file.name,size:R.file.size,type:B?.mimeType??_s(N),last_modified:R.file.lastModified,file_size_tokens:B?.fileTokenSize}]})),c.current.delete(G),m($=>$+1))},onFileCreated:(G,U,F)=>{c.current.set(G,{tempId:G,gizmoId:P,file:N,status:W.Uploading,progress:1,...c.current.get(G),fileId:U,cdnUrl:F}),m(B=>B+1)},onFileUploadProgress:(G,U)=>{const F=c.current.get(G);F?.status===W.Uploading&&c.current.set(G,{...F,progress:U}),m(B=>B+1)},onError:G=>{c.current.delete(G)}},{usesRetrievalIndex:a!=null&&_e(a,N.type,N.name)===Se.Retrieval})}))},{getInputProps:b,open:j}=qs({disabled:!1,noClick:!0,onDropAccepted:r,multiple:!0,maxSize:Fs,maxFiles:10,...Es(v)}),f=s?.files??[];function M(g){return e.jsx(os,{onRemoveFileClick:()=>{c.current.delete(g.tempId),m(P=>P+1)},file:g.file,loadingPercentage:g.status===W.Uploading?g.progress:void 0},g.tempId)}function k(g){return e.jsx(os,{file:g.name,fileId:g.file_id,onRemoveFileClick:()=>i(P=>({...P,files:P?.files?.filter(N=>N.file_id!==g.file_id)})),gizmoId:s?.id},g.file_id)}const h=Array.from(c.current.values()).filter(g=>f.every(P=>P.file_id!==g.fileId)),[S,I]=ns(h,g=>a!=null&&_e(a,g.file.type,g.file.name)===Se.CodeInterpreter),[w,_]=ns(f,g=>a!=null&&g.type!=null&&_e(a,g.type,g.name)===Se.CodeInterpreter),x=d.useRef(w.length);return d.useEffect(()=>{w.length>x.current&&i(g=>g.tools?.some(P=>P.type===O.PYTHON)?g:{...g,tools:[...g.tools??[],{type:O.PYTHON}]}),x.current=w.length},[w.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:e.jsx(u,{...bi.knowledgeWarning})}),I.length>0||_.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[I.map(M),_.map(k)]}):null,S.length>0||w.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(u,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.map(M),w.map(k)]})]}):null,e.jsx("div",{children:e.jsxs(se,{onClick:j,children:[e.jsx("input",{...b()}),e.jsx(u,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const bi=le({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function wi({placeholder:s,text:t,onChange:a,onClose:i}){return e.jsxs(qe,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:i,primaryButton:e.jsx(se,{onClick:i,children:e.jsx(u,{id:"FeFVdS",defaultMessage:"Close"})}),children:[e.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:t,onChange:n=>{a(n.target.value)},placeholder:s}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...Os.instructionsWarning})})]})}const Ne=Ve.div`text-sm text-red-500`;function Pi({children:s,collapsed:t,initial:a}){return e.jsx(kt,{initial:a,children:!t&&e.jsx(Ss.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function Ti({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const i=H(),n=ie(),o=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((l,m)=>l.type!==O.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(ca,{isDisabled:a,actionTool:l,onShowActionsEditor:()=>t(l.metadata.domain)}),l.metadata.auth?.type==="oauth"&&e.jsx(da,{label:i.formatMessage(L.callbackUrlLabel),value:`https://chat.openai.com/aip/${l.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},m)),(s?.tools?.filter(l=>l.type===O.JIT_PLUGIN)??[]).length>=rs?e.jsx("div",{children:i.formatMessage(L.maxActionsReached,{number:rs})}):e.jsx(se,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(u,{...L.createActionLabel})})]});return a?e.jsx(Ze,{side:"top",label:i.formatMessage(L.disabledCustomActionsTooltip),children:o}):o}function ki(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===O.JIT_PLUGIN)}function Si({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:i,setIsUploadingProfilePic:n,isGeneratingProfilePic:o,setIsGeneratingProfilePic:l,requireGizmoId:m,onShowActionsEditor:c}){const v=s?.tools??[],[r,b]=d.useState(!1),[j,f]=d.useState(!0),M=s?.promptStarters??[],k=[...M,...M.length<ta?[""]:[]],h=be(s),I=Ye()?.isWorkspaceAccount(),w=Bs(he.WorkspaceGPTCustomActions),_=H();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Y,{children:[e.jsx(yi,{gizmoEditorData:s,generateProfilePic:i,isGeneratingProfilePic:o,setIsGeneratingProfilePic:l,onFileChange:async x=>{if(x!=null&&x!=="uploading"&&x.fileId!=null){const g=await Oe.getFileDownloadLink(x.fileId);g.status===Be.Success&&t({profilePictureId:x.fileId!=null?x.fileId:void 0,profilePictureUrl:g.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(x==="uploading")}}),e.jsx(K,{label:e.jsx(u,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(u,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ie,{type:"text",placeholder:_.formatMessage(L.gptNamePlaceholder),value:s?.name??"",onChange:x=>{t({name:x.target.value})},onBlurCapture:()=>t(x=>({...x,name:x.name.trim()})),"data-testid":"gizmo-name-input"}),h.includes(ee.GizmoNameTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(u,{...L.nameTooLong,values:{length:aa}})}):null]}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(K,{label:e.jsx(u,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(u,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ie,{type:"text",placeholder:_.formatMessage(L.descriptionPlaceholder),value:s?.description??"",onChange:x=>t({description:x.target.value}),onBlurCapture:()=>t(x=>({...x,description:x.description?.trim()??""})),"data-testid":"gizmo-description-input"}),h.includes(ee.GizmoDescriptionTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(u,{...L.descriptionTooLong,values:{length:ia}})}):null]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:_.formatMessage(L.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(na,{className:"resize-none",rows:8,value:s?.instructions,onChange:x=>t({instructions:x.target.value}),onBlurCapture:()=>t(x=>({...x,instructions:x.instructions.trim()})),placeholder:_.formatMessage(L.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>b(!0),children:e.jsx(Ba,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...Os.instructionsWarning})}),h.includes(ee.GizmoInstructionsTooLong)?e.jsx(Ne,{className:"mt-1",children:e.jsx(u,{...L.instructionsTooLong,values:{length:oa}})}):null]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(u,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:k.map((x,g)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"rounded-e-none",value:x,type:"text",maxLength:ra,onChange:P=>{const N=P.target.value;t(E=>({...E,promptStarters:We(g>=(M.length??0)?[...M??[],N]:M.map((G,U)=>U===g?N===""?void 0:N:G))}))}}),e.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>t(P=>({...P,promptStarters:M.filter((N,E)=>E!==g)})),children:e.jsx(mt,{className:"icon-sm"})})]},g))})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:_.formatMessage(L.knowledgeExplanation)}),e.jsx(Mi,{gizmoEditorData:s,requireGizmoId:m,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(u,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Da,{enabledTools:v,onEnabledToolsChange:x=>t({tools:x})})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(u,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(Ti,{isDisabled:!!(I&&!w),gizmo:s,onShowActionsEditor:c})]}),!I&&ki(s)&&e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(u,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!j,onClick:()=>{f(x=>!x)}}),e.jsx(Pi,{collapsed:j,initial:!1,children:e.jsx(la,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(u,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),r&&e.jsx(wi,{text:s.instructions??"",onChange:x=>{t({instructions:x})},onClose:()=>b(!1),placeholder:_.formatMessage(L.instructionsSubtitle)})]})}const L=le({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function _i(s,t){const a=Ms(s);if(!Array.isArray(s.detail))return a;const i=We(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(L.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(L.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(L.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return i.length>0?i.join(`
`):a}function Ii({upsertDraftError:s}){const t=H(),a=_i(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(u,{...Ys.errorSavingDraft})}),a!=null&&e.jsx(Ze,{label:a,children:e.jsx(ua,{className:"icon-sm"})})]})}function Ci({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:i,className:n}){return i instanceof ft?e.jsx(Ii,{upsertDraftError:i}):a?e.jsxs("div",{className:re("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(u,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(u,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"text-token-text-tertiary w-4",children:t&&e.jsx(Qe,{})})]}):null}const Ys=le({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),Ni=bs(()=>ws(()=>import("./gcji6npparneeh7f.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58])).then(s=>s.CanvasFocusedViewManager));var Gi=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Gi||{});const Ai=new gt;function zi({clientThreadId:s,gizmoHasCustomActions:t}){const{modelLabel:a,dropdownSections:i}=Va(s,t),n=e.jsxs(ha,{children:[e.jsx(u,{id:"IhcP1l",defaultMessage:"Model"}),e.jsx("span",{className:"text-token-text-secondary text-xs font-medium",children:a}),e.jsx(xa,{className:"icon-sm text-token-text-tertiary"})]});return e.jsx(Je,{size:"small",alignOffset:-4,triggerButton:n,children:e.jsx($a,{sections:i})})}function Ri({gizmoEditorData:s,isSavingDraft:t,showTitle:a=!0}){const[i,n]=d.useState(()=>xe());Gs(i,{kind:te.GizmoTest,gizmo_id:s.id}),d.useEffect(()=>{De(i,h=>{h.mode={kind:te.GizmoTest,gizmo_id:s.id}})},[i,s.id]);const o=s.files?.map(h=>h.file_id).join();d.useEffect(()=>{pt(i)!=null&&n(xe())},[s.id,s.instructions,s.tools,o,i]);const l=d.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),{value:m}=ae("1213809372"),{value:c}=ae("1854238036"),v=m||c,[r,b]=d.useState(0),j=()=>{b(h=>h-360)},f=s.id,M=Li(i);d.useEffect(()=>Ps(Ai,{test_gizmo_action:({rootDomain:h,operationName:S})=>{f&&M(f,h,S)}}),[M,f]);const k=d.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(qa,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Cs.Provider,{value:l,children:e.jsx(ma,{clientThreadId:i,children:e.jsx("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:a&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{j(),n(xe())},className:"flex items-center gap-2",children:[e.jsx(u,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Ss.div,{className:"text-token-text-primary",animate:{rotate:r},transition:{duration:.3},children:e.jsx(fa,{className:"icon-md invisible group-hover:visible"})})]}),v&&e.jsx(zi,{clientThreadId:i,gizmoHasCustomActions:!!ga(s.tools)})]})})}),e.jsxs("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(Ds,{clientThreadId:i,hideHeader:!0,renderEmptyState:k()}),e.jsx(Ha.Sidebars,{children:e.jsx(Ni,{clientThreadId:i,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})}const ps=Ts.memo(Ri);function Li(s){const t=Hs(s);return d.useCallback((i,n,o)=>{t({eventSource:"url",promptMessage:ht(`Call the ${n} API with the ${o} operation`,{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:pa(n)}}}),completionMetadata:{conversationMode:{kind:te.GizmoTest,gizmo_id:i}}})},[t])}const Ui=bs(()=>ws(()=>import("./bwynn45z6zc8ip0h.js"),__vite__mapDeps([59,1,3,4,60,2,5,61,62,63,38,42,17,18,19,20,64,39,40,37,41,43,44,9,45,46,47,48,49,50,51,52,53,54,65,66,67,68,69,8,29,30,70,71,72,73,74,75,34,76,77,78,79,80,81,82])).then(s=>s.GizmoActionsEditor));var Ks=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Ks||{});function Ge({value:s,label:t,testId:a}){return e.jsx(Ls,{value:s,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":a,children:t})}function Ei({className:s,editorTab:t,setEditorTab:a}){const i=H(),{value:n}=ae("1393076427");return e.jsxs(zs,{className:re("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",s),value:t,onValueChange:o=>{a(o)},children:[n&&e.jsx(Ge,{value:"magic",label:i.formatMessage(Ae.magicMakerLabel)}),e.jsx(Ge,{value:"advanced",label:i.formatMessage(Ae.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ge,{value:"preview",label:i.formatMessage(Ae.previewLabel)})})]})}function Fi(s,t){return s.length!==t.length?!1:s.every(a=>t.some(i=>i.type===a.type))}function Oi(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Fi(s.tools,t.tools)&&Fe(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Xs=({gizmo:s,onNewGizmoId:t})=>{const a=ks(),i=$e(),n=Bs(he.BrowsingAvailable),o=i?.includes(he.GizmoCanvasToggle)&&i?.includes(he.Canvas),{value:l}=ae("4148168517"),m=H(),c=ie(),v=()=>{const p=[];n&&p.push({type:O.BROWSER}),o&&p.push({type:O.CANVAS});const T={...us,tools:[...us.tools,...p]};return l?{...T,tools:[...T.tools.filter(C=>C.type!==O.DALLE),{type:O.IMAGE_GEN}]}:T},r=d.useRef(s!=null?cs(s):v()),b=d.useRef(s),j=d.useRef(r.current),[f,M]=d.useState(()=>r.current),[k,h]=d.useState(()=>xe()),[S]=d.useState(()=>({context_message:Za(r.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ni(k,j.current,S);const{data:I}=hs(),w=I?.models.get(xs)??(I&&Ns(I.models.values(),p=>p.tags.includes(vs.GPT_4o))),{data:_}=ba(r.current.id),x=wa(),{isPending:g,error:P}=x,N=Pa(),E=d.useMemo(()=>_!=null&&!Oi(f,_),[f,_]),G=async()=>{const p=r.current;try{const T=await x.mutateAsync({editorData:p,gizmoId:p.id});if(b.current=T,r.current.id==null){const C=T.gizmo.id;r.current={...r.current,id:C,sharingTargets:T.gizmo.sharing_targets},M(r.current),t?.(C)}for(const C of T.tools.filter(D=>D.type===O.JIT_PLUGIN)){const D=r.current.tools.find(X=>X.type===O.JIT_PLUGIN&&X.metadata.domain===C.metadata.domain);D&&D.metadata.action_id!==C.metadata.action_id&&(D.metadata={...D.metadata,action_id:C.metadata.action_id},M(r.current))}return T}catch(T){const C=Ms(T)??m.formatMessage(Ys.errorSavingDraft);throw c.warning(C,{duration:2}),T}},U=d.useRef(void 0),F=async()=>r.current.id!=null?r.current.id:(U.current==null&&(U.current=G().then(p=>p.gizmo.id).catch(p=>{throw U.current=void 0,p})),U.current),[B]=d.useState(()=>Ta(()=>G(),2e3,{trailing:!0})),R=d.useCallback((p,T=!0)=>{const C=typeof p=="function"?p(r.current):ka(r.current,p);Fe(C,r.current)||(r.current=C,M(r.current),T&&B())},[B]),$=d.useRef(void 0);d.useEffect(()=>Ps(xt,{completionFinished:async p=>{const T=p.serverThreadId;if(T==null){fe(!1);return}try{const C=await Xa(r.current,T,c,$.current);C!=null&&(R(C),j.current=Is(r.current))}catch(C){ze.addError(C),c.warning("Something went wrong generating your GPT",{duration:3})}finally{$.current=oe.getCurrentNode(de(T)).message.id,fe(!1)}}}),[c,R]);const we=ti(k,S),[q,Q]=d.useState(void 0);d.useEffect(()=>{Q(La(s))},[s?.gizmo.id]);const me=async(p,T)=>{const C=be(r.current,p.recipient,T);if(C.length>0){c.warning(`Could not save GPT:

${C.map(Z=>`- ${Le(Z)}`).join(`
`)}`,{duration:3});return}const D=await G(),X=D.gizmo.id;try{return ys.logEvent("Promote Gizmo",{gizmo_id:D.gizmo.id,sharing_recipient:p.recipient,editor_tab:A}),await N.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:p.subjects,sharingRecipient:p.recipient,categories:T==null?void 0:[T]}},{onSuccess(ke){a.setQueryData(ds(a,X).queryKey,ke),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:X}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:X}]})}})}catch(Z){if(Z instanceof Sa)Q({gizmoId:X,sharingRecipient:p.recipient,moderationType:Ws.PublishBlocked,sharingTargets:Z.response?.sharing_targets,showModal:ce.AppealAvailable});else{ze.addError(Z);const ke=Z.detail??"An unknown error occurred";c.warning("Error saving GPT - "+ke,{duration:6})}}},{value:y}=ae("1393076427"),[A,es]=d.useState(()=>{if(!y)return"advanced";const p=as.getItem(is.GizmoEditorTab);return Object.values(Ks).includes(p)?p:"magic"}),Pe=vt.useState(({windowWidth:p})=>p);d.useEffect(()=>{Pe!=null&&Pe>=768&&A==="preview"&&es("magic")},[Pe,A]);const[Zs,Js]=d.useState(!1),[ss,fe]=d.useState(!1),[ts,Te]=d.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(xi,{gizmoEditorData:f,isUpsertLoading:x.isPending,isPromoteLoading:N.isPending,hasUnpublishedChanges:E,isUploadingProfilePic:Zs,isGeneratingProfilePic:ss,publishedGizmo:_,updateGizmo:R,promoteGizmo:async(p,T)=>{const C=await me(p,T);return r.current={...r.current,sharingRecipient:p.recipient},M(r.current),as.setItem(is.GizmoEditorTab,A),C},appealGizmo:async(p,T)=>{q!=null&&Q({...q,sharingRecipient:p,categories:T==null?void 0:[T],showModal:ce.AppealAvailable})},setAppealState:Q,revertDraft:_!=null&&E?()=>{const p=a.getQueryData(ds(a,r.current.id).queryKey);if(p!=null){const T=cs(p);r.current=T,M(T),G()}}:void 0,draftMessage:e.jsx(Ci,{isPublished:_!=null&&(_.gizmo.share_recipient==="marketplace"||_.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:E,isSavingDraft:g,upsertDraftError:P,className:"text-sm"}),showActionsModal:p=>{Te(p)},className:"shrink-0"}),q&&e.jsx(Ua,{appealState:q,onAppealClose:()=>Q({...q,showModal:ce.None}),onAppealSubmitted:()=>Q({...q,showModal:ce.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:ts!==void 0?e.jsx(Ui,{currentlyEditingActionDomain:ts,gizmoEditorData:f,updateGizmo:R,onClose:()=>{Te(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ei,{editorTab:A,setEditorTab:es,className:"mb-2 shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:A==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(ri,{gizmoEditorData:f,updateGizmo:R,clientThreadId:k,gizmoEditorDataRef:r,magicMakerBehaviorOverrides:S,magicMakerConversationGizmoEditorDataRef:j,requireGizmoId:F},k)}):A==="advanced"?e.jsx(Si,{gizmoEditorData:f,updateGizmo:R,currentModelConfig:w,generateProfilePic:p=>{fe(!0),we(p,r,j,ai)},setIsUploadingProfilePic:Js,isGeneratingProfilePic:ss,setIsGeneratingProfilePic:fe,requireGizmoId:F,onShowActionsEditor:p=>{Te(p)}}):e.jsx(ps,{gizmoEditorData:f,isSavingDraft:g,showTitle:!1})})]})})}),e.jsx("div",{className:re("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",A!=="preview"&&"md:flex"),children:e.jsx("div",{className:"grow",children:e.jsx(ps,{gizmoEditorData:f,isSavingDraft:g})})})]})]})};function Bi({gizmoId:s,version:t}){const{data:a}=ja({gizmoId:s,draft:!0,version:t}),i=ye(As.accountUserId),o=ya()?.id,l=a!=null&&i!=null&&o!=null&&Ma(a);return a==null||!l?null:e.jsx(Xs,{gizmo:a})}function Wi({onNewGizmoId:s}){return e.jsx(Xs,{onNewGizmoId:s})}const Di=({gizmoId:s,remixSourceId:t,version:a})=>{const i=ue(),n=Ye(),o=d.useRef(void 0);d.useEffect(()=>(ls.enterGizmoEditor(),()=>{ls.exitGizmoEditor()}),[]);let l=s;return s!=null&&o.current===s&&(l=void 0),Ea({resetThreadAction:()=>{i("/")}}),n?l!==void 0?e.jsx(Bi,{gizmoId:l,version:a},l):e.jsx(Wi,{remixSourceId:t,onNewGizmoId:m=>{o.current=m,window.history.replaceState(window.history.state,"",va(m))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Qe,{})})},Ae=le({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Hi(s){const t=ue();d.useEffect(()=>{s||t(jt(yt.NO_ACCESS))},[s,t])}const dn=()=>(_a(),null),un=Mt(function(){const t=Ye(),a=!!t?.hasPlusFeatures();Hi(t==null||a);const i=St(),[n]=_t(),o=ue(),l=i.slug,m=n.get("version"),c=l?bt(l):void 0,v=n.get("remixFrom");return d.useEffect(()=>{wt(!0).then(r=>{Ia.initializeAndGatherData(r),Pt.initializeAndGatherData(r)})},[]),d.useEffect(()=>{t!=null&&!a&&o("/")},[t,o,a]),d.useEffect(()=>{c&&ms(c)&&o(`/g/${l}/project`)},[c,o,l]),!a||c&&ms(c)?null:e.jsx(Ca,{children:e.jsx(Di,{gizmoId:c,remixSourceId:v??void 0,version:m!=null?Number(m):void 0})})});export{Ai as G,Gi as a,dn as c,un as g};
//# sourceMappingURL=d6kj34tvva4p9z7f.js.map
