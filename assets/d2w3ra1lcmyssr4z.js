import{eF as f,cQ as p,aq as _,g0 as w,aF as l,aI as u,m as h,n as g,aN as c,aO as d,b as y,_ as S}from"./citrwydz0bgriwlc.js";import{c$ as F,d0 as b,e as V,d1 as x}from"./krbmwir12ubt4od1.js";import{u as m,r as i}from"./b8ijctzpgh0s7wpx.js";import{i as E}from"./by1c2a5hsj4exnt8.js";function H(){const a=V(),e=_();return e&&a&&!w(a)&&e.isEnterprisey()}function N(){return f(p.ChartSerialization)}function R(a,e){const t=a==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(t,{userId:e})??!1),n=i.useCallback(()=>{o(!0),u.setItem(t,!0,{userId:e})},[t,e]);return[s,n]}function k(a){const[e,t]=i.useState([]),s=h(a,g.getBranch);return i.useEffect(()=>{const o=z(s);o.length!==e.length&&t(o)},[e.length,a,s]),e}function I(a){const e=a.metadata?.aggregate_result?.messages.filter(E)??[];let t=0;const s=(a.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:e[t++]}),r}),o=(a.metadata?.attachments??[]).filter(n=>F(n.name)).map(n=>({type:"table",file_id:n.id??"",title:b(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function z(a){return a.filter(t=>t.message?.author.role==="tool"&&t.message?.author.name==="python"||(t.message?.metadata?.attachments??[]).length>0).flatMap(t=>I(t.message))}async function T(a,e,t){const s=await a.text(),{parse:o}=await S(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:e,download_url:t}}function A(a){const e=a[0].values.length,t=[];for(let s=0;s<e;s++){const o=a.map(n=>n.values[s]);t.push(o)}return t}function L(a){return m({queryKey:["ada-visualization","chart",a.file_id],queryFn:async()=>{const e=await c.getFileDownloadLink(a.file_id);if(e.status===d.Success){const s=await(await fetch(e.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function M(a){return m({queryKey:["ada-visualization","table",a.file_id],queryFn:async()=>{if(a.file_name&&x(a.file_name)){const e=await y.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:a.file_id}}});return{content:e.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:A(t.columns)})),download_url:e.download_url,file_name:a.file_name}}else{const e=await c.getFileDownloadLink(a.file_id);if(e.status===d.Success){const t=await fetch(e.download_url);return T(t,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{k as a,M as b,L as c,H as d,R as e,I as g,N as u};
//# sourceMappingURL=d2w3ra1lcmyssr4z.js.map
