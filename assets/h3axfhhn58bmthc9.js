const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fpzvja73wk0zn0ai.js","assets/b8ijctzpgh0s7wpx.js","assets/krbmwir12ubt4od1.js","assets/citrwydz0bgriwlc.js","assets/root-gxczc0vy.css","assets/conversation-small-dfayqh3x.css","assets/ku4zsoy6w4wkp690.js","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js","assets/eg629yaevviy8e7x.js","assets/g7j1mfva11na5hbi.js","assets/g57w1w5sbbk11vjt.js","assets/oip1q9jhjsnquhrt.js","assets/h9ej05xawysezypc.js","assets/eeruhkv4a43aueaw.js","assets/gvs1s366o5iglka3.js","assets/ckwntmn7hqzclvef.js","assets/k6ccgr4wxcppeg93.js","assets/lc6y9pvlxdqce2f7.js","assets/nfkxdwnvdjy1s4sn.js","assets/oyzab3j7hun2568h.js","assets/cb2t82g498wwhuc2.js","assets/ndwtlsjk3xm27wkq.js","assets/dera5bljhpg5ja89.js","assets/hs2fsda156wfk7fz.js","assets/cn5tk4t34ulr2va8.js","assets/o6iizogkfybkxcpa.js","assets/e1z6gbtwznbmtc6u.js","assets/bepcvhce8mh51zvw.js","assets/vjzqprzwzqi7m8u0.js","assets/ht7deptwgbc3ooax.js","assets/ninkt5zzusr2qibx.js","assets/d2w3ra1lcmyssr4z.js","assets/by1c2a5hsj4exnt8.js","assets/her6q3ihv1schhbg.js","assets/ij1hijr26xwrvnm7.js","assets/mh17568k59gw38y0.js","assets/d21oqy6xqa35jhn3.js","assets/k5qjx4jdow04k7d2.js","assets/bdclq6pa102whxi1.js","assets/be0n9593bbjhdouz.js","assets/nvghija6qp2cunds.js","assets/djd85tifm57yisqi.js","assets/gbxx25eoj7wtyna0.js","assets/bzsolvz1ulyrc61b.js","assets/pc2givv05uuq8g6l.js","assets/ju91cj9mp2lx2yuz.js","assets/ndqm17bbs5ambnrw.js","assets/megablgldkh4lap1.js","assets/hbpbckirom363mgh.js","assets/dbalwdodzoo02ru2.js","assets/omp8ie1vzl40ti1z.js","assets/ji5qoh13hkjncrxd.js","assets/mtbwfu1a5yslb3p2.js","assets/jr954f5murhu609u.js","assets/ansi-1f6vhsjh.css","assets/gaxh4csbc95s5l26.js","assets/e74336rl4x47z2ei.js","assets/ct6yhczwft8t5t9k.js","assets/etmxhiuvgu79utu0.js","assets/l4etgojhnqjuqlgi.js","assets/belvvj76e8q0tm6q.js","assets/eobw6ahe02v4g6se.js","assets/FormattedText-kb0ehjj7.css","assets/cot-message-lf3q5fj1.css","assets/mnja07nl06pmo8dv.js","assets/daid7veon13s2bqn.js","assets/hyoix286427rgsrp.js","assets/hwx0m0azjs4pnvcb.js","assets/kcrhrkba74367sn7.js"])))=>i.map(i=>d[i]);
import{m as P,bS as we,cr as Me,h6 as qe,a_ as De,n as V,bj as Re,a$ as ne,c7 as Ge,c3 as es,eA as J,aM as Oe,j as oe,b1 as re,c as A,bl as ss,g2 as ts,h as Le,B as G,aJ as Y,db as as,e as Pe,eH as ns,F as Ie,h7 as te,eC as os,at as rs,eV as _e,eU as is,ak as ls,gA as cs,dL as ms,eW as f,s as us,N as ds,g1 as X,Q as C,fs as ye,u as gs,ex as fs,_ as N,cs as ps}from"./citrwydz0bgriwlc.js";import{j as s,M as T,r as x,i as ie,a6 as z,a5 as L,a as xs}from"./b8ijctzpgh0s7wpx.js";import{gn as hs,no as _s,eE as ys,mC as Ss,jr as js,np as bs,mx as vs,nq as Cs,gh as Es,nr as Fe,mt as Ve,ns as F,nt as Ts,nu as Ns,gu as Ue,n2 as As,i8 as Se,b3 as ee,jI as ks,nv as ws,nw as Ms,nx as ae,ny as Ds,nz as Rs,nA as Os,nB as Ls,nC as Ps,aH as je,nD as Is,nE as Fs,nF as Vs,i_ as be,nG as Be,f1 as Us,nH as Bs,nI as Hs,nJ as zs,nK as Js,gs as Ks,dI as Ws,nL as Qs,nM as $s,a$ as Ys,iE as Xs,iF as Zs,nN as qs,nO as Gs,b8 as et,da as st,nP as tt,jZ as at,nQ as nt,nR as ot,nS as He,e7 as rt,nT as it,j0 as lt,nU as ve,b1 as ct,iT as mt,nV as ut,nW as dt,f3 as gt}from"./krbmwir12ubt4od1.js";import{c as ze,d as Je,C as ft,u as pt}from"./ku4zsoy6w4wkp690.js";import{u as xt}from"./exvo283q5zxd2q6r.js";import{a as ht}from"./eg629yaevviy8e7x.js";const _t=(e,n)=>{const t=P(e,m=>V.getLastMessageSystemHints(m).includes(Ge.CANVAS)),a=ze({clientThreadId:e}),o=_s(e),i=ys(),c=we(n)?.id,l=n.some(m=>m.metadata?.canvas?.canvas_opt_in);return{isVisible:!t&&!o&&!i&&!l&&!!c,onClick:async m=>{if(!c)return;m.stopPropagation(),Ss();const d=[Me.CANMORE];a({sourceEvent:m,nodeId:c,appendMessages:[qe("The user has requested the canvas tool be disabled for this conversation. You should not call the tool again.",{disable_tool_ids:d,exclude_after_next_user_message:!0})]});const g=De(e),p=V.getConversationTurns(g,c).length,_=V.getParentPromptNode(g,c)?.message.id;js.logEventWithStatsig("Canvas Opt Out Clicked","chatgpt_canvas_opt_out_clicked",{num_turns:String(p),conversation_id:Re(e),message_id:_}),ne(e,b=>{b.disabledToolIds=d})}}},yt=({clientThreadId:e,allTurnMessages:n})=>{const{isVisible:t,onClick:a}=_t(e,n);return t?s.jsx("button",{onClick:a,className:"text-token-text-secondary hover:text-token-text-primary mb-2 w-full",children:s.jsxs("div",{className:"flex items-center rounded-xl",children:[s.jsx(T,{id:"aa5Dyk",defaultMessage:"Answer in chat instead"}),s.jsx(hs,{className:"icon text-token-text-secondary"})]})}):null},St=({messages:e,isRequestActive:n,isFinalTurn:t,allTurnMessages:a,clientThreadId:o,isUserTurn:i=!1})=>{const c=x.useMemo(()=>bs(e),[e]),l=x.useMemo(()=>c?c.map(([r,m])=>vs(n,r,m)).filter(Boolean):[],[c,n]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-col gap-2",children:l.map(r=>s.jsx(Cs,{toolCall:r,clientThreadId:o,isRequestActive:n},r.messageId))}),s.jsx(Es,{featureType:es.CANVAS_SUPPORTED,isUserTurn:i,clientThreadId:o}),t&&s.jsx(yt,{clientThreadId:o,allTurnMessages:a})]})};function jt(e,n,t){const a=Fe(r=>!!(e&&r.tasks[e])),{openThreadSidebar:o}=J(),i=Ve("caterpillar"),c=P(t,r=>V.findNode(r,m=>m.message.metadata?.async_task_id===e&&(m.message.metadata?.b1de6e2_rm===!0||m.message.metadata?.is_async_task_result_message===!0))!=null),{clearSystemHintModeTrigger:l}=Je();x.useEffect(()=>{if(a||!e||!n)return;const{async_task_created_at:r,async_task_prompt:m,async_task_title:d}=n.metadata??{};if(!r||!m||!d)return;const p={originalConversationId:Re(t)??t,taskId:e,title:d,prompt:m,createdAt:r,updatedAt:r,status:F.UNDETERMINED};Ts.setTask(e,p),l(Oe.Research)},[a,e,n,t,o,i,l,c])}const se={div:e=>{const{node:n,children:t,...a}=e;return s.jsx("div",{...a,className:"text-red-500",children:t})},p:e=>{const{node:n,children:t,...a}=e;return s.jsx("p",{...a,className:"text-token-text-primary text-start leading-6",children:t})},a:e=>{const{node:n,children:t,...a}=e;return s.jsx("a",{...a,className:"font-sm text-token-text-primary! leading-6",children:t})}},bt=1e3*60*2,vt=30;function Ke({taskId:e,clientThreadId:n,onClick:t,statusMessage:a,showSources:o,includeMargin:i,sources:c,progressBar:l}){const r=Ue(),[m,d]=x.useState(!1),g=oe(),p=re(g,"2007855518");return s.jsxs(s.Fragment,{children:[e&&m&&s.jsx(ft,{taskId:e,clientThreadId:n,onClose:()=>d(!1)}),s.jsxs("div",{className:"relative flex w-4/5 max-w-[416px]",children:[e&&p&&s.jsx("button",{onClick:()=>d(!0),disabled:!e,className:"hover:bg-token-bg-elevated-secondary bg-token-bg-elevated-primary absolute end-4 bottom-4 flex items-center justify-center rounded-full border border-black/10 p-0.5 dark:border-white/10",children:s.jsx(As,{className:"icon-lg"})}),s.jsx("button",{onClick:()=>r&&t(),className:A("bg-token-main-surface-primary mt-4 flex w-full items-start justify-start gap-[18px] rounded-2xl border border-black/10 px-5 py-4 shadow-sm dark:border-white/10",r?"hover:bg-token-main-surface-secondary cursor-pointer":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:A("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",o?"h-12":"h-6"),children:[s.jsx("div",{className:A("font-sm text-token-text-primary w-full flex-1 truncate text-start leading-7 md:w-0",i&&"me-[30px]"),children:a}),o&&c]}),s.jsx("div",{className:A("flex w-full items-center justify-start gap-4 self-stretch pb-2",e&&p&&"pe-10"),children:l})]})})]})]})}function le({taskId:e,clientThreadId:n,toggleSidebar:t,openSidebar:a,startTime:o,progressBar:i}){const c=ie(),[l,r]=x.useState(!1),m=Ns();return x.useEffect(()=>{if(!o)return;const d=Date.now()-o,g=bt-d;if(g>0){const p=setTimeout(()=>{r(!0),a()},g);return()=>clearTimeout(p)}else r(!0),a()},[o,a]),i||(i=s.jsx(ws,{className:"h-2 w-full"})),s.jsx(Ke,{taskId:e,clientThreadId:n,onClick:t,statusMessage:l?c.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-token-text-primary text-sm font-medium text-pretty",children:m.startingMessage}),progressBar:i,showSources:!1})}function Ct(e,n,t){const a=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(n.length<2)return t?.initial??a;const o=n[n.length-2];return o.type==="summary"?o.title:o.type==="search"?o.query:o?.type==="websiteOpen"?s.jsx(ee,{componentOverrides:se,children:o.activeRowText}):o.type==="fileOpen"?s.jsx(ee,{componentOverrides:se,children:o.activeRowText}):o.type==="pythonAnalysis"?s.jsx(ee,{componentOverrides:se,children:o.analysisSummary}):a}function Et({task:e,clientThreadId:n,caterpillarRows:t,messageWithTaskMetadata:a,totalSources:o,handleToggleCaterpillarSidebar:i}){const c=ie(),l=Ue(),r=Ct(c,t,a.metadata?.async_task_status_messages),m=(e?.expectedDurationMinutes??vt)*60*1e3,d=oe(),g=re(d,"3550239432"),p=t[1]?.created_at?t[1].created_at*1e3:0,_=Se(p||Date.now(),m),b=a?.create_time?a.create_time*1e3:0,y=Math.min(Se(b||Date.now(),m),4),v=g?Math.max(_,y):_;let k;const E=s.jsx("div",{className:"bg-token-main-surface-tertiary flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px]",children:s.jsx(ks,{percentage:v,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})});g&&(k=E),x.useEffect(()=>{ne(n,D=>{D.async_status=ss.STREAMING})},[n]);const{openThreadSidebar:w}=J();x.useEffect(()=>{t.length===2&&l&&w({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[t.length,w,e.taskId,n,l]);const S=x.useCallback(()=>{w({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[w,e.taskId,n]);return t.length<=1?s.jsx(le,{taskId:e.taskId,clientThreadId:n,toggleSidebar:()=>i("activity"),openSidebar:S,startTime:new Date(e.createdAt).getTime(),progressBar:k}):s.jsx(Ke,{taskId:e.taskId,clientThreadId:n,onClick:()=>i("activity"),statusMessage:r,showSources:!0,includeMargin:o>0,sources:o===0?s.jsx("div",{className:"text-token-text-tertiary text-sm text-pretty",children:s.jsx(T,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:D=>{D.stopPropagation(),i("sources")},className:A("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",l?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx(z,{initial:!1,children:s.jsx(L.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute start-0 md:end-0",children:o},o)})}),s.jsx("div",{className:A("md:pe-0",o>0&&"ps-2",o>9&&"ps-[14px]",o>99&&"ps-[22px]"),children:o>1?s.jsx(T,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(T,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:E})}function Ce({task:e,clientThreadId:n,messageWithTaskMetadata:t,totalSources:a,totalSearches:o,handleToggleCaterpillarSidebar:i}){const c=Ms(e?.originalConversationId),l=!1,r=P(n,d=>Ds(d,e?.taskId)),{clearSystemHintModeTrigger:m}=Je();return x.useEffect(()=>{e?.status===F.COMPLETED&&!r&&(c(),m(Oe.Research))},[e?.status,l,r,c,m]),s.jsx(ae,{message:s.jsxs(s.Fragment,{children:[t.metadata?.async_task_status_messages?.completed_with_time??t.metadata?.async_task_status_messages?.completed_no_time??s.jsx(T,{id:"4d0xZc",defaultMessage:"Completed"}),a===0?s.jsx(T,{id:"VggF2B",defaultMessage:" · 0 sources"}):a===1?s.jsx(T,{id:"zkkdKV",defaultMessage:" · 1 source"}):s.jsx(T,{id:"qcKt3q",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:a}}),o>0&&s.jsx(T,{id:"ti+7CY",defaultMessage:" · {searchesCount, plural, one {# search} other {# searches}}",values:{searchesCount:o}})]}),handleToggleCaterpillarSidebar:()=>i("activity")})}function Tt({messages:e,clientThreadId:n}){const t=e.find(m=>m.metadata?.b1de6e2_s&&m.metadata?.async_task_id),a=t?.metadata?.async_task_id,o=e.find(m=>m.recipient===Me.START_RESEARCH_TASK),i=P(n,m=>Ps(m,o?.id)),c=ts({clientThreadId:n}),[l,r]=x.useState(c);return x.useEffect(()=>{const m=setTimeout(()=>{r(i&&c)},3e3);return()=>clearTimeout(m)},[c,i]),!t||!a?l?s.jsx(le,{taskId:a,clientThreadId:n,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(Nt,{clientThreadId:n,payloadTaskId:a,messageWithTaskMetadata:t})}function Nt({payloadTaskId:e,messageWithTaskMetadata:n,clientThreadId:t}){jt(e,n,t);const a=Fe(p=>e?p.tasks[e]:null),o=ie(),i=a?.status,c=x.useMemo(()=>a?.rows?a.rows:[],[a?.rows]),{toggleThreadSidebar:l}=J(),{totalSources:r,totalSearches:m}=x.useMemo(()=>{if(!c)return{uniqueSources:[],totalSources:0,totalSearches:0};const p=Rs(c),_=p.reduce((y,v)=>y+v.count,0),b=Os(c);return{uniqueSources:p,totalSources:_,totalSearches:b}},[c]),d=Ve("caterpillar"),g=x.useCallback(p=>{e&&l({type:"caterpillar",caterpillarId:e,initialTab:p,clientThreadId:t},d)},[l,e,d,t]);return Ls(e),n.metadata?.async_task_status_messages?.completed_with_time?s.jsx(Ce,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:r,totalSearches:m,handleToggleCaterpillarSidebar:g}):!a||!i||i===F.UNDETERMINED?s.jsx(le,{taskId:e,clientThreadId:t,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):a.status===F.COMPLETED?s.jsx(Ce,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:r,totalSearches:m,handleToggleCaterpillarSidebar:g}):a.status===F.FAILED?s.jsx(ae,{message:n.metadata?.async_task_status_messages?.error??o.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>g("activity")}):a.status===F.CANCELLED?s.jsx(ae,{message:n.metadata?.async_task_status_messages?.cancelled??o.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>g("activity")}):s.jsx(Et,{task:a,clientThreadId:t,caterpillarRows:c,messageWithTaskMetadata:n,totalSources:r,handleToggleCaterpillarSidebar:g})}function At(e,n,t){const a=n.elements.length;if(a===0)return;const o=Object.entries(e).reduce((i,[c,l])=>Array.isArray(l)?l.length>0?i+1:i:l!==""?i+1:i,0);Pe.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...ns({clientThreadId:t}),totalItems:a.toString(),completedItems:o.toString(),ratio:(o/a).toString()})}function kt(e,n){let t="";return n.elements.forEach(a=>{const o=a.scope.split("/").pop(),i=o&&e[o],c=i?Array.isArray(i)?i.join(", "):i:"Any",l=a.label??o;t+=`${l}: ${c}
`}),t}function wt({messages:e,clientThreadId:n,isLastMessage:t}){const a=e.find(S=>S.author.role===Le.Assistant),o=e.find(S=>S.metadata?.json_form),i=o?.metadata?.json_form,[c,l]=x.useState({}),[r,m]=x.useState(),[d,g]=x.useState(),p=xt(),_=pt(n);x.useEffect(()=>{i&&(m(i.json_form_ui),g(i.json_form_data))},[i]);const b=x.useCallback(()=>{if(l({}),r){const S={...r,elements:r.elements.filter(D=>D.scope!=="#/properties/AdditionalInfo")};m(S)}d&&(delete d.properties.AdditionalInfo,g(d))},[l,m,g,r,d]),y=x.useCallback(()=>{if(r){const S={...r,elements:[...r.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};m(S)}if(d){const S={...d.properties,AdditionalInfo:{type:"string"}};g({...d,properties:S})}},[m,g,r,d]),v=r?.elements.some(S=>S.scope.endsWith("#/properties/AdditionalInfo")),k=P(n,V.getCurrentLeafId),E=o?.id!==k;if(!o||!d||!r)return a?.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(je,{className:"h-[26px] w-full"}),s.jsx(je,{className:"h-[26px] w-3/4"}),s.jsx(Is,{})]}):null;if(E)return null;const w=async S=>{const D=kt(c,r);At(c,r,n),_({sourceEvent:S,promptMessage:as(D),completionMetadata:{systemHints:[...p],conversationMode:{kind:Y.PrimaryAssistant}}})};return s.jsxs(Fs,{children:[s.jsx(Mt,{formData:c,dataSchema:d,uiSchema:r,setData:l,readOnly:E}),s.jsxs("div",{className:"flex w-full justify-between",children:[v?s.jsx("div",{}):s.jsx(G,{disabled:E,onClick:y,color:"secondary",className:"text-token-text-secondary",children:s.jsx(T,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(G,{disabled:E,onClick:b,color:"secondary",className:"text-token-text-secondary",children:s.jsx(T,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx(G,{disabled:E,onClick:w,children:s.jsx(T,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function Mt({dataSchema:e,uiSchema:n,setData:t,readOnly:a,formData:o}){return s.jsx("div",{children:s.jsx(Vs,{formData:o,readOnly:a,schema:e,uiSchema:n,onChange:i=>t(i)})})}const Dt=2e3,We=.4,Rt=.45,Ot=.2,Lt=.1,Pt=.25;var U=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(U||{});function _a({conversationMessages:e,icon:n,status:t,text:a,estimatedToolDurationMs:o,animationLoopDurationMs:i=Dt,shouldPersistAfterFinished:c=!1}){const[l,r]=x.useState(t===0?0:t===1&&!c?7:1),[m,d]=x.useState(0);x.useEffect(()=>{t===2?r(8):t===3?r(9):t===4?r(10):t===1?r(l===2?3:7):t===0&&l===10&&(r(2),d(p=>p+1))},[t]);const g=Vt(l);return x.useEffect(()=>{const p=e[0].id;if(g)return be.addDelayedRenderingMessage(p),()=>{be.removeDelayedRenderingMessage(p)}},[g]),Be(()=>{B(l)&&d(p=>p+1)},i),l===7&&!c?null:s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx(It,{icon:n,status:t,uiState:l,estimatedToolDurationMs:o,animationLoopCounter:m,shouldPersistAfterFinished:c,onFillProgressBarAnimationComplete:()=>r(4),onFinishAnimationComplete:()=>{r(5),setTimeout(()=>{r(c?7:6)},Lt*1e3)},onHideAnimationComplete:()=>r(7)}),s.jsx(Ft,{text:a,uiState:l,animationLoopCounter:m,onEnterAnimationComplete:()=>r(2)})]})}const Ee=50;function It({icon:e,status:n,uiState:t,estimatedToolDurationMs:a,animationLoopCounter:o,shouldPersistAfterFinished:i,onFillProgressBarAnimationComplete:c,onFinishAnimationComplete:l,onHideAnimationComplete:r}){const[m,d]=x.useState(0);Be(()=>{B(t)?d(E=>E+Ee):t===10&&d(0)},Ee);let g,p,_;B(t)||t===10?(g="running",p=s.jsx(e,{animationLoopCounter:o}),_="bg-transparent"):t===4||t===5||t===7&&i?(g="finished",p=s.jsx(Hs,{}),_="bg-brand-purple"):n===2?(g="error",p=s.jsx(zs,{}),_="bg-orange-500"):n===3&&(g="stopped",p=s.jsx(Js,{}),_="bg-gray-300");let b={opacity:0,scale:0,rotate:-180,x:0},y={type:"spring",bounce:.3,duration:Rt},v={opacity:0,scale:.6,rotate:0,x:0};t===0?(b={opacity:0,scale:.5,rotate:-180,x:-8},y={type:"spring",bounce:.3,duration:We}):t===1?b=!1:t===5&&(v={opacity:0,scale:0,rotate:0,x:0},y={type:"spring",bounce:.3,duration:Pt});const k=Bs(m,a);return s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsx(z,{onExitComplete:()=>{t===6&&r()},children:g!=null&&s.jsxs(L.div,{className:A("absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",_),initial:b,animate:{opacity:1,scale:1,rotate:0,x:0},exit:v,transition:y,onAnimationComplete:()=>{t===4&&l()},children:[p,(B(t)||t===10)&&s.jsx(Us,{percentage:t===3?100:k,thickness:1.5/23,className:"text-brand-purple absolute start-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-k)/100*Ot}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&c()}})]},g)})})}function Ft({text:e,uiState:n,animationLoopCounter:t,onEnterAnimationComplete:a}){const[o,i]=x.useState(e);x.useEffect(()=>{n===2&&i(e)},[t]),x.useEffect(()=>{B(n)||i(e)},[n,e]);let c={opacity:0,x:0,y:15},l={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};n===0?(c={opacity:0,x:-8,y:0},l={type:"spring",bounce:.3,duration:We,delay:.15}):n===1&&(c=!1);const r=o??void 0;return s.jsx("div",{className:A("relative h-5 w-full leading-5",n===8||n===9?"text-token-text-tertiary":"text-token-text-secondary"),children:s.jsx(z,{children:r!=null&&s.jsx(L.div,{className:"absolute start-0 top-0 line-clamp-1 overflow-visible",initial:c,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:l,onAnimationComplete:()=>{n===0&&a()},children:r},r.toString())})})}function B(e){return e===0||e===2||e===3}function Vt(e){return B(e)||e===4||e===5||e===6||e===10}const Te=Ie.div`group start-0 top-0 me-1.5 overflow-hidden mt-1 text-start`,Ut=({highlightedCommand:e,status:n,children:t,showWorkUserSetting:a=!1,hideOnlyIfNotInteractedWith:o=!1,defaultExpanded:i=!1,onOpenAnalytics:c,onClick:l,...r},m)=>{const d=t!=null||l!=null,[g]=x.useState(a),[p,_]=x.useState(a||i),[b,y]=x.useState(!1),v=n===U.Finished||n===U.Error,k=o?g?!1:!b:!1,E=n===U.Running&&"loading-shimmer";return v&&k?null:d?s.jsxs(s.Fragment,{children:[s.jsx(Ne,{ref:m,$canShowWork:!0,...r,children:s.jsx(z,{children:s.jsx(Te,{children:s.jsx(L.button,{onClick:w=>{p||c?.(),_(S=>!S),y(!0),l?.(w)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:A(E),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!l&&(p?s.jsx(Ks,{className:"icon-sm"}):s.jsx(Ws,{className:"icon-sm"}))]})},e?.toString())})})}),s.jsx(z,{children:p&&t&&s.jsx(L.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(Ne,{ref:m,$canShowWork:!1,...r,children:s.jsx(Te,{className:A(E),children:e})})},Ne=Ie.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,Bt=x.forwardRef(Ut),Ht=3,zt=.1,Ae=[0,.26,.4];function Jt({nextMessage:e,isLastMessage:n,isRequestActive:t,isLastTurnInConversation:a,clientThreadId:o,turnIndex:i,searchResultGroups:c}){const l=n||!e||e&&!te(e),r=x.useRef(!1),m=xs(),d=P(o,V.getGizmoId);x.useEffect(()=>{e&&te(e)&&!r.current&&(r.current=!0,Qs(m,d))},[e,m,d]);const g=os(e);e?.id&&$s(e?.id);const p=[];if(g?.[0]?.type==="navigation"&&e&&p.push(s.jsx(Kt,{clientThreadId:o,turnIndex:i,nextMessage:e,isRequestActive:t,isLastTurnInConversation:a,navigationCitation:g[0]},"fast-nav")),l){const _=rs(c.slice(0,Ht).map(y=>y.entries[0].url)),b=t?s.jsxs("div",{className:"flex items-center gap-1",children:[_.map((y,v)=>s.jsx(L.div,{className:A("-ms-1.5 first:ms-0 last:me-1.5","relative"),initial:{width:v===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:zt,delay:Ae[Math.min(v,Ae.length-1)]},children:s.jsx("div",{className:A("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-token-bg-primary bg-token-bg-primary border-2"),children:s.jsx(Ys,{url:y,size:32,minSize:16,className:"icon-md rounded-full"})})},y)),s.jsx(T,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(T,{id:"fssXGM",defaultMessage:"Error while searching"});p.push(s.jsx(Bt,{highlightedCommand:b,status:t?U.Running:U.Error},"search-gpt-query"))}return p.length?s.jsx(s.Fragment,{children:p}):null}const Kt=({clientThreadId:e,turnIndex:n,nextMessage:t,isRequestActive:a,isLastTurnInConversation:o,navigationCitation:i})=>{const{scrollToHeader:c}=_e("searchSources")??{},l=is(),r=_e("searchSources"),{openThreadSidebar:m}=J();return x.useEffect(()=>{ls.addFirstTiming("render.fastNavigation")},[]),x.useEffect(()=>{l&&r&&m({type:"searchSources",scrollToHeader:c,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[]),x.useEffect(()=>{const d=t,g=d.metadata?.search_source,p=i.domains.map(_=>_.url);Xs.logEvent("Search Tool Request Time To Fast Nav",e,d.id,{search_source:g,urls:p},()=>{g===cs.InstantQuery&&Zs.logEvent("Search Tool Page Load Time To Fast Nav",{message_id:d.id,urls:p,search_source:g})})},[e,t,i]),a&&o?s.jsx(L.div,{initial:{opacity:a?0:1,height:a?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(ke,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:i})}):s.jsx(ke,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:i})},ke=({clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:a})=>{const{toggleThreadSidebar:o}=J(),i=x.useMemo(()=>({clientThreadId:e,turnIndex:n,messageId:t?.id}),[e,n,t?.id]),c=x.useCallback((r,m)=>{o({type:"searchSources",scrollToHeader:m,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[o,e,n,t?.id]),l=qs(i);return s.jsx(Gs,{navigation:a,onShowSearchResults:c,trackContentReferenceEvent:l})},Wt=C(()=>N(()=>import("./fpzvja73wk0zn0ai.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),Qt=C(()=>N(()=>import("./g7j1mfva11na5hbi.js"),__vite__mapDeps([11,1,3,4,12]))),$t=C(()=>N(()=>import("./oip1q9jhjsnquhrt.js"),__vite__mapDeps([13,1,3,4,10,2,5,6,7,8,9]))),Yt=C(()=>N(()=>import("./h9ej05xawysezypc.js"),__vite__mapDeps([14,1,3,4,15,16,2,5,17,18,6,7,8,9,10]))),Xt=C(async()=>()=>null);C(async()=>()=>null);const Zt=C(async()=>(await N(()=>import("./lc6y9pvlxdqce2f7.js"),__vite__mapDeps([19,3,1,4,17,2,5,20,21,22,23,8,9,24,25,26,27,28,6,7,10]))).ImageGenMessage),qt=C(()=>N(()=>import("./bepcvhce8mh51zvw.js"),__vite__mapDeps([29,1,3,4,2,5,6,7,8,9,10]))),Gt=C(()=>N(()=>import("./e1z6gbtwznbmtc6u.js"),__vite__mapDeps([28,1,3,4,2,5,6,7,8,9,10])).then(e=>e.BrowsingMessage)),ea=C(()=>N(()=>import("./vjzqprzwzqi7m8u0.js"),__vite__mapDeps([30,1,3,4,2,5])).then(e=>e.SearchResultMessage)),sa=C(()=>N(()=>import("./ht7deptwgbc3ooax.js"),__vite__mapDeps([31,1,3,4,2,5,6,7,8,9,10])).then(e=>e.JITPluginMessage)),ta=C(()=>N(()=>import("./ninkt5zzusr2qibx.js"),__vite__mapDeps([32,3,1,4,33,2,5,34,6,7,8,9,10])).then(e=>e.DataAnalysisMessage)),aa=C(()=>N(()=>import("./her6q3ihv1schhbg.js"),__vite__mapDeps([35,1,3,4,2,5,36,10,6,7,8,9]))),na=C(()=>N(()=>import("./mh17568k59gw38y0.js"),__vite__mapDeps([37,1,3,4,38,39,2,5,26,27,28,6,7,8,9,10,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,34,61,62,63,64,65])).then(e=>e.LegacyCoTMessage)),oa=C(()=>N(()=>import("./d21oqy6xqa35jhn3.js"),__vite__mapDeps([38,1,3,4,39,2,5,26,27,28,6,7,8,9,10,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,34,61,62,63,64,65])).then(e=>e.CoT)),ra=C(()=>N(()=>import("./mnja07nl06pmo8dv.js"),__vite__mapDeps([66,1,2,3,4,5,67,68,69,70])).then(e=>e.JawboneMessage)),ia=C(async()=>()=>null);function la(e){if(e.some(n=>n.type===f.SearchGPTQuery)){const t=e.filter(o=>o.type===X).flatMap(o=>o.groups),a=t.flatMap(o=>o.messages.map(i=>i.metadata?.search_turns_count)).findLast(o=>o!=null);return a!=null?a>1:function(){const i=t.filter(r=>r.type===f.StructuredThoughts),c=t.filter(r=>r.type===f.CoTSearchTool),l=(()=>{function r(d){return d.type===f.StructuredThoughts&&d.messages.flatMap(g=>g.content).some(g=>g.content_type===ps.StructuredThoughts&&g.thoughts.length>0)}let m=!1;for(const d of t)if(d.type===f.CoTSearchTool)m=!0;else if(r(d)&&m)return!0;return!1})();return i.length>1||c.length>1||l}()}return!0}function ya({groupedMessagesToRender:e,allMessages:n,allGroupedMessages:t,clientThreadId:a,isUserTurn:o,isCompletionRequestInProgress:i,isFeedbackEnabled:c,isFinalTurn:l,isFinalUserTurn:r,turnIndex:m,hasActiveRequest:d,onRequestCompletion:g,shouldGrowContainer:p=!0,isParagen:_=!1,renderingView:b="chat"}){const{showDebugConversationTurns:y}=et(),[v]=P(a,u=>[u?.mode]),k=oe();re(k,"733205176");const E=st(a),w=ms(a),S=tt(),D=t.some(u=>u.type===f.Browsing||u.type===f.RetrievalBrowsing||u.type===f.SearchGPTQuery||!1),Qe=at(()=>us.count(ds.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),Z=we(n),ce=ze({clientThreadId:a,conversationMode:v}),$e=x.useCallback(({sourceEvent:u,requestedModelId:h,appendMessages:j,extraStreamParams:R})=>{Z&&ce({sourceEvent:u,nodeId:Z.id,requestedModelId:h,appendMessages:j,extraStreamParams:R})},[Z,ce]),q=e.map((u,h)=>{const j=h===t.length-1,R=la(e);if(u.type===X)return R?s.jsx(oa,{isStreaming:l&&j&&i,isFinalTurn:l,messageGroups:u.groups,isAutoswitch:E?.enableInfer,isAutoswitchOptOutEnabled:E?.enableInferOptOut,handleSkipClick:M=>{Pe.logEventWithStatsig("chatgpt_web_autoswitch_reasoning_skip_clicked","chatgpt_web_autoswitch_reasoning_skip_clicked",{conversationId:a,messageId:u.groups[0].messages[0].id}),$e({sourceEvent:M,requestedModelId:"gpt-4o"})},markAutoswitchPreambleAsSeen:()=>{ne(a,M=>{M.hasSeenAutoswitchPreamble=!0})},hasSeenAutoswitchPreamble:De(a)?.hasSeenAutoswitchPreamble},"cot-"+u.groups[0].messages[0].id):null;const fe=h===0?void 0:e[h-1],pe=fe?.type!==X?fe:void 0,xe=pe?.type,he=pe?.messages,Xe=u&&!te(u.messages[0]),Ze=D&&Xe,Q=[];switch(Ze||Q.push(s.jsx(ht,{className:"min-h-8",message:u.messages[0],isFeedbackEnabled:c,isFinalUserTurn:r,isCompletionInProgress:j&&i,hasActiveRequest:d,turnIndex:m,clientThreadId:a,isUserTurn:o,prevGroupedMessageType:xe,prevGroupedMessages:he},"text-message-"+u.messages[0].id)),y&&Q.push(s.jsx(ia,{clientThreadId:a,message:u.messages[0]},"message-debug-"+u.messages[0].id)),u.type){case f.Text:case f.MultiText:return u.type===f.Text?s.jsxs(x.Fragment,{children:[Q,!1,s.jsx(it,{isUserTurn:o,message:u.messages[0]})]},"group-"+u.messages[0].id):u.type===f.MultiText?s.jsx($t,{clientThreadId:a,messages:u.messages,isCompletionInProgress:j&&i,isFeedbackEnabled:c,hasActiveRequest:d,prevGroupedMessageType:xe,prevGroupedMessages:he},"multitext-"+(u.messages[0]?.id??h)):u.type;case f.Browsing:case f.RetrievalBrowsing:{const M=v!=null&&[Y.GizmoInteraction,Y.GizmoMagicCreate,Y.GizmoTest].includes(v.kind),O=w?rt(w):!1;return s.jsx(Gt,{messages:u.messages,isRequestActive:d,isLastMessageInTurn:j,isUsingGizmo:M,isUsingSnorlax:O,isRetrieval:u.type===f.RetrievalBrowsing},"browsing-"+(u.messages[0]?.id??h))}case f.SearchGPTQuery:{if(e.some(I=>I.type===X)&&R)return null;const O=e.slice(h+1).findLast(I=>I.type===f.Text||I.type===f.CoTSearchTool),$=n.findLast(I=>ye(I).length>0);return s.jsx(Jt,{clientThreadId:a,turnIndex:m,isRequestActive:d,isLastMessage:j,isLastTurnInConversation:l,nextMessage:O?.messages[0],searchResultGroups:ye($)},"searchquery-"+(u.messages[0]?.id??h))}case f.StructuredThoughts:return null;case f.ReasoningRecap:return null;case f.CoTSearchTool:return null;case f.n7jupd:return null;case f.n7jupd_i:case f.n7jupd_x:return null;case f.a8km123:{if(!u.messages.every(O=>!O.metadata?.reasoning_status)){const O=He(n,$=>$.author.role===Le.Assistant&&$.recipient==="all");return s.jsx(na,{clientThreadId:a,turnIndex:m,isStreaming:(j||O<h)&&i,isFinalTurn:l,messages:u.messages},"sum-"+(u.messages[0]?.id??h))}return s.jsx(aa,{messages:u.messages,isStreaming:j&&i,isCompletionRequestInProgress:i,hasActiveRequest:d,isLastMessage:j,isFinalTurn:l,isFeedbackEnabled:c,clientThreadId:a,currentGroupedMessageIndex:h,turnIndex:m},"sum-"+(u.messages[0]?.id??h))}case f.f959b8c:return Qe(),null;case f.is_loading_message:return j&&i?s.jsx(ot,{},"loading-message-"+h):null;case f.c12k321:return null;case f.l1p9k3u:return null;case f.b1de6e2_c:return s.jsx(wt,{messages:u.messages,clientThreadId:a,isLastMessage:j},"b1de6e2-"+(u.messages[0]?.id??h));case f.b1de6e2_s:return s.jsx(Tt,{messages:u.messages,clientThreadId:a},"b1de6e2_s-"+(u.messages[0]?.id??h));case f.b1de6e2_d:return null;case f.b1de6e2_rm:return s.jsx(nt,{messages:u.messages,clientThreadId:a,renderingView:b,children:Q},"b1de6e2_rm-"+(u.messages[0]?.id??h));case f.de1d73e:if(S){const M=h+1<t.length?t[h+1]:void 0;return s.jsx(ra,{clientThreadId:a,currentGroupedMessage:u,nextMessage:M&&M.type===f.Text?M.messages[0]:void 0,isLastMessage:j,isRequestActive:d},"jawbone-"+(u.messages[0]?.id??h))}else return null;case f.ParallelBrowsing:return s.jsx(qt,{messages:u.messages},"parallel-"+(u.messages[0]?.id??h));case f.CodeInterpreter:return s.jsx(ta,{messages:u.messages,isRequestActive:d,clientThreadId:a},"ada-"+(u.messages[0]?.id??h));case f.JITPlugin:return s.jsx(sa,{messages:u.messages,clientThreadId:a,isLastTurnInConversation:l,onRequestCompletion:g},"jit-"+(u.messages[0]?.id??h));case f.t2uay3k:return s.jsx(Zt,{messages:u.messages,clientThreadId:a,disableClickThru:_,isLastTurnInConversation:l},"t2uay3k-"+(u.messages[0]?.id??h));case f.Dalle:return s.jsx(Yt,{messages:u.messages,clientThreadId:a,disableClickThru:_},"dalle-"+(u.messages[0]?.id??h));case f.GizmoEditor:return s.jsx(Wt,{messages:u.messages},"gizmo-editor-"+(u.messages[0]?.id??h));case f.oiw209h:return s.jsx(Xt,{messages:u.messages,clientThreadId:a},"oiw209h-"+(u.messages[0]?.id??h));case f.Canmore:return s.jsx(St,{messages:u.messages,allTurnMessages:n,isFinalTurn:l,isRequestActive:d,clientThreadId:a,isUserTurn:o},"canmore-"+(u.messages[0]?.id??h));case f.Container:case f.Oboe:return null;case f.Debug:return y?s.jsx(Qt,{message:u.messages[0]},"debug-"+u.messages[0].id):null;case f.SearchResult:return s.jsx(ea,{messages:u.messages},"search-result-"+(u.messages[0]?.id??h));case f.kanzi:return null;case f.Mochi:return null}}),Ye=dt(),{wordFadeType:H,animationDurationMs:me}=lt(),K=x.useRef([]),ue=x.useRef(void 0),de=x.useRef(null),W=!o&&l&&i,ge=n[0]?.id;return gs(()=>{if(H!=="indexed"||!W)return;const u=de.current;if(!u)return;ue.current!==ge&&(ue.current=ge,K.current=[]);const h=u.getAnimations({subtree:!0}).filter(j=>j.animationName===ve["fade-in"]);if(h.length!==0){const j=ua({now:performance.now(),previousStartTimes:K.current,groupCount:h.length});K.current=j;for(let R=0;R<h.length;R++)h[R].startTime=j[R]}else K.current=[]},[q,H,W]),s.jsx("div",{className:A({"flex max-w-full flex-col":!0,[ve.root]:H==="indexed"&&W,grow:p}),style:H==="indexed"?{"--duration":`${me}ms`}:void 0,ref:de,children:s.jsx(fs,{name:"GroupedMessages",fallback:ca,children:o?q:s.jsxs(ct,{isDisabled:!W||H!=="delay",defaultAnimationDurationPerSegmentMs:me,children:[mt(k)&&l&&s.jsx(ut,{isStreaming:i,debug:Ye}),q]},n[0]?.id)})})}function ca({error:e}){return s.jsxs(gt,{type:"danger",children:[s.jsx(T,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."}),!1]})}function ma(e,n,t){if(e.length<2||n<=0)return 0;const a=n/Math.log(2);e=[...e].sort((c,l)=>c-l);let o=0,i=0;for(let c=e.length-1;c>0;--c){const l=Math.exp(-(t-e[c])/a);if(o>0&&l/o<.01)break;const r=e[c]-e[c-1];o+=l,i+=l*r}return o===0?0:o/i}function ua({now:e,previousStartTimes:n,groupCount:t,initialRate:a=50,halfLife:o=1}){const i=n.slice(0,He(n,d=>d<=e)+1),c=i.length<2?a/1e3:Math.max(.01,ma(i,o*1e3,e)),l=t-i.length;let r=i[i.length-1]??0,m=1;for(let d=0;d<l;d++){const g=c*1e3*m;l<g?m*=.8:l>g&&(m*=1.5);const p=1/(c*m),_=Math.max(e,r+p);i.push(_),r=_}return i}export{ya as C,ke as F,U as T,Bt as a,_a as b};
//# sourceMappingURL=h3axfhhn58bmthc9.js.map
