import{j as e,M as L,r as x}from"./b8ijctzpgh0s7wpx.js";import{c as o,B as $,bl as z,bj as N,bS as B,ch as R,eA as F,e as G,n as H,a_ as K,m as O}from"./citrwydz0bgriwlc.js";import{i8 as Q,jI as Z,Z as q,a4 as I,i$ as J}from"./krbmwir12ubt4od1.js";import{S as V}from"./ij1hijr26xwrvnm7.js";import{M as S}from"./eg629yaevviy8e7x.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";function W({message:t,simulatedDuration:r=8*60*1e3,maxFill:s=100}){t?.metadata?.model_slug!=="o1-pro"&&(r=20*60*1e3);const n=t?.create_time?new Date(t.create_time*1e3):Date.now(),i=Q(+n,r);return e.jsx(Z,{percentage:Math.min(i,s),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-i)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:8})}function X({title:t,content:r,buttons:s,time:n,icon:i,size:l="default",progressBar:c,disabled:a=!1,onClick:u}){const f="bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",v=l==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${a?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",p=u?"cursor-pointer":"",g=l==="small"?"text-[15px]":"";return e.jsxs("div",{className:o("relative inline-flex flex-col items-start justify-start rounded-2xl border",f,v,p,g),onClick:u,children:[e.jsxs("div",{className:o("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:o("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[e.jsx("div",{className:o("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:t}),e.jsx("div",{className:"relative h-6 w-6"}),!a&&(i||e.jsx(V,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:o("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:o("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:o("w-full leading-relaxed font-normal",a?"text-token-text-tertiary":"text-token-text-secondary"),children:r})})})]}),c?e.jsxs("div",{className:o("mb-2 inline-flex items-center justify-between self-stretch",s?.length&&"mt-[-10px]"),children:[c,s]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[n&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:n}),e.jsx("div",{className:"flex gap-2",children:s})]})]})}function Y({errorNotice:t,onOpenSidebarSummarizer:r,isReceivingUpdates:s,lastMessage:n,latestTitle:i,summarizationHeadline:l}){return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(X,{buttons:s?[e.jsx($,{onClick:c=>{c.stopPropagation(),r()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(L,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:s?e.jsx("div",{className:""}):null,content:s?`${i}...`:n?.metadata?.finished_text??"",size:"small",disabled:!s,onClick:r,progressBar:s?e.jsx(W,{message:n}):null}),t]})}const U=/\*\*(.*?)(?:\*\*|\n|$)/g,ee=t=>{let r=null,s;for(;(s=U.exec(t))!=null;)r=s[1].trim();return r},te=()=>null;function de({messages:t,isStreaming:r,isCompletionRequestInProgress:s,hasActiveRequest:n,isLastMessage:i,isFinalTurn:l,isFeedbackEnabled:c,clientThreadId:a,currentGroupedMessageIndex:u,turnIndex:f}){const[v,p]=x.useState(""),[g,C]=x.useState(!1),w=q(a)?.value===z.STREAMING,k=I(N(a)),m=B(t),M=m?.id,b=m?.metadata?.initial_text,T=m?.metadata?.summarization_headline,h=t.map(d=>R(d)).join(`

`),{toggleThreadSidebar:y}=F(),_=x.useCallback(()=>{y({type:"summarizer",clientThreadId:a,currentGroupedMessageIndex:u,turnIndex:f})},[y,a,u,f]);x.useEffect(()=>{const d=ee(h);d?p(d):b!=null&&p(b)},[h,b]),x.useEffect(()=>{h.length>0&&C(!0)},[h]),x.useEffect(()=>{g&&G.logEvent("Tool: Received a8km123 message",{client_thread_id:a,message_id:M,conversationId:N(a)})},[g]);const E=l&&i&&(w||r),P=te()!=null,A=H.isLastActorMessage(K(a),t[0].id),D=!!O(a,d=>d?.sharedConversationMetadata),j=J(t[0],A,P,s||n,D);return!k&&m?.metadata?.finish_details?.type==="interrupted"&&m?.metadata?.finish_details?.reason!=="server_timeout"||m?.clientMetadata?.err?e.jsx("div",{children:j&&e.jsx(S,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1})}):e.jsx(Y,{errorNotice:j&&e.jsx(S,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1}),onOpenSidebarSummarizer:_,isReceivingUpdates:E,lastMessage:m,latestTitle:v,summarizationHeadline:T})}export{de as default};
//# sourceMappingURL=her6q3ihv1schhbg.js.map
