import{j as A,b1 as S,B as C,f as z,c as F,O as V,eP as _}from"./citrwydz0bgriwlc.js";import{i as E,r as f,j as e,M as v,f as D,a9 as H}from"./b8ijctzpgh0s7wpx.js";import{bP as O,dO as Y,bJ as q,cW as G,dq as U,aX as J,cs as K,aH as X,ds as Z,dK as Q}from"./krbmwir12ubt4od1.js";import{g as M}from"./ji5qoh13hkjncrxd.js";import{h as $,A as ee}from"./nduxp30o3uqcxibn.js";import{F as R}from"./c4nkx1d9qfqo4ctl.js";import{R as te,N as se,a as ne}from"./hz6exfliqj1u3hji.js";import{C as L}from"./nbecgsenc0idjs5j.js";import{u as oe}from"./dqlgwtv3al9lzs4d.js";import{k as ae,l as re,m as T,e as I}from"./omp8ie1vzl40ti1z.js";import{u as ie}from"./fkpvp4h0mv7mwrx3.js";import{I as le}from"./mtbwfu1a5yslb3p2.js";import{T as ce}from"./n3fqqr9zf79bnmr6.js";import{W as de}from"./gw319re0na8zpsh7.js";import"./kdg6x58wvl6ya91l.js";import"./ftxrqc0rwihsh5tn.js";import"./ndqm17bbs5ambnrw.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./jekpe1ukp5thtucq.js";import"./b4v20hsjdnh8a64d.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./dcml6fn13vfm1zv2.js";import"./nvghija6qp2cunds.js";import"./djd85tifm57yisqi.js";import"./h3krx8dg2s8o2yh5.js";import"./cfe0bfy5asp94vp2.js";import"./jkznwfhp8ahnvlot.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./i7jya7stlyvnzya0.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./k6ccgr4wxcppeg93.js";import"./dbalwdodzoo02ru2.js";import"./c2d9eukr2hh7n3q0.js";import"./nnffynscsbaol5fb.js";import"./eeyp7d7oqudhas3m.js";import"./nfkxdwnvdjy1s4sn.js";import"./cwi4lsxreiklxbjv.js";function me({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a,lockPageView:l}){const i=E();return f.useEffect(()=>{O.recordEnvironmentsView()},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(L,{title:i.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:i.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(W,{handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a,lockPageView:l})]})}function W({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a,lockPageView:l,shouldDisableRow:i,disablePill:g}){const m=E(),x=A(),[c,b]=f.useState(""),[j,w]=f.useState(null),{mutate:k,isPending:d}=oe({onSuccess:t=>{O.recordCreateEnvSuccess(),n(t.id,M(t)),a()}}),{data:p,isLoading:h}=ae(),u=S(x,"2134057841"),r=ie({defaultValues:{repositoryId:"",agentNetworkAccess:u?{mode:"off"}:null},validators:{onSubmit:({value:t})=>{const y={};return(!t.repositoryId||t.repositoryId==="")&&(y.repositoryId=m.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),u&&t.agentNetworkAccess?.mode==="on"&&t.agentNetworkAccess.preset_allowlist===Y&&(!t.agentNetworkAccess.allowlist_domains||t.agentNetworkAccess.allowlist_domains.length===0)&&(y.agentNetworkAccess=m.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),{fields:y}}},onSubmit:({value:t})=>{O.recordEnvironmentsSubmit(),l(),k({...t,label:c,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",envVars:[],secrets:[]})}}),P=t=>{t.preventDefault(),t.stopPropagation(),r.handleSubmit()};return f.useEffect(()=>{h||p?.installations.length===0&&$()},[h,p,x]),e.jsx("form",{onSubmit:P,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(ee,{selectedInstallationId:j,setSelectedInstallationId:w}),e.jsx(r.Field,{name:"repositoryId",children:t=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(te,{installationId:j,selectedRepository:t.state.value,onSelect:(y,B)=>{t.handleChange(y),b(B)},shouldDisableRow:i,disablePill:g}),e.jsx(R,{field:t})]})}),u&&e.jsx(r.Field,{name:"agentNetworkAccess",children:t=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(se,{agentNetworkAccess:t.state.value,onChange:t.handleChange}),e.jsx(R,{field:t}),t.state.value?.mode==="on"&&e.jsx(ne,{})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(C,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(r.Subscribe,{selector:t=>t.values,children:t=>e.jsx(C,{color:"primary",size:"medium",loading:d,disabled:!c||u&&!t.agentNetworkAccess,onClick:()=>r.handleSubmit(),children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})})]})]})})}function xe({selectedTab:s,onChange:n}){const a=E(),l=A(),i=S(l,"2665240312"),g=f.useCallback(m=>{n(m)},[n]);return e.jsx("div",{className:"border-token-border-primary flex w-full items-center border-b align-middle",children:i&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ce,{currentTab:s,onChange:g,withUnderline:!0,tabs:[{label:a.formatMessage({id:"wham.selectEnvironmentHeader.create",defaultMessage:"Existing environments"}),key:"select"},{label:a.formatMessage({id:"wham.selectEnvironmentHeader.select",defaultMessage:"New environment"}),key:"create"}]})})})}function ue({environment:s,isSelected:n,className:a}){return e.jsxs("div",{className:F("flex items-center justify-between gap-2",a),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:s.label}),s.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(v,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:s.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:s.description})]}),n?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Z,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function fe({environment:s,isSelected:n,onClick:a}){return e.jsx("button",{className:F("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:a,type:"button",children:e.jsx(ue,{environment:s,isSelected:n,className:"w-full"})})}function N(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(X,{className:"h-14 w-full"})})}const ge=10;function pe({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a}){const l=E(),[i,g]=f.useState(""),m=A(),x=S(m,"2673860158"),{data:c,isLoading:b,fetchNextPage:j,hasNextPage:w,isFetchingNextPage:k}=T({pageSize:ge,enforceRepoAccess:x}),d=f.useMemo(()=>c?.pages.flatMap(o=>o.items??[])??[],[c]),p=d.filter(o=>o.label.toLowerCase().includes(i.toLowerCase())),h=I(o=>o.environmentId),u=I(o=>o.setEnvironmentId);return f.useEffect(()=>{if(h){const o=d.find(r=>r.id===h);o?n(o.id,M(o)):u(null)}else d.length===1&&(u(d[0].id),n(d[0].id,M(d[0])))},[h,d,n,u]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(q,{color:"search",iconPosition:"left",icon:G,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:i,onChange:o=>g(o.target.value),placeholder:l.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:l.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:b?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{}),e.jsx(N,{})]}):e.jsxs(e.Fragment,{children:[p.length===0&&!w?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):p.map((o,r)=>e.jsxs("div",{children:[e.jsx(fe,{environment:o,isSelected:h===o.id,onClick:()=>n(o.id,M(o))}),r!==p.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},o.id)),e.jsx(le,{isFetchingNextPage:k,hasNextPage:w??!1,fetchNextPage:j,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(C,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(C,{color:"primary",size:"medium",disabled:!h,onClick:a,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function he(){const s=E(),n=U(),i=z()?.name??s.formatMessage({id:"wham.codexOnboardingEnvironments.workspaceName",defaultMessage:"Workspace"});return e.jsx(J,{label:s.formatMessage({id:"wham.codexOnboardingEnvironments.environmentExistsTooltip",defaultMessage:"An environment has already been created for {workspaceName}. Youâ€™ll be able to create a new environment later for this repo in settings."},{workspaceName:i}),children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-tertiary inline-flex items-center justify-center gap-1 rounded-3xl py-1.5 ps-1.5 pe-1.5",children:[e.jsx(K,{className:"icon-sm"}),!n&&e.jsx("div",{className:"justify-start pe-1 text-xs leading-3 font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.environmentExists",defaultMessage:"Environment already exists"})})]})})}function ve({handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a}){const l=E(),[i,g]=f.useState("select"),{data:m}=re(),x=c=>m?.some(b=>b.repos.includes(c.id))??!1;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(L,{title:l.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:l.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx("div",{className:"pb-4",children:e.jsx(xe,{selectedTab:i,onChange:c=>{g(c)}})}),i==="select"?e.jsx(pe,{handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a}):e.jsx(W,{lockPageView:()=>{},handleGoBack:s,handleSelectEnvironment:n,goToNextPage:a,shouldDisableRow:x,disablePill:e.jsx(he,{})})]})}function be(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(v,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost thereâ€¦"}),e.jsx(V,{})]})})}function je(){const{eligible:s,isLoading:n}=Q(),a=A(),l=S(a,"2673860158"),i=S(a,"2395384117"),{data:g,isLoading:m}=T({pageSize:1,enforceRepoAccess:l}),x=D(),[c,b]=f.useState(!1),j=()=>{x("/codex/onboarding/connections")},w=()=>{x(i?"/codex/onboarding/starter-tasks":"/codex/onboarding/data-check")},k=I(r=>r.setEnvironmentId),d=I(r=>r.setBranch),p=(r,P)=>{k(r),d(P)},u=(g?.pages.flatMap(r=>r.items).length??0)>0;if(n||m)return e.jsx(be,{});if(!s)return e.jsx(H,{to:"/codex"});const o=!c&&u&&!0;return e.jsx(de,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:o?e.jsx(ve,{handleGoBack:j,handleSelectEnvironment:p,goToNextPage:w}):e.jsx(me,{handleGoBack:j,handleSelectEnvironment:p,goToNextPage:w,lockPageView:()=>b(!0)})})})}const mt=()=>[{title:"Codex"}],xt=_(function(){return e.jsx(je,{})});export{xt as default,mt as meta};
//# sourceMappingURL=oiz8l6whcgzkguee.js.map
