import{el as A,em as b}from"./krbmwir12ubt4od1.js";import{P as y,F as m,S as g,T as C,N as S,D as k,a as w,b as u}from"./k1h56nx2kjoqc52m.js";const K=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function N(r){let e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let i,n,s,l;for(let a=0;a<e.length-1;a++){let f=e[a];if(/^(cmd|meta|m)$/i.test(f))l=!0;else if(/^a(lt)?$/i.test(f))i=!0;else if(/^(c|ctrl|control)$/i.test(f))n=!0;else if(/^s(hift)?$/i.test(f))s=!0;else if(/^mod$/i.test(f))K?l=!0:n=!0;else throw new Error("Unrecognized modifier name: "+f)}return i&&(t="Alt-"+t),n&&(t="Ctrl-"+t),l&&(t="Meta-"+t),s&&(t="Shift-"+t),t}function T(r){let e=Object.create(null);for(let t in r)e[N(t)]=r[t];return e}function d(r,e,t=!0){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t&&e.shiftKey&&(r="Shift-"+r),r}function J(r){return new y({props:{handleKeyDown:x(r)}})}function x(r){let e=T(r);return function(t,i){let n=A(i),s,l=e[d(n,i)];if(l&&l(t.state,t.dispatch,t))return!0;if(n.length==1&&n!=" "){if(i.shiftKey){let a=e[d(n,i,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((i.shiftKey||i.altKey||i.metaKey||n.charCodeAt(0)>127)&&(s=b[i.keyCode])&&s!=n){let a=e[d(s,i)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}class o extends u{constructor(e){super(e,e)}map(e,t){let i=e.resolve(t.map(this.head));return o.valid(i)?new o(i):u.near(i)}content(){return g.empty}eq(e){return e instanceof o&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new o(e.resolve(t.pos))}getBookmark(){return new p(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!D(e)||!F(e))return!1;let i=t.type.spec.allowGapCursor;if(i!=null)return i;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,i=!1){e:for(;;){if(!i&&o.valid(e))return e;let n=e.pos,s=null;for(let l=e.depth;;l--){let a=e.node(l);if(t>0?e.indexAfter(l)<a.childCount:e.index(l)>0){s=a.child(t>0?e.indexAfter(l):e.index(l)-1);break}else if(l==0)return null;n+=t;let f=e.doc.resolve(n);if(o.valid(f))return f}for(;;){let l=t>0?s.firstChild:s.lastChild;if(!l){if(s.isAtom&&!s.isText&&!S.isSelectable(s)){e=e.doc.resolve(n+s.nodeSize*t),i=!1;continue e}break}s=l,n+=t;let a=e.doc.resolve(n);if(o.valid(a))return a}return null}}}o.prototype.visible=!1;o.findFrom=o.findGapCursorFrom;u.jsonID("gapcursor",o);class p{constructor(e){this.pos=e}map(e){return new p(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return o.valid(t)?new o(t):u.near(t)}}function D(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),i=r.node(e);if(t==0){if(i.type.spec.isolating)return!0;continue}for(let n=i.child(t-1);;n=n.lastChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function F(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),i=r.node(e);if(t==i.childCount){if(i.type.spec.isolating)return!0;continue}for(let n=i.child(t);;n=n.firstChild){if(n.childCount==0&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}function I(){return new y({props:{decorations:P,createSelectionBetween(r,e,t){return e.pos==t.pos&&o.valid(t)?new o(t):null},handleClick:z,handleKeyDown:M,handleDOMEvents:{beforeinput:O}}})}const M=x({ArrowLeft:c("horiz",-1),ArrowRight:c("horiz",1),ArrowUp:c("vert",-1),ArrowDown:c("vert",1)});function c(r,e){const t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(i,n,s){let l=i.selection,a=e>0?l.$to:l.$from,f=l.empty;if(l instanceof C){if(!s.endOfTextblock(t)||a.depth==0)return!1;f=!1,a=i.doc.resolve(e>0?a.after():a.before())}let h=o.findGapCursorFrom(a,e,f);return h?(n&&n(i.tr.setSelection(new o(h))),!0):!1}}function z(r,e,t){if(!r||!r.editable)return!1;let i=r.state.doc.resolve(e);if(!o.valid(i))return!1;let n=r.posAtCoords({left:t.clientX,top:t.clientY});return n&&n.inside>-1&&S.isSelectable(r.state.doc.nodeAt(n.inside))?!1:(r.dispatch(r.state.tr.setSelection(new o(i))),!0)}function O(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof o))return!1;let{$from:t}=r.state.selection,i=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!i)return!1;let n=m.empty;for(let l=i.length-1;l>=0;l--)n=m.from(i[l].createAndFill(null,n));let s=r.state.tr.replace(t.pos,t.pos,new g(n,0,0));return s.setSelection(C.near(s.doc.resolve(t.pos+1))),r.dispatch(s),!1}function P(r){if(!(r.selection instanceof o))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",k.create(r.doc,[w.widget(r.selection.head,e,{key:"gapcursor"})])}export{I as g,J as k};
//# sourceMappingURL=djd85tifm57yisqi.js.map
