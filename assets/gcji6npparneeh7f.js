import{r as l,ah as K,p as q,i as Y,j as r,a6 as X,a5 as x}from"./b8ijctzpgh0s7wpx.js";import{mn as $,mo as J,mp as k,eK as Q,C as p,mq as Z,mr as tt,ly as et,ms as st,mt as at,mu as ot,mv as nt,jt as it,mw as rt,mx as ct,my as dt,mz as R,mA as z,jr as lt,eE as ut,u as mt,mB as M,U as N,mC as W,mD as pt,mE as ht,j7 as ft,mF as gt}from"./krbmwir12ubt4od1.js";import{h1 as S,aI as D,m as O,n as T,ew as xt,dW as vt,g1 as Ct,eW as F,ex as wt,gM as Tt,g9 as It}from"./citrwydz0bgriwlc.js";import{L as bt}from"./grmx1v2b0e1c1pfw.js";import{T as yt}from"./hu7jamjectvubclw.js";import{g as St}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./m4qet7ipn6ha09it.js";import"./hbpbckirom363mgh.js";import"./by50z05oxjtbvc0n.js";import"./eq7m7kpdgo83dcz8.js";import"./m27qwee0va0l7e3n.js";import"./eqsdgkbw87fpj3r7.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./bhqc37jb73aufzkm.js";import"./n8y79r98tvk4ovf6.js";import"./noq8k3whf0dyc5h2.js";import"./fl25v7yedm9z0cyb.js";import"./n4e94a1v0wut7i04.js";import"./5l7gzqkfu3rktsj8.js";import"./h6aag2lelyp3pu40.js";import"./j2zbz2jpl151yhf4.js";import"./h3axfhhn58bmthc9.js";import"./eg629yaevviy8e7x.js";import"./hf1qeqo8wh44t1id.js";import"./nv8u6v964bkr3z82.js";import"./bt7o8eyltdx74vk0.js";import"./c23qlyb7rng4ydyc.js";import"./k00srulxk3kjmgxy.js";import"./iki1bxy2syl3zwuv.js";import"./b4v20hsjdnh8a64d.js";import"./dcml6fn13vfm1zv2.js";import"./nvghija6qp2cunds.js";import"./djd85tifm57yisqi.js";import"./h3krx8dg2s8o2yh5.js";import"./cfe0bfy5asp94vp2.js";import"./jkznwfhp8ahnvlot.js";import"./megablgldkh4lap1.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./i7jya7stlyvnzya0.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./k6ccgr4wxcppeg93.js";import"./dbalwdodzoo02ru2.js";import"./c2d9eukr2hh7n3q0.js";import"./k5qjx4jdow04k7d2.js";import"./ocq21rw37s5jtm4i.js";import"./kwgbehxqut2f64bk.js";const j="oai/apps/canmoreSidebarWidth",Et=.25,At=400,L=400;function P(t){return t-At}function b(t,s){return K(L,P(t),s??Et*t)}function _t(){const t=S.useState(S.selectWindowWidth),s=b(t,$(D.DANGER_SECRET_FOLDERS_ONLY_getItem(j))),a=H(),[e,i]=l.useState(s);l.useEffect(()=>{(e<L||e>P(t))&&i(b(t,e))},[t]);function o(c){i(v=>b(t,v+=c.delta.x))}function n(c){i(c),D.DANGER_SECRET_FOLDERS_ONLY_setItem(j,c)}function u(){const c=b(t,void 0);n(c)}const h=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:h,viewportWidth:t,handleDrag:o,handleDoubleClick:u,persist:n}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(t){const s=S.useState(S.selectWindowWidth);return(t??s)>1e3}const A="sharedCanvas";function Rt(){const[t,s]=q(),a=t.get(A),e=Y();l.useEffect(()=>{const i=a&&J.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{k(i)});const o=new URLSearchParams(t);o.delete(A),s(o);const n=new URL(window.location.href);n.searchParams.delete(A),history.replaceState(null,"",n)},[a,t,s,e])}const Mt="textdocId",Nt=t=>{const a=new URLSearchParams(window.location.search).get(Mt),e=O(t,i=>T.findNode(i,({message:o})=>{const n=o.metadata?.canvas;return n?.create_source===Q.HIVE&&(a?n?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{e&&requestAnimationFrame(()=>{k(e)})},[e])};function Wt(t,s){let a;return s?.type===p.Textdoc?s.textdocId.startsWith(Z)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===p.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziTurnId}),tt(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const U=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:n}=et(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&n(void 0),u.current=!0,()=>{u.current=!1}),[a]),a==null)return null;switch(a.type){case p.Textdoc:return r.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:o});case p.Kanzi:break;case p.ADAVisualization:return null}},Dt=300,Ft=t=>{switch(t?.type){case p.Textdoc:return t.textdocId;default:return null}};function jt(t,s){const[a,e,i,o]=O(t,d=>[T.getRequestId(d),T.getConversationLastTurn(d),T.isMessageTurnEnded(d),T.getVariantIds(d).length>1]),n=xt(a),u=st(),[h,c]=l.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!i&&e&&(d=vt(e.messageGroups,f=>f.type!==Ct)),kt({groupedMessage:d,isRequestActive:n,latestTextdocId:u})},[i,e,o,s,n,u]),v=c!=null,C=Ft(c),w=at("canvas");l.useEffect(()=>{if(c&&h&&!ot()&&(w(),nt(c,h),c.type===p.Textdoc)){const{textdocId:d}=c,f=St(d);it(document.getElementById(f))}},[v,C])}function kt({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case F.Canmore:{const[e,i]=t.messages;if(!rt(e))break;const o=ct(s,e,i??null),n=o.textdocId??a;if(n&&(o.function===dt.CreateTextdoc?(o.content??"").length>Dt||o.status===R.WAITING:o.status===R.STREAMING))return[o.messageId,{type:p.Textdoc,textdocId:n}];break}case F.kanzi:{const[,e]=t.messages,i=e?.metadata?.kanzi,o=i?.task_id,n=i?.turn_id;if(o&&n)return[e.id,{type:p.Kanzi,kanziId:o,kanziTurnId:n,isKickoff:!0,defaultDebug:!0}];break}}return[void 0,null]}const y={type:"spring",bounce:.12,duration:.64},zt={type:"spring",bounce:0,duration:.58},Ot=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:n,persist:u}=_t(),[h,c]=l.useState(!0),[v,C]=l.useState(!1),w=pt(({rect:m})=>m),{windowHeight:d,windowWidth:f}=It(m=>m,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:e,width:f-e,height:d},_=!1;if(w&&(g.top<0||g.top+g.height>d)){_=!0;const m={width:(f-e)*.75,height:d*.75};g={top:d/2-m.height/2,left:(f-e-m.width)/2+e,width:m.width,height:m.height}}const I=w?.borderRadius,E=ht(),V=E?.history!=null||E?.showChangesAtVersion!=null,G=ft();return r.jsxs(r.Fragment,{children:[V&&r.jsx(bt,{onClick:()=>gt(E.textdocId),zIndexKey:"chatOverlay"}),r.jsxs(x.div,{initial:{marginInlineEnd:G?-260:0},animate:{marginInlineEnd:0},transition:zt,children:[r.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),r.jsx(x.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),r.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),r.jsx(x.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:v?{duration:0}:y,onAnimationComplete:()=>c(!1),children:r.jsx(x.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:I},animate:{borderRadius:0},exit:{borderRadius:I},transition:y,children:r.jsxs("div",{className:"h-full",children:[r.jsx(x.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>C(!0),onPointerUp:()=>C(!1),onDrag:(m,B)=>o(B),onDragEnd:()=>{C(!1),u(e)},onDoubleClick:()=>n()}),v&&r.jsx("div",{className:"absolute inset-0 z-10"}),r.jsx(U,{onClose:a,clientThreadId:t,isAnimating:h,focusedObject:s,width:f-e})]})})})]})},Lt=l.memo(Ot),Pt=({clientThreadId:t,focusedObject:s,onClose:a})=>r.jsx(Tt,{children:r.jsx(x.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:r.jsx(U,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Ht=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=H(s),i=ut();jt(t,a||i),Rt(),Nt(t);const o=mt();l.useEffect(()=>{z()},[t]);const n=o&&(e?r.jsx(Lt,{clientThreadId:t,onClose:W,focusedObject:o},"canvas-sidebar"):r.jsx(Pt,{clientThreadId:t,onClose:W,focusedObject:o},"canvas-modal"));l.useEffect(()=>{if(o)return M(h=>Wt(h,o)),()=>M(null)},[o]);const u=n!=null;return l.useEffect(()=>(N.setActiveStageSidebar(u),()=>{u&&N.setActiveStageSidebar(!1)}),[u]),r.jsx(X,{children:n},t)},Ge=t=>{const s=l.useRef(null);return r.jsx(wt,{ref:s,onError:(a,e)=>{z(),setTimeout(()=>{s.current?.resetErrorBoundary()}),lt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:r.jsx(Ht,{...t})})};export{Ge as CanvasFocusedViewManager};
//# sourceMappingURL=gcji6npparneeh7f.js.map
