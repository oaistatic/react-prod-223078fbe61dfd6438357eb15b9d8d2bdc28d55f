import{j as s,a6 as X,a5 as Z,i as D,r as i,M as O,d as z,f as ee,o as te,v as se,R as ne,c as M}from"./b8ijctzpgh0s7wpx.js";import{ac as _,c as b,a7 as ae,dl as oe,e as re,eT as ce,g as Y,b as ie,l as le,ab as ue,aq as de,j as fe,b1 as Q,S as me}from"./citrwydz0bgriwlc.js";import{u as he,F as $}from"./j81kavn28xsab5an.js";import{u as C,F as v,a as j,b as xe}from"./hp67ts4xs05yms3p.js";import{jw as U,ij as ge,oR as ye,dq as G,U as pe,sW as ve,a6 as V,d as ke,cW as be}from"./krbmwir12ubt4od1.js";import{u as we}from"./eigi8l95ddhoqirr.js";import"./cfe0bfy5asp94vp2.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./h3krx8dg2s8o2yh5.js";function je({children:t,rootClassName:e,className:a,description:n,icon:r,isOpen:o=!1,onClose:c,primaryButton:d,secondaryButton:l,size:m="normal",title:x,type:g,noPadding:f=!1,hideSeparator:p=!1,showCloseButton:u=!1,shouldIgnoreClickOutside:y=!1,closeButton:N,isScrollable:w=!0,position:S="center",removePopoverStyling:L=!1,showOverlayBackground:q=!0,shadow:E="normal"}){const F=!!x,I=!!t,h=F&&I&&!p;return s.jsx(X,{children:o&&s.jsx(_.Root,{testId:"modal-fanny-pack",isOpen:!0,onClose:c,shouldIgnoreClickOutside:y,className:e,children:s.jsx(_.Overlay,{showBackground:q,children:s.jsxs(Ce,{size:m,position:S,className:b("flex flex-col focus:outline-hidden",{"max-w-md":m==="normal"},a),removePopoverStyling:L,shadow:E,children:[s.jsx(_.Header,{icon:r,title:x,type:g,closeButton:u&&(N??s.jsx(ae,{onClick:()=>c(!0)})),description:n,withSeparator:h}),s.jsxs("div",{className:b("grow",w?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":m!=="fullscreen"&&!f,"md:pt-0!":!I}),children:[t,d!=null||l!=null?s.jsx(_.Actions,{primaryButton:d,secondaryButton:l,modalHasContent:I}):null]})]})})})})}function Ce({className:t,children:e,position:a="center",size:n,removePopoverStyling:r=!1,shadow:o="normal"}){return s.jsx(Z.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:14},transition:{duration:.175,ease:"easeInOut",exit:{opacity:{duration:.1,ease:"easeOut"},y:{duration:.175,ease:"easeOut"}}},className:b("z-50 h-full w-full overflow-y-auto",n!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",n!=="fullscreen"&&a==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",n!=="fullscreen"&&a==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:s.jsx(oe,{className:b(!r&&"popover","bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",n!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",t),children:e})})}function Ne(){const t=D(),e=C(n=>n.query),a=i.useRef(null);return s.jsx("input",{className:"placeholder:text-token-text-tertiary w-full border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",placeholder:t.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:n=>v.setQuery(n.target.value),onKeyDown:n=>{!n.shiftKey&&(n.key==="ArrowUp"||n.key==="ArrowDown")&&n.preventDefault()},value:e,ref:a})}function P({className:t,isActive:e=!1,icon:a,children:n,onClick:r,onMouseEnter:o,onMouseLeave:c}){const d=C(l=>l.mouseInteractionsDisabled);return s.jsx("div",{className:b("cursor-pointer",t),onMouseEnter:d?void 0:o,onMouseLeave:d?void 0:c,onClick:r,children:s.jsxs("div",{className:b("group relative flex items-center rounded-lg px-4 py-3",e&&"dark:bg-token-main-surface-secondary bg-[#f4f4f4]"),children:[a,s.jsx("div",{className:b("relative grow overflow-hidden whitespace-nowrap",a?"ps-4":""),children:n})]})})}function W(t){return t.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function Se({historyResult:t,index:e}){const a=D(),{item:n,onSelect:r}=t,o=C(c=>c.activeIndex);return s.jsx(P,{isActive:o===e,icon:s.jsx(U,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{j.logClick(n.id,e,"history"),r&&r()},onMouseEnter:()=>v.setActiveIndex(e),onMouseLeave:()=>v.setActiveIndex(void 0),children:s.jsx("div",{className:"text-sm",children:n.title??W(a)})})}function Re({labelResult:t}){return s.jsx("div",{className:"group text-token-text-secondary relative my-2 px-4 py-2 text-xs leading-4 font-medium",children:t.text})}function Me({newChatResult:t,query:e=void 0,index:a}){const{onSelect:n}=t,r=C(o=>o.activeIndex);return s.jsx(P,{isActive:r===a,onClick:()=>{re.logNewChatButtonClicked({location:"Fanny Pack"}),n&&n()},onMouseEnter:()=>v.setActiveIndex(a),onMouseLeave:()=>v.setActiveIndex(void 0),icon:s.jsx(ge,{className:"icon-sidebar text-token-text-secondary"}),children:s.jsx("div",{className:"text-sm",children:e?s.jsx(O,{id:"iQsutJ",defaultMessage:'New chat "{query}"',values:{query:e}}):s.jsx(O,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Pe(t){return i.useMemo(()=>{if(!t)return null;const e=new Date(t*1e3),a=new Date;return e.toDateString()===a.toDateString()?"Today":new Date(new Date().setDate(a.getDate()-1)).toDateString()===e.toDateString()?"Yesterday":e.getFullYear()===a.getFullYear()?e.toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[t])}var T,H;function Ee(){if(H)return T;H=1;var t=ce(),e=/[\\^$.*+?()[\]{}|]/g,a=RegExp(e.source);function n(r){return r=t(r),r&&a.test(r)?r.replace(e,"\\$&"):r}return T=n,T}var Fe=Ee();const Ie=z(Fe),_e=8;function De(t){return t.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function K({text:t,textToHighlight:e,shouldAdjustStart:a=!1,highlightClassName:n}){const r=i.useMemo(()=>{if(!a||!e)return t;const c=t.toLowerCase().indexOf(e?.toLowerCase());if(c===-1)return t;const d=Math.max(c-_e,0),l=t.substring(d);return d===0?l:"â€¦"+l},[t,e,a]),o=i.useMemo(()=>{const c=new RegExp(`(${Ie(e)})`,"gi");return r.split(c)},[r,e]);return!e||e.length===0?s.jsx("span",{children:t}):s.jsx("div",{className:"truncate",children:o.map((c,d)=>c.toLowerCase()===e.toLowerCase()?s.jsx("span",{className:n,children:c},d):c)})}function Ae({searchResult:t,index:e,elementRef:a}){const{item:n,onSelect:r,query:o}=t,c=D(),d=Pe(n.updateTime),l=De(n),x=C(f=>f.activeIndex)===e,g=i.useRef(null);return i.useEffect(()=>{let f;const p=setTimeout(()=>{f=new IntersectionObserver(u=>{u.forEach(y=>{y.isIntersecting&&(j.logImpression(n.source,e,n.conversationId),f&&f.disconnect())})},{threshold:.5}),g.current&&f.observe(g.current)},250);return()=>{f&&f.disconnect(),clearTimeout(p)}},[g,n,o,e]),s.jsx("div",{ref:g,children:s.jsx(P,{isActive:x,icon:n.isArchived?s.jsx(ye,{className:"icon-sidebar text-token-text-tertiary"}):s.jsx(U,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{j.logClick(n.conversationId,e,n.source),r&&r()},onMouseEnter:()=>v.setActiveIndex(e),onMouseLeave:()=>v.setActiveIndex(void 0),children:s.jsxs("div",{className:"flex items-center",ref:a,children:[s.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:l.titleClassName,children:s.jsx(K,{text:n.title&&n.title.length>0?n.title:W(c),textToHighlight:o.length>=3?o:void 0,highlightClassName:l.titleHighlightedClassName})}),s.jsx("div",{className:b("pt-1",l.messageClassName),children:s.jsx(K,{text:n.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:l.messageHighlightedClassName})})]}),x&&s.jsx("div",{className:"text-token-text-secondary ps-6 text-xs",children:d})]})})})}function A(){return i.useMemo(()=>({closeFannyPackModal:t=>{j.logClose(t),v.setIsActive(!1)}}),[])}function B(){const t=ee(),e=G(),{closeFannyPackModal:a}=A();return i.useCallback(n=>{e&&pe.closeActiveSidebar(),t(n),a("click")},[t,a,e])}function Le(){const{conversations:t}=ve(i.useMemo(()=>({}),[])),e=Y("550560761").config.value,a=Number(e?.history_results_limit??6),n=i.useMemo(()=>t.slice(0,Math.min(t.length,a)),[t,a]),r=we(n,0),o=B(),c=i.useMemo(()=>({kind:"newChat",onSelect:()=>{o("/")}}),[o]);return i.useMemo(()=>{const l=[c];return l.push(...[r.recent,r.dynamicMonths,r.dynamicYears].reduce((m,x)=>(Object.entries(x).forEach(([g,{items:f,label:p}])=>{f.length>0&&(m.push({kind:"label",text:p}),f.forEach(u=>{m.push({kind:"history",onSelect:()=>{o(V(u.id))},item:u})}))}),m),[])),l},[c,r,o])}async function qe({query:t,cursor:e}){return ie.safeGet("/conversations/search",{parameters:{query:{query:t,cursor:e}}})}function Te(){const t=C(h=>h.query),e=B(),[a,n]=i.useState(""),[r,o]=i.useState(!1),c=i.useRef(ke(h=>{o(!1),n(h)},250)).current,d=i.useCallback(h=>{h!==a&&(o(!0),c(h))},[a,c]);i.useEffect(()=>{d(t)},[t,d]);const{data:l,isError:m,isLoading:x,isFetchingNextPage:g,hasNextPage:f,fetchNextPage:p}=te({queryKey:["conversationSearch",{query:a}],queryFn:({pageParam:h})=>qe({query:a,cursor:h}),initialPageParam:"",getNextPageParam:h=>h.cursor??void 0,enabled:!!a});i.useEffect(()=>{x&&j.logQuery()},[x]),i.useEffect(()=>{m&&j.logQueryError()},[m]),i.useEffect(()=>{g&&j.logQueryMore()},[g]);const u=i.useMemo(()=>l?.pages.flatMap(h=>h.items)??[],[l]),y=i.useRef(null),N=i.useCallback(h=>{x||h==null||(y.current?.disconnect(),y.current=new IntersectionObserver(k=>{k[0].isIntersecting&&!g&&f&&p()}),y.current.observe(h))},[x,g,f,p]);i.useEffect(()=>()=>{y.current?.disconnect()},[]);const w=u&&a===t,S=t.length>0&&(r||x||g),L=Y("550560761").config.value,q=Number(L?.local_results_limit??0),E=he(t,q),F=i.useMemo(()=>{const h=E;return w&&u.forEach(k=>{h.has(k.conversation_id)||h.set(k.conversation_id,{conversationId:k.conversation_id,nodeId:k.current_node_id,title:k.title,isArchived:k.is_archived,updateTime:k.update_time,snippet:k.payload.snippet,source:"remote"})}),Array.from(h.values())},[E,u,w]);return{searchResults:i.useMemo(()=>F.map(h=>({kind:"search",onSelect:()=>{e(`${V(h.conversationId)}?src=history_search`)},item:h,query:t})),[F,e,t]),shouldShowLoading:S,infiniteScrollTriggerElementRef:N}}function Oe(t,e,a){switch(t.kind){case"history":return s.jsx(Se,{historyResult:t,index:e});case"label":return s.jsx(Re,{labelResult:t});case"loading":return s.jsx(He,{loadingResults:t});case"newChat":return s.jsx(Me,{newChatResult:t,query:t.query,index:e});case"noResults":return s.jsx($e,{});case"search":return s.jsx(Ae,{searchResult:t,index:e,elementRef:a})}}function Be(t,e){const a=i.useCallback(()=>{for(let o=(t??-1)+1;o<e.length;o++)if(e[o].onSelect)return o;return t},[t,e]),n=i.useCallback(()=>{for(let o=(t??e.length)-1;o>=0;o--)if(e[o].onSelect)return o;return t},[t,e]),r=i.useCallback(()=>{t!==void 0&&e[t]&&e[t].onSelect&&e[t].onSelect()},[t,e]);i.useEffect(()=>{const o=c=>{c.isComposing||(c.key==="ArrowUp"&&!c.shiftKey?v.setActiveIndex(n()):c.key==="ArrowDown"&&!c.shiftKey?v.setActiveIndex(a()):(c.key==="Enter"||c.key==="Return")&&(c.preventDefault(),r()))};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[n,a,r]),i.useEffect(()=>{const o=()=>{xe.getMouseInteractionsDisabled()&&v.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function Qe(t,e){const a=i.useRef([]);return i.useEffect(()=>{a.current=e.map(()=>ne.createRef())},[e]),i.useEffect(()=>{a.current.forEach((n,r)=>{t===r&&n?.current&&n.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[t,a]),a}function $e(){return s.jsx(P,{className:"text-token-text-tertiary text-sm",icon:s.jsx(be,{className:"icon-sidebar"}),children:s.jsx(O,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function R(){return s.jsx(P,{icon:s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-[14px] w-[14px] rounded-full"}),children:s.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-2 w-1/4 rounded-full"}),s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary mt-3 h-2 w-1/2 rounded-full"})]})})}function He({loadingResults:t}){return t.shouldShowMultiple?s.jsxs(s.Fragment,{children:[s.jsx(R,{}),s.jsx(R,{}),s.jsx(R,{}),s.jsx(R,{}),s.jsx(R,{})]}):s.jsx(R,{})}function Ke(){const t=B(),{searchResults:e,shouldShowLoading:a,infiniteScrollTriggerElementRef:n}=Te(),r=Le(),o=C(u=>u.query),c=o.length>0,{value:d}=le("1741586789");i.useEffect(()=>{j.setQuerySessionId(se())},[o]);const l=i.useMemo(()=>({kind:"newChat",query:o,onSelect:()=>{t(`/?q=${o}`)}}),[o,t]),m=i.useMemo(()=>{const u=[];return o&&d&&u.push(l),c?u.push(...e):u.push(...r),a?u.push({kind:"loading",shouldShowMultiple:u.length===0}):u.length===0&&u.push({kind:"noResults"}),u},[o,d,l,c,a,e,r]),x=C(u=>u.activeIndex);Be(x,m);const g=Qe(x,m),f=i.useRef(null);i.useEffect(()=>{v.setActiveIndex(0),f.current&&(f.current.scrollTop=0)},[o]);const p=i.useRef(!0);return i.useEffect(()=>{p.current&&!a&&m.length===1&&m[0].kind==="noResults"&&j.logNoResults(),p.current=a},[a,m]),s.jsx("div",{ref:f,children:s.jsx("ol",{className:"mx-2",children:m.map((u,y)=>s.jsx("li",{ref:g.current[y],children:Oe(u,y,y===m.length-1?n:void 0)},y))})})}function ct(){"use forget";const t=M.c(3),e=C(Ye),a=G();let n;return t[0]!==e||t[1]!==a?(n=a?s.jsx(Ge,{isOpen:e}):s.jsx(Ve,{isOpen:e}),t[0]=e,t[1]=a,t[2]=n):n=t[2],n}function Ye(t){return t.isActive}function Ue(t){"use forget";const e=M.c(9),{onClick:a,className:n}=t,r=D();let o;e[0]!==n?(o=b("hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex items-center justify-center rounded-full bg-transparent p-1 focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden",n),e[0]=n,e[1]=o):o=e[1];let c;e[2]!==r?(c=r.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),e[2]=r,e[3]=c):c=e[3];let d;e[4]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(me,{className:"icon-sidebar text-token-text-tertiary hover:text-token-text-primary"}),e[4]=d):d=e[4];let l;return e[5]!==a||e[6]!==o||e[7]!==c?(l=s.jsx("button",{className:o,"aria-label":c,onClick:a,children:d}),e[5]=a,e[6]=o,e[7]=c,e[8]=l):l=e[8],l}function J(t){"use forget";const e=M.c(19),{className:a}=t,{closeFannyPackModal:n}=A(),r=de(),o=i.useRef(!1),c=fe();let d;e[0]!==c?(d=Q(c,"3678527908"),e[0]=c,e[1]=d):d=e[1];const l=d;let m;e[2]!==c?(m=Q(c,"1422501431"),e[2]=c,e[3]=m):m=e[3];const x=m;let g,f;e[4]!==r||e[5]!==l||e[6]!==x?(g=()=>{!o.current&&l&&r&&(x?$.setCurrentAccountV2(r):$.setCurrentAccount(r),o.current=!0)},f=[l,r,x],e[4]=r,e[5]=l,e[6]=x,e[7]=g,e[8]=f):(g=e[7],f=e[8]),i.useEffect(g,f);let p;e[9]!==a?(p=b("flex flex-col",a),e[9]=a,e[10]=p):p=e[10];let u;e[11]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(Ne,{}),e[11]=u):u=e[11];let y;e[12]!==n?(y=s.jsxs("div",{className:"ms-6 me-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[u,s.jsx(Ue,{className:"ms-4",onClick:()=>{n("button")}})]}),e[12]=n,e[13]=y):y=e[13];let N;e[14]===Symbol.for("react.memo_cache_sentinel")?(N=s.jsx("hr",{className:"border-token-border-default"}),e[14]=N):N=e[14];let w;e[15]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx("div",{className:"my-2 grow overflow-y-auto",children:s.jsx(Ke,{})}),e[15]=w):w=e[15];let S;return e[16]!==p||e[17]!==y?(S=s.jsxs("div",{className:p,children:[y,N,w]}),e[16]=p,e[17]=y,e[18]=S):S=e[18],S}function Ge(t){"use forget";const e=M.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=A();let r;e[0]!==n?(r=()=>{n("modal")},e[0]=n,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(J,{}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=s.jsx(ue,{testId:"modal-fanny-pack-mobile",isOpen:a,onClose:r,size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}function Ve(t){"use forget";const e=M.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=A();let r;e[0]!==n?(r=()=>{n("modal")},e[0]=n,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(J,{className:"max-h-[440px] min-h-[440px]"}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=s.jsx(je,{className:"border-token-border-default border bg-clip-padding shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:max-w-[680px] md:min-w-[680px]",isOpen:a,onClose:r,showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}export{ct as FannyPackModalContainer};
//# sourceMappingURL=k8jiigfasp6umn8z.js.map
