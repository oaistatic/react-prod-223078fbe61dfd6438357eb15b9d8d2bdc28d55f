import{i as _,j as e,M as i,r as m,u as E,a as h,b as j}from"./b8ijctzpgh0s7wpx.js";import{gt as H,i5 as K,cX as O,bX as p,jI as F}from"./krbmwir12ubt4od1.js";import{L as Q}from"./noo2d2kse83ez5bs.js";import{m as n}from"./nhimtm9k3553f3om.js";import{g as w,d as M,b as z,c as I}from"./fz34z4n2nuu0f63k.js";import{B as v,b as u,ad as X,ab as Y,l as b,O as J}from"./citrwydz0bgriwlc.js";function V({setEnabled:t,isLoading:r,isEnabled:s}){const c=_();return e.jsxs("div",{className:"flex flex-row content-center items-center justify-items-center",children:[e.jsx(H,{disabled:r,checked:s,onCheckedChange:t,"aria-label":c.formatMessage(n.sendInviteEmailsLabel)}),e.jsx(Q,{className:"ms-2",children:e.jsx(i,{...n.sendInviteEmailsLabel})})]})}function $({setEnabled:t,isLoading:r,isEnabled:s}){const c=_(),[o,a]=m.useState(!1),d=()=>{a(!0)},l=y=>{a(!1),y&&t(!1)};return e.jsx("div",{className:"pt-1.5",children:s?e.jsxs(e.Fragment,{children:[e.jsx(v,{disabled:r,color:"danger",onClick:()=>{r||d()},children:e.jsx(i,{...n.deleteDirectorySyncConnectionButton})}),e.jsx(K,{title:c.formatMessage(n.deleteDirectorySyncConnectionModalHeader),description:c.formatMessage(n.deleteDirectorySyncConnectionModalExplanation),confirmText:c.formatMessage(n.deleteDirectorySyncConnectionModalConfirmButton),cancelText:c.formatMessage(n.deleteDirectorySyncConnectionModalCancelButton),isOpen:o,primaryButtonColor:"danger",onClose:()=>l(!1),onConfirm:()=>l(!0)})]}):e.jsx(e.Fragment,{children:e.jsx(v,{disabled:r,color:"primary",onClick:()=>{r||t(!0)},children:e.jsx(i,{...n.enableDirectorySyncButton})})})})}class S{static async getWorkspaceDirectorySyncSettings(r){return u.safeGet("/accounts/{account_id}/scim",{parameters:{path:{account_id:r}}})}static async setWorkspaceDirectorySyncEnabled(r,s){return u.safePost("/accounts/{account_id}/scim/set_enabled",{parameters:{path:{account_id:r}},requestBody:{enabled:s}})}static async setWorkspaceDirectorySyncEmailInvitesEnabled(r,s){return u.safePost("/accounts/{account_id}/scim/set_email_invites_enabled",{parameters:{path:{account_id:r}},requestBody:{enabled:s}})}static async getWorkspaceDirectorySyncPortalUrl(r){return u.safeGet("/accounts/{account_id}/scim/portal_link",{parameters:{path:{account_id:r}}})}static async getWorkspaceDirectorySyncFailedEvents(r){return u.safeGet("/accounts/{account_id}/scim/failed_events",{parameters:{path:{account_id:r}}})}static async retryWorkspaceDirectorySyncFailedEvent(r,s){return u.safePost("/accounts/{account_id}/scim/failed_events/{event_id}/retry",{parameters:{path:{account_id:r,event_id:s}}})}static async retryAllWorkspaceDirectorySyncFailedEvents(r){return u.safePost("/accounts/{account_id}/scim/failed_events/retry_all",{parameters:{path:{account_id:r}}})}static async discardWorkspaceDirectorySyncFailedEvent(r,s){return u.safeDelete("/accounts/{account_id}/scim/failed_events/{event_id}",{parameters:{path:{account_id:r,event_id:s}}})}static async getWorkspaceDirectorySyncProgressUsers(r){return u.safeGet("/accounts/{account_id}/scim/sync_progress_users",{parameters:{path:{account_id:r}}})}static async getWorkspaceDirectorySyncProgressGroups(r){return u.safeGet("/accounts/{account_id}/scim/sync_progress_groups",{parameters:{path:{account_id:r}}})}}function Z({isLoading:t,workspaceId:r,isDirectoryConnectionConfigured:s}){const[c,o]=m.useState(!1),a=X(),d=_(),l=async()=>{try{o(!0);const y=await S.getWorkspaceDirectorySyncPortalUrl(r);o(!1),y?.portal_link?window.open(y.portal_link,"_blank"):a.danger(d.formatMessage({id:"directorySync.portalLinkNotFound",defaultMessage:"Portal link not found."}))}catch(y){y instanceof Error?a.danger(y.message):a.danger(d.formatMessage({id:"directorySync.unexpectedError",defaultMessage:"An unexpected error occurred."}))}};return e.jsxs(v,{disabled:t||c,color:"secondary",className:"mt-3",onClick:l,children:[s?e.jsx(i,{...n.launchDirectorySyncManagementPortalText}):e.jsx(i,{...n.launchDirectorySyncSetupPortalText}),e.jsx(O,{className:"icon-sm ms-1"})]})}function T(t){switch(t){case"dsync.user.created":return n.directorySyncEventTypeUserCreated;case"dsync.user.updated":return n.directorySyncEventTypeUserUpdated;case"dsync.user.deleted":return n.directorySyncEventTypeUserDeleted;case"dsync.group.created":return n.directorySyncEventTypeGroupCreated;case"dsync.group.updated":return n.directorySyncEventTypeGroupUpdated;case"dsync.group.deleted":return n.directorySyncEventTypeGroupDeleted;case"dsync.group.user_added":return n.directorySyncEventTypeGroupUserAdded;case"dsync.group.user_removed":return n.directorySyncEventTypeGroupUserRemoved;case"dsync.activated":return n.directorySyncEventTypeActivated;case"dsync.deleted":return n.directorySyncEventTypeDeleted;case"dsync.deactivated":return n.directorySyncEventTypeDeleted}}function ee({isLoading:t,failedEvents:r,retryEventWithId:s,retryAllFailedEvents:c,discardFailedEventWithId:o}){const[a,d]=m.useState(!1),[l,y]=m.useState(),x=_();return e.jsxs(e.Fragment,{children:[l&&e.jsx(Y,{testId:"modal-directory-sync-failed-events",isOpen:a,onClose:d,title:x.formatMessage(T(l.event.event)),description:l.failure_reason,type:"success",showCloseButton:!0,isScrollable:!0,children:e.jsx("pre",{children:JSON.stringify(l.event,null,2)})}),r.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"flex items-center space-x-4",children:[e.jsx(i,{...n.failedDirectorySyncEventsTableHeader}),e.jsx(v,{disabled:t,color:"secondary",size:"small",className:"ms-auto",onClick:()=>{c()},children:e.jsx(i,{...n.retryAllFailedDirectorySyncEventsButton})})]}),e.jsxs(p.Root,{className:"w-full table-auto",children:[e.jsxs(p.Header,{children:[e.jsx(p.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(i,{...n.directorySyncEventsTableFailureEventTypeColumnHeader})}),e.jsx(p.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(i,{...n.directorySyncEventsTableFailureReasonColumnHeader})}),e.jsx(p.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(i,{...n.directorySyncEventsTableActionsColumnHeader})})]}),e.jsx(p.Body,{children:r.map((f,k)=>e.jsxs("tr",{children:[e.jsx(p.Cell,{children:e.jsx(i,{...T(f.event.event)})}),e.jsx(p.Cell,{children:f.failure_reason}),e.jsxs(p.Cell,{children:[e.jsx("div",{children:e.jsx(v,{disabled:t,color:"secondary",size:"small",onClick:()=>{y(f),d(!0)},children:e.jsx(i,{...n.showEventDirectorySyncEventButton})})}),e.jsx("div",{className:"ms-2",children:e.jsx(v,{disabled:t,color:"secondary",size:"small",onClick:()=>{s(f.event.id)},children:e.jsx(i,{...n.retryDirectorySyncEventButton})})}),e.jsx("div",{className:"ms-2",children:o&&e.jsx(v,{disabled:t,color:"secondary",size:"small",onClick:()=>{o(f.event.id)},children:e.jsx(i,{...n.discardDirectorySyncEventButton})})})]})]},f.event.id))})]})]})]})}function te({isLoading:t,numUsersSynced:r,numUsersInDirectory:s,numGroupsSynced:c,numGroupsInDirectory:o,failedEvents:a,retryEventWithId:d,retryAllFailedEvents:l,discardFailedEventWithId:y}){const{value:x}=b("2091463435");return e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"my-2",children:[e.jsxs("div",{children:[e.jsx(i,{...n.directorySyncUserSyncStatus,values:{numUsersSynced:r,numUsersInDirectory:s}}),e.jsx(F,{percentage:r/(s||1)*100})]}),e.jsx("div",{className:"mt-4",children:x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(i,{...n.directorySyncGroupSyncStatus,values:{numGroupsSynced:c,numGroupsInDirectory:o}})}),e.jsx(F,{percentage:c/(o||1)*100})]})})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ee,{isLoading:t,failedEvents:a,retryEventWithId:d,retryAllFailedEvents:l,discardFailedEventWithId:y})})]})}const D=2e3;function C(t,r){const[s,c]=m.useState(!1),{data:o,...a}=E({queryKey:["workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await S.getWorkspaceDirectorySyncSettings(t)},enabled:!!t,refetchInterval:r&&s?D:!1});return m.useEffect(()=>{o?.enabled&&o?.directory_connection==null?c(!0):c(!1)},[o]),{data:o,...a}}function N(t,r){const[s,c]=m.useState(!1),{data:o}=C(t,r),{data:a,...d}=E({queryKey:["workspace/directorySyncStatus/progressUsers","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await S.getWorkspaceDirectorySyncProgressUsers(t)},enabled:!!t&&!!o?.directory_connection,refetchInterval:s?D:!1});return m.useEffect(()=>{a?.synced_scim_users===0||a?.synced_scim_users!==a?.total_scim_users?c(!0):c(!1)},[a,o?.directory_connection]),{isLoadingUsers:s,data:a,...d}}function re(t,r){const[s,c]=m.useState(!1),{data:o}=C(t,r),{data:a,...d}=E({queryKey:["workspace/directorySyncStatus/progressGroups","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await S.getWorkspaceDirectorySyncProgressGroups(t)},enabled:!!t&&!!o?.directory_connection,refetchInterval:r&&s?D:!1});return m.useEffect(()=>{a?.synced_scim_groups===0||a?.synced_scim_groups!==a?.total_scim_groups?c(!0):c(!1)},[a,o?.directory_connection]),{isLoadingGroups:s,data:a,...d}}function se(t,r){const{isLoadingUsers:s}=N(t,r);return E({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySync",t],queryFn:async()=>{if(t!==void 0)return await S.getWorkspaceDirectorySyncFailedEvents(t)},enabled:!!t,refetchInterval:s?D:!1})}function ne(t){const r=h();return j({mutationFn:s=>S.retryWorkspaceDirectorySyncFailedEvent(t,s),onSuccess:()=>{r.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function ce(t){const r=h();return j({mutationFn:()=>S.retryAllWorkspaceDirectorySyncFailedEvents(t),onSuccess:()=>{r.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function ae(t){const r=h();return j({mutationFn:s=>S.discardWorkspaceDirectorySyncFailedEvent(t,s),onSuccess:()=>{r.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents"]})}})}function oe(t){const r=h();return j({mutationFn:s=>S.setWorkspaceDirectorySyncEnabled(t,s),onSuccess:()=>{r.refetchQueries({queryKey:["workspace/directorySync",t]})}})}function ie(t){const r=h();return j({mutationFn:s=>S.setWorkspaceDirectorySyncEmailInvitesEnabled(t,s),onSuccess:()=>{r.refetchQueries({queryKey:["workspace/directorySync",t]})}})}function pe({workspaceId:t}){const{value:r}=b("2091463435"),{value:s}=b("2494375100"),{data:c,isLoading:o}=C(t,!0),{data:a,isLoading:d}=N(t,!0),{data:l,isLoading:y}=re(t,r),{data:x,isLoading:f}=se(t,!0),{mutateAsync:k,status:W}=oe(t),{mutateAsync:q,status:G}=ne(t),{mutateAsync:A,status:U}=ce(t),{mutateAsync:L,status:P}=ae(t),{mutateAsync:B,status:R}=ie(t),g=W==="pending"||G==="pending"||U==="pending"||P==="pending"||R=="pending"||o||d||y||f;return e.jsxs(z,{className:`${g?"text-token-text-secondary":""}`,children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{children:e.jsx(i,{...n.directorySyncTitle})}),e.jsx("div",{className:"ms-2 mt-1",children:g&&e.jsx(J,{})})]})}),e.jsx(M,{children:e.jsx(i,{...n.directorySyncInfoText})}),c?.directory_connection&&e.jsx("div",{children:e.jsx(te,{isLoading:g,numUsersSynced:a?.synced_scim_users??0,numUsersInDirectory:a?.total_scim_users??0,numGroupsSynced:l?.synced_scim_groups??0,numGroupsInDirectory:l?.total_scim_groups??0,failedEvents:x??[],retryEventWithId:q,retryAllFailedEvents:A,discardFailedEventWithId:L})}),s&&c?.enabled&&e.jsx("div",{children:e.jsx(V,{setEnabled:B,isLoading:g,isEnabled:c?.send_user_invite_emails??!1})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx($,{setEnabled:k,isLoading:g,isEnabled:c?.enabled??!0}),c?.enabled&&e.jsx(e.Fragment,{children:e.jsx(Z,{isLoading:g,workspaceId:t,isDirectoryConnectionConfigured:!!c?.directory_connection})})]})]})}export{pe as DirectorySyncSection};
//# sourceMappingURL=f8oioeiwvft4qyzh.js.map
