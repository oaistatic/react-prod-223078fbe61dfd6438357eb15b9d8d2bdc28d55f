import{i as L,r as f,j as e,e as Q,a6 as te,a5 as F,M as B}from"./b8ijctzpgh0s7wpx.js";import{y as se,dg as ie,dh as ne,di as oe,dj as le,dl as re,c as E,dk as de,S as ce,B as T,ct as z,dr as q,j as ge,aS as me,cs as ue,F as K,m as fe,aJ as xe,aQ as O,e as A,ad as he}from"./citrwydz0bgriwlc.js";import{S as pe}from"./eeruhkv4a43aueaw.js";import{S as Ie}from"./gvs1s366o5iglka3.js";import{i6 as ve,i7 as W,cs as we,i8 as be,f1 as je,cT as _e,i9 as Me,g8 as ye,ia as Ce,ib as D,dA as ke,bV as J,eQ as Se,bL as Ne,bM as Ee,bT as Ve,bU as Te,ga as De,bW as Oe,b6 as X,b5 as Y,bH as Z,eu as P,ic as Ae,id as Pe,O as Fe}from"./krbmwir12ubt4od1.js";import{D as Le,a as ee,u as Re,I as R}from"./ckwntmn7hqzclvef.js";import{b as Ge}from"./k6ccgr4wxcppeg93.js";import{T as V}from"./h3axfhhn58bmthc9.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./eg629yaevviy8e7x.js";const Be={enter:a=>({zIndex:0,x:a===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:a=>({zIndex:0,x:a===1?"10%":"-10%",opacity:0})},ze={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},We=1e3,$e=1e3,$=(a,i)=>Math.abs(a)*i;function Ue(a){const i=L(),n=se(),o=ve(),m=[W.Small,W.Mobile].includes(o),[p,u]=f.useState({width:0,height:0}),[c,x]=f.useState(!1),[l,h]=f.useState(a.image),[j,I]=f.useState(!1),_=p.width>0&&p.height>0,C=f.useRef(null),[v,r]=f.useState(0);f.useEffect(()=>{if(!l.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{u({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=l.url},[l.url]),f.useEffect(()=>{const s=C.current;if(j)return s?.addEventListener("keydown",M),()=>{s?.removeEventListener("keydown",M)};h(a.image)},[j]);function d(){h(s=>{const S=(a.images.findIndex(y=>y.url===s.url)+1)%a.images.length;return a.images[S]}),r(-1)}function t(){h(s=>{const w=a.images.findIndex(y=>y.url===s.url),S=w>0?(w-1)%a.images.length:a.images.length-1;return a.images[S]}),r(1)}function g(s){I(s),s&&a.onOpen?.(l)}function M(s){s.key==="ArrowLeft"?t():s.key==="ArrowRight"&&d()}const k=a.images.findIndex(s=>s.url===l.url);return e.jsxs(ie,{onOpenChange:g,children:[e.jsx(ne,{disabled:!_,className:a.className,"aria-label":i.formatMessage(N.showImage),children:a.children}),e.jsx(oe,{container:n?.document.body,children:e.jsx(le,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:e.jsxs(re,{className:E("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:C,children:[e.jsx("div",{className:E("flex flex-1 transition-[flex-basis]",!c&&"md:basis-[75vw]"),children:e.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[e.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[e.jsx(de,{asChild:!0,children:e.jsx("button",{"aria-label":i.formatMessage(N.closeModal),children:e.jsx(ce,{})})}),e.jsx("div",{children:!m&&e.jsxs(e.Fragment,{children:[a.getActions?.(l)?.map((s,w)=>e.jsx(T,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},w)),e.jsx(T,{color:"ghost",size:"small",onClick:()=>x(s=>!s),"aria-label":i.formatMessage(N.toggleSidebar),className:"md:inline-flex",icon:we})]})})]}),e.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:e.jsx(te,{initial:!1,custom:v,children:e.jsxs(F.div,{className:"absolute grid h-full w-full grid-rows-2",custom:v,variants:Be,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:w,velocity:S})=>{const y=$(w.x,S.x);y<-1e3?d():y>We&&t()},children:[e.jsx(F.img,{src:l.url,alt:l.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:w,velocity:S})=>{const y=$(w.y,S.y);y<-1e3?x(!0):y>$e&&x(!1)}},l.url),m&&c&&e.jsx(F.div,{className:"flex text-white",variants:ze,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:a.metadataRenderer(l)})]},l.url)})}),a.images.length>1?e.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[e.jsx(T,{color:"ghost",size:"small",onClick:t,"aria-label":i.formatMessage(N.previousImage),icon:pe}),a.images.map((s,w)=>e.jsx("img",{src:s.url,alt:s.alt??"",className:E("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",s.url===l.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{h(s),r(w<k?1:-1)},"aria-label":i.formatMessage(N.showImage),role:"button"},s.url)),e.jsx(T,{color:"ghost",size:"small",onClick:d,"aria-label":i.formatMessage(N.nextImage),icon:Ie})]}):null]})}),e.jsx("div",{className:E("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",c?"md:basis-[25vw]":"md:basis-0"),children:e.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:a.metadataRenderer(l)})})]})})})]})}const N=Q({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function He({withLottie:a}){return e.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[e.jsx(Le,{animate:a,matchTextColor:!0,className:"h-6 w-6"}),e.jsx(Qe,{})]})}function Qe(){const[i,n]=f.useState(new Date);f.useEffect(()=>{n(new Date)},[]);const o=be(+i,25e3);return e.jsx(je,{percentage:o,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-o)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function ua({messages:a,clientThreadId:i,disableClickThru:n=!1}){const[o,m]=a,p=_e(o),u=Me(),c=a.some(h=>u.has(h.id));let x=null;m!=null&&z.isMultimodalTextMessage(m)&&(x=z.getImageAssetPointers(m));let l=V.Running;return x!=null?l=V.Finished:m!=null?l=V.Error:p&&(l=V.Stopped),e.jsx(ee.Provider,{value:n,children:!c&&e.jsx(Ke,{imageAssets:x??[],clientThreadId:i,toolStatus:l,toolMessage:m,messageId:o.id})})}const qe="https://help.openai.com/en/articles/8932459",Ke=({imageAssets:a,clientThreadId:i,toolMessage:n,toolStatus:o,messageId:m})=>{const p=L(),u=q(i),c=ye(a,void 0,u),x=ge(),l=me(x),h=Ce(i),j=f.useMemo(()=>o===V.Finished&&c.every(r=>!!r.data),[o,c]);if(n?.content.content_type===ue.SystemError)return null;const I=ae(a[0]),_=c.map(r=>r.data).filter(r=>r!=null),C=_.map(r=>({...r,alt:D(r)})),v=(r=0)=>`${m}-image-${r}`;return e.jsxs("div",{children:[e.jsxs(Ze,{$numItems:c.length,className:"my-1 transition-opacity duration-300",children:[c.length===0&&o===V.Running&&e.jsx(U,{layoutId:"loading:placeholder",shape:I,isToolRunning:!0},"loading"),c.map((r,d)=>{const{isLoading:t,data:g,error:M}=r;if(t)return e.jsx(U,{shape:I,layoutId:v(d)},d);if(M!=null||g?.url==null)return e.jsx(G,{layoutId:v(d),className:"text-token-text-tertiary text-sm",shape:I,children:e.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:p.formatMessage(b.imageLoadError)})},d);if(n&&g){const k={...g,alt:D(g)};return e.jsx(Je,{image:k,allImages:C,clientThreadId:i,toolMessage:n,index:d,onOpenImageEditor:()=>{ke.setFocusedObject({type:J.Image,image:k,allImages:_,messageId:n.id})}},d)}})]}),l&&j&&e.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:e.jsx("span",{className:"me-2",children:h?e.jsx(B,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:r=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:qe,target:"_blank",rel:"noopener noreferrer",children:r})}}):e.jsx(B,{id:"pvSitT",defaultMessage:"Made with the old version of image generation. New images <link>coming soon</link>.",values:{link:r=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:r})}})})})]})};function Je({toolMessage:a,clientThreadId:i,allImages:n,image:o,index:m,onOpenImageEditor:p}){const u=L(),c=q(i),x=ae(o),l=f.useContext(ee),[h,j]=f.useState({}),I=Re({clientThreadId:i});async function _(t){Ae(t,c,a.id,l)}function C(t){O.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),A.logEvent("chatgpt_dalle_image_view_full",{conversationId:c,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:P(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),A.logEvent("chatgpt_image_view_full",{conversationId:c,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:P(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function v(t,g){j(k=>({...k,[t.asset_pointer]:g}));const M=l?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";O.logEvent(M,g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),A.logEvent(M,{liked:g,conversationId:c,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:P(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_rating",g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),A.logEvent("chatgpt_image_rating",{liked:g,conversationId:c,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:P(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function r(t){const g=h[t.asset_pointer],M={label:u.formatMessage(b.likeImage),onClick:()=>v(t,!0),disabled:g===!0,ariaLabel:u.formatMessage(b.likeImage),icon:X},k={label:u.formatMessage(b.dislikeImage),onClick:()=>v(t,!1),disabled:g===!1,ariaLabel:u.formatMessage(b.dislikeImage),icon:Y},s={label:u.formatMessage(b.downloadImage),onClick:()=>_(t),ariaLabel:u.formatMessage(b.downloadImage),icon:Z};return[g!==!1&&M,g!==!0&&k,s].filter(Boolean)}let d=e.jsx(Ye,{image:o,shape:x,rating:h[o.asset_pointer],onDownload:()=>_(o),onRate:(t,g)=>v(t,g),clientThreadId:i,layoutId:void 0});return I?d=e.jsx("div",{role:"button",onClick:p,children:d}):l||(d=e.jsx(Ue,{image:o,images:n,metadataRenderer:t=>e.jsx(Xe,{image:t}),onOpen:C,getActions:r,children:d})),e.jsx("div",{className:"flex",children:d},m)}function U({shape:a,layoutId:i,isToolRunning:n=!1}){const{isOpen:o}=Ge();return e.jsx(G,{shape:a,layoutId:o?void 0:i,children:e.jsx("div",{className:"flex min-h-full items-center justify-center",children:e.jsx(He,{withLottie:n})})},"loading")}function Xe({image:a}){const i=L(),[n,o]=f.useState(!1),m=he();function p(u){const c=D(a);o(!0),Fe(c,m,u),setTimeout(()=>{o(!1)},2e3)}return e.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[e.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:i.formatMessage(b.imageViewerMetadataTitle)}),e.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:D(a)}),e.jsx(T,{color:"primary",onClick:p,disabled:n,className:"hidden sm:block",icon:Pe,children:n?i.formatMessage(b.imageViewerMetadataCopyButtonCopied):i.formatMessage(b.imageViewerMetadataCopyButton)})]})}function G({children:a,shape:i,className:n,layoutId:o}){return e.jsxs(F.div,{layoutId:o,className:E("relative",n,i==="1792x1024"&&"aspect-7/4",i==="1024x1024"&&"aspect-square max-w-[400px]",i==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[e.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),e.jsx("div",{className:"relative h-full",children:a})]})}function Ye({image:a,shape:i,rating:n,onDownload:o,onRate:m,clientThreadId:p,layoutId:u}){const c=Se(),x=Ne(Ee.isBusinessWorkspace),l=fe(p,d=>d?.mode),h=Ve(),j=Te(),I=j?.type===J.Image&&j.image.asset_pointer===a.asset_pointer,{url:_,width:C,height:v}=a,r=!c&&!x&&l?.kind!==xe.GizmoMagicCreate;return e.jsxs(G,{shape:i,className:"group/dalle-image",layoutId:I?void 0:u,children:[e.jsx(De,{alt:D(a),src:_,width:C,height:v}),e.jsx("div",{className:E("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",I?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),h?!I&&e.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:e.jsx(Oe,{})}):e.jsxs(e.Fragment,{children:[r&&e.jsxs(H,{children:[n!==!1&&e.jsx(R,{icon:X,selected:n===!0,onClick:d=>{d.stopPropagation(),m(a,!0)}}),n!==!0&&e.jsx(R,{icon:Y,selected:n===!1,onClick:d=>{d.stopPropagation(),m(a,!1)}})]}),e.jsx(H,{$rightAlign:!0,children:e.jsx(R,{icon:Z,onClick:d=>{d.stopPropagation(),o()}})})]})]})}const H=K.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2
${({$rightAlign:a})=>a?"end-3":"start-3"}`,Ze=K.div`grid gap-2
${({$numItems:a})=>a<=1?"grid-cols-1":"grid-cols-2"}`;function ae(a){if(!a)return"1024x1024";const{width:i,height:n}=a;return i>n?"1792x1024":i<n?"1024x1792":"1024x1024"}const b=Q({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{ua as default};
//# sourceMappingURL=h9ej05xawysezypc.js.map
