import{i as W,r as A,j as a,M as T,f as De,b as nt,e as rt}from"./b8ijctzpgh0s7wpx.js";import{B as $,j as Ie,al as ot,S as it,c as at,O as ct,aj as Te,ab as ut,ad as lt,b1 as Ae,aY as ht,aU as J}from"./citrwydz0bgriwlc.js";import{u as dt}from"./nvghija6qp2cunds.js";import{b as Ne,a as ft}from"./ndqm17bbs5ambnrw.js";import{u as mt,C as gt,H as pt,F as Ct,S as xt}from"./dbalwdodzoo02ru2.js";import{dq as Mt,aX as ee,lp as _e,eO as At,aH as Et,nX as ue,K as q,q as Le,nY as vt,bJ as wt,lC as bt,nZ as yt,iu as Bt}from"./krbmwir12ubt4od1.js";import{C as Re,e as _,l as Ft,u as Oe,f as St,h as kt,j as jt,W as Ee,d as ve,w as we,v as Dt}from"./omp8ie1vzl40ti1z.js";import{C as Pe,a as le,u as It,b as Tt,c as Nt,S as be}from"./ji5qoh13hkjncrxd.js";function _t({isSubmitDisabled:t,createTask:e,disabledReason:s}){const r=W(),n=Mt(),[o,i]=A.useState(!1);return a.jsxs("div",{className:"flex items-center gap-2",onClick:c=>c.stopPropagation(),children:[a.jsx(ee,{open:n?o:void 0,onOpenChange:i,label:s??r.formatMessage({id:"wham.whamComposer.fasterTitle",defaultMessage:"Fast mode where the agent doesn't edit code"}),children:a.jsx($,{size:"small",color:"secondary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>e({runEnvironmentInQaMode:!0}),children:a.jsx(T,{id:"wham.composer.askButton",defaultMessage:"Ask"})})}),a.jsx(ee,{label:s,children:a.jsx($,{size:"small",color:"primary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>e({runEnvironmentInQaMode:!1}),children:a.jsx(T,{id:"wham.composer.codeItButton",defaultMessage:"Code"})})})]})}const Lt=t=>A.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},A.createElement("path",{d:"M3.299 3.12201C3.55219 2.83266 3.91796 2.66669 4.30244 2.66669H11.6974C12.0819 2.66669 12.4477 2.83266 12.7009 3.12201L15.0342 5.78868C15.7885 6.65079 15.1763 8.00002 14.0307 8.00002H1.96911C0.82356 8.00002 0.211325 6.65079 0.965671 5.78868L3.299 3.12201ZM11.6974 4.00002L4.30244 4.00002L1.96911 6.66669H14.0307L11.6974 4.00002ZM1.33326 10C1.33326 9.63183 1.63174 9.33335 1.99993 9.33335H13.9999C14.3681 9.33335 14.6666 9.63183 14.6666 10C14.6666 10.3682 14.3681 10.6667 13.9999 10.6667H1.99993C1.63174 10.6667 1.33326 10.3682 1.33326 10ZM1.99993 12.6667C1.99993 12.2985 2.2984 12 2.66659 12H13.3333C13.7015 12 13.9999 12.2985 13.9999 12.6667C13.9999 13.0349 13.7015 13.3334 13.3333 13.3334H2.66659C2.2984 13.3334 1.99993 13.0349 1.99993 12.6667Z",fill:"currentColor"})),Rt=4;function Ot({attempts:t,setAttempts:e}){const s=W(),[r,n]=A.useState(!1),o=A.useRef(null),i=()=>n(!1),c=Ie(),l=ot(c,"2179180337").value.max_attempts??Rt;return a.jsxs(_e,{open:r,onOpenChange:n,children:[a.jsx(Pe,{triggerText:s.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:s.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Choose number of attempts"}),ariaLabel:s.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open attempts selector"}),Icon:a.jsx(Lt,{"aria-hidden":!0,className:"icon-sm"}),truncate:!1}),a.jsx(Re,{align:"start",sideOffset:12,isOpen:r,closePopover:i,popoverContentRef:o,children:a.jsx("div",{className:"bg-token-bg-primary flex w-40 flex-col rounded-lg p-2",children:[...Array(l)].map((h,u)=>a.jsx(le,{className:"w-full",onClick:()=>{e(u+1),i()},isSelected:t===u+1,label:s.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:u+1})},u+1))})})]})}function Pt({comments:t,onClearComments:e}){return t.length===0?null:a.jsxs("div",{className:"bg bg-token-bg-secondary flex w-full items-center gap-3 rounded-t-2xl rounded-b-lg px-3 py-2.5 font-semibold text-blue-400",children:[a.jsx(At,{className:"icon"}),a.jsx("div",{className:"flex-1 text-sm",children:a.jsx(T,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),a.jsx("button",{className:"text-token-text-secondary",onClick:s=>{s.preventDefault(),s.stopPropagation(),e()},children:a.jsx(it,{className:"icon"})})]})}const He=t=>A.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},A.createElement("path",{d:"M18 4C19.6569 4 21 5.34315 21 7V14.5H21.5L21.6025 14.5049C22.1067 14.5562 22.5 14.9823 22.5 15.5V17C22.5 18.6569 21.1569 20 19.5 20H4.5C2.89489 20 1.58421 18.7394 1.50391 17.1543L1.5 17V15.5L1.50488 15.3975C1.55621 14.8933 1.98232 14.5 2.5 14.5H3V7C3 5.34315 4.34315 4 6 4H18ZM3.5 17L3.50488 17.1025C3.55621 17.6067 3.98232 18 4.5 18H19.5C20.0523 18 20.5 17.5523 20.5 17V16.5H3.5V17ZM6 6C5.44772 6 5 6.44772 5 7V14.5H19V7C19 6.44772 18.5523 6 18 6H6Z",fill:"currentColor"}));function $e({className:t}){return a.jsx(Et,{className:at("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function R(t){return Array.isArray?Array.isArray(t):Ke(t)==="[object Array]"}function Ht(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function $t(t){return t==null?"":Ht(t)}function L(t){return typeof t=="string"}function We(t){return typeof t=="number"}function Wt(t){return t===!0||t===!1||Gt(t)&&Ke(t)=="[object Boolean]"}function Ge(t){return typeof t=="object"}function Gt(t){return Ge(t)&&t!==null}function j(t){return t!=null}function ce(t){return!t.trim().length}function Ke(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Kt="Incorrect 'index' type",zt=t=>`Invalid value for key ${t}`,Vt=t=>`Pattern length exceeds max of ${t}.`,Qt=t=>`Missing ${t} property in key`,Yt=t=>`Property 'weight' in key '${t}' must be a positive integer`,ye=Object.prototype.hasOwnProperty;class Zt{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(r=>{let n=ze(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function ze(t){let e=null,s=null,r=null,n=1,o=null;if(L(t)||R(t))r=t,e=Be(t),s=he(t);else{if(!ye.call(t,"name"))throw new Error(Qt("name"));const i=t.name;if(r=i,ye.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(Yt(i));e=Be(i),s=he(i),o=t.getFn}return{path:e,id:s,weight:n,src:r,getFn:o}}function Be(t){return R(t)?t:t.split(".")}function he(t){return R(t)?t.join("."):t}function Xt(t,e){let s=[],r=!1;const n=(o,i,c)=>{if(j(o))if(!i[c])s.push(o);else{let l=i[c];const h=o[l];if(!j(h))return;if(c===i.length-1&&(L(h)||We(h)||Wt(h)))s.push($t(h));else if(R(h)){r=!0;for(let u=0,d=h.length;u<d;u+=1)n(h[u],i,c+1)}else i.length&&n(h,i,c+1)}};return n(t,L(e)?e.split("."):e,0),r?s:s[0]}const qt={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Jt={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},Ut={location:0,threshold:.6,distance:100},es={useExtendedSearch:!1,getFn:Xt,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var f={...Jt,...qt,...Ut,...es};const ts=/[^ ]+/g;function ss(t=1,e=3){const s=new Map,r=Math.pow(10,e);return{get(n){const o=n.match(ts).length;if(s.has(o))return s.get(o);const i=1/Math.pow(o,.5*t),c=parseFloat(Math.round(i*r)/r);return s.set(o,c),c},clear(){s.clear()}}}class Ce{constructor({getFn:e=f.getFn,fieldNormWeight:s=f.fieldNormWeight}={}){this.norm=ss(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,L(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();L(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!j(e)||ce(e))return;let r={v:e,i:s,n:this.norm.get(e)};this.records.push(r)}_addObject(e,s){let r={i:s,$:{}};this.keys.forEach((n,o)=>{let i=n.getFn?n.getFn(e):this.getFn(e,n.path);if(j(i)){if(R(i)){let c=[];const l=[{nestedArrIndex:-1,value:i}];for(;l.length;){const{nestedArrIndex:h,value:u}=l.pop();if(j(u))if(L(u)&&!ce(u)){let d={v:u,i:h,n:this.norm.get(u)};c.push(d)}else R(u)&&u.forEach((d,m)=>{l.push({nestedArrIndex:m,value:d})})}r.$[o]=c}else if(L(i)&&!ce(i)){let c={v:i,n:this.norm.get(i)};r.$[o]=c}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Ve(t,e,{getFn:s=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){const n=new Ce({getFn:s,fieldNormWeight:r});return n.setKeys(t.map(ze)),n.setSources(e),n.create(),n}function ns(t,{getFn:e=f.getFn,fieldNormWeight:s=f.fieldNormWeight}={}){const{keys:r,records:n}=t,o=new Ce({getFn:e,fieldNormWeight:s});return o.setKeys(r),o.setIndexRecords(n),o}function U(t,{errors:e=0,currentLocation:s=0,expectedLocation:r=0,distance:n=f.distance,ignoreLocation:o=f.ignoreLocation}={}){const i=e/t.length;if(o)return i;const c=Math.abs(r-s);return n?i+c/n:c?1:i}function rs(t=[],e=f.minMatchCharLength){let s=[],r=-1,n=-1,o=0;for(let i=t.length;o<i;o+=1){let c=t[o];c&&r===-1?r=o:!c&&r!==-1&&(n=o-1,n-r+1>=e&&s.push([r,n]),r=-1)}return t[o-1]&&o-r>=e&&s.push([r,o-1]),s}const H=32;function os(t,e,s,{location:r=f.location,distance:n=f.distance,threshold:o=f.threshold,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,includeMatches:l=f.includeMatches,ignoreLocation:h=f.ignoreLocation}={}){if(e.length>H)throw new Error(Vt(H));const u=e.length,d=t.length,m=Math.max(0,Math.min(r,d));let g=o,x=m;const v=c>1||l,w=v?Array(d):[];let p;for(;(p=t.indexOf(e,x))>-1;){let b=U(e,{currentLocation:p,expectedLocation:m,distance:n,ignoreLocation:h});if(g=Math.min(b,g),x=p+u,v){let N=0;for(;N<u;)w[p+N]=1,N+=1}}x=-1;let B=[],D=1,E=u+d;const S=1<<u-1;for(let b=0;b<u;b+=1){let N=0,I=E;for(;N<I;)U(e,{errors:b,currentLocation:m+I,expectedLocation:m,distance:n,ignoreLocation:h})<=g?N=I:E=I,I=Math.floor((E-N)/2+N);E=I;let G=Math.max(1,m-I+1),K=i?d:Math.min(m+I,d)+u,O=Array(K+2);O[K+1]=(1<<b)-1;for(let M=K;M>=G;M-=1){let z=M-1,Q=s[t.charAt(z)];if(v&&(w[z]=+!!Q),O[M]=(O[M+1]<<1|1)&Q,b&&(O[M]|=(B[M+1]|B[M])<<1|1|B[M+1]),O[M]&S&&(D=U(e,{errors:b,currentLocation:z,expectedLocation:m,distance:n,ignoreLocation:h}),D<=g)){if(g=D,x=z,x<=m)break;G=Math.max(1,2*m-x)}}if(U(e,{errors:b+1,currentLocation:m,expectedLocation:m,distance:n,ignoreLocation:h})>g)break;B=O}const F={isMatch:x>=0,score:Math.max(.001,D)};if(v){const b=rs(w,c);b.length?l&&(F.indices=b):F.isMatch=!1}return F}function is(t){let e={};for(let s=0,r=t.length;s<r;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<r-s-1}return e}const te=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class Qe{constructor(e,{location:s=f.location,threshold:r=f.threshold,distance:n=f.distance,includeMatches:o=f.includeMatches,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:h=f.ignoreDiacritics,ignoreLocation:u=f.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:o,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:h,ignoreLocation:u},e=l?e:e.toLowerCase(),e=h?te(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const d=(g,x)=>{this.chunks.push({pattern:g,alphabet:is(g),startIndex:x})},m=this.pattern.length;if(m>H){let g=0;const x=m%H,v=m-x;for(;g<v;)d(this.pattern.substr(g,H),g),g+=H;if(x){const w=m-H;d(this.pattern.substr(w),w)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=r?te(e):e,this.pattern===e){let v={isMatch:!0,score:0};return n&&(v.indices=[[0,e.length-1]]),v}const{location:o,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:h,ignoreLocation:u}=this.options;let d=[],m=0,g=!1;this.chunks.forEach(({pattern:v,alphabet:w,startIndex:p})=>{const{isMatch:B,score:D,indices:E}=os(e,v,w,{location:o+p,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:h,includeMatches:n,ignoreLocation:u});B&&(g=!0),m+=D,B&&E&&(d=[...d,...E])});let x={isMatch:g,score:g?m/this.chunks.length:1};return g&&n&&(x.indices=d),x}}class P{constructor(e){this.pattern=e}static isMultiMatch(e){return Fe(e,this.multiRegex)}static isSingleMatch(e){return Fe(e,this.singleRegex)}search(){}}function Fe(t,e){const s=t.match(e);return s?s[1]:null}class as extends P{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class cs extends P{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}}class us extends P{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class ls extends P{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class hs extends P{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class ds extends P{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Ye extends P{constructor(e,{location:s=f.location,threshold:r=f.threshold,distance:n=f.distance,includeMatches:o=f.includeMatches,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:h=f.ignoreDiacritics,ignoreLocation:u=f.ignoreLocation}={}){super(e),this._bitapSearch=new Qe(e,{location:s,threshold:r,distance:n,includeMatches:o,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:h,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Ze extends P{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,r;const n=[],o=this.pattern.length;for(;(r=e.indexOf(this.pattern,s))>-1;)s=r+o,n.push([r,s-1]);const i=!!n.length;return{isMatch:i,score:i?0:1,indices:n}}}const de=[as,Ze,us,ls,ds,hs,cs,Ye],Se=de.length,fs=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,ms="|";function gs(t,e={}){return t.split(ms).map(s=>{let r=s.trim().split(fs).filter(o=>o&&!!o.trim()),n=[];for(let o=0,i=r.length;o<i;o+=1){const c=r[o];let l=!1,h=-1;for(;!l&&++h<Se;){const u=de[h];let d=u.isMultiMatch(c);d&&(n.push(new u(d,e)),l=!0)}if(!l)for(h=-1;++h<Se;){const u=de[h];let d=u.isSingleMatch(c);if(d){n.push(new u(d,e));break}}}return n})}const ps=new Set([Ye.type,Ze.type]);class Cs{constructor(e,{isCaseSensitive:s=f.isCaseSensitive,ignoreDiacritics:r=f.ignoreDiacritics,includeMatches:n=f.includeMatches,minMatchCharLength:o=f.minMatchCharLength,ignoreLocation:i=f.ignoreLocation,findAllMatches:c=f.findAllMatches,location:l=f.location,threshold:h=f.threshold,distance:u=f.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:o,findAllMatches:c,ignoreLocation:i,location:l,threshold:h,distance:u},e=s?e:e.toLowerCase(),e=r?te(e):e,this.pattern=e,this.query=gs(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:o}=this.options;e=n?e:e.toLowerCase(),e=o?te(e):e;let i=0,c=[],l=0;for(let h=0,u=s.length;h<u;h+=1){const d=s[h];c.length=0,i=0;for(let m=0,g=d.length;m<g;m+=1){const x=d[m],{isMatch:v,indices:w,score:p}=x.search(e);if(v){if(i+=1,l+=p,r){const B=x.constructor.type;ps.has(B)?c=[...c,...w]:c.push(w)}}else{l=0,i=0,c.length=0;break}}if(i){let m={isMatch:!0,score:l/i};return r&&(m.indices=c),m}}return{isMatch:!1,score:1}}}const fe=[];function xs(...t){fe.push(...t)}function me(t,e){for(let s=0,r=fe.length;s<r;s+=1){let n=fe[s];if(n.condition(t,e))return new n(t,e)}return new Qe(t,e)}const se={AND:"$and",OR:"$or"},ge={PATH:"$path",PATTERN:"$val"},pe=t=>!!(t[se.AND]||t[se.OR]),Ms=t=>!!t[ge.PATH],As=t=>!R(t)&&Ge(t)&&!pe(t),ke=t=>({[se.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Xe(t,e,{auto:s=!0}={}){const r=n=>{let o=Object.keys(n);const i=Ms(n);if(!i&&o.length>1&&!pe(n))return r(ke(n));if(As(n)){const l=i?n[ge.PATH]:o[0],h=i?n[ge.PATTERN]:n[l];if(!L(h))throw new Error(zt(l));const u={keyId:he(l),pattern:h};return s&&(u.searcher=me(h,e)),u}let c={children:[],operator:o[0]};return o.forEach(l=>{const h=n[l];R(h)&&h.forEach(u=>{c.children.push(r(u))})}),c};return pe(t)||(t=ke(t)),r(t)}function Es(t,{ignoreFieldNorm:e=f.ignoreFieldNorm}){t.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:o,score:i})=>{const c=n?n.weight:null;r*=Math.pow(i===0&&c?Number.EPSILON:i,(c||1)*(e?1:o))}),s.score=r})}function vs(t,e){const s=t.matches;e.matches=[],j(s)&&s.forEach(r=>{if(!j(r.indices)||!r.indices.length)return;const{indices:n,value:o}=r;let i={indices:n,value:o};r.key&&(i.key=r.key.src),r.idx>-1&&(i.refIndex=r.idx),e.matches.push(i)})}function ws(t,e){e.score=t.score}function bs(t,e,{includeMatches:s=f.includeMatches,includeScore:r=f.includeScore}={}){const n=[];return s&&n.push(vs),r&&n.push(ws),t.map(o=>{const{idx:i}=o,c={item:e[i],refIndex:i};return n.length&&n.forEach(l=>{l(o,c)}),c})}class V{constructor(e,s={},r){this.options={...f,...s},this.options.useExtendedSearch,this._keyStore=new Zt(this.options.keys),this.setCollection(e,r)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Ce))throw new Error(Kt);this._myIndex=s||Ve(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){j(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const o=this._docs[r];e(o,r)&&(this.removeAt(r),r-=1,n-=1,s.push(o))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:o,sortFn:i,ignoreFieldNorm:c}=this.options;let l=L(e)?L(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Es(l,{ignoreFieldNorm:c}),o&&l.sort(i),We(s)&&s>-1&&(l=l.slice(0,s)),bs(l,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const s=me(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:o,i,n:c})=>{if(!j(o))return;const{isMatch:l,score:h,indices:u}=s.searchIn(o);l&&n.push({item:o,idx:i,matches:[{score:h,value:o,norm:c,indices:u}]})}),n}_searchLogical(e){const s=Xe(e,this.options),r=(c,l,h)=>{if(!c.children){const{keyId:d,searcher:m}=c,g=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(l,d),searcher:m});return g&&g.length?[{idx:h,item:l,matches:g}]:[]}const u=[];for(let d=0,m=c.children.length;d<m;d+=1){const g=c.children[d],x=r(g,l,h);if(x.length)u.push(...x);else if(c.operator===se.AND)return[]}return u},n=this._myIndex.records,o={},i=[];return n.forEach(({$:c,i:l})=>{if(j(c)){let h=r(s,c,l);h.length&&(o[l]||(o[l]={idx:l,item:c,matches:[]},i.push(o[l])),h.forEach(({matches:u})=>{o[l].matches.push(...u)}))}}),i}_searchObjectList(e){const s=me(e,this.options),{keys:r,records:n}=this._myIndex,o=[];return n.forEach(({$:i,i:c})=>{if(!j(i))return;let l=[];r.forEach((h,u)=>{l.push(...this._findMatches({key:h,value:i[u],searcher:s}))}),l.length&&o.push({idx:c,item:i,matches:l})}),o}_findMatches({key:e,value:s,searcher:r}){if(!j(s))return[];let n=[];if(R(s))s.forEach(({v:o,i,n:c})=>{if(!j(o))return;const{isMatch:l,score:h,indices:u}=r.searchIn(o);l&&n.push({score:h,key:e,value:o,idx:i,norm:c,indices:u})});else{const{v:o,n:i}=s,{isMatch:c,score:l,indices:h}=r.searchIn(o);c&&n.push({score:l,key:e,value:o,norm:i,indices:h})}return n}}V.version="7.1.0";V.createIndex=Ve;V.parseIndex=ns;V.config=f;V.parseQuery=Xe;xs(Cs);function ys(){const t=W(),{environmentId:e,setEnvironmentId:s}=_(),[r,n]=A.useState(!1),o=A.useRef(null),{data:i,isLoading:c}=Ft(),l=i?.find(u=>u.id===e);It("environment",r,()=>n(!1)),A.useEffect(()=>{if(!c){if(e&&!l)s(null);else if(!e&&i?.length){const u=ue(i,[d=>!(d.is_pinned??!1),d=>-(d.task_count??0)]);s(u[0].id)}}},[c,e,l,i,s]),Oe([{key:"whamEnvironments",action:()=>n(!0),actionMessageDescriptor:t.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:Le.Chat,keyboardBinding:[q.Mod,"e"]}]);const h=()=>n(!1);return c?a.jsx("div",{className:"flex items-center gap-3 rounded-full",children:a.jsx($e,{})}):a.jsxs("div",{className:"flex items-center gap-3 rounded-full",children:[a.jsxs(_e,{open:r,onOpenChange:n,children:[a.jsx(Pe,{triggerText:l?.label??t.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),toolTip:(l?.label?.length??0)>16?l?.label??"":l?.label||r?"":t.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),ariaLabel:t.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:a.jsx(He,{"aria-hidden":!0,className:"icon-sm"})}),a.jsx(Re,{align:"start",sideOffset:12,isOpen:r,closePopover:h,popoverContentRef:o,children:a.jsx(Bs,{isLoading:c,environments:i??[],environmentId:e,setEnvironmentId:s,closePopover:h})})]}),l&&a.jsx(Tt,{environment:l})]})}function Bs({isLoading:t,environments:e,environmentId:s,setEnvironmentId:r,closePopover:n}){const o=W(),i=A.useRef(null),[c,l]=A.useState(""),h=p=>{r(p),n()},u=De(),d=A.useMemo(()=>new V(e,{threshold:.4,keys:["label","repos"]}),[e]),m=A.useMemo(()=>{if(!c?.trim()){const[E,S]=vt(e,F=>F.is_pinned);return[...ue(E,F=>-(F.task_count??0)),...ue(S,F=>-(F.task_count??0))]}const p=c.trim().toLowerCase(),B=d?.search(c).map(E=>E.item)??[],D=E=>{const S=E.toLowerCase();return S===p?0:S.startsWith(p)?1:2};return B.sort((E,S)=>{if(E.is_pinned!==S.is_pinned)return E.is_pinned?-1:1;const F=D(E.label)-D(S.label);return F!==0?F:E.label.localeCompare(S.label)})},[c,d,e]),{hoveredId:g,setHoveredId:x,onKeyDown:v,getItemRef:w}=Nt({items:m,keyExtractor:p=>p.id,onSelect:h});return A.useEffect(()=>{i.current?.focus()},[]),a.jsxs("div",{className:"bg-token-bg-primary flex w-72 flex-col gap-2 overflow-y-auto rounded-lg p-2",children:[e.length>4&&a.jsx("div",{className:"contents",onClick:p=>{p.stopPropagation()},children:a.jsx(wt,{ref:i,className:"w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",type:"text",autoComplete:"off",name:"branch-to-add",value:c,onChange:p=>l(p.target.value),onKeyDown:v,placeholder:o.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip",defaultMessage:"Search environments"}),ariaLabel:o.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria",defaultMessage:"Search environments"})})}),a.jsx("div",{className:"flex max-h-[120px] flex-col overflow-y-auto md:max-h-[220px]",children:t?a.jsx("div",{className:"flex w-full items-center justify-center py-2",children:a.jsx(ct,{className:"ms-2"})}):e.length>0?m.length>0?m.map(p=>{const B=s===p.id;return a.jsx(le,{as:"button",ref:w(p),onMouseEnter:()=>x(p.id),className:"w-full",truncateLabel:!0,onClick:()=>{h(p.id)},isVirtualHover:g===p.id,isSelected:B,label:p.label},p.id)}):a.jsx("div",{className:"p-2 text-center",children:a.jsx("p",{className:"text-token-text-secondary text-sm",children:a.jsx(T,{id:"wham.environmentPopover.noMatches",defaultMessage:"No matches found"})})}):a.jsxs("div",{className:"p-2 text-center",children:[a.jsx("p",{className:"text-token-text-primary text-sm",children:a.jsx(T,{id:"wham.environmentPopover.noEnvironments",defaultMessage:"No environments"})}),a.jsx("p",{className:"text-token-text-secondary text-xs",children:a.jsx(T,{id:"wham.environmentPopover.missingEnvironment",defaultMessage:"Codex requires an environment to work"})})]})}),a.jsx("div",{className:"border-token-border-default border-t"}),a.jsx(le,{className:"w-full",onClick:()=>{u("/codex/settings/environments")},isSelected:!1,icon:a.jsx(bt,{className:"icon-sm"}),label:o.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"})},"manage-environment")]})}function Fs(){const t=W(),{isConnected:e,isLoading:s,openGithubModal:r,error:n,refetch:o}=Ne(Te.GITHUB_CONNECTOR,"github","/codex","CODEX"),{enabled:i}=ft();return s?a.jsx($e,{}):n?a.jsx(ee,{label:t.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:a.jsx($,{color:"secondary",size:"small",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:o,children:a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(He,{"aria-hidden":!0,className:"icon-sm"}),a.jsx(T,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):i?a.jsx(a.Fragment,{children:a.jsx("div",{className:"z-0 flex w-full justify-between",children:e?a.jsx("div",{className:"flex gap-4",children:a.jsx(ys,{})}):a.jsx("div",{className:"flex gap-2",children:a.jsxs($,{type:"button",color:"secondary",size:"small",onClick:r,children:[a.jsx(be,{"aria-hidden":!0,className:"icon-sm me-1.5"}),a.jsx(T,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):a.jsx(ee,{label:t.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:a.jsxs($,{type:"button",color:"secondary",size:"small",onClick:r,disabled:!0,children:[a.jsx(be,{"aria-hidden":!0,className:"icon-sm me-1.5"}),a.jsx(T,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function Ss(){const t=W(),e=De(),{setupMfa:s}=yt({redirectUrl:"/codex"});return a.jsx(ut,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:a.jsxs("div",{className:"flex w-full justify-end gap-2",children:[a.jsx($,{color:"secondary",onClick:()=>{e("/")},children:a.jsx(T,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),a.jsx($,{color:"primary",onClick:()=>{s()},children:a.jsx(T,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}function Rs({disableAutoFocus:t=!1,isBigBoxMode:e=!1,isExpandedByDefault:s=!1,disableDuringSubmit:r=!1,followUp:n,onClearComments:o,onSubmit:i,onSuccess:c,attemptIndex:l,hasSiblingTurns:h}){const u=W(),d=lt(),{refetch:m}=St(),{refetch:g}=kt(n?.taskId),{refetch:x}=jt(n?.taskId),v=_(({environmentId:C})=>C),w=_(({branch:C})=>C),p=_(({addTurnToTaskMap:C})=>C),B=Bt(C=>C.isExpanded),[D,E]=A.useState(!0),[S,F]=A.useState(!1),[b,N]=A.useState(1),I=Ie(),G=Ae(I,"3492040717"),K=Ae(I,"3536244140"),[O,ne]=A.useState(!1),M=dt(),{whisperControls:z}=mt({composerController:M,composerType:"codex"}),Q=ht(M.store,C=>C.controlsDisabled),re=_(C=>C.getRateLimit()?.remaining===0),qe=_(C=>C.getRateLimit()?.resets_after_text),Y=re&&!!n,{isConnected:Je,error:Ue}=Ne(Te.GITHUB_CONNECTOR,"github","/codex","CODEX"),xe=n&&(n.comments.length??0)>0,et=n?!0:!!v&&!!w,oe=A.useSyncExternalStore(C=>M.subscribe("change",C),()=>!M.isEmpty(),()=>!1)||xe;Oe([{key:"focusComposer",action:()=>M.focus(),actionMessageDescriptor:u.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),group:Le.Chat,keyboardBinding:[q.Shift,q.Escape],altKeyboardBindings:n?void 0:[[q.Mod,q.Shift,"o"]]}]);const Me=re?u.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset {resetsAfterText}"},{resetsAfterText:qe}):et?oe?Je?Ue?u.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"}):void 0:u.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"}):u.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"}):u.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"}),ie=!!Me||S&&r,{mutate:Z,isPending:tt}=nt({mutationFn:async({runEnvironmentInQaMode:C}={runEnvironmentInQaMode:!1})=>{if(!v||!oe||!w&&!n)throw new Error("Environment, content, and branch are required");const X=M.getContentToSend().content;if(i?.(),F(!0),n)return await Ee.createFollowUpTask(n.taskId,n.turnId,X,n.comments,C,G?b:void 0).catch(y=>{throw M.setText(X),y instanceof J&&y.status===429?d.danger(u.formatMessage(je.rateLimit),{id:n.turnId,duration:5,hasCloseButton:!0}):y instanceof ve?we(y,n.turnId,u,d):y instanceof J&&y.status===403&&y.detail?.toLowerCase().includes("multi-factor authentication")?ne(!0):d.danger(u.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:n.turnId,duration:5,hasCloseButton:!0}),y});{if(!w)throw new Error("Branch is required");E(!1);const y=crypto.randomUUID();return _.getState().addPendingTaskId(y),Ee.createNewTask(v,w,X,C,G?b:void 0).catch(k=>{throw _.getState().removePendingTaskId(y),M.getContentToSend().content.length?(d.danger(u.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:y,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(X)):M.setText(X),k}).catch(k=>{throw k instanceof J&&k.status===429?d.danger(u.formatMessage(je.rateLimit),{id:y,duration:5,hasCloseButton:!0}):k instanceof ve?we(k,y,u,d):k instanceof J&&k.status===403&&k.detail?.toLowerCase().includes("multi-factor authentication")?ne(!0):d.danger(u.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:y,duration:5,hasCloseButton:!0}),k}).then(k=>(_.getState().assignPendingTaskToFinalTask(y,k.task.id),_.getState().setRateLimit(k.rate_limit),k))}},onSuccess:C=>{p(C.task.id,C.turn),C.user_turn&&p(C.task.id,C.user_turn),c?.(C),setTimeout(()=>{M.focus()},0),g(),m(),n&&x()},onSettled:()=>{F(!1)}});A.useEffect(()=>{if(!ie)return M.subscribe("keydown",C=>{C.metaKey&&C.key==="Enter"?Z({runEnvironmentInQaMode:!1}):C.altKey&&C.key==="Enter"&&Z({runEnvironmentInQaMode:!0})})},[M,Z,ie]);let ae;K?ae=!Q&&oe:ae=!0;const st=h&&l?u.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:l}):u.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"});return a.jsxs("div",{className:"contents",inert:r&&S||Y,children:[a.jsxs(gt,{disableAutoFocus:t||re,isExpandedByDefault:s&&!Y,isBigBoxModeActive:e&&!Y,isTemporaryChat:!1,textareaMaxHeightClassName:"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]",placeholder:n?st:D?u.formatMessage({id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"}):u.formatMessage({id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"}),onSubmit:()=>{tt||Z({runEnvironmentInQaMode:!1})},composerController:M,children:[xe&&a.jsx(pt,{children:a.jsx(Pt,{comments:n.comments,onClearComments:o})}),!Q&&a.jsx(Ct,{children:a.jsxs("div",{className:"flex gap-4",children:[!n&&a.jsx(Fs,{}),G&&a.jsx(Ot,{attempts:b,setAttempts:N})]})}),a.jsxs(xt,{children:[B&&!Y&&a.jsxs(a.Fragment,{children:[K&&a.jsx("div",{inert:S,children:z}),ae&&a.jsx(_t,{isSubmitDisabled:ie,createTask:Z,disabledReason:Me})]}),Y&&a.jsx(Dt,{})]})]}),O&&a.jsx(Ss,{})]})}const je=rt({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Codex is busy right now. Please try again later."}});export{He as S,Rs as W};
//# sourceMappingURL=ju91cj9mp2lx2yuz.js.map
