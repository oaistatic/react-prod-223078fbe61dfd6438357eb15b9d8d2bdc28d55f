import{r as g,u as m}from"./b8ijctzpgh0s7wpx.js";import{c5 as i,c6 as r}from"./citrwydz0bgriwlc.js";import{u as L}from"./gaxh4csbc95s5l26.js";import{dn as u}from"./krbmwir12ubt4od1.js";const c="last_checked_loc",f=24*60*60*1e3,s="last_denied_loc",d=60*60*1e3;function C(){const[o]=L(),{data:e}=m({queryKey:["userLocation",o.useLocation],queryFn:({queryKey:[t,n]})=>S({enabled:n}),initialData:y(o.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return e}function y(o){if(o){const e=i.getCookie(r.LastLocation);if(e)try{return JSON.parse(e)}catch{return l(),null}}return null}async function S({enabled:o}){if(!o)return l();if((await A())?.state!=="granted"){const t=localStorage.getItem(c);if(t){const n=Number(t),a=i.getCookie(r.LastLocation);if(a&&Date.now()-f<n)try{return JSON.parse(a)}catch{}}}const e=localStorage.getItem(s);if(e){const t=Number(e);if(Date.now()-d<t)return null}return await new Promise(t=>{navigator.geolocation.getCurrentPosition(n=>{const a={latitude:n.coords.latitude,longitude:n.coords.longitude,locationAccuracy:n.coords.accuracy};i.setCookie(r.LastLocation,JSON.stringify(a),{maxAge:u}),localStorage.setItem(c,Date.now().toString()),t(a)},()=>{localStorage.setItem(s,Date.now().toString()),t(l())},{enableHighAccuracy:!0,maximumAge:0})})}async function A(){return navigator?.permissions?await navigator.permissions.query({name:"geolocation"}):null}const _={latitude:null,longitude:null,locationAccuracy:null};function l(){return i.setCookie(r.LastLocation,JSON.stringify(_),{maxAge:u}),localStorage.removeItem(c),localStorage.removeItem(s),null}g.createContext(null);export{C as u};
//# sourceMappingURL=c5l07rcbg83bqush.js.map
