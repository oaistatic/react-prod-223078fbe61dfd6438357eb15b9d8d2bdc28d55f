const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/klnyb5wz6otm2g6q.js","assets/b8ijctzpgh0s7wpx.js","assets/citrwydz0bgriwlc.js","assets/root-gxczc0vy.css","assets/krbmwir12ubt4od1.js","assets/conversation-small-dfayqh3x.css","assets/er3uzu01hefrnojy.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{bj as X,c as S,S as K,F as L,aQ as T,e as M,ad as B,B as Z,m as J,gV as y,gU as P,cs as Y,ct as $,ak as ee,Q as te,_ as ne,n as ae}from"./citrwydz0bgriwlc.js";import{r as u,i as I,j as e,a5 as W,M as v,a as oe,l as se}from"./b8ijctzpgh0s7wpx.js";import{F as ie}from"./jncxxxf8x7thpqvw.js";import{bz as V,lt as re,lu as le,lv as ce,lw as de,bB as ue,bC as me,ic as pe,bH as ge,ib as H,cs as U,dA as E,aX as fe,am as he,al as A,lx as xe,eu as O,at as je,gm as we,id as be,O as ve,dr as Ce,gn as ke,cT as ye,ev as Ee,bV as z,ly as Ie,lz as _e,lA as De,ga as Se}from"./krbmwir12ubt4od1.js";import"./k6ccgr4wxcppeg93.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./me9hhl03j9gxv6g7.js";import"./jkznwfhp8ahnvlot.js";import"./nvghija6qp2cunds.js";import"./djd85tifm57yisqi.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./i7jya7stlyvnzya0.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./dcml6fn13vfm1zv2.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./dbalwdodzoo02ru2.js";import"./b4v20hsjdnh8a64d.js";import"./h3krx8dg2s8o2yh5.js";import"./cfe0bfy5asp94vp2.js";import"./c2d9eukr2hh7n3q0.js";import"./pfex3j43xcablmav.js";import"./pc9qsszhmtx9pu7o.js";import"./dera5bljhpg5ja89.js";import"./hs2fsda156wfk7fz.js";import"./m4qet7ipn6ha09it.js";import"./h3axfhhn58bmthc9.js";import"./eg629yaevviy8e7x.js";import"./be0n9593bbjhdouz.js";import"./gbxx25eoj7wtyna0.js";import"./bzsolvz1ulyrc61b.js";import"./pc2givv05uuq8g6l.js";import"./jy1hvpbwecfrhxw6.js";import"./otl51en3t0ec5n7s.js";import"./eigi8l95ddhoqirr.js";import"./etmxhiuvgu79utu0.js";import"./ct6yhczwft8t5t9k.js";import"./bzpm2hv3f3hhm416.js";import"./oyzab3j7hun2568h.js";import"./nhujhl3wh6ze4xx0.js";import"./cjgrwe6bv9n1lytg.js";function Ne(){const[t,n]=u.useState({undoStack:[],currentIndex:-1});function o(a){n(c=>({undoStack:[...c.undoStack.slice(0,c.currentIndex+1),a],currentIndex:c.currentIndex+1}))}function r(){n(a=>({undoStack:a.undoStack,currentIndex:Math.max(a.currentIndex-1,-1)}))}function s(){n(a=>({undoStack:a.undoStack,currentIndex:Math.min(a.currentIndex+1,a.undoStack.length-1)}))}function i(){n({undoStack:[],currentIndex:-1})}return{currentDrawnShape:t.undoStack.length>0?t.undoStack[t.currentIndex]:null,onNewDrawnShape:o,canUndoDrawing:t.currentIndex>=0,undoDrawing:r,canRedoDrawing:t.currentIndex<t.undoStack.length-1,redoDrawing:s,clearAllDrawings:i}}var m=(t=>(t[t.Default=0]="Default",t[t.Inpaint=1]="Inpaint",t))(m||{});function Te({imageAsset:t,mode:n,setMode:o,clientThreadId:r,messageId:s,cursorWidth:i,setCursorWidth:a,inpaintingDrawingState:c,isLoadingNewImage:l}){const p=X(r),{canUndoDrawing:d,undoDrawing:j,canRedoDrawing:h,redoDrawing:x,clearAllDrawings:w}=c,b=I();return e.jsxs(W.div,{className:"flex h-16 w-full justify-between px-4",...V,children:[e.jsx("div",{className:"flex items-center",children:n===m.Inpaint&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S("flex items-center gap-3",l&&"opacity-50"),children:[e.jsx(F,{className:"h-[11px] w-[11px]"}),e.jsxs(re,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[i],onValueChange:C=>a(C[0]),disabled:l,children:[e.jsx(le,{className:"bg-token-text-quaternary relative h-[2px] grow",children:e.jsx(ce,{className:"bg-token-text-secondary absolute h-full"})}),e.jsx(de,{className:"bg-token-text-secondary block h-[11px] w-[11px] rounded-full"})]}),e.jsx(F,{className:"h-6 w-6"})]}),e.jsx(R,{}),e.jsx(f,{disabled:!d||l,onClick:j,children:e.jsx(ue,{})}),e.jsx(f,{disabled:!h||l,onClick:x,children:e.jsx(me,{})}),e.jsx(R,{}),e.jsx(f,{disabled:!d||l,onClick:w,children:e.jsx(v,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),e.jsx("div",{className:"flex items-center",children:n===m.Inpaint?e.jsx(f,{onClick:()=>o(m.Default),disabled:l,children:e.jsx(v,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{imageAsset:t,setMode:o,messageId:s,serverThreadId:p}),e.jsx(f,{tooltip:b.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>pe(t,p,s),children:e.jsx(ge,{})}),e.jsx(Me,{prompt:H(t),children:e.jsx(f,{tooltip:b.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:e.jsx(U,{})})}),e.jsx(f,{tooltip:b.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:E.close,children:e.jsx(K,{className:"icon-lg"})})]})})]})}function Me({prompt:t,children:n}){const[o,r]=u.useState(!1),s=I(),i=B();return e.jsx(we,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:e.jsx("div",{className:"group",children:n}),className:"z-10",size:"none",children:e.jsxs("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[e.jsx("div",{className:"text-token-text-secondary",children:e.jsx(v,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),e.jsx("div",{children:t}),e.jsx("div",{children:e.jsx(Z,{color:"secondary",disabled:o,onClick:a=>{r(!0),ve(t,i,a),setTimeout(()=>r(!1),2e3)},icon:be,children:o?s.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):s.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function f({children:t,tooltip:n,disabled:o,onClick:r}){const s=e.jsx("button",{className:S("hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary rounded-sm p-2 font-semibold",o?"text-token-text-quaternary":"text-token-text-secondary"),disabled:o,onClick:r,children:t});return n!=null?e.jsx(fe,{label:n,children:s}):s}function Pe({imageAsset:t,setMode:n,messageId:o,serverThreadId:r,disabled:s}){const i=I(),a=he(A.DalleEditingOnboarding),c=a.eligible&&!a.isLoading,l=e.jsx(f,{tooltip:c?void 0:i.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n(m.Inpaint),T.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),M.logEvent("chatgpt_dalle_inpaint_click",{conversationId:r,messageId:o,generationId:t.metadata?.dalle?.gen_id,fileId:O(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),T.logEvent("chatgpt_image_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),M.logEvent("chatgpt_image_inpaint_click",{conversationId:r,messageId:o,generationId:t.metadata?.dalle?.gen_id,fileId:O(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})},disabled:s,children:e.jsx(xe,{})});return c?e.jsx(je,{announcementKey:A.DalleEditingOnboarding,show:!0,side:"bottom",sideOffset:0,title:i.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:i.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:a.markAsViewed,children:e.jsx("div",{children:l})}):l}const R=L.div`mx-3 w-[1px] h-6 bg-token-border-default`,F=L.div`rounded-full border-2 border-token-text-secondary`;function Ae({mode:t,imageIndex:n,allImages:o,onSwitchImage:r,isLoadingNewImage:s}){const i=n>0,a=u.useCallback(()=>{i&&r(o[n-1])},[i,o,n,r]),c=n<o.length-1,l=u.useCallback(()=>{c&&r(o[n+1])},[c,o,n,r]);return u.useEffect(()=>{function p(d){d.target instanceof HTMLTextAreaElement||t===m.Default&&(d.key==="ArrowLeft"?a():d.key==="ArrowRight"&&l())}return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}},[t,a,l]),e.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:t===m.Inpaint?!s&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(v,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),e.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:e.jsx(U,{className:"icon-md"})})]}):o.length>1?e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:a,children:e.jsx(Ce,{className:"icon"})}),e.jsx("div",{children:e.jsx(v,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:o.length}})}),e.jsx("button",{disabled:!c,className:"disabled:text-token-text-tertiary",onClick:l,children:e.jsx(ke,{className:"icon"})})]}):null})}const Oe=0,Re=64;function Fe({imageAsset:t,children:n,containerDimensions:o,isLoadingNewImage:r}){return e.jsxs(W.div,{className:"absolute",style:Le(t,o),...V,children:[n,e.jsx("div",{className:S("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function Le(t,n){const{width:o,height:r}=t,{width:s,height:i}=n,a=s-2*Oe,c=i-2*Re,l=o/r,p=a/c,d=l>p,j=d?a:c*l,h=d?a/l:c,x=(i-h)/2,w=(s-j)/2;return{top:x,left:w,width:j,height:h}}const Be=te(()=>ne(()=>import("./klnyb5wz6otm2g6q.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.DynamicDrawingCanvas));function Ot({clientThreadId:t,messageId:n,image:o,allImages:r}){const s=J(t,ae.getCurrentNode),i=[y.Dalle,y.t2uay3k].includes(P(s.message))&&!ye(s.message),a=oe();return u.useEffect(()=>{async function c(l,p){try{const d=await Ee(a,l);E.setFocusedObject({type:z.Image,image:d[0],allImages:d,messageId:p})}catch(d){ee.addError(new Error("Failed to load newly created images:",{cause:d}))}}if(s!=null&&[y.Dalle,y.t2uay3k].includes(P(s.message))&&s.message.content.content_type===Y.MultimodalText){const l=$.getImageAssetPointers(s.message);c(l,s.id)}},[a,s]),e.jsx(We,{image:o,allImages:r,isLoadingNewImage:i,clientThreadId:t,messageId:n})}function We({image:t,allImages:n,isLoadingNewImage:o,clientThreadId:r,messageId:s}){const[i,a]=u.useState(m.Default),[c,l]=u.useState({width:window.innerWidth-ie,height:window.innerHeight}),p=u.useRef(null),[d,j]=u.useState(136),h=Ne(),{currentDrawnShape:x,onNewDrawnShape:w,clearAllDrawings:b}=h,C=u.useRef(null),_=I(),N=B(),{setTargetedContent:k}=Ie();u.useEffect(()=>{const g=new ResizeObserver(D=>{const{width:q,height:Q}=D[0].contentRect;l({width:q,height:Q})});return p.current&&g.observe(p.current),()=>{g.disconnect()}},[]),u.useEffect(()=>{function g(D){D.key==="Escape"&&(i===m.Inpaint?a(m.Default):E.close())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[i]),u.useEffect(()=>(x==null?k({type:"object",placeholderTextOverride:se({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit image…"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:g=>_e(g,t)}):k({type:"object",label:_.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async g=>await De(g,t,C.current?.getImageData(),_,N),onCleared:()=>a(m.Default)}),()=>{k(void 0)}),[t,_,k,x,N]),u.useEffect(()=>{i!==m.Inpaint&&b()},[i]),u.useEffect(()=>{a(m.Default)},[t]);const G=n.findIndex(g=>g.asset_pointer===t.asset_pointer);return e.jsxs("div",{ref:p,className:"flex h-full w-full flex-col justify-between",children:[e.jsx(Te,{imageAsset:t,mode:i,setMode:a,clientThreadId:r,messageId:s,cursorWidth:d,setCursorWidth:j,inpaintingDrawingState:h,isLoadingNewImage:o}),e.jsx(Ae,{mode:i,imageIndex:G,allImages:n,onSwitchImage:g=>{E.setFocusedObject({type:z.Image,image:g,allImages:n,messageId:s})},isLoadingNewImage:o}),e.jsxs(Fe,{imageAsset:t,containerDimensions:c,isLoadingNewImage:o,children:[e.jsx(Se,{className:"h-full w-full",alt:H(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),i===m.Inpaint&&e.jsx("div",{className:"absolute inset-0",children:e.jsx(Be,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:d,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:x,onNewDrawnShape:w})})]})]})}export{Ot as ImageEditor};
//# sourceMappingURL=hpn4skkcz7o0jbpw.js.map
