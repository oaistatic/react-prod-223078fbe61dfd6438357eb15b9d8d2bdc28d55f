const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hp67ts4xs05yms3p.js","assets/j81kavn28xsab5an.js","assets/citrwydz0bgriwlc.js","assets/b8ijctzpgh0s7wpx.js","assets/root-gxczc0vy.css","assets/krbmwir12ubt4od1.js","assets/conversation-small-dfayqh3x.css","assets/cfe0bfy5asp94vp2.js","assets/ku4zsoy6w4wkp690.js","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js"])))=>i.map(i=>d[i]);
import{c as C,j as t,r as p,M as w,R as je,a as Rt,e as Bt,i as X,f as Te,a5 as Y,a6 as Se}from"./b8ijctzpgh0s7wpx.js";import{o as et,tb as Pt,tc as Lt,td as Ie,ad as tt,rH as zt,rm as me,r3 as At,r4 as Ft,sW as Dt,l1 as L,e7 as Ht,nL as Gt,te as $t,tf as Ut,tg as _e,th as st,a5 as Wt,ij as Vt,aS as Ee,ti as at,rN as nt,L as Kt,cW as it,cP as Oe,r9 as qt,cR as Re,cS as Be,r8 as Qt,am as Yt,al as rt,j7 as Pe,dq as Xt,jd as Jt,at as Zt,ft as es,tj as ot,rp as ts,rq as ke,tk as ss,cb as Le,tl as as,tm as ns,mQ as lt,mO as ct,aX as te,U as ye,c7 as dt,tn as is,to as rs,cd as os,N as ze,rS as ls,tp as cs,rP as ds,c5 as ut,ko as us,gN as fs,tq as Me,im as ms,mR as hs,tr as xs,ts as ge,tt as gs,df as ps,gB as bs,hl as js,tu as Ae,tv as Ss,tw as vs,tx as ys,ty as ws,tz as Ns,tA as Cs,tB as Ge,tC as _s,tD as ks,tE as ft,bJ as Ms,B as mt,ds as Ts,nr as Is,qT as Es,nu as Os,nz as Rs,tF as ht,tG as Bs,tH as Ps,nN as Ls,bg as zs,bh as As,tI as Fs,cs as xt,gs as Ds,dI as Hs,a$ as Gs,b7 as $s,dG as Us,tJ as Ws,tK as Vs,tL as Ks,rM as qs,tM as Qs,tN as Ys,o0 as Xs}from"./krbmwir12ubt4od1.js";import{aq as Fe,ex as Js,aI as $e,aF as Ue,g_ as Zs,e$ as ea,c as I,B as he,cp as ta,eR as se,O as sa,e as K,ak as aa,_ as We,j as xe,ae as na,cS as ia,aS as ra,dr as oa,dL as gt,bL as la,S as ca,au as De,m as He,E as da,k as ua,n as pt,cY as fa,dj as ma,dl as ha,dG as xa,dw as ga,dx as pa,di as ba,dg as ja,a8 as bt,eF as Sa,eA as jt,b1 as St,eH as va,eV as ya,ab as wa,a7 as Na,fq as vt,gH as ee,eU as Ca}from"./citrwydz0bgriwlc.js";import{i as we,j as _a,S as ka,k as Ma,l as Ta,m as yt,e as Ia}from"./b4v20hsjdnh8a64d.js";import{u as Ea,H as Oa,a as Ra}from"./eigi8l95ddhoqirr.js";import{i as wt}from"./cfe0bfy5asp94vp2.js";import{W as Nt}from"./etmxhiuvgu79utu0.js";import{P as Ba}from"./ct6yhczwft8t5t9k.js";function Pa(s){"use forget";const e=C.c(2),{currentGizmoId:i}=s,a=Fe();if(!a||a.isQuorum())return null;let n;return e[0]!==i?(n=t.jsx(Js,{name:"GizmoSidebarList",children:t.jsx(za,{currentGizmoId:i,maxToShowOnLoad:4})}),e[0]=i,e[1]=n):n=e[1],n}const Ve=2,Ke=3;function La(s){const e=zt(s,d=>d.flair.kind),i=e[me.Recent]?.slice(0,Ve),a=e[me.Recent]?.slice(Ve),n=e[me.Workspace]?.slice(0,Ke),r=e[me.Workspace]?.slice(Ke),o=[...n??[],...e[me.FirstParty]??[],...e[me.SidebarKeep]??[],...i??[]],l=[...a??[],...r??[]];return{topGizmos:o,remainingGizmos:l}}const za=({currentGizmoId:s,maxToShowOnLoad:e})=>{"use forget";const[i,a]=p.useState(!($e.getItem(Ue.IsGptListCollapsed)??!0)),n=et(),{data:{gizmos:r=[]}={}}=Pt(),{topGizmos:o,remainingGizmos:l}=p.useMemo(()=>La(n?r.filter(c=>!Lt(c.resource)):r),[r,n]),d=Math.max(o.length,e);let u=[...o,...l];const m=u.length>d;return m&&!i&&(u=u.slice(0,d-1)),t.jsxs(t.Fragment,{children:[u.map(c=>t.jsx(we,{gizmo:c.resource,isActive:c.resource.gizmo.id===s,flair:c.flair.kind},c.resource.gizmo.id)),m&&t.jsx(Ie,{onClick:c=>{c.preventDefault(),a(f=>{const h=!f;return $e.setItem(Ue.IsGptListCollapsed,!h),h})},icon:tt,children:i?t.jsx(w,{id:"GizmoSidebarList.showLess",defaultMessage:"Show less"}):t.jsx(w,{id:"GizmoSidebarList.showMoreItems",defaultMessage:"Show more"})})]})},qe=Bt({unableToLoadHistory:{id:"history.unableToLoad",defaultMessage:"Unable to load history"},retryButton:{id:"history.retryButton",defaultMessage:"Retry"}});function Aa(s){const e=JSON.stringify(s.map(a=>[a.id,a.title,a.update_time]));return p.useMemo(()=>s,[e])}function Fa(s){"use forget";const e=C.c(61),{activeId:i,hideOverflowMenu:a}=s,n=Rt(),[r,o]=p.useState(!1),[l,d]=p.useState(0),u=Zs(),[m,c]=p.useState(!1),f=At(),h=Ft();let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x={},e[0]=x):x=e[0];const{conversations:g,hasNextPage:j,fetchNextPage:b,isLoading:S,isFetchingNextPage:N,isError:k}=Dt(x),y=Aa(g),_=p.useRef(null);let M;e[1]!==j||e[2]!==S||e[3]!==b?(M=P=>{S||P==null||(_.current?.disconnect(),_.current=new IntersectionObserver(Ot=>{Ot[0].isIntersecting&&j&&b()}),_.current.observe(P))},e[1]=j,e[2]=S,e[3]=b,e[4]=M):M=e[4];const v=M;let R,B;e[5]===Symbol.for("react.memo_cache_sentinel")?(R=()=>()=>{_.current?.disconnect()},B=[],e[5]=R,e[6]=B):(R=e[5],B=e[6]),p.useEffect(R,B);let E,z;e[7]!==y?(E=()=>{ta.publish({kind:"refreshHistory",conversations:y})},z=[y],e[7]=y,e[8]=E,e[9]=z):(E=e[8],z=e[9]),p.useEffect(E,z);const G=y;let V,q;e[10]!==l||e[11]!==u?(V=()=>{const P=$t(Ut(),Date.now());u(()=>{d(l+1)},P+1e3)},q=[l,u],e[10]=l,e[11]=u,e[12]=V,e[13]=q):(V=e[12],q=e[13]),p.useEffect(V,q);const T=G.length===0;L.markStart("History",L.NS_SIDEBAR),Fe()!=null&&!S&&L.markRendered("History",L.NS_SIDEBAR);const $=Ea(G,l);let A;e[14]===Symbol.for("react.memo_cache_sentinel")?(A="278356667",e[14]=A):A=e[14];const{config:U}=ea(A);let F;e[15]!==U?(F=U.get("remove_separators",!1),e[15]=U,e[16]=F):F=e[16];const W=F;let D;e[17]!==f?(D=f!=null&&f.kind==="conversation"&&f.gizmoId!=null&&Ht(f.gizmoId),e[17]=f,e[18]=D):D=e[18];const O=D,ae=S||k||T,H=p.useRef(0),Ne=ae&&"h-full items-center justify-center empty:hidden",Ce=m&&"opacity-50";let ne;e[19]!==Ne||e[20]!==Ce?(ne=I(Ne,Ce),e[19]=Ne,e[20]=Ce,e[21]=ne):ne=e[21];let ie;e[22]!==O?(ie=P=>{P.preventDefault(),O&&c(!0)},e[22]=O,e[23]=ie):ie=e[23];let re;e[24]!==O||e[25]!==f||e[26]!==h?(re=P=>{P.preventDefault(),O&&(H.current=0,c(!1),h({newGizmoId:null,conversation:f.conversation,previousGizmoId:f.gizmoId??null}))},e[24]=O,e[25]=f,e[26]=h,e[27]=re):re=e[27];let oe,le;e[28]!==O?(oe=P=>{P.preventDefault(),O&&(H.current=H.current+1)},le=P=>{P.preventDefault(),O&&(H.current=H.current-1,H.current===0&&c(!1))},e[28]=O,e[29]=oe,e[30]=le):(oe=e[29],le=e[30]);let ce;e[31]!==T||e[32]!==S?(ce=T&&S&&t.jsx(se,{children:t.jsx(sa,{className:"m-auto"})}),e[31]=T,e[32]=S,e[33]=ce):ce=e[33];let de;e[34]!==r||e[35]!==T||e[36]!==k||e[37]!==n?(de=T&&k&&t.jsxs("div",{className:"text-token-text-tertiary p-3 text-center italic",children:[t.jsx(w,{...qe.unableToLoadHistory}),!r&&t.jsx("div",{className:"mt-1",children:t.jsx(he,{as:"button",color:"primary",size:"small",className:"m-auto mt-2",onClick:()=>{o(!0),Gt(n)},children:t.jsx(w,{...qe.retryButton})})})]}),e[34]=r,e[35]=T,e[36]=k,e[37]=n,e[38]=de):de=e[38];let ue;e[39]!==i||e[40]!==$||e[41]!==j||e[42]!==a||e[43]!==v||e[44]!==T||e[45]!==S||e[46]!==G||e[47]!==W?(ue=!S&&!T&&(W?t.jsx(Oa,{activeId:i,hasNextPage:j,items:G,infiniteScrollTriggerElementRef:v,hideOverflowMenu:a}):t.jsx(Ra,{activeId:i,bucketedItems:$,hasNextPage:j,items:G,infiniteScrollTriggerElementRef:v,hideOverflowMenu:a})),e[39]=i,e[40]=$,e[41]=j,e[42]=a,e[43]=v,e[44]=T,e[45]=S,e[46]=G,e[47]=W,e[48]=ue):ue=e[48];let fe;e[49]!==N?(fe=N&&t.jsxs("div",{className:"mb-5",children:[t.jsx(_e,{}),t.jsx(_e,{}),t.jsx(_e,{})]}),e[49]=N,e[50]=fe):fe=e[50];let ve;return e[51]!==ne||e[52]!==ie||e[53]!==re||e[54]!==oe||e[55]!==le||e[56]!==ce||e[57]!==de||e[58]!==ue||e[59]!==fe?(ve=t.jsxs("div",{id:"history",className:ne,onDragOver:ie,onDrop:re,onDragEnter:oe,onDragLeave:le,children:[ce,de,ue,fe]}),e[51]=ne,e[52]=ie,e[53]=re,e[54]=oe,e[55]=le,e[56]=ce,e[57]=de,e[58]=ue,e[59]=fe,e[60]=ve):ve=e[60],ve}const Da=je.memo(Fa);function Ct(s){return wt()?s?"⌘K":"⌘ K":"Ctrl+K"}const Ha=({onNewThread:s,hideNewChat:e})=>t.jsxs(Ee,{first:!0,children:[!e&&t.jsx(kt,{onNewThread:s}),t.jsx(Mt,{}),!1,t.jsx(at,{})]});function _t(s){return wt()?s?"⇧⌘O":"⇧ ⌘ O":"Ctrl+Shift+O"}const kt=({onNewThread:s,iconOnly:e,onClickComplete:i})=>{const a=X(),n=st(),r=l=>{K.logNewChatButtonClicked({location:n??"Sidebar gizmo list",gizmo_id:"primary"}),K.logEvent("Sidebar Click Gizmo",{gizmo_id:"primary"}),nt(l,s),i?.(l)},o=a.formatMessage({id:"6Abeg/",defaultMessage:"New chat"});return t.jsx(Wt,{"data-testid":"create-new-chat-button",to:"/",onClick:r,icon:Vt,label:o,highlightTrailing:t.jsx("div",{className:"touch:hidden",children:_t()}),...e?{iconOnly:!0,iconAriaLabel:o}:{}})},Mt=({iconOnly:s,onClickComplete:e})=>{const i=X(),{isFannyPackEnabled:a}=Kt(),n=st();if(p.useEffect(()=>{a&&(aa.addAction("fannypack.web.action_seen"),We(()=>import("./hp67ts4xs05yms3p.js").then(o=>o.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])))},[a]),!a)return null;const r=i.formatMessage({id:"bDEsvT",defaultMessage:"Search chats"});return t.jsx(Ie,{onClick:o=>{We(()=>import("./hp67ts4xs05yms3p.js").then(l=>l.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(l=>l.openFannyPackSearch()),K.logEventWithStatsig("chatgpt_web_search_sidebar_item_clicked","chatgpt_web_search_sidebar_item_clicked",{location:n}),e?.(o)},icon:it,label:r,highlightTrailing:t.jsx("div",{className:"touch:hidden",children:Ct()}),...s?{iconOnly:!0,iconAriaLabel:r}:{}})};function Ga(){const s=Te(),e=xe(),{shouldShowTooltipNux:i,tooltipAnnouncement:a}=$a(),{name:n}=Oe(),[r,o]=p.useState(!1),{onDropConversation:l,canDropConversation:d}=_a("sidebar_header_plus"),u=n?Re:Be;return t.jsx(t.Fragment,{children:t.jsx(Ua,{showNuxTooltip:i,tooltipAnnouncement:a,children:t.jsx(Ie,{className:I(r&&"bg-token-bg-tertiary"),onDragEnter:m=>{d&&(m.preventDefault(),o(!0))},onDrop:m=>{d&&(m.preventDefault(),m.stopPropagation(),o(!1),l())},onDragLeave:()=>{o(!1)},icon:qt,onClick:()=>{na(e,({closeModal:m})=>t.jsx(Qt,{onClose:m,onSuccess:c=>{c&&s(`/g/${c}/project`)}})),i&&a.markAsViewed(),K.logEventWithStatsig("Projects: Create Open","chatgpt_web_projects_create_open",{source:"sidebar_row_button"})},children:t.jsx(w,{...u.newProjectButton})})})})}function $a(){const s=Yt(rt.hasSeenProjectsWebNuxTooltip);return{shouldShowTooltipNux:!s.isLoading&&s.eligible,tooltipAnnouncement:s}}function Ua({showNuxTooltip:s,tooltipAnnouncement:e,children:i}){const a=X(),n=Pe(),r=Xt(),o=Jt(),{name:l}=Oe(),d=l?Re:Be;return!s||r||!o||!n?t.jsx(t.Fragment,{children:i}):t.jsx(Zt,{announcementKey:rt.hasSeenProjectsWebNuxTooltip,theme:"bright",side:"right",show:!0,badge:"new",dismissOnOutsideClick:!0,title:a.formatMessage(d.projectsNuxTooltipTitle),description:a.formatMessage(d.projectsNuxTooltipDescription),onDismiss:e.markAsViewed,sideOffset:-5,children:i})}function Wa({currentGizmoId:s}){const{name:e}=Oe(),i=e?Re:Be;return t.jsx(es,{side:"right",sideOffset:-4,alignOffset:-7,size:"auto",triggerButton:t.jsx(ot,{as:"div",icon:tt,label:t.jsx(w,{...i.seeMoreProjectItems})}),children:t.jsx("div",{className:"max-h-[50dvh] max-w-(--sidebar-width) overflow-x-auto [scrollbar-gutter:stable]",children:t.jsx(se,{children:t.jsx(ka,{currentGizmoId:s,inSidebarFlyout:!0,customListItem:we})})})})}function Va({snorlaxes:s,currentGizmoId:e}){return t.jsx(t.Fragment,{children:s.map(i=>t.jsx(we,{gizmo:i.gizmo,isActive:i.gizmo.gizmo.id===e},i.gizmo.gizmo.id))})}function Ka({currentGizmoId:s}){const{snorlaxes:e,data:i,isLoading:a,isError:n,refetch:r,hasNextPage:o}=ts(),l=e.slice(0,ke),d=p.useRef(!1),[u,m]=p.useState(!0),c=p.useCallback(function(S){S&&m(!1),r()},[r,m]),f=n||i===void 0&&!a&&d.current;L.markStart("SnorlaxSidebarList",L.NS_SIDEBAR),i!=null&&!a&&L.markRendered("SnorlaxSidebarList",L.NS_SIDEBAR),i===void 0&&!a&&!d.current&&(d.current=!0,c(!1));const x=e?.find(b=>b.gizmo.gizmo.id===s),g=l.some(b=>b.gizmo.gizmo.id===s),j=e&&(e?.length>(!s||g?ke:ke+1)||o);return t.jsxs(t.Fragment,{children:[f&&t.jsx(ss,{showRetry:u,refetch:c}),!f&&t.jsx(Ee,{id:"snorlax-heading",children:!a&&t.jsxs(t.Fragment,{children:[t.jsx(Ga,{}),t.jsx(Va,{snorlaxes:l,currentGizmoId:s}),x&&!g&&t.jsx(we,{gizmo:x.gizmo,isActive:!0}),j&&t.jsx(Wa,{currentGizmoId:s})]})})]})}function qa(s){"use forget";const e=C.c(5),{clientThreadId:i,onNewThread:a}=s,n=oa(i),r=gt(i),o=la(),l=et(),d=o?void 0:n;let u;return e[0]!==r||e[1]!==l||e[2]!==a||e[3]!==d?(u=t.jsx(Qa,{currentGizmoId:r,activeId:d,isSnorlaxEnabled:l,onNewThread:a}),e[0]=r,e[1]=l,e[2]=a,e[3]=d,e[4]=u):u=e[4],u}function Qa(s){"use forget";const e=C.c(21),{currentGizmoId:i,activeId:a,isSnorlaxEnabled:n,onNewThread:r}=s,o=Fe();let l;e[0]!==o?(l=o?.isQuorum(),e[0]=o,e[1]=l):l=e[1];const d=l,u=Le();let m;e[2]!==r||e[3]!==u?(m=u!=="all_sticky"&&t.jsx(Ha,{onNewThread:r,hideNewChat:u==="new_chat_sticky"}),e[2]=r,e[3]=u,e[4]=m):m=e[4];let c;e[5]!==i||e[6]!==d||e[7]!==n||e[8]!==u?(c=!d&&t.jsxs(t.Fragment,{children:[t.jsxs(Ee,{first:u==="all_sticky",children:[t.jsx(as,{}),t.jsx(ns,{}),t.jsx(Pa,{currentGizmoId:i})]}),n&&t.jsx(Ka,{currentGizmoId:i})]}),e[5]=i,e[6]=d,e[7]=n,e[8]=u,e[9]=c):c=e[9];let f;e[10]!==d?(f=null,e[10]=d,e[11]=f):f=e[11];let h;e[12]!==a?(h=t.jsx(Da,{activeId:a}),e[12]=a,e[13]=h):h=e[13];let x;e[14]!==c||e[15]!==f||e[16]!==h?(x=t.jsx(se,{fallback:null,children:t.jsxs(p.Suspense,{children:[c,f,h]})}),e[14]=c,e[15]=f,e[16]=h,e[17]=x):x=e[17];let g;return e[18]!==m||e[19]!==x?(g=t.jsxs(t.Fragment,{children:[m,x]}),e[18]=m,e[19]=x,e[20]=g):g=e[20],g}function Kn(s){"use forget";const e=C.c(4),{clientThreadId:i,onNewThread:a}=s,n=xe();let r;return e[0]!==i||e[1]!==n||e[2]!==a?(r=ra(n)?t.jsx(qa,{clientThreadId:i,onNewThread:a}):null,e[0]=i,e[1]=n,e[2]=a,e[3]=r):r=e[3],r}function Ya(s){"use forget";const e=C.c(20),{onNewThread:i}=s,a=X(),n=ia(Ja),r=Ma();let o;e[0]!==a?(o=a.formatMessage({id:"Q6nsOM",defaultMessage:"Close sidebar"}),e[0]=a,e[1]=o):o=e[1];const l=o,d=n?.visible&&n.getTitlebarAreaRect().left>0?"justify-end":"justify-between";let u;e[2]!==d?(u=I("h-header-height flex items-center",d),e[2]=d,e[3]=u):u=e[3];let m;e[4]!==i?(m=t.jsx(Za,{onNewThread:i}),e[4]=i,e[5]=m):m=e[5];let c;e[6]!==r?(c=r&&t.jsx(Ta,{}),e[6]=r,e[7]=c):c=e[7];let f;e[8]!==l?(f=t.jsx(lt,{className:"no-draggable cursor-w-resize rtl:cursor-e-resize",color:"tertiary","aria-label":l,onClick:Xa,icon:ct,mobileIcon:ca,"data-testid":"close-sidebar-button"}),e[8]=l,e[9]=f):f=e[9];let h;e[10]!==l||e[11]!==f?(h=t.jsx(te,{label:l,triggerAs:null,children:f}),e[10]=l,e[11]=f,e[12]=h):h=e[12];let x;e[13]!==c||e[14]!==h?(x=t.jsxs("div",{className:"flex",children:[c,h]}),e[13]=c,e[14]=h,e[15]=x):x=e[15];let g;return e[16]!==u||e[17]!==m||e[18]!==x?(g=t.jsxs("div",{id:"sidebar-header",className:u,children:[m,x]}),e[16]=u,e[17]=m,e[18]=x,e[19]=g):g=e[19],g}function Xa(){ye.setSidebarOpen(!1)}function Ja(){return navigator.windowControlsOverlay}function Za({onNewThread:s,testId:e}){const i=X();return t.jsx(lt,{onClick:a=>{const n=a.currentTarget.closest("nav");if(n&&n.scrollTop>0){n.scrollTo({top:0,behavior:"smooth"}),a.preventDefault();return}nt(a,s)},icon:dt,iconClassName:"icon-lg",color:"primary","aria-label":i.formatMessage({id:"H6SRdK",defaultMessage:"Home"}),"data-testid":e,as:"link"})}const en=()=>{const s=Te();return t.jsxs("div",{className:"flex h-full flex-col gap-2 p-3",children:[t.jsx(Ya,{onNewThread:()=>{is(s)}}),t.jsx(tn,{}),t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(rs,{})})]})},Tt="border border-token-border-xlight bg-token-sidebar-surface-secondary";function Q({className:s,width:e}){return t.jsx("div",{className:I("h-2.5 grow rounded-sm",Tt,s),style:{maxWidth:e+"px"}})}function tn(){const s=t.jsx("div",{className:I("h-4 w-4 shrink-0 grow-0 rounded-full",Tt)});return t.jsxs("div",{className:"mt-2 flex w-full grow flex-col gap-4 overflow-hidden px-2",style:{maskImage:"linear-gradient(to bottom, black 50%, transparent 100%)",WebkitMaskImage:"linear-gradient(to bottom, black 50%, transparent 100%)"},children:[t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:80})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:120})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:100})]}),t.jsx("div",{className:"mt-5 flex flex-row items-center justify-start gap-3",children:t.jsx(Q,{width:150})}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:50})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:100})]}),t.jsxs("div",{className:"mb-5 flex flex-row items-center justify-start gap-3",children:[s,t.jsx(Q,{width:80})]}),[120,180,160,100,90,190,140,120,180,170,100,120,180,150].map((e,i)=>t.jsx("div",{className:"flex flex-row items-center justify-start py-1",children:t.jsx(Q,{width:e})},i))]})}function sn(s){"use forget";const e=C.c(49);let i,a,n;e[0]!==s?({onOpen:a,className:i,...n}=s,e[0]=s,e[1]=i,e[2]=a,e[3]=n):(i=e[1],a=e[2],n=e[3]);const r=Te(),o=X(),l=xe(),d=an;let u;e[4]!==i?(u=I("group/tiny-bar flex h-full w-(--sidebar-rail-width) cursor-e-resize flex-col items-start bg-transparent motion-safe:transition-colors rtl:cursor-w-resize",i),e[4]=i,e[5]=u):u=e[5];let m;e[6]!==o?(m=o.formatMessage({id:"GpHrv5",defaultMessage:"Open sidebar"}),e[6]=o,e[7]=m):m=e[7];let c;e[8]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsxs(t.Fragment,{children:[t.jsx(dt,{className:"icon-lg -m-1 group-hover/tiny-bar:hidden group-focus-visible:hidden"}),t.jsx(ct,{className:"icon hidden group-hover/tiny-bar:block group-focus-visible:block"})]}),e[8]=c):c=e[8];let f;e[9]!==o?(f=o.formatMessage({id:"IaY18K",defaultMessage:"Open sidebar"}),e[9]=o,e[10]=f):f=e[10];let h;e[11]!==f?(h=t.jsx(ot,{as:"button",className:"cursor-e-resize rtl:cursor-w-resize",icon:c,"aria-label":f,"aria-expanded":!1,"aria-controls":"stage-slideover-sidebar",iconOnly:!0,fillContainer:!0}),e[11]=f,e[12]=h):h=e[12];let x;e[13]!==m||e[14]!==h?(x=t.jsx("div",{className:"h-header-height flex items-center justify-center",children:t.jsx(te,{label:m,side:"right",triggerAs:null,sideOffset:14,children:h})}),e[13]=m,e[14]=h,e[15]=x):x=e[15];let g;e[16]!==o?(g=o.formatMessage({id:"6Abeg/",defaultMessage:"New chat"}),e[16]=o,e[17]=g):g=e[17];let j;e[18]===Symbol.for("react.memo_cache_sentinel")?(j=_t(!0),e[18]=j):j=e[18];let b;e[19]!==r?(b=t.jsx(kt,{iconOnly:!0,onNewThread:()=>os(r),onClickComplete:d}),e[19]=r,e[20]=b):b=e[20];let S;e[21]!==g||e[22]!==b?(S=t.jsx(te,{label:g,secondaryLabel:j,side:"right",labelOrientation:"horizontal",triggerAs:"div",children:b}),e[21]=g,e[22]=b,e[23]=S):S=e[23];let N;e[24]!==o?(N=o.formatMessage({id:"VUMlGk",defaultMessage:"Search chats"}),e[24]=o,e[25]=N):N=e[25];let k;e[26]===Symbol.for("react.memo_cache_sentinel")?(k=Ct(!0),e[26]=k):k=e[26];let y;e[27]===Symbol.for("react.memo_cache_sentinel")?(y=t.jsx(Mt,{iconOnly:!0,onClickComplete:d}),e[27]=y):y=e[27];let _;e[28]!==N?(_=t.jsx(te,{label:N,secondaryLabel:k,side:"right",labelOrientation:"horizontal",triggerAs:"div",children:y}),e[28]=N,e[29]=_):_=e[29];let M;e[30]!==l||e[31]!==o?(M=null,e[30]=l,e[31]=o,e[32]=M):M=e[32];let v;e[33]!==o?(v=o.formatMessage({id:"JBxuOc",defaultMessage:"Library"}),e[33]=o,e[34]=v):v=e[34];let R;e[35]===Symbol.for("react.memo_cache_sentinel")?(R=t.jsx(at,{iconOnly:!0,onClickComplete:d}),e[35]=R):R=e[35];let B;e[36]!==v?(B=t.jsx(te,{label:v,side:"right",triggerAs:"div",children:R}),e[36]=v,e[37]=B):B=e[37];let E;e[38]!==S||e[39]!==_||e[40]!==M||e[41]!==B?(E=t.jsxs("div",{className:"mt-(--sidebar-section-first-margin-top)",children:[S,_,M,B]}),e[38]=S,e[39]=_,e[40]=M,e[41]=B,e[42]=E):E=e[42];let z;return e[43]!==a||e[44]!==n||e[45]!==u||e[46]!==E||e[47]!==x?(z=t.jsxs("div",{className:u,onClick:a,...n,children:[x,E]}),e[43]=a,e[44]=n,e[45]=u,e[46]=E,e[47]=x,e[48]=z):z=e[48],z}function an(s){s.stopPropagation()}function qn(s){"use forget";const e=C.c(10);let i,a,n;e[0]!==s?({onClick:a,className:i,...n}=s,e[0]=s,e[1]=i,e[2]=a,e[3]=n):(i=e[1],a=e[2],n=e[3]);let r;e[4]!==i?(r=I(i,"grow overflow-hidden"),e[4]=i,e[5]=r):r=e[5];let o;return e[6]!==a||e[7]!==n||e[8]!==r?(o=t.jsx(cs,{onClick:a,className:r,...n}),e[6]=a,e[7]=n,e[8]=r,e[9]=o):o=e[9],o}function Qn(s){"use forget";const e=C.c(2),{onNewChatButtonClick:i}=s,{isUnauthenticated:a,isLoading:n}=De();if(n||!a)return null;let r;return e[0]!==i?(r=t.jsx(yt,{className:"me-3",onClick:()=>{K.logNewChatButtonClicked({location:"Mobile header"}),i()}}),e[0]=i,e[1]=r):r=e[1],r}function Yn(s){"use forget";const e=C.c(9),{onNewChatButtonClick:i,clientThreadId:a}=s,{isUnauthenticated:n,isLoading:r}=De(),o=ls(),l=gt(a),d=He(a,pt.getIsNewConversation),u=da(),m=d&&u&&!n&&!l,c=xe();let f;e[0]!==c?(f=ua(c,"3687420405").get("enable_sticky_signup_button",!1),e[0]=c,e[1]=f):f=e[1];const h=f;if(r)return null;if(n){let b;return e[2]!==o||e[3]!==h?(b=h?t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(Ye,{}),t.jsx(Qe,{})]}):o?t.jsx(Ye,{}):t.jsx(Qe,{}),e[2]=o,e[3]=h,e[4]=b):b=e[4],b}let x;e[5]!==i?(x=t.jsx(yt,{onClick:()=>{K.logNewChatButtonClicked({location:"Mobile header"}),i()}}),e[5]=i,e[6]=x):x=e[6];const g=x;if(!m)return g;let j;return e[7]!==a?(j=t.jsx(ds,{variant:"secondary",clientThreadId:a}),e[7]=a,e[8]=j):j=e[8],j}function Qe(){"use forget";const s=C.c(8),e=ut();let i;s[0]===Symbol.for("react.memo_cache_sentinel")?(i={id:"navigation.signUpButtonText",defaultMessage:"Sign up",description:"Button text for Sign up button"},s[0]=i):i=s[0];const a=us(i);let n;s[1]!==e?(n=()=>{e({authType:"signup",callback:nn})},s[1]=e,s[2]=n):n=s[2];let r;s[3]!==a?(r=t.jsx(w,{...a}),s[3]=a,s[4]=r):r=s[4];let o;return s[5]!==n||s[6]!==r?(o=t.jsx(he,{as:"button",size:"small",color:"primary",onClick:n,children:r}),s[5]=n,s[6]=r,s[7]=o):o=s[7],o}function nn(s){K.logSignUpButtonClicked({location:"Mobile Chat Stage Header",provider:s})}function Ye(){"use forget";const s=C.c(5),e=ut();let i;s[0]!==e?(i=()=>{e({authType:"login",callback:rn})},s[0]=e,s[1]=i):i=s[1];let a;s[2]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(w,{...fa.logInButtonText}),s[2]=a):a=s[2];let n;return s[3]!==i?(n=t.jsx(he,{as:"button",size:"small",color:"primary",onClick:i,"data-testid":"mobile-login-button",children:a}),s[3]=i,s[4]=n):n=s[4],n}function rn(s){K.logLogInButtonClicked({location:"Mobile Chat Stage Header",provider:s})}function on(s){"use forget";const e=C.c(6),{onClick:i}=s,a=Ia(xs,hs,!0,!0);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx("span",{className:"sr-only",children:t.jsx(w,{id:"navigation.openSidebar",defaultMessage:"Open sidebar"})}),e[0]=n):n=e[0];let r;e[1]!==a?(r=t.jsx(a,{className:"icon-lg text-token-text-secondary mx-2"}),e[1]=a,e[2]=r):r=e[2];let o;return e[3]!==i||e[4]!==r?(o=t.jsxs("button",{type:"button",className:"hover:text-token-text-primary touch:h-10 touch:w-10 inline-flex h-9 w-9 items-center justify-center rounded-md focus:ring-2 focus:ring-white focus:outline-hidden focus:ring-inset active:opacity-50",onClick:i,"data-testid":"open-sidebar-button",children:[n,r]}),e[3]=i,e[4]=r,e[5]=o):o=e[5],o}const ln=s=>{"use forget";const e=C.c(21),{rightContentExpanded:i,onOpenSidebar:a,children:n,showNavSidebar:r,leftContent:o,rightContent:l,bottomContent:d}=s,m=ze(fn)?"[box-shadow:var(--sharp-edge-top-shadow)]":"[box-shadow:var(--sharp-edge-top-shadow-placeholder)]";let c;e[0]!==m?(c=I("draggable h-header-height bg-token-bg-primary sticky top-0 z-10 flex items-center justify-center border-transparent ps-0 md:hidden",m),e[0]=m,e[1]=c):c=e[1];let f;e[2]!==o||e[3]!==a||e[4]!==r?(f=(r||o)&&t.jsxs("div",{className:"no-draggable absolute start-0 top-0 bottom-0 ms-2 inline-flex items-center justify-center",children:[r&&t.jsx(on,{onClick:a}),o]}),e[2]=o,e[3]=a,e[4]=r,e[5]=f):f=e[5];let h;e[6]!==n?(h=t.jsx("div",{className:"no-draggable",children:n}),e[6]=n,e[7]=h):h=e[7];let x;e[8]!==l||e[9]!==i?(x=l&&t.jsx("div",{className:I("no-draggable absolute end-0 top-0 bottom-0 me-2 inline-flex items-center justify-center",i&&"start-10"),children:l}),e[8]=l,e[9]=i,e[10]=x):x=e[10];let g;e[11]!==c||e[12]!==f||e[13]!==h||e[14]!==x?(g=t.jsxs("div",{className:c,children:[f,h,x]}),e[11]=c,e[12]=f,e[13]=h,e[14]=x,e[15]=g):g=e[15];let j;e[16]!==d?(j=d&&t.jsx("div",{className:"no-draggable bg-token-bg-primary flex w-full items-center justify-center md:hidden",children:d}),e[16]=d,e[17]=j):j=e[17];let b;return e[18]!==g||e[19]!==j?(b=t.jsxs(t.Fragment,{children:[g,j]}),e[18]=g,e[19]=j,e[20]=b):b=e[20],b};function cn(s){"use forget";const e=C.c(3),{isPopover:i,children:a}=s,n=i===void 0?!1:i;L.markStart("StageNavigationSidebar"),L.markRendered("StageNavigationSidebar");let r;return e[0]!==a||e[1]!==n?(r=n?t.jsx(un,{children:a}):t.jsx(dn,{children:a}),e[0]=a,e[1]=n,e[2]=r):r=e[2],r}const It={type:"spring",bounce:.1,duration:.35},Xe={...It,duration:.4},dn=s=>{"use forget";const e=C.c(21),{style:i,children:a}=s;L.trackNamespace(L.NS_SIDEBAR);const n=fs(),r=Pe(),o=Le(),l=o==="none"&&"bg-token-bg-elevated-secondary";let d;e[0]!==l?(d=I("border-token-border-light z-21 h-full shrink-0 overflow-hidden border-e max-md:hidden dark:border-[#00000030]",l),e[0]=l,e[1]=d):d=e[1];const u=n?ms:It;let m;e[2]!==o?(m=o==="none"?{width:0}:!1,e[2]=o,e[3]=m):m=e[3];let c;e[4]!==r||e[5]!==o?(c=o==="none"?{width:260}:{width:r?"var(--sidebar-width)":"var(--sidebar-rail-width)",backgroundColor:r?"var(--bg-elevated-secondary)":"var(--bg-primary)"},e[4]=r,e[5]=o,e[6]=c):c=e[6];let f;e[7]!==o?(f=o==="none"?{width:0}:void 0,e[7]=o,e[8]=f):f=e[8];let h;e[9]!==a||e[10]!==r||e[11]!==o?(h=o==="none"?t.jsx("div",{className:"flex h-full w-[var(--sidebar-width)] flex-col",children:a}):t.jsxs("div",{className:"relative flex h-full flex-col",children:[t.jsx(Me.Provider,{value:"tiny_bar",children:t.jsx(sn,{className:I("absolute inset-0",r?"pointer-events-none opacity-0":"opacity-100",r?"motion-safe:[transition-timing-function:steps(1,end)]":"motion-safe:[transition-timing-function:steps(1,start)]","motion-safe:transition-opacity motion-safe:duration-150"),inert:r,onOpen:mn})}),t.jsx(Me.Provider,{value:"expanded_sidebar",children:t.jsx("div",{className:I(r?"opacity-100":"pointer-events-none opacity-0","motion-safe:transition-opacity motion-safe:duration-150 motion-safe:ease-linear","bg-token-bg-elevated-secondary h-full w-[var(--sidebar-width)] overflow-x-clip overflow-y-auto text-clip whitespace-nowrap"),inert:!r,children:a})})]}),e[9]=a,e[10]=r,e[11]=o,e[12]=h):h=e[12];let x;return e[13]!==i||e[14]!==d||e[15]!==u||e[16]!==m||e[17]!==c||e[18]!==f||e[19]!==h?(x=t.jsx(Y.div,{className:d,transition:u,initial:m,animate:c,exit:f,style:i,id:"stage-slideover-sidebar",children:h}),e[13]=i,e[14]=d,e[15]=u,e[16]=m,e[17]=c,e[18]=f,e[19]=h,e[20]=x):x=e[20],x},un=s=>{"use forget";const e=C.c(11),{children:i}=s,a=ze(hn);let n;e[0]!==a?(n=a&&t.jsx(ma,{asChild:!0,children:t.jsx(Y.div,{className:"fixed inset-0 z-10 bg-gray-50/50 dark:bg-black/50",transition:Xe,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.12}}})}),e[0]=a,e[1]=n):n=e[1];let r;e[2]!==i||e[3]!==a?(r=a&&t.jsx(ha,{asChild:!0,onOpenAutoFocus:gn,children:t.jsxs(Y.div,{className:"bg-token-sidebar-surface-primary top-banner-visible:bottom-0 top-banner-visible:top-(--top-banner-height,0px) top-banner-visible:h-auto fixed start-0 top-0 z-50 h-full w-[var(--sidebar-width)] max-w-xs border-e border-gray-200 shadow-[0_0_64px_0_rgba(0,0,0,0.07)] [view-transition-name:var(--sidebar-popover)] focus:outline-hidden dark:border-gray-800",transition:Xe,initial:{translateX:"-100%"},animate:{translateX:"0"},exit:{translateX:"-100%",transition:{duration:.12}},children:[t.jsx(xa,{asChild:!0,children:t.jsxs(ga,{children:[t.jsx(w,{id:"navigation.sidebarTitle",defaultMessage:"Sidebar"}),t.jsx(pa,{})]})}),t.jsx(Me.Provider,{value:"popover",children:i})]})}),e[2]=i,e[3]=a,e[4]=r):r=e[4];let o;e[5]!==n||e[6]!==r?(o=t.jsx(ba,{forceMount:!0,children:t.jsxs(Se,{children:[n,r]})}),e[5]=n,e[6]=r,e[7]=o):o=e[7];let l;return e[8]!==a||e[9]!==o?(l=t.jsx(ja,{open:a,onOpenChange:xn,children:o}),e[8]=a,e[9]=o,e[10]=l):l=e[10],l};function fn(s){return s.isConversationScrolledFromTop}function mn(){return ye.setSidebarOpen(!0)}function hn(s){return s.isPopoverSidebarOpen}function xn(s){ye.setPopoverSidebarOpen(s)}function gn(s){s.preventDefault()}function pn({children:s}){return t.jsx("div",{className:"bg-token-main-surface-primary h-full w-full px-[22px] py-4",children:s})}function bn(){return t.jsxs("div",{className:"flex w-full gap-2",children:[t.jsx("div",{className:"h-6 w-6",children:t.jsx(ge,{className:"h-full w-full rounded-full!"})}),t.jsxs("div",{className:"flex w-full flex-col gap-2",children:[t.jsx(ge,{}),t.jsx(ge,{}),t.jsx(ge,{}),t.jsx(ge,{})]})]})}function pe({icon:s,message:e,iconClassName:i}){return t.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:t.jsx(Ae,{fillIcon:!1,icon:s,className:i,children:t.jsx("div",{className:"mt-[.5px] flex h-10",children:e})})})}const jn=({finalRow:s})=>{const e=X(),i=s.type==="fileOpen"?gs[s.iconType]??ps:null;return t.jsx(Se,{children:t.jsx(Y.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:s.type==="search"?t.jsx(pe,{icon:t.jsx(it,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:e.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):s.type==="websiteOpen"?t.jsx(pe,{icon:t.jsx(bs,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):s.type==="fileOpen"?t.jsx(pe,{icon:t.jsx(i,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):s.type==="pythonAnalysis"?t.jsx(pe,{icon:t.jsx(js,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):t.jsx(pe,{icon:t.jsx(bt,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})};function be({children:s}){return t.jsx(Y.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:s})}const Sn=({previousRow:s,currentRow:e})=>t.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?t.jsx(be,{children:t.jsx(Ss,{row:e,showIcon:!s||s.type!=="search"})},`search_${e.id}`):e.type==="summary"?t.jsx(be,{children:t.jsx(vs,{row:e,showIcon:!s||s.type!=="summary"})},`summary_${e.id}`):e.type==="websiteOpen"?t.jsx(be,{children:t.jsx(ys,{website:e})},`website_${e.id}`):e.type==="fileOpen"?t.jsx(be,{children:t.jsx(ws,{row:e})},`file_${e.id}`):e.type==="pythonAnalysis"?t.jsx(be,{children:t.jsx(Ns,{row:e})},`python_${e.id}`):null}),vn=120,yn=1e3*60*2;function Je(s){s?.scrollIntoView({block:"center",behavior:"smooth"})}function wn({caterpillarStatusMessageTexts:s}){return t.jsx("div",{className:"p-4",children:t.jsx(mt,{type:"error",title:s.failureMessage,content:s.failureBannerContentMessage})})}function Nn({caterpillarStatusMessageTexts:s}){return t.jsx("div",{className:"p-4",children:t.jsx(mt,{title:s.cancelledMessage,content:""})})}function Cn({interruptPrompt:s,setInterruptPrompt:e,handleInterruptCaterpillar:i}){const a=X();return t.jsxs("div",{className:"flex w-full flex-col justify-center gap-4 p-4",children:[t.jsx(Ms,{ariaLabel:a.formatMessage({id:"aYWRtV",defaultMessage:"Press enter to interrupt task"}),name:"interrupt-caterpillar-prompt",value:s,onChange:n=>e(n.target.value),color:"search",onPressEnter:i}),t.jsx(he,{onClick:i,children:t.jsx(w,{id:"h73FdF",defaultMessage:"Interrupt task"})})]})}function _n({sourcesCount:s,taskInfo:e}){const i=He(e.originalConversationId,n=>pt.findNode(n,r=>r.message.metadata?.b1de6e2_s===!0&&r.message.metadata?.async_task_id===e.taskId)?.message.metadata?.async_task_status_messages),a=p.useMemo(()=>i?.completed_no_time?t.jsxs(t.Fragment,{children:[i?.completed_with_time??i?.completed_no_time,t.jsx(w,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:s}})]}):t.jsx(w,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:s}}),[s,i]);return!e.updatedAt&&!i?.completed?null:t.jsx(Ae,{icon:t.jsx(Ts,{className:"text-token-text-secondary"}),fillIcon:!1,children:t.jsx("div",{className:"text-token-text-tertiary",children:a})})}function kn({taskInfo:s,caterpillarStatusMessageTexts:e,sourcesCount:i,caterpillarHeaderRef:a}){const[n,r]=p.useState(""),[o,l]=p.useState(!1),d=Sa("caterpillar-interrupts"),u=p.useRef(!1),m=p.useRef(null),c=p.useMemo(()=>(u.current=!!m.current&&Cs(m.current,vn),s.rows??[]),[s.rows]);p.useEffect(()=>{if(c.length===0){const j=new Date(s.createdAt).getTime(),b=Date.now()-j,S=yn-b;if(S>0){const N=setTimeout(()=>{l(!0)},S);return()=>clearTimeout(N)}else l(!0)}else l(!1)},[c,s.createdAt]),p.useEffect(()=>{u.current&&Je(m.current)},[c]),p.useEffect(()=>{Ge(s)||setTimeout(()=>{m.current&&Je(m.current)},100)},[]);const f=_s({taskId:s.taskId,prompt:n}),h=Ge(s)||ks(s),x=p.useCallback(async()=>{await f.mutateAsync(),r("")},[f,r]),g=p.useMemo(()=>c.length?h?c:c.slice(0,c.length-1):c,[c,h]);return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:a},"task-header"),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[t.jsx("div",{className:"text-base font-medium",children:s.title}),c.length?t.jsxs(Se,{initial:!1,children:[g.map((j,b)=>t.jsx(Sn,{previousRow:b>0?c[b-1]:null,currentRow:j},j.id)),!h&&t.jsx(jn,{finalRow:c[c.length-1]})]}):o?t.jsx(Ae,{fillIcon:!1,icon:t.jsx(bt,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:e.waitingInQueueMessage}):t.jsx(bn,{}),ft(s)&&d&&t.jsx(Cn,{interruptPrompt:n,setInterruptPrompt:r,handleInterruptCaterpillar:x}),s.status==="failed"?t.jsx(wn,{caterpillarStatusMessageTexts:e}):s.status==="cancelled"?t.jsx(Nn,{caterpillarStatusMessageTexts:e}):s.status==="completed"?t.jsx(_n,{caterpillarStatusMessageTexts:e,taskInfo:s,sourcesCount:i}):null]}),t.jsx("div",{ref:m},"task-footer")]})}function Mn({taskId:s,setWidth:e=void 0,initialTab:i}){const a=Is(f=>Es.getTask(s,f)),{closeThreadSidebar:n}=jt(),[r,o]=p.useState(i),l=Os(),d=p.useRef(null),u=!1;p.useEffect(()=>{o(i)},[i]),p.useEffect(()=>{},[a?.taskId,a?.status,u]),p.useEffect(()=>{},[a?.taskId,a?.status,r]),p.useEffect(()=>{},[e,a,u]);const{uniqueSources:m,totalSources:c}=p.useMemo(()=>{if(!a?.rows)return{uniqueSources:[],totalSources:0};const f=Rs(a.rows),h=f.reduce((x,g)=>x+g.count,0);return{uniqueSources:f,totalSources:h}},[a?.rows]);return t.jsx(ht,{handleClose:n,leading:t.jsx("div",{className:"flex w-full justify-center",children:t.jsx(Ps,{activeTab:r,setActiveTab:o,showAuxTab:u,sourcesCount:c,caterpillarHeaderRef:d})}),children:a&&t.jsxs(pn,{children:[!1,r==="activity"&&t.jsx(kn,{taskInfo:a,caterpillarStatusMessageTexts:l,sourcesCount:c,caterpillarHeaderRef:d}),r==="sources"&&t.jsx(Bs,{taskIsPending:ft(a),finalMessage:a.finalMessage,sources:m,caterpillarHeaderRef:d})]})})}const Ze=3;function Tn({product:s,descriptionCitation:e,clientThreadId:i,messageId:a,contentReferenceStartIndex:n,productIndex:r,analyticsMetadata:o,offsetTopMargin:l=!1}){const d=xe(),u=St(d,"3381490948"),[m,c]=p.useState({}),[f,h]=p.useState(void 0),x=p.useRef([]),g=p.useRef([]),j=f?.product.offers??s.offers??[];for(const v of j)x.current.some(R=>R.merchant_name===v.merchant_name)||x.current.push(v);const b=f?.product.image_urls??s.image_urls??[];for(const v of b)g.current.includes(v)||g.current.push(v);const S=Ls(o),N=zs.useStore(),k=null,{numReviews:y,rating:_,ratingGroupedCitation:M}=p.useMemo(()=>{const v=f?.product??s;return{numReviews:v.num_reviews,rating:v.rating,ratingGroupedCitation:v.rating_grouped_citation}},[s,f]);return t.jsxs("div",{className:I("bg-token-bg-primary flex w-full flex-col",l?"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] min-h-screen":"mt-0"),children:[t.jsx(In,{imageUrls:g.current,title:s.title,onImageClick:v=>{N.setCurrentImage({image:{url:v,content_url:v,thumbnail_url:v,title:s.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:As.ProductDetails,analyticsMetadata:o,contentReferenceStartIndex:n,productIndex:r})}}),t.jsxs("div",{className:"border-token-border-light flex flex-col border-t px-6 py-4",children:[t.jsx("div",{className:"text-token-text-primary text-xl font-semibold",children:s.title}),y&&y>0&&_&&t.jsx(En,{rating:_,numReviews:y,ratingGroupedCitation:M,trackContentReferenceEvent:S,analyticsMetadata:o}),!1,s.description&&t.jsxs("div",{className:"pt-3 text-sm",children:[s.description,e&&t.jsx(Nt,{webpageItem:e,trackContentReferenceEvent:S,analyticsMetadata:{section:"products",section_location:"sidebar"}})]})]}),t.jsx(On,{offers:x.current,analyticsMetadata:o,contentReferenceStartIndex:n,productIndex:r,product:s,sCKStore:k,imageUrls:g.current}),u&&t.jsx(Ba,{clientThreadId:i,messageId:a,product:s,trackContentReferenceEvent:S,onProductEntityUpdated:v=>{h(v)}})]})}function In({imageUrls:s,title:e,onImageClick:i}){const[a,n]=p.useState(0),r=p.useRef(null);return s?t.jsxs("div",{className:"flex flex-col",children:[s[a]&&t.jsx(Y.div,{className:"bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse",drag:"x",dragConstraints:{left:0,right:0},dragElastic:0,onDragEnd:(o,{offset:l,velocity:d})=>{const u=Math.abs(l.x)*d.x;u<-1e3?a<s.length-1&&n(a+1):u>1e3&&a>0&&n(a-1)},onClick:()=>i(s[a]),children:t.jsx("img",{className:"m-0 aspect-square w-full object-contain mix-blend-darken",src:s[a],alt:e,draggable:!1})}),s.length>1&&t.jsx("div",{ref:r,className:"no-scrollbar flex flex-row gap-2.5 overflow-x-scroll px-6 py-3",children:s.map((o,l)=>t.jsx("div",{className:I("flex-none cursor-pointer overflow-hidden rounded-md border-2 p-0.5",a===l?"border-token-text-primary":"border-transparent"),onMouseEnter:()=>n(l),onClick:()=>i(o),children:t.jsx("div",{className:"bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse",children:t.jsx("img",{className:"h-10 w-10 rounded-xs object-cover mix-blend-darken",src:o,alt:e})})},`${l}-${o}`))})]}):null}function En({rating:s,numReviews:e,ratingGroupedCitation:i,trackContentReferenceEvent:a,analyticsMetadata:n}){return t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("div",{className:"text-token-text-secondary flex flex-row items-center gap-1 text-sm text-nowrap text-ellipsis",children:[t.jsx(Fs,{rating:s??0}),t.jsx(w,{id:"Tj10jZ",defaultMessage:"{rating} ({num_reviews})",values:{rating:(s??0).toFixed(1),num_reviews:new Intl.NumberFormat().format(e)}}),t.jsx(te,{label:t.jsx(w,{id:"zngDZ6",defaultMessage:"Ratings and pricing are sourced from third parties which may update over time"}),children:t.jsx(xt,{className:"h-4 w-4"})})]}),i&&t.jsx(Nt,{webpageItem:i,trackContentReferenceEvent:a,analyticsMetadata:{...n,section:"products",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0})]})}function On({offers:s,analyticsMetadata:e,contentReferenceStartIndex:i,productIndex:a,product:n,sCKStore:r,imageUrls:o}){const l=xe(),d=St(l,"3375735072"),[u,m]=p.useState(!1);return t.jsxs("div",{className:"-mx-3 flex flex-col px-6 pb-3",children:[s.slice(0,u?s.length:Ze).map((c,f)=>t.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:t.jsx(Rn,{offer:c,isSCKEnabled:d,onBuyClick:h=>{h.stopPropagation()},onMerchantClick:()=>{K.logEventWithStatsig("Product Offer Clicked","product_offer_clicked",{...va(e),content_reference_start_index:i,product_index:a,offer_index:f,product_id:n.id,offer_url:c.url,checkout_url:c.checkout_url,offers_count:s.length}),window.open(c.checkout_url||c.url,"_blank")}},c.url)},c.url)),s.length>Ze&&t.jsxs(he,{className:"w-fit px-3",size:"small",color:"ghost",onClick:()=>m(!u),children:[u?t.jsx(w,{id:"Gl3oLS",defaultMessage:"See less"}):t.jsx(w,{id:"f9tOaY",defaultMessage:"See more"}),u?t.jsx(Ds,{}):t.jsx(Hs,{})]})]})}function Rn({offer:s,onMerchantClick:e,onBuyClick:i,isSCKEnabled:a}){const n=s.price_details,r=n?.base&&(n.shipping??n.tax)&&n.total,o=n?.display_price==="total_price"||r,l=n?.display_price==="total_price";let d=null;return r&&n?d=t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.base",defaultMessage:"Base price: {amount}",values:{amount:n.base}})}),n.shipping&&t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.shipping",defaultMessage:"Shipping: {amount}",values:{amount:n.shipping}})}),n.tax&&t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.tax",defaultMessage:"Tax: {amount}",values:{amount:n.tax}})})]}):l&&(d=t.jsx(w,{id:"ur3//V",defaultMessage:"Prices shown include estimated tax and shipping."})),t.jsxs("div",{className:I("flex cursor-pointer flex-col rounded-xl p-3","hover:bg-token-bg-tertiary"),onClick:e,children:[t.jsxs("div",{className:"flex flex-row items-center gap-2 text-sm font-semibold",children:[t.jsx(Gs,{className:"h-5 w-5 rounded-full",url:s.url,size:128,minSize:16,fallback:t.jsx($s,{className:"text-token-text-tertiary"})}),t.jsx("div",{className:"min-w-0 flex-1 truncate",children:s.merchant_name}),o&&d?t.jsx(te,{label:d,children:t.jsxs("span",{className:"flex items-center gap-0.5",children:[t.jsx("span",{children:s.price}),t.jsx(xt,{className:"text-token-text-secondary h-3 w-3"})]})}):t.jsx("span",{children:s.price}),t.jsx(he,{className:"w-fit min-w-20 truncate",size:"small",color:"secondary",children:t.jsx(w,{id:"sTpOJt",defaultMessage:"Buy"})})]}),t.jsx("div",{className:"text-token-text-secondary pt-2.5 text-xs",children:s.product_name}),t.jsx("div",{className:"text-token-text-secondary text-xs",children:s.details})]})}function Bn({clientThreadId:s,type:e="sidebar"}){const{closeThreadSidebar:i}=jt(),{clientThreadId:a,messageId:n,turnIndex:r,contentReferenceStartIndex:o,productIndex:l}=ya("product")??{},d=He(a,x=>x),u=p.useMemo(()=>({clientThreadId:s,messageId:n,turnIndex:r}),[s,n,r]);if(a!==s||o===void 0||l===void 0||!n)return null;const{product:m,descriptionCitation:c}=Us({thread:d,messageId:n,contentReferenceStartIndex:o,productIndex:l});if(!m)return null;const f=`${n}-${o}-${l}`,h=t.jsx(Tn,{product:m,descriptionCitation:c,clientThreadId:s,messageId:n,contentReferenceStartIndex:o,productIndex:l,analyticsMetadata:u,offsetTopMargin:e==="sidebar"});switch(e){case"sidebar":return t.jsx(ht,{handleClose:i,children:h},f);case"modal":return t.jsxs(wa,{testId:"modal-chat-screen-product-flyout",className:"relative max-w-md",size:"custom",type:"success",noPadding:!0,title:m.title,visuallyHiddenHeader:!0,isOpen:!0,onClose:i,children:[h,t.jsx(Na,{className:"absolute end-2.5 top-2.5 z-10",onClick:i})]},f)}}function Pn(s){"use forget";const e=C.c(22),{isExpanded:i,children:a}=s,n=p.useRef(null),[r,o]=p.useState("400px");let l;e[0]!==a?(l=je.isValidElement(a)?je.cloneElement(a,{setWidth:o}):a,e[0]=a,e[1]=l):l=e[1];const d=l,u=i?r:0;let m;e[2]===Symbol.for("react.memo_cache_sentinel")?(m={type:"spring",bounce:.12,duration:.3},e[2]=m):m=e[2];let c;e[3]!==u?(c={width:u,transition:m},e[3]=u,e[4]=c):c=e[4];let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{n.current&&(n.current.style.visibility="visible")},e[5]=f):f=e[5];let h;e[6]!==i?(h=()=>{n.current&&(i||(n.current.style.visibility="hidden"))},e[6]=i,e[7]=h):h=e[7];const x=!i&&"pointer-events-none";let g;e[8]!==x?(g=I("absolute h-full",x),e[8]=x,e[9]=g):g=e[9];let j;e[10]!==r?(j={width:r},e[10]=r,e[11]=j):j=e[11];let b;e[12]!==d?(b=t.jsx("div",{className:"flex h-full flex-col",children:d}),e[12]=d,e[13]=b):b=e[13];let S;e[14]!==b||e[15]!==g||e[16]!==j?(S=t.jsx("div",{className:g,style:j,children:b}),e[14]=b,e[15]=g,e[16]=j,e[17]=S):S=e[17];let N;return e[18]!==S||e[19]!==c||e[20]!==h?(N=t.jsx(Se,{children:t.jsx(Y.div,{className:"bg-token-sidebar-surface-primary relative z-1 shrink-0 overflow-x-hidden max-lg:w-0!",ref:n,initial:!1,animate:c,onAnimationStart:f,onAnimationComplete:h,children:S})}),e[18]=S,e[19]=c,e[20]=h,e[21]=N):N=e[21],N}const Xn=s=>{"use forget";const e=C.c(21),{setWidth:i,clientThreadId:a}=s,n=vt();if(!n)return null;let r;e[0]!==n||e[1]!==a?(r=ee(n,"searchSources")&&t.jsx(Ws,{clientThreadId:a}),e[0]=n,e[1]=a,e[2]=r):r=e[2];let o;e[3]!==n||e[4]!==a?(o=ee(n,"retrievalResults")&&t.jsx(Vs,{clientThreadId:a}),e[3]=n,e[4]=a,e[5]=o):o=e[5];let l;e[6]!==n||e[7]!==a?(l=ee(n,"summarizer")&&t.jsx(Ks,{clientThreadId:a}),e[6]=n,e[7]=a,e[8]=l):l=e[8];let d;e[9]!==n||e[10]!==i?(d=ee(n,"caterpillar")&&t.jsx(Mn,{taskId:n.caterpillarId,initialTab:n.initialTab,setWidth:i}),e[9]=n,e[10]=i,e[11]=d):d=e[11];let u;e[12]!==n||e[13]!==a?(u=ee(n,"product")&&t.jsx(Bn,{clientThreadId:a}),e[12]=n,e[13]=a,e[14]=u):u=e[14];let m;return e[15]!==r||e[16]!==o||e[17]!==l||e[18]!==d||e[19]!==u?(m=t.jsxs(t.Fragment,{children:[r,o,l,d,u]}),e[15]=r,e[16]=o,e[17]=l,e[18]=d,e[19]=u,e[20]=m):m=e[20],m};function Et(s){"use forget";const e=C.c(42),{children:i,hideNavigation:a,mobileHeaderContent:n,mobileHeaderRightContentExpanded:r,mobileHeaderLeftContent:o,mobileHeaderRightContent:l,mobileHeaderBottomContent:d,renderNavSidebar:u,threadFlyout:m,forceOpenDesktopSidebar:c}=s,f=a===void 0?!1:a,h=c===void 0?!1:c,{isUnauthenticated:x}=De(),g=ze(zn),j=Ca(),b=qs(),S=vt(),N=Pe();let k,y;e[0]!==i?(k=[],y=null,je.Children.forEach(i,H=>{je.isValidElement(H)&&(H.type===Et.Sidebars?y=H:k.push(H))}),e[0]=i,e[1]=k,e[2]=y):(k=e[1],y=e[2]);const _=!x&&!f&&u!=null,M=!f&&(_||x);let v;e[3]!==S?(v=S?ee(S,"summarizer"):!1,e[3]=S,e[4]=v):v=e[4];const R=v,B=S?!ee(S,"summarizer"):!1,E=j&&(R||B),z=Le(),G=_&&(b||h||N||z!=="none");let V;e[5]===Symbol.for("react.memo_cache_sentinel")?(V=t.jsx(se,{children:t.jsx(Qs,{})}),e[5]=V):V=e[5];const q=g!=="popover-nav"&&"z-0";let T;e[6]!==q?(T=I("relative flex h-full w-full flex-1 transition-colors",q),e[6]=q,e[7]=T):T=e[7];let J;e[8]!==b||e[9]!==x||e[10]!==u||e[11]!==G?(J=G&&t.jsx(cn,{isPopover:b,children:x?t.jsx(en,{}):u?.()}),e[8]=b,e[9]=x,e[10]=u,e[11]=G,e[12]=J):J=e[12];let Z;e[13]!==J?(Z=t.jsx(Se,{initial:!1,children:J}),e[13]=J,e[14]=Z):Z=e[14];let $;e[15]!==d||e[16]!==n||e[17]!==r||e[18]!==o||e[19]!==l||e[20]!==M||e[21]!==_?($=M&&t.jsxs(se,{children:[t.jsx(Ys,{}),t.jsx(ln,{rightContentExpanded:r,onOpenSidebar:Ln,showNavSidebar:_,leftContent:o,rightContent:l,bottomContent:d,children:n})]}),e[15]=d,e[16]=n,e[17]=r,e[18]=o,e[19]=l,e[20]=M,e[21]=_,e[22]=$):$=e[22];let A;e[23]!==k?(A=t.jsx("main",{className:"transition-width relative h-full w-full flex-1 overflow-auto",id:"main","z-index":"-1",children:k}),e[23]=k,e[24]=A):A=e[24];let U;e[25]!==A||e[26]!==$?(U=t.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[$,A]}),e[25]=A,e[26]=$,e[27]=U):U=e[27];let F;e[28]!==U||e[29]!==Z?(F=t.jsxs("div",{className:"relative flex h-full w-full flex-row",children:[Z,U]}),e[28]=U,e[29]=Z,e[30]=F):F=e[30];let W;e[31]!==E||e[32]!==m?(W=t.jsx(se,{children:t.jsx(Pn,{isExpanded:E,children:m})}),e[31]=E,e[32]=m,e[33]=W):W=e[33];let D;e[34]!==y||e[35]!==F||e[36]!==W||e[37]!==T?(D=t.jsxs("div",{className:T,children:[F,W,y]}),e[34]=y,e[35]=F,e[36]=W,e[37]=T,e[38]=D):D=e[38];let O;e[39]===Symbol.for("react.memo_cache_sentinel")?(O=t.jsx(se,{children:t.jsx(Xs,{useManuallyControlledVisibility:!0})}),e[39]=O):O=e[39];let ae;return e[40]!==D?(ae=t.jsxs("div",{className:"flex h-full w-full flex-col",children:[V,D,O]}),e[40]=D,e[41]=ae):ae=e[41],ae}function Ln(){return ye.setSidebarOpen(!0)}function zn(s){return s.activeSidebar}function An(s){"use forget";const e=C.c(2),{children:i}=s;let a;return e[0]!==i?(a=t.jsx(t.Fragment,{children:i}),e[0]=i,e[1]=a):a=e[1],a}Et.Sidebars=An;export{Kn as C,Xn as F,kt as N,Ha as P,Qa as S,Ya as a,Et as b,Yn as c,Qn as d,qn as e};
//# sourceMappingURL=otl51en3t0ec5n7s.js.map
