import{r as c,j as e,ak as pe,an as $e,ao as ge,ap as qe,al as he,a5 as _,i as Me,e as Ne,a6 as z,M as Je}from"./b8ijctzpgh0s7wpx.js";import{c as Ke,a as Qe,s as et,g as tt,b as ot,d as st,P as ee,T as be}from"./lmplvejuyg12irwe.js";import{bh as nt,ah as at,c as B,u as rt,z as Ie,ak as it,h1 as ae,aD as lt}from"./citrwydz0bgriwlc.js";import{g as ct,u as ye,D as dt}from"./5l7gzqkfu3rktsj8.js";import{b as ut,T as mt,a as ft,c as L,A as Ee,u as pt,i as gt,C as ht,g as xe}from"./irlq60m937fn2zd9.js";import{c as bt}from"./by50z05oxjtbvc0n.js";import{M as Et,d as xt,e as Te,h as Tt,C as te}from"./grmx1v2b0e1c1pfw.js";import{k as ie,l as vt,m as Pe,i as G}from"./eqsdgkbw87fpj3r7.js";import{T as ve,Z as Ct,C as At}from"./jy1u8exw8iz2slve.js";import{a7 as je,jA as _e,eE as Rt,jr as w,mn as wt,og as Ot,g as St,js as j,g5 as Mt,eP as Nt,jX as It,dq as yt,jB as Pt}from"./krbmwir12ubt4od1.js";import{u as Ce}from"./lygl0b4m7kuziox8.js";import{t as jt,B as _t,I as kt}from"./nocn237nvwexmsr4.js";import{H as Lt,P as Bt}from"./iibbvizt2zwon2cy.js";import{D as Ht,S as Dt,a as Vt}from"./noq8k3whf0dyc5h2.js";import{s as ke,T as Wt}from"./k1h56nx2kjoqc52m.js";import"./djd85tifm57yisqi.js";import"./f76gy0b8ieo4s693.js";import"./pc2givv05uuq8g6l.js";import"./etmxhiuvgu79utu0.js";import"./kwgbehxqut2f64bk.js";import"./ftxrqc0rwihsh5tn.js";import"./h6aag2lelyp3pu40.js";import"./j2zbz2jpl151yhf4.js";import"./eq7m7kpdgo83dcz8.js";import"./m4qet7ipn6ha09it.js";import"./hbpbckirom363mgh.js";import"./gbxx25eoj7wtyna0.js";import"./bzsolvz1ulyrc61b.js";import"./fl25v7yedm9z0cyb.js";import"./n4e94a1v0wut7i04.js";function Ft(t,o){c.useEffect(()=>{const n=t?.current;if(n!=null)return nt(n,{mousedown:d=>{o.current?.maybeFocusOnEditor(d)===!0&&d.preventDefault()}})},[o,t])}const Xt=({wrapperClassName:t,value:o="",width:n,comments:d,paddingBottom:h})=>{const l=c.useRef(null),a=c.useRef(null),r=at();return c.useEffect(()=>{const{current:p}=l;if(p)return a.current=Ke({mount:p,comments:d,value:o,isDarkMode:r}),()=>{a.current?.destroy()}},[]),c.useEffect(()=>{const p=Qe(o,d);a.current?.updateState(p)},[o,d]),e.jsx("div",{className:t,children:e.jsx("div",{ref:je(l),className:B(et.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:n,paddingBottom:h}})})},Le=t=>!t||"docView"in t&&t.docView==null||ut(t.state.doc),oe=100,Gt={type:"spring",duration:1.5,bounce:.1},zt={type:"spring",duration:.5,bounce:0},Ae={type:"spring",duration:.2},Re={type:"spring",duration:1,delay:.1},Ut={type:"spring",duration:1},Zt={type:"spring",duration:.5,bounce:0},Yt=({isRewriting:t=!1,value:o,previousValue:n,previousComments:d,documentWidth:h,paddingBottom:l,onStart:a})=>{const r=ie(),p=pe(0),u=pe(-100),T=c.useRef(!1),[m,b]=$e(),[{height:C},i]=_e(),E=Rt();rt(()=>{const s=r();return s&&(s.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const f=r();f&&(f.dom.style.clipPath="")}},[]),c.useEffect(()=>{const s=r();if(!s||Le(s))return m?void 0:b?.();try{const f=vt(s.state.doc)?.end;if(f==null||f>o.length)return;const{top:v}=s.coordsAtPos(0),{top:R,bottom:O}=s.coordsAtPos(Math.max(s.state.doc.content.size-1,0),-1),A=O-v,S=R-v;if(p.set(A-S),!m){ge(u,A+2*p.get(),zt).then(()=>b?.());return}ge(u,A,Gt)}catch(f){w.logError("Failed to set rewrite animation position",f),b?.()}},[m,o]);const g=qe(u,s=>wt(s)-oe+2);return he(u,"change",s=>{const f=r();!f||!s||!T.current||(f.dom.style.clipPath=`inset(0 0 calc(100% - ${s}px) 0)`)}),he(u,"animationStart",()=>{t&&a?.()}),e.jsxs(e.Fragment,{children:[E&&e.jsx(_.div,{style:{visibility:"hidden",pointerEvents:"none",height:C},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(_.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-10% to-transparent",style:{translateY:g,height:oe},initial:{opacity:0},animate:{opacity:1,transition:Ae},exit:{opacity:0,transition:Re},onAnimationComplete:()=>T.current=!0},"wash-top"),e.jsx(_.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full bg-linear-to-b to-transparent",style:{translateY:u,height:oe},initial:{opacity:0},animate:{opacity:1,transition:Ae},exit:{opacity:0,transition:Re}},"wash-bottom"),e.jsx(_.div,{ref:i,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:Ut},exit:{opacity:0,transition:Zt},children:e.jsx(Xt,{value:n,width:h,comments:d,wrapperClassName:"h-fit flex",paddingBottom:l})},"previousValue")]})},$t=t=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},c.createElement("path",{d:"M4.91463 13.3C4.2134 13.3 3.80005 12.874 3.80005 12.1394V3.8533C3.80005 3.12606 4.2134 2.70001 4.91463 2.70001H8.43555C10.4359 2.70001 11.6908 3.72108 11.6908 5.3445C11.6908 6.50515 10.8197 7.47479 9.69038 7.64375V7.70252C11.1372 7.8127 12.2 8.86315 12.2 10.2662C12.2 12.1321 10.7902 13.3 8.51674 13.3H4.91463ZM6.02923 7.1075H7.63098C8.81939 7.1075 9.49847 6.58595 9.49847 5.68976C9.49847 4.83764 8.90058 4.35282 7.8598 4.35282H6.02923V7.1075ZM6.02923 11.6472H7.94838C9.23274 11.6472 9.92662 11.1036 9.92662 10.0899C9.92662 9.09822 9.2106 8.56932 7.89671 8.56932H6.02923V11.6472Z"})),qt=t=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},c.createElement("path",{d:"M9.95321 12.8207C9.90524 13.0976 9.66251 13.3 9.37844 13.3H4.93339C4.57343 13.3 4.29943 12.9807 4.35802 12.6295C4.40447 12.3511 4.64795 12.1468 4.93338 12.1468H6.59937L8.09417 3.8533H6.62059C6.26063 3.8533 5.98663 3.534 6.04523 3.1828C6.09169 2.90432 6.33517 2.70001 6.62059 2.70001H11.0668C11.4254 2.70001 11.6989 3.01687 11.6428 3.367C11.5978 3.6471 11.3536 3.8533 11.0668 3.8533H9.39658L7.90177 12.1468H9.37844C9.73986 12.1468 10.0142 12.4685 9.95321 12.8207Z"}));function we(t,o){if(t==null)return!1;const n=t.state.schema.marks[o];return n==null?!1:jt(t.state,t.dispatch,n)}function se(t,o){if(t==null)return!1;const{state:n,dispatch:d}=t,h=Ie(n.schema.nodes[Lt.proseMirrorNodeName()]);return ke(h,{level:o})(n,d)}function Jt(t){if(t==null)return!1;const{state:o,dispatch:n}=t,d=Ie(o.schema.nodes[Bt.proseMirrorNodeName()]);return ke(d)(o,n)}const Kt=({availableWidth:t,onAddComment:o,isSendDisabled:n=!1,isWaitingForCommentResponse:d=!1,onSubmitAccelerator:h})=>{const l=Me(),a=ie(),r=Pe(),p=Ot(),u=c.useCallback(i=>{const{width:E,height:g}=i,s=a();if(!r||!s||Le(s))return null;const{to:f,empty:v,head:R}=r.selection,{platform:O}=St(),A=O==="web"?R:f,S=A===f;if(v||!Ce(s.state.doc,A))return null;const{right:U,left:M,top:k}=s.coordsAtPos(0);let I=A,V=s.state.doc.nodeAt(I);const W=S?-1:1;for(;!V?.isText&&Ce(s.state.doc,I+W);)I+=W,V=s.state.doc.nodeAt(I);const{left:F,bottom:H,top:Z}=s.coordsAtPos(I,S?-1:1),X=U-M;function Y(){if(S)return Math.max(F-M-E,0);let P=F-M;return P+E>X&&(P=-(E-X)),P}function y(){const P=window.innerHeight-H>g*2;return S&&P?{top:H-k+8,aboveOrBelow:Ee.BELOW}:{top:Z-k-g-8,aboveOrBelow:Ee.ABOVE}}const D=y();return{left:Y(),top:D.top,aboveOrBelow:D.aboveOrBelow,toolbarSize:i}},[r,a]),T=c.useCallback(()=>a()?.dom??null,[a]),m=[{label:l.formatMessage(N.heading1),className:"text-5xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER1),se(a(),1)}},{label:l.formatMessage(N.heading2),className:"text-3xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER2),se(a(),2)}},{label:l.formatMessage(N.heading3),className:"text-2xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER3),se(a(),3)}},{label:l.formatMessage(N.body),className:"text-base",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_PARAGRAPH),Jt(a())}}],b=()=>{const i=a();if(!i)return null;const{state:E}=i,{from:g,to:s,sourceFrom:f,sourceTo:v}=ct(E);return g==null||s==null||f==null||v==null?(w.logError("Prosemirror getSelectionRange has null values",null,{from:g,to:s,sourceFrom:f,sourceTo:v}),null):{from:g,to:s,sourceFrom:f,sourceTo:v}},C=(i,E,g)=>{const s=a(),f=b();if(f==null)return;const{sourceFrom:v,sourceTo:R}=f,O={start:v,end:R};if(r&&s){const A=r.tr.setSelection(Wt.create(r.doc,r.selection.anchor));s.dispatch(A)}w.logButtonClick(j.TOOLBAR_FORMAT_STYLE,{action:{action:g.action,id:g.id,title:g.title},prompt:E,sourceFrom:v,sourceTo:R}),h?.(i,O,l.formatMessage(E),g)};return e.jsxs(mt,{isWaitingForCommentResponse:d,isSendDisabled:n,onAddComment:o,toolbarType:ft.WRITING,getToolbarPosition:u,getEditorDom:T,getSelectionRange:b,children:[p&&e.jsxs(e.Fragment,{children:[e.jsx(L.Separator,{}),e.jsx(L.Popover,{label:l.formatMessage(N.format),hideLabel:t<=400,icon:Mt,align:"center",children:e.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",ve),children:Ht.map(i=>{const{title:E,icon:g}=i;return e.jsxs("button",{onClick:s=>{"prompt"in i&&C(s,i.prompt,i)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(g,{className:"icon-md"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:l.formatMessage(E)})]},i.id)})})})]}),e.jsx(L.Separator,{}),e.jsx(L.Action,{label:l.formatMessage(N.bold),hideLabel:!0,icon:$t,onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_BOLD),we(a(),_t.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(L.Action,{label:l.formatMessage(N.italic),hideLabel:!0,icon:qt,onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_ITALIC),we(a(),kt.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(L.Popover,{label:l.formatMessage(N.format),hideLabel:!0,icon:Dt,children:e.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",ve),children:m.map(({label:i,className:E,onClick:g})=>e.jsx("button",{onClick:g,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:E,children:i})},i))})})]})},N=Ne({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Oe({position:t,numEdits:o,closestEditId:n}){const d=ye(),h=Me(),l=t==="top"?Nt:It,a=()=>{const p=d();if(!p||!n)return;const u=tt(p,n);if(u.length===0){it.addError("Edit could not be found while attempting to scroll",{closestEditId:n});return}u[t==="top"?0:u.length-1].scrollIntoView({behavior:"smooth",block:"center"})},r=t==="top"?-4:4;return e.jsx(z,{children:o>0&&e.jsx(_.div,{className:B("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:r,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:r,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:B("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":h.formatMessage(Se.ariaLabel),role:"button",onClick:a,children:[e.jsx(Je,{...Se.label,values:{count:o}}),e.jsx(l,{className:"icon-sm ms-2"})]})})})}const Se=Ne({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Qt({diff:t=null}){const o=ye(),[n,d]=c.useState([]),[h,l]=c.useState([]),a=ae.useState(ae.selectWindowHeight),r=c.useCallback(()=>{const p=o();if(!p||!t)return;const u=[],T=[];for(const m of t.edits){const b=ot(p,m.id);if(b.length>0){const C=st(b);C.bottom<0?u.push([m.id,C]):C.top>a&&T.push([m.id,C])}}u.sort(([,m],[,b])=>m.bottom-b.bottom),T.sort(([,m],[,b])=>m.top-b.top),d(u.map(([m])=>m)),l(T.map(([m])=>m))},[t,a,o]);return pt(t?.edits??[],r),c.useEffect(()=>{const p=setTimeout(r,500);return()=>{clearTimeout(p)}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(Oe,{position:"top",numEdits:n.length,closestEditId:n[n.length-1]}),e.jsx(Oe,{position:"bottom",numEdits:h.length,closestEditId:h[0]})]})}const re=lt(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Ho}=re,eo=({pos:t})=>{const o=ie()(),n=Pe();if(!o||!n||t==null)return null;const{doc:d}=n,{top:h,left:l}=o.coordsAtPos(0),{top:a,left:r}=o.coordsAtPos(t),p=d.nodeAt(t),u=t+(p?.nodeSize??0)-1,{top:T}=o.coordsAtPos(t+1),{top:m,bottom:b,right:C}=o.coordsAtPos(u),E=(T>=m?C:o.dom.getBoundingClientRect().right)-r,g=b-a+4;return e.jsx(_.div,{style:{top:a-h,left:r-l,height:g,width:E},className:B("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Ct.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},to=({pos:t})=>e.jsx(z,{children:t!=null&&e.jsx(eo,{pos:t})}),oo={type:"spring",bounce:.12,duration:.64},ne=24,so=16,no=0,ao=8,Do=({comments:t,diff:o,readonlyReason:n,isDisabled:d=!1,isRewriting:h=!1,isAnimatingFromPreview:l=!1,isSendDisabled:a=!1,previousComments:r,previousValue:p,isPreview:u=!1,isRequestActive:T=!1,isWaitingForCommentResponse:m=!1,targetedContent:b=null,onAcceleratorsExpandedChange:C,getAutocompleteSuggestion:i,getStableCommentId:E=Pt,onBlur:g,onCancelRequest:s,onChange:f,onSave:v,onAddComment:R,onSubmitAccelerator:O,onAcceptComment:A,onDismissComment:S,onExitShowChanges:U,value:M,commentsMode:k=te.ENABLED,hideAccelerators:I=!1,hideToolbar:V=!1,hideEditOverlay:W=!1,safeUrls:F,width:H,modelCursor:Z,shouldResetSelection:X,metadata:Y})=>{const y=c.useRef(null),D=c.useRef(null);Ft(D,y);const[{width:P},Be]=_e(),le=yt(),ce=c.useRef(null),[$,de]=c.useState(!1),He=ce.current,De=gt(He)??!1,ue=le?Et:xt,q=(()=>{if(H==null){const x=De?0:xe();return P-x}return H-ue*2-xe()})(),J=q>=Te+bt?Te:Tt,Ve=q-J,We=G(({commentingOn:x})=>x),Fe=G(({hoveredCommentId:x})=>x),Xe=G(({focusedCommentId:x})=>x),Ge=G(({hoveredBlockCommentLauncherPos:x})=>x),ze=re(x=>x.hoveredEditId),Ue=re(x=>x.rejectedEdits);c.useEffect(()=>{b==null&&y.current?.revertChanges()},[b]),c.useEffect(()=>{y.current?.flushChanges(),y.current?.UNSAFE_setValue(M)},[M]);const Ze=ae.useState(({windowHeight:x})=>{if(le)return u?no:so;if(u)return ne;const K=ao/100*x;return Math.max(ne,K)}),Ye=({currentTarget:x,nativeEvent:K})=>{const fe=K.composedPath();for(const Q of fe.slice(0,fe.indexOf(x)))if(Q instanceof HTMLElement&&(Q.id===be.PROSEMIRROR_EDITOR_CONTAINER||Q.id===be.PROSEMIRROR_CONTEXT_CHILDREN))return;U?.()},me=u?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:D,onClick:Ye,children:e.jsx(_.div,{className:At.document,style:{margin:`0 ${ue}px`},initial:l?{paddingTop:ne}:!1,animate:{paddingTop:Ze},transition:oo,children:e.jsx("div",{ref:je(Be,ce),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(ee,{comments:t,diff:o,editorRef:y,hoveredCommentId:Fe,focusedCommentId:Xe,hoveredEditId:ze,rejectedEdits:Ue,value:h&&!$?"":M,commentingOn:We,isDisabled:d||h||$,onBlur:g,onChange:f,onSave:v,width:J,safeUrls:F,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:me,modelCursor:Z,shouldResetSelection:X,transparentBackground:!$,contentRefereces:Y?.contentReferences??[],getAutocompleteSuggestion:i,children:[e.jsxs(ee.EditorChildren,{children:[e.jsx(z,{onExitComplete:()=>de(!1),children:h&&e.jsx(Yt,{isRewriting:h,documentWidth:J,previousValue:p,previousComments:r,value:M,paddingBottom:me,onStart:()=>de(!0)})}),!V&&e.jsx(Kt,{availableWidth:q,isWaitingForCommentResponse:m,isSendDisabled:a,onAddComment:R,onSubmitAccelerator:O}),k===te.ENABLED&&e.jsx(to,{pos:Ge}),e.jsx(z,{children:k!==te.ALL_HIDDEN&&e.jsx(ht,{availableWidth:Ve,comments:t,commentsMode:k,isRequestActive:T,onAddComment:R,onAcceptComment:A,onDismissComment:S,isWaitingForCommentResponse:m,disableBlockComments:T,getStableCommentId:E})})]}),e.jsxs(ee.ContextChildren,{children:[!W&&o&&e.jsx(Qt,{diff:o}),!I&&e.jsx(dt,{isRequestActive:T,onSubmit:O,isVisuallyHidden:a||!!n?.isStreamingFromNative||n?.isReadonly&&!n.isStreaming,actions:Vt,onCancel:s,onExpandedChange:C})]})]})})})})};export{Do as DocumentComposer};
//# sourceMappingURL=ui18q22qvogsg5s2.js.map
