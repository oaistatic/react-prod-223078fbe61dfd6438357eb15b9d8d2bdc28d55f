import{r as c,i as L,j as e,M as u}from"./b8ijctzpgh0s7wpx.js";import{ft as P,dY as v,mm as E,ad as z,gn as U,aX as W}from"./krbmwir12ubt4od1.js";import{c as w,B as S,ah as H,ad as K}from"./citrwydz0bgriwlc.js";import{C as $,S as G,i as X,g as Y,D as q,f as J}from"./iq1x6sz8bwtm6i1f.js";import{i as Q}from"./h6aag2lelyp3pu40.js";import{a as Z,S as ee}from"./n0ebefrhb3m9t57u.js";import{F as te}from"./i8tm8q9bfwwc933k.js";import{W as ie}from"./eeyp7d7oqudhas3m.js";import"./omp8ie1vzl40ti1z.js";import"./n3fqqr9zf79bnmr6.js";import"./nvghija6qp2cunds.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./djd85tifm57yisqi.js";import"./c23qlyb7rng4ydyc.js";import"./ju91cj9mp2lx2yuz.js";import"./ndqm17bbs5ambnrw.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./dbalwdodzoo02ru2.js";import"./ji5qoh13hkjncrxd.js";import"./mtbwfu1a5yslb3p2.js";import"./jmanj1myc9r62cus.js";import"./eeruhkv4a43aueaw.js";import"./k00srulxk3kjmgxy.js";import"./iki1bxy2syl3zwuv.js";import"./bdclq6pa102whxi1.js";import"./be0n9593bbjhdouz.js";import"./gbxx25eoj7wtyna0.js";import"./bzsolvz1ulyrc61b.js";import"./pc2givv05uuq8g6l.js";import"./jr954f5murhu609u.js";import"./gaxh4csbc95s5l26.js";import"./e74336rl4x47z2ei.js";import"./h3axfhhn58bmthc9.js";import"./eg629yaevviy8e7x.js";import"./k5qjx4jdow04k7d2.js";import"./o6iizogkfybkxcpa.js";import"./ct6yhczwft8t5t9k.js";import"./etmxhiuvgu79utu0.js";import"./by1c2a5hsj4exnt8.js";import"./l4etgojhnqjuqlgi.js";import"./belvvj76e8q0tm6q.js";import"./eobw6ahe02v4g6se.js";import"./gvs1s366o5iglka3.js";import"./eprrfci9x6sa3hga.js";import"./n0ud0ko19kosxgev.js";import"./lik51q5yy8pdcusl.js";import"./he8ni3xt3ac4tebf.js";import"./n4yg932g6pqv5x7h.js";import"./m4qet7ipn6ha09it.js";import"./j2zbz2jpl151yhf4.js";import"./nfkxdwnvdjy1s4sn.js";import"./cwi4lsxreiklxbjv.js";function V({filePath:t,side:o,lineNumber:h,onSubmit:m,onDelete:r,onClose:a,initialComment:i}){const d=i?T(i):"",[n,s]=c.useState(i?T(i):""),[x,g]=c.useState(!i),[j,F]=c.useState(!1),y=c.useRef(null),N=L(),k=()=>{if(!n)return;const f=i?{...i,content:[{content_type:"text",text:n}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:n}],position:{side:o===G.old?"left":"right",path:t,line:h}};m?.(f),g(!1),y.current?.blur(),a?.()};return c.useEffect(()=>{!j&&i&&n===d&&setTimeout(()=>{g(!1)},100),j&&(g(!0),y.current?.focus())},[j,i,n,d]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:w("flex flex-col gap-2",$),children:[e.jsx(Q,{ref:y,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white",onFocus:()=>F(!0),onBlur:()=>F(!1),placeholder:N.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:n,onChange:f=>s(f.target.value),onKeyDown:f=>{f.key==="Enter"&&f.metaKey&&(f.preventDefault(),k()),f.key==="Escape"&&(f.preventDefault(),a?.())}}),x&&e.jsxs("div",{className:w("mt-2 flex items-center justify-between gap-2",!r&&"justify-end"),children:[r&&e.jsx(S,{color:"danger",onClick:()=>r?.(),children:e.jsx(u,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(S,{color:"secondary",onClick:()=>{a?.(),g(!1),i&&s(T(i))},children:e.jsx(u,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(S,{color:"primary",disabled:!n,onClick:k,children:i?e.jsx(u,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(u,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function T(t){return t.content.map(o=>o.content_type==="text"?o.text:"").join("")}function oe({copyDiffToClipboard:t,copyPatchToClipboard:o,unifiedDiff:h,setUnifiedDiff:m}){const[r,a]=c.useState(!1),i=d=>n=>{n.preventDefault(),n.stopPropagation(),d==="diff"?t():o()};return e.jsxs(P,{open:r,onOpenChange:a,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),a(!0)},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(z,{className:"icon-md"})}),children:[e.jsx(v.Item,{icon:E,onClick:i("diff"),children:e.jsx(u,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(v.Item,{icon:E,onClick:i("patch"),children:e.jsx(u,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})}),e.jsx(v.Separator,{}),e.jsxs(v.RadioGroup,{value:h?"unified":"split",onValueChange:d=>m(d==="unified"),children:[e.jsx(v.RadioItem,{value:"split",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(Z,{className:"icon-md"}),e.jsx(u,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),e.jsx(v.RadioItem,{value:"unified",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(ee,{className:"icon-md"}),e.jsx(u,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]})]})}const ae="_diffView_avtz7_1",se={diffView:ae},M="wham-toggle-all-diffs";function re(t){return c.useEffect(()=>{function o(h){t(h.detail.open)}return window.addEventListener(M,o),()=>{window.removeEventListener(M,o)}},[t]),c.useCallback(o=>{window.dispatchEvent(new CustomEvent(M,{detail:{open:o}}))},[])}function ne({diff:t,viewType:o,stickyHeader:h,enableComments:m=!1,comments:r,onCommentCreate:a,onCommentDelete:i,onCommentUpdate:d,setUnifiedDiff:n}){const s=H(),x=L(),[g,j]=c.useState(()=>!X(t.diffFile)),[F,y]=c.useState(!1),N=K(),k=re(j);c.useEffect(()=>{t.diffFile.initTheme(s?"dark":"light")},[t.diffFile,s]);const f=(r??[]).reduce((l,p)=>{const b=p.position.path,_=p.position.side,D=p.position.line;l[b]||(l[b]={oldFile:{},newFile:{}});const B=_==="left"?l[b].oldFile:l[b].newFile;return B&&(B[D]={data:p}),l},{}),C=Y(t.diffFile),R=()=>{navigator.clipboard.writeText(t.diffFile._newFileName),y(!0),setTimeout(()=>{y(!1)},1e3)},A=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),N.success(x.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},I=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),N.success(x.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},O=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":C,className:w("flex flex-col pt-1",se.diffView),children:[e.jsx("div",{role:"button",onClick:l=>{const p=!g;l.altKey?k(p):j(p)},className:w("focus-visible:outline-none",h&&"sticky top-0 z-1"),children:e.jsxs("div",{className:w("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!g&&"rounded-b-2xl"),children:[e.jsx(U,{className:w("icon me-3 transition-transform duration-200",g&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:C,children:C}),e.jsx(te,{diffFile:t.diffFile}),e.jsx(W,{label:x.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:F,children:e.jsx("div",{role:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),R()},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(E,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(ie,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(oe,{copyDiffToClipboard:A,copyPatchToClipboard:I,unifiedDiff:o==="unified",setUnifiedDiff:n})]})]})}),g&&(O||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(u,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(u,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(q,{className:w("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:s?"dark":"light",diffViewHighlight:!0,diffViewMode:o==="split"&&!J(t.diffFile)?3:4,diffViewWrap:!0,diffViewAddWidget:m,extendData:f[t.diffFile._newFileName],renderExtendLine:({lineNumber:l,side:p,data:b})=>!m||!(p===1?f[t.diffFile._newFileName]?.oldFile:f[t.diffFile._newFileName]?.newFile)?null:e.jsx(V,{initialComment:b,onSubmit:D=>d?.(D),onDelete:()=>i?.(b),filePath:t.diffFile._newFileName,side:p,lineNumber:l}),renderWidgetLine:({onClose:l,lineNumber:p,side:b})=>!m||!a?null:e.jsx(V,{onSubmit:a,onClose:l,filePath:t.diffFile._newFileName,side:b,lineNumber:p})}))]})}function ft({diffFiles:t,unifiedDiff:o,setUnifiedDiff:h,enableComments:m,comments:r,setComments:a}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(u,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function i(s){!a||!r||a([...r,s])}function d(s){!a||!r||a(r.filter(x=>x.id!==s.id))}function n(s){!a||!r||a(r.map(x=>x.id===s.id?s:x))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(s=>e.jsx(ne,{diff:s,stickyHeader:!0,viewType:o?"unified":"split",setUnifiedDiff:h,enableComments:m,comments:m?r:[],onCommentCreate:i,onCommentDelete:d,onCommentUpdate:n},s.diffFile._newFileName))})})}export{ft as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=i9xy0clsaaglw0pm.js.map
