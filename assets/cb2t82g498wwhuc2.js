import{j as n,a5 as L,aa as V,i as w,r as u,a as X,a6 as K,e as Q,f as J}from"./b8ijctzpgh0s7wpx.js";import{dg as Y,di as Z,y as ee,c as m,ah as ae,dj as te,dl as se,dk as ne,F as re,dw as oe,dx as ie,j as le,m as ce,b1 as N,cb as de,ae as y,bj as v,g8 as ue,n as I,b as R,ad as fe,aq as U,e as A,a7 as me,ab as T,a_ as F,ct as S,dW as he,O as ge,B as xe}from"./citrwydz0bgriwlc.js";import{dq as pe,h as we,eu as W,ev as ke,ew as O,aL as ve,bH as be,ex as Me,ey as ye,ez as Se,bw as je}from"./krbmwir12ubt4od1.js";import{P as B}from"./ndwtlsjk3xm27wkq.js";function _e({className:e,children:a,position:t="center",size:s,removePopoverStyling:r=!1,shadow:o="normal"}){const i=V(),l=w(),d=Math.random()*40-20;return u.useEffect(()=>{i.start({x:0,y:0,rotate:0,opacity:1,transition:{type:"spring",duration:.6,bounce:.15}})},[i]),n.jsx(L.div,{initial:{x:0,y:"100%",rotate:0,opacity:1},animate:i,exit:{x:0,y:"100%",rotate:d,opacity:1},transition:{type:"spring",duration:.6,bounce:.15},className:m("z-50 h-full w-full overflow-y-auto",s!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",s!=="fullscreen"&&t==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",s!=="fullscreen"&&t==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:n.jsx(se,{className:m(!r&&"popover","bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full min-w-0 gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717]",s!=="fullscreen"&&"rounded-[36px]",o==="normal"&&"shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)]",e),"aria-description":l.formatMessage({id:"slide-up-modal.share-sheet.description",defaultMessage:"Share sheet"}),"aria-describedby":"",children:a})})}function Ce({isOpen:e,onClose:a,children:t,shouldIgnoreClickOutside:s=!1,className:r}){return n.jsx(Y,{open:e,onOpenChange:o=>{s||o===!1&&a(!1)},children:n.jsx(Z,{container:ee()?.document.body,children:n.jsx("div",{className:m("absolute inset-0",r),children:t})})})}function Pe({className:e,children:a,showBackground:t=!0}){const s=ae(),r=t?s?"rgba(0, 0, 0, 0.8)":"rgba(249,249,249,0.8)":"rgba(0, 0, 0, 0)";return n.jsx(te,{asChild:!0,children:n.jsx(L.div,{initial:{backdropFilter:"blur(0px)",backgroundColor:s?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},animate:{backdropFilter:t?"blur(4px)":"blur(0px)",backgroundColor:r},exit:{backdropFilter:"blur(0px)",backgroundColor:s?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},className:m("fixed inset-0 z-50",e),children:a})})}function Le({title:e,description:a,icon:t,type:s}){return n.jsxs("div",{className:"flex max-w-full min-w-0 items-center",children:[n.jsx(Ie,{icon:t,type:s}),n.jsxs("div",{className:"flex max-w-full min-w-0 grow flex-col gap-1",children:[e!=null&&n.jsx(oe,{className:"text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl",children:e}),a!=null&&n.jsx(ie,{className:"text-token-text-tertiary text-sm",children:a})]})]})}function Ne({title:e,accessory:a,description:t,withSeparator:s=!0,icon:r,type:o,closeButton:i,textCenter:l}){return!e&&!t?null:n.jsxs(Re,{$hasSeparator:s,children:[n.jsx("div",{className:m("flex max-w-full",l&&"flex-1 justify-center text-center"),children:n.jsx(Le,{title:e,description:t,icon:r,type:o})}),n.jsxs("div",{className:"flex items-center gap-5",children:[a,i!=null&&n.jsx(ne,{asChild:!0,className:"sm:mt-0",children:i})]})]})}const Ie=({type:e,icon:a})=>a==null?null:n.jsx("div",{className:m("me-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:h-10 sm:w-10",e==="danger"&&"bg-red-100",e==="warning"&&"bg-yellow-100",e==="success"&&"bg-green-100"),children:n.jsx(a,{className:m("icon-lg",e==="danger"&&"text-red-600",e==="warning"&&"text-yellow-700",e==="success"&&"text-green-700"),"aria-hidden":"true"})}),Re=re.div`px-4 pb-2 sm:p-6 flex items-center justify-between ${({$hasSeparator:e})=>e&&"border-b border-black/10 dark:border-white/10"}`,k={Root:Ce,Overlay:Pe,Content:_e,Header:Ne},f=Q({copyLink:{id:"postSharingModal.copyLink",defaultMessage:"Copy link"},linkCopied:{id:"postSharingModal.linkCopied",defaultMessage:"Link copied!"},failedToGenerateShareLink:{id:"postSharingModal.failedToGenerateShareLink",defaultMessage:"Failed to generate share link"},fromChatGPT:{id:"postSharingModal.fromChatGPT",defaultMessage:"From ChatGPT"},contentUnavailable:{id:"postSharingModal.contentUnavailable",defaultMessage:"Content Unavailable"},unavailableReasonGeneral:{id:"postSharingModal.unavailableReasonGeneral",defaultMessage:"This share link is not available because it doesn’t exist or you don’t have access to it."},unavailableReasonWorkspace:{id:"postSharingModal.unavailableReasonWorkspace",defaultMessage:"This content was shared from a workspace you don’t have access to. Ask the owner to invite you if you’d like to view it."},ok:{id:"postSharingModal.ok",defaultMessage:"OK"},shareLinkVisibleToWorkspaceOnly:{id:"postSharingModal.shareLinkVisibleToWorkspaceOnly",defaultMessage:"The share links are visible to workspace members only."}});function Ue(e){const a=he(e,t=>S.getImageAssetPointers(t).length>0);return a?S.getImageAssetPointers(a)[0]:null}function Ae({showLinkCopied:e,isGeneratingShareLink:a,onClick:t,postText:s,showDownloadButton:r,disabled:o}){const i=w(),l=U()?.isWorkspaceAccount();let d=[{id:"copy",icon:a?n.jsx(ge,{}):n.jsx(ve,{}),label:e?i.formatMessage(f.linkCopied):i.formatMessage(f.copyLink),action:"copy"}];return l?r&&d.push({id:"download",icon:n.jsx(be,{}),label:i.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):d=d.concat({id:"x",href:c=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(c)}&text=${s?encodeURIComponent(s):""}`,icon:n.jsx(Me,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:c=>`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(c)}&text=${s?encodeURIComponent(s):""}`,icon:n.jsx(ye,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:c=>`https://www.reddit.com/submit?url=${encodeURIComponent(c)}&title=${s?encodeURIComponent(s):""}`,icon:n.jsx(Se,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"}),n.jsx(n.Fragment,{children:d.map(c=>n.jsxs("button",{onClick:()=>{t(c),A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:c.id})},disabled:o,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[n.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:n.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:c.icon})}),n.jsx("div",{className:"w-full text-center text-xs",children:c.label})]},c.id))})}async function Te(e,a,t){return W(a.asset_pointer)?(await ke(e,[a],null,void 0,t))[0]:null}const Fe=async(e,a,t)=>{const s=()=>I.findNode(F(a),({message:i})=>i.id===t||!!S.getImageAssetPointers(i).find(l=>l.asset_pointer===e));let r=s();if(!r?.message&&(await we(a),r=s(),!r?.message))return null;const o=v(a);return{postText:r.message.metadata?.image_gen_title,imageAssetPointer:Ue([r.message]),serverThreadId:o}};async function We(e,a,t,s){const r=W(a.asset_pointer);if(!r)return null;const o=await R.safePost("/share/post",{requestBody:{post_text:t,attachments_to_create:[{kind:"image_share",file_id:r,conversation_id:e,width:s?.width,height:s?.height}]}});return O(o.post.id)}async function Oe(e,a,t){const s=await R.safePost("/share/post",{requestBody:{post_text:t,attachments_to_create:[{kind:"message_slice",conversation_id:e,message_ids:a}]}});return O(s.post.id)}function G(e,a){const t=F(e);return t?{kind:"message_slice",messages:a.map(r=>{const o=I.findNode(t,({message:i})=>i.id===r);return o?o.message:null}).filter(Boolean)}:null}function D({postSharingData:e,closeModal:a}){const{clientThreadId:t,postText:s,generateShareLinkFn:r,coverImageUrl:o,messageSliceIds:i}=e,l=u.useRef(void 0),[d,c]=u.useState(!1),[g,x]=u.useState(!1),h=w(),b=fe(),[$,j]=u.useState(!0),q=U()?.isWorkspaceAccount();u.useEffect(()=>{A.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),u.useEffect(()=>{l.current=void 0},[t]);const _=u.useMemo(()=>o||!i||i.length===0?null:G(t,i),[o,t,i]),C=v(t),z=async p=>{if(!(d||!C)&&C){if(!l.current){c(!0);try{const M=await r();M&&(l.current=M)}catch{b.danger(h.formatMessage(f.failedToGenerateShareLink))}finally{c(!1)}}if(l.current){if(p.action==="copy")navigator.clipboard.writeText(l.current),x(!0),b.success(h.formatMessage(f.linkCopied)),setTimeout(()=>{x(!1)},3e3);else if(p.action==="share"&&p.href)window.open(p.href(l.current),"_blank","noopener,noreferrer");else if(p.action==="download"){if(!o)return;je({url:o,fileName:`${s}.png`})}}}},H=n.jsx("div",{className:m("max-xs:max-h-[260px] flex h-[30vh] max-h-[550px] w-full justify-center rounded-xl max-sm:max-h-[300px]",!o&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:o?n.jsx("img",{src:o,alt:s}):_&&n.jsx(B,{attachments:[_],clientThreadId:t})});return n.jsx(K,{onExitComplete:a,children:$&&n.jsx(k.Root,{isOpen:!0,onClose:()=>{j(!1)},className:"max-w-[664px] px-4",children:n.jsx(k.Overlay,{showBackground:!0,children:n.jsxs(k.Content,{size:"normal",position:"center",className:m("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":"normal"==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[n.jsx(k.Header,{title:s,type:"success",closeButton:n.jsx(me,{onClick:()=>j(!1)})}),n.jsxs("div",{children:[n.jsx("div",{className:"pointer-events-none flex justify-center",children:H}),n.jsx("div",{className:"mt-12 flex flex-wrap justify-center space-y-4 space-x-12 max-sm:mt-6 max-sm:space-x-6",children:n.jsx(Ae,{showLinkCopied:g,isGeneratingShareLink:d,disabled:d,onClick:z,postText:s,showDownloadButton:!!o})}),q&&n.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-4",children:h.formatMessage(f.shareLinkVisibleToWorkspaceOnly)})]})]})})})})}function P({clientThreadId:e,coverImageUrl:a,messageSliceIds:t,closeModal:s}){const r=u.useMemo(()=>a||!t||t.length===0?null:G(e,t),[a,e,t]);return r&&n.jsx(T,{testId:"modal-mobile-post-preview",isOpen:!0,onClose:s,type:"success",size:"custom",position:"top",noPadding:!0,contentClassName:"w-full",children:n.jsx("div",{className:"aspect-[4/3] w-full",children:n.jsx(B,{attachments:[r],clientThreadId:e})})})}const Be=u.createContext({postWithProfile:null,setIsReportModalOpen:e=>{}});function Xe(){return!!u.useContext(Be)?.postWithProfile}async function E({postText:e,postTitle:a,clientThreadId:t,generateShareLinkFn:s,renderPreviewFn:r,usePostText:o,useShareLink:i,useShareTitle:l}){if(!v(t))return!1;try{const c=await s();return c?(r&&r(),await navigator.share({text:o?e:void 0,url:i?c:void 0,title:l?a:void 0}),!0):!1}catch{return!1}}async function Ge(e,a,t,s,r,o){const i=await Fe(e,a,t);if(!i?.imageAssetPointer||!i?.serverThreadId)return;const{postText:l,imageAssetPointer:d,serverThreadId:c}=i,g=await Te(s,d,c);if(!g)return;const x=()=>We(c,d,l,g);if(o&&N(r,"1138231213")){const h=de(r,"2382399797");if(await E({clientThreadId:a,postText:l,generateShareLinkFn:x,usePostText:h.get("navigator_share_text",!1),useShareLink:h.get("navigator_share_link",!1)}))return}y(r,D,{postSharingData:{clientThreadId:a,postText:l,generateShareLinkFn:x,coverImageUrl:g?.url}})}async function De(e,a,t,s,r){const o=v(e);if(!o)return;const i=()=>Oe(o,a,r);if(s&&N(t,"1138231213")){const l=await E({clientThreadId:e,generateShareLinkFn:i,renderPreviewFn:()=>{y(t,P,{clientThreadId:e,coverImageUrl:void 0,messageSliceIds:a})},useShareLink:!0,useShareTitle:!0,postTitle:r});if(ue(t,P),l)return}y(t,D,{postSharingData:{clientThreadId:e,generateShareLinkFn:i,postText:r,messageSliceIds:a}})}function Ke({assetPointer:e=null,clientThreadId:a,imageGenMessageId:t,messageSliceIds:s}){const r=X(),o=le(),i=pe(),l=ce(a,d=>d?.title);return u.useCallback(async()=>{t?await Ge(e,a,t,r,o,i):s&&await De(a,s,o,i,l??void 0)},[e,a,t,s,l,r,i,o])}function Ee(e){const a=w();switch(e){case"general":return a.formatMessage(f.unavailableReasonGeneral);case"workspace":return a.formatMessage(f.unavailableReasonWorkspace);default:return a.formatMessage(f.unavailableReasonGeneral)}}function Qe({closeModal:e,reason:a}){const t=w(),s=J(),r=()=>{e(),s("/")},o=Ee(a);return n.jsx(T,{testId:"modal-post-sharing-error",isOpen:!0,type:"danger",textCenter:!0,title:t.formatMessage(f.contentUnavailable),description:o,onClose:r,footerContent:n.jsx(xe,{size:"large",color:"primary",className:"w-full",onClick:r,children:t.formatMessage(f.ok)})})}export{Qe as P,Be as a,Xe as b,Ke as u};
//# sourceMappingURL=cb2t82g498wwhuc2.js.map
