const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dlsoz00g3d1kx3ut.js","assets/citrwydz0bgriwlc.js","assets/b8ijctzpgh0s7wpx.js","assets/root-gxczc0vy.css","assets/ku4zsoy6w4wkp690.js","assets/krbmwir12ubt4od1.js","assets/conversation-small-dfayqh3x.css","assets/k1h56nx2kjoqc52m.js","assets/exvo283q5zxd2q6r.js","assets/jekpe1ukp5thtucq.js","assets/nvghija6qp2cunds.js","assets/djd85tifm57yisqi.js","assets/jkznwfhp8ahnvlot.js","assets/megablgldkh4lap1.js","assets/hbpbckirom363mgh.js","assets/izdon3syh095bs23.js","assets/dweroubxngal4vlb.js","assets/i7jya7stlyvnzya0.js","assets/cb2t82g498wwhuc2.js","assets/ndwtlsjk3xm27wkq.js","assets/dcml6fn13vfm1zv2.js","assets/o0ebhsapkoy5qkg1.js","assets/k7nub2yuxq70se07.js","assets/k6ccgr4wxcppeg93.js","assets/dbalwdodzoo02ru2.js","assets/pc9qsszhmtx9pu7o.js","assets/dera5bljhpg5ja89.js","assets/hs2fsda156wfk7fz.js","assets/cgmvdx042qfdmsg3.js","assets/nkmoggp2eivap3m9.js","assets/ds9z3b5ax7x2isfi.js","assets/o146mt4hljz23377.js","assets/jub8x4vtu4ve8tc3.js","assets/eq7m7kpdgo83dcz8.js","assets/hf1qeqo8wh44t1id.js","assets/gy64pge8qevmvg7e.js","assets/ehfklztncg6rr3uj.js","assets/kgw7qrdf71g2l8gc.js","assets/o6iizogkfybkxcpa.js","assets/daid7veon13s2bqn.js","assets/hwx0m0azjs4pnvcb.js","assets/eeq4y4a9pg3xg60r.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,M as D,i as ae,f as is,a5 as H,e as xt,aq as ta,ap as na,ak as Gs,a6 as ls,a as vt,R as aa,p as oa}from"./b8ijctzpgh0s7wpx.js";import{ci as ra,cj as ia,ck as la,s5 as Hs,dv as ca,f5 as da,dw as Vs,or as ua,f0 as ma,j9 as ga,bz as pa,s6 as ha,bY as fa,ft as xa,dY as X,rB as va,dM as ba,ad as ya,e as bt,gd as Sa,k2 as Je,fe as _a,i1 as Ta,i3 as ja,s7 as Ca,R as yt,s8 as zs,s9 as Ma,sa as ka,sb as we,sc as Ia,b8 as St,sd as wa,dc as Ra,de as Ea,lI as he,eO as _t,cn as Na,eR as Pa,se as Fa,S as Aa,sf as Tt,gE as La,gF as Ua,gI as Da,gG as Ba,sg as Oa,au as jt,lG as Ga,sh as Ct,si as Ha,aX as Va,sj as za,sk as qa,o1 as cs,cx as Mt,sl as Wa,nY as $a,sm as Ka,gB as Qa,sn as Ya,so as Re,rT as Xa,go as Ja,O as Za,qv as eo,sp as so,sq as kt,sr as to,pU as no,dq as ao,gp as fe,bI as It,U as wt,ss as oo,bD as ro,b6 as Rt,bE as io,b5 as Et,st as lo,su as co,jv as uo,id as mo,sv as go,bL as Nt,bM as Pt,dg as Ft,d as po,sw as ho,ql as fo,dk as xo,eL as vo,N as At,sx as bo,ps as Lt,eQ as yo,i9 as So,pC as _o,X as To,da as Ut,sy as jo,db as Co,sz as Mo,dh as ko,sA as Io,Z as wo,sB as qs,sC as Ro,sD as Eo,sE as No,nP as Po,jF as Fo,dj as Ao,sF as Lo,sG as Uo,sH as Do,sI as Bo,sJ as Oo,sK as Go,sL as Ho,rb as Ze,sM as Vo,o_ as Fe,sN as es,sO as Ws,sP as zo,sQ as qo,cU as Wo,jH as $o,nS as Ko,iF as Qo,iQ as Yo,iP as Xo,is as Jo,sR as Zo,co as er,lF as sr,sS as tr,dd as nr,gu as ar,qo as or,qp as rr,qr as ir,sT as lr,sU as cr,sV as dr,P as ur,pO as mr,eP as gr,jX as pr}from"./krbmwir12ubt4od1.js";import{Q as oe,_ as me,fp as $s,ea as Ks,bj as ne,ad as Le,au as ds,cs as Pe,O as Dt,b as us,c as U,F as re,a_ as xe,bS as N,ew as ms,n as A,h as G,gT as Bt,ah as hr,m as Z,a$ as ue,cx as gs,fN as fr,cp as Ot,aL as xr,d as Gt,B as Ht,z as Qs,ak as ss,e as O,eH as se,aq as ps,aM as te,e8 as Vt,g2 as vr,bX as br,ep as yr,et as Sr,aQ as J,c2 as _r,ho as Tr,ch as zt,hp as jr,ct as qt,j as ve,hf as Cr,he as Ys,cb as Wt,dr as Ue,aJ as ts,S as Mr,b1 as Ae,ej as kr,g0 as Ir,g1 as $e,cg as wr,bL as Rr,dL as Er,dR as Nr,bl as Ke,gU as Pr,gV as Fr,eA as Ar,l as Lr,eW as Xs,eC as Ur,ex as Dr,eR as Br,gQ as Or,a6 as Gr,cT as Hr}from"./citrwydz0bgriwlc.js";import{a as Vr,b as zr,c as qr}from"./pc9qsszhmtx9pu7o.js";import{d as Wr,e as $t}from"./nvghija6qp2cunds.js";import{a as $r}from"./ndwtlsjk3xm27wkq.js";import{a as Kt,u as Kr,b as Qt}from"./cb2t82g498wwhuc2.js";import"./m4qet7ipn6ha09it.js";import{M as Qr,O as Yr}from"./k7nub2yuxq70se07.js";import{d as Xr,b as Js}from"./k6ccgr4wxcppeg93.js";import{a as Jr,G as Zr}from"./dcml6fn13vfm1zv2.js";import{C as ns,F as ei}from"./h3axfhhn58bmthc9.js";import{P as Yt}from"./hbpbckirom363mgh.js";import{d as si,n as ti,c as ni}from"./ku4zsoy6w4wkp690.js";import{b as Xt}from"./exvo283q5zxd2q6r.js";import{m as ai}from"./be0n9593bbjhdouz.js";import{g as oi}from"./eg629yaevviy8e7x.js";const ri=oe(async()=>me(()=>import("./dlsoz00g3d1kx3ut.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(s=>s.ImageGenNewEditor));function Rl({postWithProfile:s,clientThreadId:n,closeModal:a}){return s.post.attachments[0]?.kind==="media_generation"?e.jsx(ii,{postWithProfile:s,clientThreadId:n,closeModal:a}):s.post.attachments[0]?.kind==="message_slice"?e.jsx(li,{postWithProfile:s,closeModal:a}):null}function ii({postWithProfile:s,clientThreadId:n,closeModal:a}){const t=c.useRef(null),[o,r]=c.useState(!1),[l,m]=c.useState(!1),i=is(),{post:u}=s,d=u.attachments[u.attachments.length-1],g={url:d.url,content_type:Ks.ImageAssetPointer,asset_pointer:d.asset_pointer??Hs(d.id),size_bytes:0,width:d.width,height:d.height},f=ae(),x=ca(),h=ne(n),k=Le(),I=c.useCallback(b=>x.getState().files.find(v=>v.tempId===b),[x]),R=d.url,E=c.useCallback(async b=>{if(t.current){const v=await t.current,C=v?I(v?.tempId):null;if(C)return C}return t.current=fetch(b).then(v=>v.blob()).then(v=>{const C=new File([v],"image.png",{type:"image/png"}),T=da(C);return Vs.uploadFile(x,T,C,ua.Multimodal,[C.type],f,k).then(()=>{const _=I(T);return _&&_.status===ma.Ready&&_.fileId?_:null})}),t.current},[x,f,k,I]),{onRequestCompletion:P}=Wr(),{isUnauthenticated:p}=ds(),y=c.useCallback(async b=>{if(!(!b.promptMessage||p)){m(!0);try{const v=await E(R);if(!v||!v.fileId||!v.fileSpec)return;const C=[{content_type:Ks.ImageAssetPointer,asset_pointer:Hs(v.fileId),size_bytes:v.fileSpec.size,width:d.width,height:d.height},...b.promptMessage.content.content_type===Pe.MultimodalText||b.promptMessage.content.content_type===Pe.Text?b.promptMessage.content.parts:[]],T={...b,promptMessage:{...b.promptMessage,content:{content_type:Pe.MultimodalText,parts:C}},extraStreamParams:{...b.extraStreamParams??{},continueFromSharedPostId:u.id}};P(T),a(),Vs.reset(x)}catch{k.danger(f.formatMessage({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image"}))}finally{m(!1)}}},[d.height,d.width,E,P,x,R,a,p,f,k,u.id]),w=e.jsx(Jt,{post:u,setIsReportModalOpen:r,closeModal:a,additionalButtons:e.jsx(Vr,{imageAsset:g,serverThreadId:h})});return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(ga,{children:e.jsx(ri,{image:g,isLoadingNewImage:!1,clientThreadId:n,onClose:()=>{a(),i("/",{replace:!0})},onRequestCompletion:y,editorControls:w,messageId:u.id,footer:l?e.jsx(ci,{}):null})}),o&&e.jsx(Zt,{post:u,onClose:()=>r(!1)})]})}function li({postWithProfile:s,closeModal:n}){const[a,t]=c.useState(!1),{post:o}=s;return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(Jt,{post:o,setIsReportModalOpen:t,closeModal:n}),e.jsx($r,{attachments:o.attachments,variant:"fullscreen"}),a&&e.jsx(Zt,{post:o,onClose:()=>t(!1)})]})}function Jt({post:s,setIsReportModalOpen:n,closeModal:a,additionalButtons:t}){const o=is(),r=ae(),l=Le(),m=c.useCallback(async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await us.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:s.id}}}),o("/",{replace:!0})}catch{l.danger(r.formatMessage({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post"}))}},[s.id,r,l,o]);return e.jsx(e.Fragment,{children:e.jsxs(H.div,{className:"flex h-16 w-full px-2 sm:px-4",...pa,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(zr,{onClose:()=>{a(),o("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(ha,{areButtonsFullWidth:!0,post:s,setIsReportModalOpen:n})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[s.permissions.can_delete&&e.jsx(qr,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:m,children:e.jsx(fa,{})}),t]})]})})}function ci(){const s=ae();return e.jsxs(H.div,{className:"shadow-token-border-default pointer-events-none inline-flex items-center justify-center gap-1.5 self-center rounded-[16px] px-3.5 py-2 text-sm shadow-lg",transition:{duration:.3,ease:"easeInOut"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(Dt,{}),e.jsx("span",{children:s.formatMessage({id:"postReceiverModal.preparingImage",defaultMessage:"Preparing image..."})})]})}function Zt({post:s,onClose:n}){const{data:a}=ra($s.Post),t=ae(),o=ia(t,s.id,$s.Post);if(a==null)return null;const r=`Report ${s.text??"Post"}`;return e.jsx(la,{reasons:a.reasons,submitReport:o,title:r,onClose:n,header:a.header,subHeader:a.header_explanation})}function di(){const s=c.useContext(Kt),n=s?.postWithProfile?.post,a=s?.setIsReportModalOpen;return!n||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(D,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(xa,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(ba,{className:"rounded-full",label:"",icon:e.jsx(ya,{className:"icon-sm"})}),children:e.jsx(X.Item,{icon:va,onClick:()=>a(!0),children:e.jsx(D,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function El(){const s=c.useContext(Kt),n=s?.postWithProfile?.post,a=s?.setIsReportModalOpen;return!n||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(D,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:t=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:t})}})})}const ui="bg-token-main-surface-primary text-token-text-primary",mi="openai",Zs=["bg-blue-300 text-white"];function gi(s){return Zs[(s?.charCodeAt(0)??0)%Zs.length]}const Ee=({children:s})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:U(c.isValidElement(s)&&s.type===Je?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:s})});function as(s){const{messages:n,isUserTurn:a,avatarClassName:t,gizmo:o}=s,r="medium",m=n[0]?.metadata?.shared_conversation_id,i=m!=null,u=bt(),{gizmoEditorData:d,mode:g}=Sa();let f=e.jsx(Ee,{children:e.jsx(Je,{className:t??ui,iconName:mi,size:r})});return o?f=e.jsx(Ee,{children:e.jsx(Jr,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):d!=null&&g==="test"&&(f=e.jsx(Zr,{isFirstParty:!1,src:d.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(Ee,{children:e.jsx(Je,{className:gi(m),iconName:"user",size:r})}):e.jsx(Ee,{children:e.jsx(_a,{user:u,size:r})}):f})}const et=oe(()=>me(()=>import("./cgmvdx042qfdmsg3.js"),__vite__mapDeps([28,1,2,3,5,6,29,30])).then(s=>s.MemoryActionResult));function st(s,n,a){ue(s,t=>{gs.updateTree(t,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const tt=({messages:s})=>{for(const{metadata:n}of s){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:t}=n??{};if(t)return t}};function pi(s){const n=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=c.useRef({left:null,right:null});return s.variantIds.length<2?e.jsx(en,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...s}):e.jsx(hi,{...s,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function hi(s){const{clientThreadId:n,variantIds:a,turnIndex:t,firstVisibleTokenTimestampsRef:o}=s;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=hs(),l=Bt(),m=hr(),[i,u]=a,d=c.useMemo(()=>yt(i+u)()>=.5,[i,u]),[g,f]=d?[u,i]:[i,u],[x,h,k]=Z(n,y=>{const w=Qs(y).tree.getLeafFromNode(g).id,b=Qs(y).tree.getLeafFromNode(f).id,v=A.getConversationTurns(y,w),C=A.getConversationTurns(y,b),T=t<v.length?v[t]:null,_=t<C.length?C[t]:null;return T||ss.addError(`Paragen Left turn index ${t} out of bounds`,{turnIndex:t,turnCount:v.length,lastTurnRole:N(v)?.role,lastMessageAuthor:N(N(v)?.messages)?.author,lastMessageContentType:N(N(v)?.messages)?.content.content_type,lastMessageMetadata:N(N(v)?.messages)?.metadata,altTurnCount:C.length,altLastTurnRole:N(C)?.role,altLastMessageRole:N(N(C)?.messages)?.author.role}),_||ss.addError(`Paragen Right turn index ${t} out of bounds`,{turnIndex:t,turnCount:C.length,lastTurnRole:N(C)?.role,lastMessageAuthor:N(N(C)?.messages)?.author,lastMessageContentType:N(N(C)?.messages)?.content.content_type,lastMessageMetadata:N(N(C)?.messages)?.metadata,altTurnCount:v.length,altLastTurnRole:N(v)?.role,altLastMessageRole:N(N(v)?.messages)?.author.role}),[w,T,_]}),[I,R]=d?[k,h]:[h,k],E=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";c.useEffect(()=>(zs.setState({displayingSideBySideFeedback:!0}),()=>{zs.setState({displayingSideBySideFeedback:!1})}),[]);const P=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),p=c.useCallback((y,{shouldSubmitParagenFeedback:w=!0}={})=>{if(!h||!k||!I||!R)throw new Error("Expected both turns to exist");ue(n,F=>{gs.setCurrentBranch(F,y)});const b=y===g,v=y===i;I.messages.length>0&&st(n,I.messages[I.messages.length-1].id,v?"original":"new"),R.messages.length>0&&st(n,R.messages[R.messages.length-1].id,v?"original":"new");const C=ne(n),T=[h,k].map((F,W)=>({messageId:F.messages[F.messages.length-1].id,loadFirstTokenTime:W===0?o.current.left:o.current.right,loadEndTime:N(F.messages)?.clientMetadata?.completionSampleFinishTime})),_=b?T[0].messageId:T[1].messageId,M=A.getParentPromptNode(xe(n),x);if(!M)throw new Error("Expected prompt for side by side feedback");const j={},L=M.message.clientMetadata?.variantsInStreamInfo==null&&M.message.metadata?.paragen_variants_info!=null;for(const F of T)j[F.messageId]=L?{load_first_token_time:s.conversationTurnMountTime,load_end_time:s.conversationTurnMountTime}:{load_first_token_time:F.loadFirstTokenTime,load_end_time:F.loadEndTime};w&&lt({params:{conversation_id:C,displayed_message_ids:T.map(F=>F.messageId),message_metadatas:j,rating:"selected",selected_message_id:_,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:M.message.id}})},[n,g,i,I,R,h,k,x,o,s.conversationTurnMountTime,r]);return c.useEffect(()=>fr(Ot,{requestCompletion:y=>{const w=ne(n),b=A.getParentPromptNode(xe(n),x);if(!b)throw new Error("Expected prompt for side by side feedback");if(!h||!k)throw new Error("Expected both turns to exist");const v=[h,k].map((M,j)=>({messageId:M.messages[M.messages.length-1].id,loadFirstTokenTime:j===0?o.current.left:o.current.right,loadEndTime:N(M.messages)?.clientMetadata?.completionSampleFinishTime})),C={},T=b.message.clientMetadata?.variantsInStreamInfo==null&&b.message.metadata?.paragen_variants_info!=null;for(const M of v)C[M.messageId]=T?{load_first_token_time:s.conversationTurnMountTime,load_end_time:s.conversationTurnMountTime}:{load_first_token_time:M.loadFirstTokenTime,load_end_time:M.loadEndTime};const _=y.isForSkippingParagen;lt({params:{conversation_id:w,displayed_message_ids:v.map(M=>M.messageId),message_metadatas:C,rating:_?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:_?3:r?2:1,user_prompt_message_id:b.message.id}}),_&&p(g,{shouldSubmitParagenFeedback:!1})}}),[h,k,x,n,s.conversationTurnMountTime,E,I?.messages,R?.messages,m,r,o,p,g]),e.jsx(en,{...s,setPreferredFeedback:p,leftVariantId:g,rightVariantId:f,leftTurn:h,rightTurn:k,hasActiveRequest:l,originalTurn:I,visibilityStateRef:P})}function en({setPreferredFeedback:s,leftVariantId:n,rightVariantId:a,leftTurn:t,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:m,...i}){const u=(t&&tt(t))??null,d=(o&&tt(o))??null,g=c.useMemo(()=>t?.messages??[],[t?.messages]),f=c.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:h}=i,k=c.useMemo(()=>t?.messageGroups??[],[t?.messageGroups]),I=c.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),R=Ta(),E=xe(i.clientThreadId),P=N(t?.messages),p=N(o?.messages),y=ms(A.getRequestId(E,P?.id??p?.id)),w=y&&!P?.end_turn,b=y&&!p?.end_turn,v=t?.role===G.User,C=o?.role===G.User,T=c.useRef(null),_=c.useRef(null),M=c.useRef(null),j=t!=null,L=o!=null;!j&&h.current.left==null&&(h.current.left=Date.now()),!L&&h.current.right==null&&(h.current.right=Date.now()),c.useEffect(()=>{if(T.current&&_.current&&M.current){const pe=Array(11).fill(0).map((be,Q)=>Q/10),$=new IntersectionObserver(be=>be.forEach(Q=>{Q.target===_.current?(m.current.left_visibility_initial==null&&(m.current.left_visibility_initial=Q.intersectionRatio),m.current.left_visibility_max=Math.max(m.current.left_visibility_max??0,Q.intersectionRatio)):Q.target===M.current&&(m.current.right_visibility_initial==null&&(m.current.right_visibility_initial=Q.intersectionRatio),m.current.right_visibility_max=Math.max(m.current.right_visibility_max??0,Q.intersectionRatio))}),{root:T.current,threshold:pe});return $.observe(_.current),$.observe(M.current),()=>$.disconnect()}},[m]);const{data:F}=ja(void 0,!1,R),W=hs(),ge=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(D,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:U("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",W?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(D,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),W?ge:null]}),W?null:ge,e.jsx("div",{className:U(Ca,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:T,children:e.jsxs("div",{className:U("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",W&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!W&&"gap-4 sm:gap-6"),children:[e.jsxs(nt,{horizontalScrollContainerRef:T,rootElementRef:_,onClick:()=>{s(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:j,children:[e.jsxs(rt,{children:[e.jsx(as,{messages:g,isUserTurn:v,avatarClassName:x}),e.jsx(ot,{children:e.jsx(D,{...ct.responseNumber,values:{responseIndex:1,display_label:u}})})]}),W&&j?e.jsx(at,{}):e.jsxs(e.Fragment,{children:[F!=null&&!v&&e.jsx(et,{clientThreadId:i.clientThreadId,messages:g,isParagen:!0}),e.jsx(ns,{...i,allMessages:g,groupedMessagesToRender:k,allGroupedMessages:k,isUserTurn:v,isFinalUserTurn:!1,isCompletionRequestInProgress:w,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(it,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:t,originalTurn:l})]})]}),e.jsxs(nt,{horizontalScrollContainerRef:T,rootElementRef:M,onClick:()=>{s(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:L,children:[e.jsxs(rt,{children:[e.jsx(as,{messages:f,isUserTurn:C,avatarClassName:x}),e.jsx(ot,{children:e.jsx(D,{...ct.responseNumber,values:{responseIndex:2,display_label:d}})})]}),W&&L?e.jsx(at,{}):e.jsxs(e.Fragment,{children:[F!=null&&!C&&e.jsx(et,{clientThreadId:i.clientThreadId,messages:f,isParagen:!0}),e.jsx(ns,{...i,allMessages:f,groupedMessagesToRender:I,allGroupedMessages:I,isFinalUserTurn:!1,isUserTurn:C,isCompletionRequestInProgress:b,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(it,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:l})]})]})]})})]})}function nt({horizontalScrollContainerRef:s,rootElementRef:n,onClick:a,children:t,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const l=hs(),{scrollX:m}=ta({layoutEffect:!1,container:s,target:n}),i=Ma(),u=ka(),d=c.useRef(null),g=c.useRef(null),f=c.useRef(null),[x,h]=c.useState(!1),[k,I]=c.useState(!1),[R,E]=c.useState(!1),[P,p]=c.useState(0);c.useEffect(()=>{if(!l)return;const _=new IntersectionObserver(M=>{for(const j of M)j.target===d.current?h(j.isIntersecting):j.target===f.current?E(j.isIntersecting):j.target===g.current&&I(j.isIntersecting)},{root:i?.current});return d.current&&g.current&&f.current&&(_.observe(d.current),_.observe(g.current),_.observe(f.current)),()=>{_.disconnect()}},[P,l,i]);const y=!R&&(k||x),w=na(m,_=>y?-1*_:0),b=Gs(0);c.useEffect(()=>{if(!l)return;const _=new ResizeObserver(M=>{we(M.length===1,"entryList.length === 1");const j=M[0];we(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),b.set(j.contentBoxSize[0].inlineSize)});return n.current&&_.observe(n.current),()=>{_.disconnect()}},[l,b,n]);const v=Gs(0);c.useEffect(()=>{if(!l)return;const _=new ResizeObserver(M=>{we(M.length===1,"entryList.length === 1");const j=M[0];we(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),v.set(j.contentBoxSize[0].blockSize+16),p(j.contentBoxSize[0].blockSize)});return u.current&&_.observe(u.current),()=>{_.disconnect()}},[l,v,u]);const C=e.jsx(Ht,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(D,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),T=r;return e.jsx("div",{"data-paragen-root":!0,className:U("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",l?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:U(Ia,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:U("absolute top-48 right-0! left-0! h-px","invisible"),ref:d}),e.jsx("div",{className:U("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:g}),e.jsx("div",{className:U("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:f}),t,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:T?null:e.jsx(H.div,{style:{translateX:w,width:b,bottom:v},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:U({fixed:y,"z-20 flex w-full justify-center":!0}),children:C})}):o?null:C]})})}function at(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(de,{className:"h-4 w-[75%]"}),e.jsx(de,{className:"h-4 w-[50%]"}),e.jsx(de,{className:"h-4 w-[80%]"}),e.jsx(de,{className:"h-4 w-[55%]"}),e.jsx(de,{className:"h-4 w-[66%]"}),e.jsx(de,{className:"h-4 w-[64%]"}),e.jsx(de,{className:"h-4 w-[48%]"})]})}function hs(){const{layer:s}=xr("3119715334");return s.get("should-enable-hojicha",!1)}const ot=re.div`text-sm text-token-text-secondary font-semibold`,rt=re.div`flex gap-4 items-center mb-1`,de=re.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function it({clientThreadId:s,conversationTurnMountTime:n,turn:a,originalTurn:t}){const o=St();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===t?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],m=l?.metadata?.__internal,i=l?.metadata?.paragen_display_label;if(m){const{model_id:g,model_definition_slug:f,model_definition_virtual_model_id:x,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:k,augmented_paragen_prompt_id:I,augmented_paragen_prompt:R}=m;g&&(r+=`
Model ID: ${g}`),f&&(r+=`
Model Slug: ${f}`),x&&(r+=`
Virtual Model ID: ${x}`),h&&(r+=`
Alternative Model Rule: ${h}`),k&&(r+=`
Prompt Group ID: ${k}`),I&&(r+=`
Prompt ID: ${I}`),R&&(r+=`
Prompt: ${R}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${l.id}`;const u=A.getParentPromptNode(xe(s),a.messages[0].id);if(!u)throw new Error("Expected prompt for side by side feedback");const d=u.message.clientMetadata?.variantsInStreamInfo==null&&u.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${u.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${n} (persisted)`:N(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function lt({params:s}){await us.safePost("/paragen_submission",{requestBody:s,authOption:Gt.SendIfAvailable})}const ct=xt({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function fi({handleShowRetrievalResults:s,clientThreadId:n,turnIndex:a,responseComplete:t=!1}){const[o,r]=Z(n,d=>[A.getTurnContentReferences(d,a),A.getConversationTurnAtIndex(d,a).messages]),l=c.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:t}),[n,t,a]),m=c.useRef(!1);c.useEffect(()=>{m.current||(m.current=!0,O.logEvent("File Sources Footer Shown",l))},[l]);const i=c.useCallback(()=>{O.logEvent("File Sources Footer Clicked",l),s()},[s,l]),u=c.useMemo(()=>{const d=new Set,g=[];function f(h){!h||d.has(h)||(d.add(h),g.push(h))}if(o.forEach(h=>{h.type==="file"?f(h.cloud_doc_url??h.extra?.cloud_doc_url):h.type==="file_navlist"&&h.items.forEach(k=>{f(k.cloud_doc_url)})}),t){for(const h of r)if(wa(h)){const k=Ra(h.content.result),I=h.metadata?.cloud_doc_urls??[],R=k.chunks;for(let E=0;E<R.length;E++){const P=R[E];if(!P.documentId)continue;if(E<I.length){f(I[E]);continue}const p=P.documentId.endsWith("--google")?P.documentId.split("--")[1]:void 0,y=P.metadata.cloud_doc_url??(p?`https://drive.google.com/file/d/${p}`:void 0);f(y?.toString())}break}}const x=[];for(let h=0;h<g.length;h++){const k=g[h],I=Ea(k);if(I&&x.push(I.Icon),x.length>=3)break}return x},[r,o,t]);return u.length===0&&!t?null:e.jsxs(e.Fragment,{children:[e.jsx(H.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:U("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[u.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:u.reverse().map((d,g)=>e.jsx(H.div,{className:U("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(d,{className:"icon-sm"})},g))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(D,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function sn({followups:s,analyticsMetadata:n}){const a=c.useRef(!1),t=$t();return c.useEffect(()=>{a.current||(a.current=!0,s.forEach((o,r)=>{O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...se(n),action:"show",position:(r+1).toString(),followup_text:he(o)})}))},[s,n]),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:s.slice(0,4).map((o,r)=>e.jsx(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},children:e.jsx(vi,{followUp:o,onSelectingSuggestedReply:t,analyticsMetadata:n,position:r})},r))})}const xi=re.div`
  h-[1px] opacity-45
  ${({$isSelected:s})=>s?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function vi({followUp:s,onSelectingSuggestedReply:n,analyticsMetadata:a,position:t}){return e.jsxs(H.button,{whileHover:"hover",className:U("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-0 py-3 text-start"),onClick:o=>{n(o,s,[],0),O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...se(a),action:"click",position:(t+1).toString(),followup_text:he(s)})},onMouseEnter:()=>{O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...se(a),action:"hover",position:(t+1).toString(),followup_text:he(s)})},children:[e.jsx(H.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(_t,{className:"text-token-text-secondary icon"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:he(s)})]})}const bi=()=>e.jsx(Yt,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),yi=s=>({[te.Search]:"Web Search",[te.Research]:"Research",[te.PictureV2]:"Draw Image",[te.Think]:"Think Harder"})[s]??"Title",os=(s,n,a,t,o)=>{O.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...se(a),categoryId:n.categoryId,suggestionId:n.id,position:t,action:s,numSuggestions:String(o)})},Si=(s,n)=>{const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,s.forEach((t,o)=>{os("show",t,n,o+1,s.length)}))},[s,n])},tn=({clientThreadId:s,suggestions:n,analyticsMetadata:a,style:t="default"})=>{const o=$t();return Si(n,a),e.jsx(e.Fragment,{children:n.map((r,l)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:l*.03},className:U("w-full flex-1",t==="compact"&&"flex-col"),children:[t==="compact"&&l>0&&e.jsx(xi,{$isSelected:!1}),e.jsx(_i,{clientThreadId:s,suggestion:r,onSelectingSuggestedReply:o,position:l+1,numSuggestions:n.length,analyticsMetadata:a,style:t})]},r.prompt))})},_i=({clientThreadId:s,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:t,position:o,numSuggestions:r,style:l="default"})=>{const{setThreadSystemHintMode:m}=si(),i=ps(),u=is();return e.jsx(H.button,{onClick:d=>{if(os("click",n,t,o,r),n.categoryId===te.Research)if(i?.isFree()){Na(u,"Suggested Capabilities Upsell");return}else m(n.categoryId,!0,t);a(d,n,[],0)},onMouseEnter:()=>{os("hover",n,t,o,r)},className:U("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",l==="default"&&"gap-4 p-2"),children:l==="compact"?e.jsx(Ti,{clientThreadId:s,suggestion:n}):e.jsx(ji,{clientThreadId:s,suggestion:n})})},Ti=({suggestion:s,clientThreadId:n})=>{const{categoryId:a}=s,{systemHints:t}=Xt(n),o=t.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(_t,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"}):e.jsx(Vt,{svgString:o?.logo??"",className:"text-token-text-secondary icon group-hover:text-token-interactive-label-accent-default"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:he(s)})]})},ji=({clientThreadId:s,suggestion:n})=>{const{categoryId:a,imageUrl:t,description:o,title:r,ctaLabel:l,prompt:m}=n,{systemHints:i}=Xt(s),u=i.find(d=>d.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===te.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${t})`},children:e.jsx(Pa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??yi(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((d,g)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},g))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(Fa,{isBadge:!0,className:"opacity-100",logo:e.jsx(Vt,{svgString:u?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??m}),l&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[l,e.jsx(H.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(Aa,{className:"icon-sm"})})]})]})]})},rs=(s,n,a,t)=>{O.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...se(a),tabId:n,position:t,action:s})},Ci=(s,n)=>{const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,s.forEach((t,o)=>{rs("show",t.value,n,o+1)}))},[s,n])},Mi=({clientThreadId:s,categorySuggestions:n,lastMessageId:a,analyticsMetadata:t,style:o="default"})=>{const r=n.map(({category_id:i,title:u,suggestions:d})=>({value:i,message:u,suggestions:d?.map(Tt)??[]})),[l,m]=c.useState(r[0].value);return Ci(r,t),e.jsxs(La,{value:l,onValueChange:m,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(Ua,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,u)=>e.jsx(Ii,{value:i.value,message:i.message,isActive:l===i.value,analyticsMetadata:t,position:u+1},i.value))}),r.map(i=>e.jsx(Da,{value:i.value,children:e.jsx(ki,{initialSuggestions:i.suggestions,clientThreadId:s,categoryId:i.value,isActive:l===i.value,lastMessageId:a,analyticsMetadata:t,style:o})},i.value))]})},ki=({initialSuggestions:s,clientThreadId:n,categoryId:a,isActive:t,lastMessageId:o,analyticsMetadata:r,style:l="default"})=>{const m=ne(n),i=t&&s.length===0,{suggestions:u,isLoading:d}=Oa({categoryId:a,shouldFetch:i,serverThreadId:m,lastMessageId:o}),g=i?u:s;return a==="ask"?d?e.jsx(bi,{}):e.jsx(sn,{followups:g.map(f=>({type:jt.Reply,text:f.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:d?e.jsxs(e.Fragment,{children:[e.jsx(dt,{}),e.jsx(dt,{})]}):e.jsx(tn,{clientThreadId:n,suggestions:g,analyticsMetadata:r,style:l})})},Ii=({value:s,message:n,isActive:a,analyticsMetadata:t,position:o})=>e.jsxs(Ba,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:s,onClick:()=>{rs("click",s,t,o)},onMouseEnter:()=>{rs("hover",s,t,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ls,{children:a&&e.jsx(H.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),dt=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Yt,{lines:3,size:"sm"})})]}),wi=({clientThreadId:s,categorySuggestions:n,lastMessageId:a,analyticsMetadata:t})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],l=r.suggestions.length>0?r.suggestions:void 0;return o&&l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(D,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(tn,{clientThreadId:s,suggestions:l.map(Tt),analyticsMetadata:t,style:r.style})]}):e.jsx(Mi,{clientThreadId:s,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:t})};function Ri({clientThreadId:s,followups:n,categorySuggestions:a,lastMessageId:t,analyticsMetadata:o,isTatertotFollowupsEnabled:r}){const l=Ga.useIsEnabled(s),{capabilitySuggestionsEnabled:m}=Ct(r),i=a&&a.length>0;return e.jsx(e.Fragment,{children:l&&(m?i&&e.jsx(wi,{clientThreadId:s,lastMessageId:t,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Ei,{followups:n,analyticsMetadata:o}))})}function Ei({followups:s,analyticsMetadata:n}){return e.jsxs("div",{className:"group",children:[e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}),e.jsx(sn,{followups:s,analyticsMetadata:n})]})}function Ni({modelSlug:s,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:t,isHovered:o,animateShortLabel:r}){const{data:l}=br(),[m,i]=c.useState("initial");c.useEffect(()=>{if(n){const f=setTimeout(()=>i("show"),500),x=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(f),clearTimeout(x)}}i("initial")},[n]);const{shorterLabel:u}=l?.categories.find(({defaultModel:f})=>f===s)??{},d={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},g=a?"visible":o?"show":m;return e.jsxs(H.div,{initial:"initial",animate:g,className:"flex items-center pb-0",children:[e.jsx(cs,{className:"icon-md"}),(t||r)&&e.jsx(H.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:d,transition:{type:"tween",duration:.18},children:u}),t&&e.jsx(Mt,{className:"icon-sm"})]})}function Qe(s,n){const{modelSwitcherDeny:a,subscriptionLevel:t}=s;return!!a&&a.reason===_r.RATE_LIMIT&&t===Tr.PLUS&&!n}const Ne="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Pi({className:s,clientThreadId:n,message:a,onModelSelect:t,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[l,m]=c.useState(null),[i,u]=c.useState(!1),[d,g]=c.useState(!1),f=a.metadata?.model_slug,x=a.id,h=c.useRef(null),k=b=>{b||setTimeout(()=>{h.current&&h.current.blur()},10)};c.useEffect(()=>{k(i)},[i]);const I=Z(n,Xa),R=vr({clientThreadId:n}),E=c.useRef(R);c.useEffect(()=>{E.current=R},[R]);const P=c.useCallback(b=>{E.current?ue(n,v=>{v.conduitToken=null,v.prepareState=null}):ue(n,v=>{v.conduitToken=b,v.prepareState="success"})},[n]);if(I)return null;const p=Ha(n,a.id),y=a.metadata?.model_slug,w=qa(p,y);return e.jsxs(X.Root,{onOpenChange:b=>{o&&(y&&ti(n,y,[],P),u(b),k(b))},children:[o?e.jsx(Va,{label:r?e.jsx(D,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(D,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:y}}),children:e.jsx(za,{ref:h,className:U("cursor-pointer",s),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:r?e.jsx(Ni,{modelSlug:y,animateModelLabelOnRender:w,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:d}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{className:"icon-md"}),e.jsx(Mt,{className:"icon-sm"})]})})}):null,o&&e.jsx(X.Portal,{children:e.jsxs(X.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(X.Label,{children:e.jsx(D,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx(Fi,{clientThreadId:n,messageId:x,message:a,onModelSelect:t,messageModelSlug:f,setHoveredOption:m,hoveredOption:l})]})})]})}function Fi({clientThreadId:s,message:n,messageId:a,messageModelSlug:t,onModelSelect:o,setHoveredOption:r,hoveredOption:l}){const m=ae(),{data:i=null}=yr(),u=i&&Sr(i),{modelOptions:d,messageModelEnabledTools:g}=Wa({clientThreadId:s,message:n}),f=g.includes(te.Search),x=c.useMemo(()=>d.find(p=>p.value===t),[d,t]),[h,k]=c.useMemo(()=>$a(d,p=>p.subcategory),[d]),I=Ka(n);c.useEffect(()=>{const p=d.some(y=>Qe(y,u));O.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:p,is_new_regen_dropdown:!0})},[]);const R=c.useMemo(()=>{const p=new Map;return h.forEach(y=>{const w=y.subcategory;w&&(p.has(w)||p.set(w,[]),p.get(w)?.push(y))}),p},[h]),E=U("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),P=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:m.formatMessage(Ye.search),icon:e.jsx(Qa,{className:E}),condition:f&&!I,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:m.formatMessage(Ye.nosearch),icon:e.jsx(Ya,{className:E}),condition:f&&I,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[k.map(p=>{const{value:y,...w}=p;return e.jsx(Re,{value:y,onSelect:b=>{J.logEvent("chatgpt_regenerate_switch_model_button_clicked",y,{requestedModelId:y,...se({clientThreadId:s,messageId:a})}),o({sourceEvent:b,requestedModelId:y})},includeRegenerate:!1,onMouseEnter:()=>r(y),onMouseLeave:()=>r(null),isHovered:l===y,messageModelSlug:t,includeCheck:!1,shouldShowUpsell:Qe(p,u),className:Ne,...w,icon:e.jsx("span",{className:E}),clientThreadId:s},y)}),[...R.entries()].map(([p,y])=>e.jsxs(X.Sub,{children:[e.jsx(X.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:p})}),e.jsx(X.Portal,{children:e.jsx(X.SubContent,{className:"min-w-fit",children:y.map(w=>{const{value:b,...v}=w;return e.jsx(Re,{value:b,onSelect:C=>{J.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...se({clientThreadId:s,messageId:a})}),o({sourceEvent:C,requestedModelId:b})},includeRegenerate:!1,onMouseEnter:()=>r(b),onMouseLeave:()=>r(null),isHovered:l===b,messageModelSlug:t,includeCheck:!1,className:Ne,...v,icon:null,shouldShowUpsell:Qe(w,u),clientThreadId:s},p+"-"+b)})})})]},p)),!!x&&e.jsxs(e.Fragment,{children:[e.jsx(X.Separator,{}),e.jsx(Re,{onSelect:p=>{J.logEvent("chatgpt_regenerate_try_again_button_clicked",x.value,{requestedModelId:x.value,...se({clientThreadId:s,messageId:a})}),o({sourceEvent:p,requestedModelId:x.value})},includeRegenerate:!0,onMouseEnter:()=>r(x.value),onMouseLeave:()=>r(null),messageModelSlug:t,includeCheck:!1,className:Ne,...x,label:m.formatMessage(Ye.tryAgain),subtitle:x.label,icon:e.jsx(cs,{className:E}),clientThreadId:s},x.value),P.filter(p=>p.condition).map(p=>e.jsx(Re,{onSelect:y=>{J.logEvent(p.eventName,x.value,{requestedModelId:x.value,...se({clientThreadId:s,messageId:a})}),o({sourceEvent:y,requestedModelId:x.value,extraStreamParams:p.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(p.key),onMouseLeave:()=>r(null),isHovered:l===p.key,messageModelSlug:t,includeCheck:!1,className:Ne,...x,label:p.label,subtitle:"",icon:p.icon,clientThreadId:s},p.key))]})]})}const Ye=xt({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ai=c.memo(Pi);async function Li(s,n,a,{unprocessed:t=!1}={}){const o=[],r=[],l={};for(const m of s.messages){if(Ui(m)){const i=m.metadata?.content_references,u=zt(m);if(t)o.push(u);else{const d=ai(u,i);d["text/plain"]&&o.push(d["text/plain"]),d["text/html"]&&r.push(d["text/html"])}}if(jr(m)){const i=qt.getImageAssetPointers(m);if(i.length>0){const u=i[0];try{const d=ne(a),{url:g}=await Ja.fetch(n,{asset:u,conversationId:d??void 0}),x=await(await fetch(g)).blob();["image/png","image/jpeg","image/webp"].includes(x.type)&&(l[x.type]=x)}catch{return Promise.reject()}}}}return o.length>0&&(l["text/plain"]=o.join(`

`)),r.length>0&&(l["text/html"]=r.join(`

`)),l}function Ui(s){return!s.clientMetadata?.err&&(s.author.role===G.Assistant||s.author.role===G.User)&&(s.author.role===G.User||s.recipient==="all")&&!s.metadata?.reasoning_status}const nn=async(s,n,a,t,o,r="mouse",l)=>{const i=A.getConversationTurns(xe(n))[a];if(!i)return Promise.reject();const{messages:u}=i,d=o,g=u[0]?.author.role===G.User,f=d.metaKey||d.altKey,x=await Li(i,l,n,{unprocessed:f||g});await Za(x,t,o);const h=ne(n);h&&eo(s,{messageId:u[0].id,type:"copy",serverThreadId:h,selectedText:zt(u[0]),source:r,location:"message"})},Di=null,Bi=oe(()=>me(()=>import("./o146mt4hljz23377.js"),__vite__mapDeps([31,2,1,3,32,33,5,6,34,35])).then(s=>s.VoicePlayButton)),Oi=oe(async()=>()=>null),Gi=({alwaysShow:s,isUserTurn:n,children:a})=>{const t=c.useRef(null);return c.useEffect(()=>{const o=t.current;o&&(s?requestAnimationFrame(()=>{o&&(o.style.maskPosition=s?"0% 0%":"")}):o.style.maskPosition="")},[s]),e.jsx("div",{className:U("flex",!s&&"absolute start-0 end-0 flex",n?"justify-end":"min-h-[46px] justify-start"),children:e.jsx("div",{ref:t,className:U("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1 w-full",s&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(s||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Hi=({activeVariantIndex:s,clientThreadId:n,conversationMode:a,lastMessage:t,messages:o,numVariants:r,onChangeIndex:l,onRate:m,showCanvasButton:i,showCopyButton:u,showPagination:d,showPlayButton:g,showRatingButtons:f,showRegenerateButton:x,isJam:h,turn:k,turnIndex:I})=>{const R=ve(),E=ae(),P=Le(),p=vt(),y=t?.clientMetadata?.rating;t?.clientMetadata?.requestId;const{imageGenMessages:w,enableImageGenPostSharing:b,enableMessageSliceSharing:v,hasErrorInTurn:C,isIncomplete:T}=to(o),_=no.useSelectedIndex(),M=o.filter(Cr).filter($=>$.recipient==="all"),j=w.length>0,L=ao(),F=ne(n),W=j&&M.length===0&&w.some(Ys),ge=!h&&F!=null&&!C&&!T;let pe=null;return ge&&(b||v?pe=e.jsx(qi,{clientThreadId:n,imageGenMessageId:w[_]?.id,messages:o}):L&&Wt(R,"1547743984").get("show_share_button_inline",!1)&&(pe=e.jsx(fe,{onClick:()=>{F&&wt.openSharingModal(F)},label:E.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:It}))),c.useMemo(()=>o.findLast($=>$.metadata?.n7jupd_schedulable),[o]),t&&oo(t)&&!Ys(t)?null:e.jsxs(e.Fragment,{children:[!1,d&&e.jsx(kt,{currentPage:s,onChangeIndex:l,length:r}),!1,u&&!W&&e.jsx(an,{onClick:$=>{nn(R,n,I,P,$,"mouse",p)}}),!j&&f&&e.jsxs(e.Fragment,{children:[y!=="thumbsDown"&&e.jsx(fe,{onClick:()=>m("thumbsUp"),disabled:y==="thumbsUp",icon:y==="thumbsUp"?ro:Rt,label:E.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),y!=="thumbsUp"&&e.jsx(fe,{onClick:()=>m("thumbsDown"),disabled:y==="thumbsDown",icon:y==="thumbsDown"?io:Et,label:E.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),g&&t&&M.length>0&&e.jsx(Bi,{conversationId:n,message:t,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!j&&i&&e.jsx(lo,{turn:k}),!1,t&&Di,x&&t&&e.jsx(zi,{clientThreadId:n,conversationMode:a,lastMessage:t,messages:o,hasImageGenMessage:j,withModelSelectorLabel:!1}),pe]})},Vi=({activeVariantIndex:s,clientThreadId:n,numVariants:a,onAnticipateEdit:t,onChangeIndex:o,onEnterEdit:r,showCopyButton:l,showEditMessageButton:m,showPagination:i,turnIndex:u})=>{const d=ve(),g=Le(),f=vt();return e.jsxs(e.Fragment,{children:[l&&e.jsx(an,{onClick:x=>{nn(d,n,u,g,x,"mouse",f)}}),m&&e.jsx(so,{onAnticipateEdit:t,onEnterEdit:r}),i&&e.jsx(kt,{currentPage:s,onChangeIndex:o,length:a})]})},zi=({clientThreadId:s,conversationMode:n,messages:a,hasImageGenMessage:t,lastMessage:o,withModelSelectorLabel:r})=>{const l=ni({clientThreadId:s,conversationMode:n}),m=go(s,o),i=c.useCallback(({sourceEvent:u,requestedModelId:d,appendMessages:g,extraStreamParams:f})=>{o&&l({sourceEvent:u,nodeId:o.id,requestedModelId:d,appendMessages:g,extraStreamParams:f})},[o,l]);return t?e.jsx(Oi,{messages:a,onModelSelect:i}):e.jsx(Ai,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:s,message:o,onModelSelect:i,canRegenerateResponse:m,withModelSelectorLabel:r})},an=({onClick:s})=>{const[n,a]=c.useState(!1),t=co(),o=ae(),r=c.useCallback(l=>{l.stopPropagation(),O.logEvent("ChatGPT Turn Action Copy Clicked"),s(l),a(!0),setTimeout(()=>{t()&&a(!1)},2e3),J.logEvent("chatgpt_turn_action_copy")},[t,s]);return e.jsx(fe,{icon:n?uo:mo,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function qi({clientThreadId:s,imageGenMessageId:n,messages:a}){const[t,o]=c.useState(!1),r=ae(),l=c.useMemo(()=>n?"media_generation":"message_slice",[n]),m=a?.map(u=>u.id)??void 0,i=Kr({clientThreadId:s,imageGenMessageId:n,messageSliceIds:m});return c.useEffect(()=>{O.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action",attachment_type:l})},[l]),e.jsx(fe,{onClick:async()=>{o(!0);try{await i()}finally{o(!1)}O.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action",attachment_type:l})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:t?Dt:It,disabled:t})}const ut=[1,2,3,4,10,20,30],Wi=1,$i=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function on({clientThreadId:s,isInline:n=!1}){const a=Nt(Pt.isBusinessWorkspace),t=Ft(),o=c.useRef(!1),r=Ue(s),[l,m,i,u]=Z(s,j=>[j?.mode,A.getRequestId(j),A.getConversationLastTurn(j),A.getConversationTurns(j).filter(L=>L.role===G.Assistant).length]),{isUnauthenticated:d}=ds(),g=c.useMemo(()=>{if(!r)return-1;const j=yt(r);return j()>Wi?-1:ut[Math.floor(j()*ut.length)]},[r]),f=ms(m),x=function(){return Math.random()<.5?"default":"personality_v1"},[h,k]=c.useState(null),[I,R]=c.useState(!1),[E,P]=c.useState(!1),[p,y]=c.useState(!1),[w,b]=c.useState(x),v=(j,L)=>{const F=i?.messages[0]?.id;k(j),b(L),T(F,j,L)},C=i?.role===G.Assistant,T=c.useMemo(()=>po((j,L,F)=>{r&&j&&(a&&t?ho({rating:xo(L),shown_at_assistant_turn:g,prompt:F},r,j):a||us.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:r}},requestBody:{message_id:j,rating:L,shown_at_assistant_turn:g,prompt:F},authOption:Gt.SendIfAvailable})),O.logEvent("Conversation Rating Submitted",{rating:L,showAtAssistantTurn:g,conversationId:r,prompt:F}),R(!0),setTimeout(()=>{P(!0)},1500)},2e3),[a,t,r,g]),_=u!==g||f||!C||!!a&&!t||l?.kind!==ts.PrimaryAssistant&&l?.kind!==ts.FlyingCircusCustomization&&l?.gizmo_id!==void 0&&!$i.includes(l?.gizmo_id)||p||d;c.useEffect(()=>{!_&&!o.current&&(O.logEvent("Conversation Rating Shown",{showAtAssistantTurn:g,conversationId:r}),o.current=!0)},[_]);const M=fo();return p||!M.forceShowConvoRating&&_?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ls,{children:I&&!E&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(mt,{$padded:!0,$fullRounded:n,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(D,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!I&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(mt,{$padded:!1,$fullRounded:n,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-2.5 text-sm",children:[w==="personality_v1"?e.jsx(D,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):n?e.jsx(D,{id:"CkMYrE",defaultMessage:"Is this helpful so far?"}):e.jsx(D,{id:"5BJ2RC",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(Xe,{$selected:h==="thumbsUp",onClick:()=>v("thumbsUp",w),children:e.jsx(Rt,{className:"icon-md"})}),e.jsx(Xe,{$selected:h==="thumbsDown",onClick:()=>v("thumbsDown",w),children:e.jsx(Et,{className:"icon-md"})})]})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(Xe,{className:"p-3",$selected:!1,onClick:()=>y(!0),children:e.jsx(Mr,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})]})},"rating")]})}const Xe=re.button`
  ${s=>s.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,mt=re.div`inline-flex border border-gray-100 dark:border-gray-700
${s=>s.$padded&&"py-2.5 px-4"}
${s=>s.$fullRounded?"rounded-full":"rounded-xl"}
`,Ki=oe(()=>me(()=>import("./ehfklztncg6rr3uj.js"),__vite__mapDeps([36,2,1,3,5,6,27])));function rn({clientThreadId:s,canShowInlineMessageFeedback:n,messageForRating:a}){const t=ps()?.isWorkspacePlan()??!1,o=Z(s,i=>{const u=A.getConversationTurns(i);let d=0;for(let g=u.length-1;g>=0;g--){const f=u[g];if(f.messages.some(x=>x.metadata?.is_indepth_feedback))return!0;if(f.messages.some(x=>x.author.role===G.Assistant)&&d++,d>=3)break}return!1}),r=Ue(s),l=At(i=>i.voiceFeedbackThread),m=r===l;return o?"none":m&&r&&!t?"voice":a.clientMetadata?.rating&&n?"inline":"conversation"}function Qi({clientThreadId:s,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:t,currentModelId:o}){const r=ve(),l=Ae(r,"294957382"),m=rn({clientThreadId:s,canShowInlineMessageFeedback:n,messageForRating:a}),i=Ue(s),{voiceName:u}=vo();if(m==="none")return null;let d=null;if(m==="voice"&&i)kr.feedbackShown.success({voice:u}),d=e.jsx("div",{className:"text-center",children:e.jsx(bo,{serverThreadId:i})});else if(m==="inline")d=e.jsx(Ki,{clientThreadId:s,conversationMessage:a,allGroupedMessages:t,currentModelId:o});else if(m==="conversation"){if(l)return null;d=e.jsx("div",{className:"text-center",children:e.jsx(on,{clientThreadId:s})})}return e.jsx("div",{className:"mt-3 w-full empty:hidden",children:d})}function Yi({clientThreadId:s,canShowInlineMessageFeedback:n,messageForRating:a}){const t=ve(),o=Ae(t,"294957382");return rn({clientThreadId:s,canShowInlineMessageFeedback:n,messageForRating:a})!=="conversation"||!o?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grow"}),e.jsx(on,{clientThreadId:s,isInline:!0})]})}const Xi=oe(()=>me(()=>import("./cgmvdx042qfdmsg3.js"),__vite__mapDeps([28,1,2,3,5,6,29,30])).then(s=>s.MemoryActionResult)),Ji=oe(()=>me(()=>import("./kgw7qrdf71g2l8gc.js"),__vite__mapDeps([37,2,38,39,1,3,5,6,40])).then(s=>s.AutomationSourceHeader)),gt=oe(()=>me(()=>import("./eeq4y4a9pg3xg60r.js"),__vite__mapDeps([41,2,1,3,5,6,4,7,8,9])).then(s=>s.TextMessageEditor)),pt=80,Zi=16,ht={minHeight:`calc(100dvh - ${Do}px - 120px)`};function el(s){const{turnIndex:n,isFinalTurn:a,clientThreadId:t,onRequestCompletion:o,currentModelId:r,avatarClassName:l,showAvatar:m,scrollToMessageId:i,dateHeaderType:u}=s,{isNewScrollEnabled:d}=Lt(),g=bt();ps()?.normalizedAccountUserId;const f=ve(),x=!!g&&Ir(g),h=yo(),k=Nt(Pt.isBusinessWorkspace),I=qo(),R=!!m,P=null!=null,[p,y]=Z(t,S=>{const z=A.getConversationTurnAtIndex(S,n),q=n>0?A.getConversationTurnAtIndex(S,n-1):null,B=q?.role===G.User&&q.messages.some(V=>V.metadata?.visually_hide_response_from_conversation);return[z,B]}),{messages:w,messageGroups:b}=p,v=So(),C=w[0],T=N(w),{messages:_,visibleMessages:M,messageGroups:j,lastMessageToRender:L,doesTurnHaveDelayedMessages:F}=c.useMemo(()=>{const S=v.size===0?-1:b.findIndex(V=>V.type===$e?V.groups.some(le=>le.messages.some(qe=>v.has(qe?.id))):V.messages.some(le=>v.has(le?.id))),z=S!==-1&&S+1<b.length,q=z?b.slice(0,S+1):b,B=z?q.flatMap(V=>V.type===$e?V.groups.flatMap(le=>le.messages):V.messages):w;return{messages:B,visibleMessages:B.filter(wr),messageGroups:q,lastMessageToRender:N(B),doesTurnHaveDelayedMessages:S!==-1}},[w,b,v]),W=Ae(f,"1887864177"),ge=Xr(),$=Z(t,S=>A.getLastMessageSystemHints(S))?.includes(te.Tatertot)&&Ae(f,"28816792"),{capabilitySuggestionsEnabled:be}=Ct($),Q=c.useMemo(()=>({clientThreadId:t,turnIndex:n,messageId:T?.id}),[t,n,T?.id]),ln=!1,[fs,xs]=c.useState(!1),[vs,cn]=c.useState(!1),dn=c.useContext(_o)!=null,K=p.role===G.User,bs=Rr(),ye=Er(t),De=To(p.gizmoId??ye).data,Be=Ut(t),un=jo(t),ys=Co(Be),mn=Mo(Be,un),Ss=Ft(),[Oe,gn,pn,_s,Se,ll,hn,fn,xn,Ts,vn,ie,js,_e,bn]=Z(t,S=>{const z=A.getParentPromptNode(S,C.id),q=z?.message.clientMetadata?.variantsInStreamInfo??(z?.message.metadata?.paragen_variant_choice?void 0:z?.message.metadata?.paragen_variants_info),B=A.getVariantIds(S,C.id),V=A.getCurrentVariantId(S,C.id),le=V?B.indexOf(V):0,qe=q&&S?.tree!=null&&B.some(ce=>{const{errType:Os}=S.tree.getLeafFromNode(ce).message.clientMetadata??{};return Os!=null&&Os!=="info"}),We=A.getConversationTurns(S);return[S?.async_status===Ke.STREAMING,A.isMessageTurnEnded(S,T?.id),qe,$o(S?.mode,De?.gizmo.id),S?.continuingFromSharedConversationId!=null,null,We.findIndex(ce=>ce.role===G.User)===n,Ko(We,ce=>ce.role===G.User)===n,We.findIndex(ce=>ce.role===G.Assistant)===n,A.getRequestId(S,T?.id),q,B,le,!!S?.continuingFromSharedPostId,S?.currentLeafId]});let yn="default";const Sn=_.some(S=>S.content.content_type===Pe.MultimodalText),_n=Wt(f,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Cs}=ds(),Ms=p.messages.map(S=>S.id),Y=c.useRef(null),ks=!d&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&I,Te=K?N(M):void 0,Ge=Te?.id,Tn=c.useCallback(()=>{Ge&&(O.logEvent("Edit Prompt",{id:Ge,threadId:ne(t)}),Nr(f,"chatgpt_edit_prompt"),xs(!0))},[Ge,t,f]),jn=c.useCallback(()=>{xs(!1)},[]),Is=ko()??!1,{onChangeRating:Cn}=Io({clientThreadId:t,currentModelConfig:Be}),Mn=S=>{if(!T)return;Cn({nodeId:T.id,messageId:T.id,rating:S});const z=Is&&b.some(q=>q.type!==$e&&q.messages?.some(Wo));O.logEventWithStatsig(S==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:T.id,threadId:ne(t),model:r,rating:S,...Is?{isCATriggered:z}:{}}),cn(!0)},[kn]=c.useState(()=>Date.now()),In=Ue(t),ws=wo(t)?.value,wn=ws===Ke.STREAMING,Rn=ws===Ke.REALTIME,En=Ts!=null,Nn=ms(Ts),Pn=qs.useState(S=>qs.isReplayInProgress(S,bn)),ee=!gn&&Nn||F||Rn||Pn&&a,Rs=Bt(),Es=c.useRef(!1),Fn=Ro(t,T),[,An]=oa(),{isOpen:He}=Js(),Ns=Qt();c.useEffect(()=>{const z=new URLSearchParams(window.location.search).get("message");!(z!=null&&Ms.includes(z))||!Y.current||(Y.current.scrollIntoView({behavior:"instant"}),An(B=>(B.delete("message"),B),{replace:!0,preventScrollReset:!0}))},[]),c.useEffect(()=>{if(d)return;const q=new URLSearchParams(window.location.search).get("message")!=null;if(Es.current||q||i===void 0||!Y.current||Ns){i==="finalAgentTurn"&&a&&ue(t,B=>{B.scrollToMessageId=void 0});return}(Ms.includes(i)||i==="finalAgentTurn"&&a)&&(Es.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Y.current)if(i==="finalAgentTurn"&&a)Y.current.scrollIntoView({behavior:"instant",block:"end"}),ue(t,B=>{B.scrollToMessageId=void 0});else{const B=Y.current.offsetHeight;let V;He?V=-8:B>pt?V=pt-B:V=0,Y.current.style.scrollMarginTop=`${V+Zi}px`,Y.current.scrollIntoView({behavior:"smooth"})}})}))},[i,Y.current,He,Ns]);const{showDebugConversationTurns:Ln}=St(),Un=Eo(),Dn=!h&&!Se&&!_e&&!bs&&!K,Bn=L?.author.role===G.Assistant?L:null,On=L?.metadata?.system_hints?.includes(te.Research);No({isCompletionRequestInProgress:ee,isUserTurn:K,message:Bn});const{isOpen:Gn}=Js(),Hn=Po(),je=Fo(_s),Ce=!je&&Dn&&a&&vn?.num_variants_in_stream===2&&ie.length<=2&&!T?.clientMetadata?.inlineComparisonRating&&!pn,Vn=At(S=>S.voiceFeedbackThread),Me=a&&(En||In===Vn),Ve=Oe||ee||wn,Ps=!fs&&!h&&!Se&&!_e&&!je&&!Gn&&p.role!==G.Developer&&(!Me||!Ve),zn=!Ps&&(!Me||!Ve)&&(h||Se||_e),qn=_.some(S=>Pr(S)===Fr.l1239dk1),Wn=Me&&!ee&&!Se&&!_e&&!h&&!qn&&(W||ge||be||$),ke=T!=null&&!0&&(!k||mn||x||Ss)&&!je&&!Cs&&!bs&&!T.metadata?.b1de6e2_s,Fs=(!k||Ss)&&ke&&Me&&!Oe&&!ee&&!He,As=!h&&!((ee||Oe)&&a)&&ie.length>1&&!Ce&&!0,Ls=K&&_.some(S=>Ao(S)?.shouldHideContent),$n=K&&Te!=null&&!je&&!h&&!Sn&&!Ls&&!Cs&&!0&&!On,Kn=T!=null&&(T.clientMetadata?.disclaimers??[]).length===0,Us=c.useCallback(S=>{ue(t,z=>{gs.setCurrentBranch(z,ie[S])}),O.logEvent("Change Active Node",{intent:"toggle_between"})},[t,ie]),Qn=Lo(p,_,Ln),{toggleThreadSidebar:Ds}=Ar(),Ie=T?.id,Yn=c.useCallback(()=>{Ie&&Ds({type:"retrievalResults",clientThreadId:t,turnIndex:n,messageId:Ie})},[Ie,Ds,t,n]),Xn=c.useMemo(()=>Uo(p,ys,!!ye),[ys,ye,p]);if(!Qn&&!Ce)return ks?e.jsx("div",{style:ht}):null;if(y)return null;const Jn=L?.metadata?.followup_prompts?L.metadata.followup_prompts.map(S=>({text:S,type:jt.Reply})):[],Zn=L?.metadata?.category_suggestions,ea=!_.some(S=>qt.getAudioAssetPointers(S).length>0)&&!0&&!ye,sa=!ee&&_.some(S=>S.author.role===G.Assistant&&S.metadata?.onboarding?.main_usages),ze=_.find(S=>!!S.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Bs=!Ls&&(!a||!ee);return Un&&!a&&M.length===0?null:e.jsx(Bo.Provider,{value:xn,children:e.jsxs(Oo,{children:[e.jsx(Go,{dateHeaderType:u,turn:p}),e.jsxs("article",{className:U("text-token-text-primary w-full",!d&&i==="finalAgentTurn"&&I?"opacity-0":"",{hidden:dn&&hn}),style:ks?ht:void 0,ref:Y,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!d&&a,children:[e.jsx(Ho,{role:p.role}),e.jsxs(Ze,{verticalPadding:yn,horizontalPadding:Ce?"none":"standard",children:[Ce?e.jsxs(e.Fragment,{children:[e.jsx(pi,{isFeedbackEnabled:ke,variantIds:ie,conversationTurnMountTime:kn,...s}),_n&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Ht,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Ot.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(Vo,{className:"text-token-text-secondary me-1"}),e.jsx(D,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Fe,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",children:e.jsxs(e.Fragment,{children:[ln,!K&&!0&&R&&e.jsx(tl,{children:e.jsx(as,{messages:_,isUserTurn:K,avatarClassName:l,gizmo:De})}),e.jsx("div",{className:es({isUserTurn:K}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!K&&!h&&e.jsx(Xi,{messages:_,clientThreadId:t,gizmoId:De?.gizmo.id}),Hn&&!K&&e.jsx(Ji,{clientThreadId:t,messages:_}),fs&&Te?e.jsx(gt,{message:Te,clientThreadId:t,onRequestCompletion:o,onExitEdit:jn,disabled:Rs}):e.jsx(ns,{allMessages:w,groupedMessagesToRender:j,allGroupedMessages:b,...s,isUserTurn:K,isFinalUserTurn:fn,isCompletionRequestInProgress:ee,isFeedbackEnabled:ke,isFinalTurn:a,hasActiveRequest:Rs}),Xn&&e.jsx(fi,{handleShowRetrievalResults:Yn,clientThreadId:t,turnIndex:n,responseComplete:!Ve}),sa&&e.jsx(Qr,{clientThreadId:t}),ze&&ze.length>0&&!ee&&e.jsx(Yr,{clientThreadId:t,examples:ze}),Ps&&e.jsx(Gi,{isUserTurn:K,alwaysShow:!0,children:K?e.jsx(Vi,{activeVariantIndex:js,clientThreadId:t,numVariants:ie.length,onAnticipateEdit:gt.prefetch,onChangeIndex:Us,onEnterEdit:Tn,showCopyButton:Bs,showEditMessageButton:$n,showPagination:As,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(Hi,{activeVariantIndex:js,clientThreadId:t,conversationMode:_s,lastMessage:T,messages:_,numVariants:ie.length,onChangeIndex:Us,onRate:Mn,showCanvasButton:Fn&&!0,showCopyButton:Bs,showPagination:As,showPlayButton:Kn,showRatingButtons:ke,showRegenerateButton:ea,isJam:P,turn:p,turnIndex:n}),e.jsx(Ws,{clientThreadId:t,message:T,turnIndex:n}),Fs&&e.jsx(Yi,{canShowInlineMessageFeedback:vs,clientThreadId:t,messageForRating:T})]})}),zn&&e.jsx(Ws,{clientThreadId:t,message:T,turnIndex:n}),Fs&&e.jsx(Qi,{canShowInlineMessageFeedback:vs,clientThreadId:t,messageForRating:T,allGroupedMessages:b,currentModelId:r}),Wn&&e.jsx(Ri,{followups:Jn,categorySuggestions:Zn,clientThreadId:t,lastMessageId:Ie,analyticsMetadata:Q,isTatertotFollowupsEnabled:$})]})})})]})}),e.jsx(zo,{clientThreadId:t,turn:p,isFinalTurn:a})]})]})]})})}const sl=aa.memo(el),tl=re.div`shrink-0 flex flex-col relative items-end`;function nl(s){const n=A.getConversationTurns(s),a=n.findIndex(o=>o.role===G.Assistant);if(a===-1)return;const t=n[a];for(let o=0;o<t.messageGroups.length;o++)if(t.messageGroups[o].type===Xs.SearchGPTQuery){const l=t.messageGroups.slice(o+1).find(({type:i})=>i===Xs.Text);if(l==null)return;const m=Ur(l.messages[0]);if(m?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:m[0],message:l.messages[0]}}}function al(s,n){if(n==null||s==null)return s;const a=new Set(s.domains.map(t=>t.url));return{...s,domains:[...s.domains,...n.domains.filter(t=>!a.has(t.url))],safe_urls:[...s.safe_urls??[],...n.safe_urls??[]]}}function ol({clientThreadId:s,prefetchNavlink:n,setPrefetchNavlink:a}){const t=c.use(n),{value:o}=Lr("1032814809");c.useEffect(()=>{window.__oai_SSR_NAVLINK&&Qo.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:t?.timing},window.__oai_SSR_NAVLINK)},[]),c.useEffect(()=>{t==null&&a(void 0)},[t,a]);const r=c.useMemo(()=>t==null?null:{...t.navlink,domains:t.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[t]),l=Z(s,nl),m=c.useMemo(()=>al(r,l?.navigationCitation),[l,r]);return t==null||m==null?null:e.jsxs("div",{children:[e.jsx(Ze,{horizontalPadding:"standard",children:e.jsx(Fe,{children:e.jsx("div",{className:es({isUserTurn:!0}),children:e.jsx("div",{className:oi(!0),children:e.jsx(Yo,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(Xo,{text:t.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(Ze,{horizontalPadding:"standard",children:e.jsx(Fe,{children:e.jsxs("div",{className:es({isUserTurn:!1}),children:[e.jsx(ei,{clientThreadId:s,turnIndex:l?.turnIndex??2,nextMessage:l?.message,navigationCitation:m}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",t.timing,"ms"]}),e.jsx(rl,{})]}):null]})})})}),e.jsx(Jo,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function rl(){const[s,n]=c.useState(null);return c.useEffect(()=>{const a=new PerformanceObserver(t=>{t.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(l=>l??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),s==null?null:e.jsxs("span",{children:["render: ",s,"ms"]})}function Nl(s){const{prefetchNavlink:n,setPrefetchNavlink:a,clientThreadId:t}=s,{isNewScrollEnabled:o}=Lt(),r=Zo(t),l=er(),i=sr().store.useContentAreaDimensions(tr.Header,u=>u?.height?u.height:void 0);return e.jsxs("div",{onCopy:r,className:U("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",l&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",i?null:!o&&"pb-25"),style:{paddingBottom:i},children:[n?e.jsx(Dr,{name:"prefetch-navlink",onError:u=>{ss.addError("Error with prefetch navlink",{error:u}),a(void 0)},children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(ol,{clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a})})}):null,e.jsx(Br,{children:e.jsx(il,{isNewScrollEnabled:o,paddingBottom:i,...s})})]})}function il({onRequestCompletion:s,clientThreadId:n,scrollContainerRef:a,paddingBottom:t,isNewScrollEnabled:o}){const[r,l,m,i]=Z(n,M=>[M?.mode,A.getConversationTurnIds(M),M?.conversationOrigin===Or.APPLE,M?.scrollToMessageId]),u=nr(),d=Qt(),g=ar(),f=or(),[x]=rr(),h=ir(),[k]=lr(),I=Ut(n),R=cr(I.id),E=r?.kind===ts.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":R;c.useEffect(()=>{u&&(J.logEvent("chatgpt_continue_conversation_page_loaded"),O.logEvent("Continue Conversation: Page Loaded"),J.logEvent("chatgpt_conversation_share_page_loaded"),O.logEvent("Share Public Chat: Shared Conversation Loaded"))},[u]);const P=c.useCallback(()=>{o||f({behavior:"smooth"})},[o,f]),p=c.useContext(Gr),y=Hr(p),[w,b]=c.useState(!1),v=(w||!1)&&!y,C=c.useRef(null),T=dr(n),_=d&&!g;return e.jsxs(e.Fragment,{children:[_&&e.jsx(di,{}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(D,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{wt.openModal(ur.ReportConversation),J.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),O.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(D,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),l.map((M,j)=>e.jsx(sl,{isFinalTurn:j===l.length-1,turnIndex:j,clientThreadId:n,onRequestCompletion:s,currentModelId:I.id,avatarClassName:E,scrollToBottom:o?void 0:P,scrollToMessageId:o?void 0:i,dateHeaderType:T(j),showAvatar:void 0},M)),!o&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(mr,{setIsScrolledToEdge:M=>{b(M)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:C}),m&&x&&!k&&e.jsx(ft,{className:U("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{J.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:e.jsx(gr,{className:"icon-md text-token-text-primary"})}),e.jsx(ls,{children:v&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(ft,{className:U(t?null:"bottom-8"),style:{bottom:t},onClick:()=>{J.logEvent("chatgpt_thread_scroll_to_bottom"),C.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(pr,{className:"icon-md text-token-text-primary"})})})})]})]})}const ft=re.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Zt as P,El as S,Nl as T,Rl as a};
//# sourceMappingURL=pfex3j43xcablmav.js.map
