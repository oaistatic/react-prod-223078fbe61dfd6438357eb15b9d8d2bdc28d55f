import{cV as k}from"./krbmwir12ubt4od1.js";import{b as H,S as d,c as i,E as f,u as A,C as u,D as c,d as y}from"./eqsdgkbw87fpj3r7.js";import{H as P}from"./jy1u8exw8iz2slve.js";function D(e,t){const n=L(e);if(n.length===0)return t;let o=t;return n.forEach(s=>{o=F(s,o)}),o}function F(e,t){return H(t,{start:e.fromA,end:e.toA},w(e))}function w(e){const{fromA:t,toA:n,fromB:o,toB:s}=e;return s-o-(n-t)}function L(e){const t=[],n=(o,s,r,a)=>{t.push({fromA:o,toA:s,fromB:r,toB:a})};return e.changes.iterChangedRanges(n,!0),t}function O(e,t){const n=Array.from(e.keys()),o=Array.from(t.keys());if(n.length!==o.length)return!1;n.sort(),o.sort();for(let s=0;s<n.length;s++)if(n[s]!==o[s])return!1;for(const s of n){const r=e.get(s),a=t.get(s);if(!r||!a||r.start!==a.start||r.end!==a.end)return!1}return!0}const S=d.define(),R=d.define(),b=d.define(),B=d.define();function T(e){return new Map(e.map(t=>[t.id,t.at]))}const m=i.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(S))return n.value;return e}}),l=i.define({create(){return[]},update(e,t){for(const a of t.effects)if(a.is(R))return a.value;const n=e,o=T(n),s=D(t,o);return O(o,s)?n:A(n,s)}}),C=i.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(b))return n.value;return e}}),g=i.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(B))return n.value;return e}});function h(e){if(!e||e.to-e.from===0)return c.none;const t=c.mark({class:P.code});return c.set([t.range(e.from,e.to)])}function p(e,t,n){if(e.length===0)return c.none;const s=[...e].sort((r,a)=>r.at.start-a.at.start).map(r=>{if(r.at.end-r.at.start===0)return null;const a=r.id===t,v=r.id===n,E=y({isHovered:a,isFocused:v,isCode:!0,diffStatus:r.diffStatus});return c.mark({class:E,attributes:{"data-comment-id":r.id}}).range(r.at.start,r.at.end)}).filter(k);return c.set(s)}const j=i.define({create(e){const t=e.field(m,!1);return h(t??null)},update(e,t){const n=t.state.field(m,!1);return h(n??null)},provide:e=>f.decorations.from(e)}),x=i.define({create(e){const t=e.field(l,!1),n=e.field(C,!1),o=e.field(g,!1);return p(t??[],n??null,o??null)},update(e,t){const n=t.state.field(l,!1),o=t.state.field(C,!1),s=t.state.field(g,!1);return p(n??[],o??null,s??null)},provide:e=>f.decorations.from(e)});function G(e){e.state.selection.main.empty&&e.dispatch({effects:S.of(null)})}function I(e){let t=e.dataset.commentId;for(let n=0;n<10&&!t&&e.parentElement;n++)e=e.parentElement,t=e.dataset.commentId;return t}function M(e){const t=e.target,n=I(t);n&&u.focusComment(n)}function N(e){const t=e.target,n=I(t);n?u.mouseEnterComment(n):u.mouseLeaveComment()}function z(e,t=null,n=null){return[l.init(()=>e),m,C.init(()=>t),g.init(()=>n),j,x,f.updateListener.of(o=>{o.selectionSet&&G(o.view)}),f.domEventHandlers({click:M,mouseover:N})]}export{S as a,b,z as c,B as d,l as e,R as s};
//# sourceMappingURL=bhqc37jb73aufzkm.js.map
