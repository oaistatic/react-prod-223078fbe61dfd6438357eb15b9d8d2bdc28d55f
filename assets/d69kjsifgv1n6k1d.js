import{j as e,i as F,k as H,f as B,r as n,M as S,a6 as O,a5 as D,L as U,a9 as E}from"./b8ijctzpgh0s7wpx.js";import{B as V}from"./me9hhl03j9gxv6g7.js";import{b as z,c as q}from"./nvghija6qp2cunds.js";import{P as G}from"./ku4zsoy6w4wkp690.js";import{m2 as K,dq as _,gN as $,ds as Q,m3 as Y,bL as Z,bM as J,dK as X,gO as ee,gM as se,iu as I}from"./krbmwir12ubt4od1.js";import{j as y,b1 as M,O as te,B as ae,c as ne,eR as re,E as oe,aY as ie,u as W}from"./citrwydz0bgriwlc.js";import{b as ce}from"./otl51en3t0ec5n7s.js";import{W as le}from"./ju91cj9mp2lx2yuz.js";import{b as de,a as me,c as ue,h as he}from"./gw319re0na8zpsh7.js";import{W as fe}from"./jmanj1myc9r62cus.js";import{T as xe}from"./n3fqqr9zf79bnmr6.js";import{e as f,f as pe,l as A,t as ge}from"./omp8ie1vzl40ti1z.js";import{S as ke}from"./d7kgdj2gn7xkll1d.js";import{I as ve}from"./mtbwfu1a5yslb3p2.js";import{a as be,b as je}from"./eeyp7d7oqudhas3m.js";import{u as we}from"./nnffynscsbaol5fb.js";function Ce({disabled:o,children:i}){return o?e.jsx("div",{className:"pointer-events-none opacity-50 select-none","aria-hidden":"true",tabIndex:-1,inert:!0,children:i}):i}function Se(){const o=F(),i=f(({tasksFilter:d})=>d),x=f(({setTasksFilter:d})=>d),p=y(),m=H(),r=B(),v=M(p,"2665240312"),u=n.useCallback(d=>{x(d);const j=new URLSearchParams(m.search);j.set("tab",d==="archived"?"archived":"all"),r({pathname:m.pathname,search:j.toString()},{replace:!0})},[x,m,r]);return e.jsx("div",{className:"border-token-border-primary mt-4 flex w-full items-center border-b align-middle md:mt-6",children:v&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(xe,{currentTab:i,onChange:u,withUnderline:!0,tabs:[{label:o.formatMessage({id:"wham.whamTasksHeader.all",defaultMessage:"Tasks"}),key:"current"},{label:o.formatMessage({id:"wham.whamTasksHeader.archived",defaultMessage:"Archive"}),key:"archived"}]})})})}function Ne(){const o=F(),i=f(({tasksFilter:c})=>c),{data:x,isLoading:p,error:m,fetchNextPage:r,hasNextPage:v,isFetchingNextPage:u,refetch:d,isPending:j}=pe({refetchOnMount:!0,refetchOnWindowFocus:!0}),g=x?.pages.flatMap(c=>c.items??[])??[],N=f(c=>c.pendingTaskIds),w=g.length>0,[l,T]=n.useState(null),t=i==="archived"?[]:Array.from(Object.entries(N)).filter(([c,b])=>!g.some(k=>k.id===b)).map(([c])=>c).reverse(),a=g.length===0&&t.length===0;return e.jsx("div",{className:"flex flex-col justify-center",children:p&&!w?e.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:e.jsx(te,{})}):e.jsxs(e.Fragment,{children:[a&&e.jsx(e.Fragment,{children:m?e.jsxs("div",{className:"mt-6 flex w-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(S,{id:"wham.whamTasksSection.errorLoadingTasks",defaultMessage:"Error loading tasks"})}),e.jsx(ae,{color:"secondary",onClick:()=>d(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{id:"wham.whamTasksSection.retry",defaultMessage:"Retry"}),e.jsx(ke,{className:"icon-xs"})]})})]}):e.jsx("div",{className:"mt-6 flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"text-token-text-secondary text-sm",children:i==="current"?o.formatMessage({id:"wham.whamTasksSection.noActiveTasks",defaultMessage:"No active tasks"}):o.formatMessage({id:"wham.whamTasksSection.noArchivedTasks",defaultMessage:"No archived tasks"})})})}),i!=="archived"&&t.map(c=>e.jsx(be,{},c)),g.map((c,b)=>e.jsx(je,{index:b,taskListItem:c,hoveredIndex:l,onMouseEnter:()=>{T(b)},onMouseLeave:()=>T(null)},c.id)),e.jsx(ve,{isFetchingNextPage:u||j,hasNextPage:v??!1,fetchNextPage:r})]})})}const Te=n.memo(Ne);function Ee(){const o=y();return M(o,"3984934927")}const ye=o=>n.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...o},n.createElement("path",{d:"M14.3349 13.3301V6.60645L5.47065 15.4707C5.21095 15.7304 4.78895 15.7304 4.52925 15.4707C4.26955 15.211 4.26955 14.789 4.52925 14.5293L13.3935 5.66504H6.66011C6.29284 5.66504 5.99507 5.36727 5.99507 5C5.99507 4.63273 6.29284 4.33496 6.66011 4.33496H14.9999L15.1337 4.34863C15.4369 4.41057 15.665 4.67857 15.665 5V13.3301C15.6649 13.6973 15.3672 13.9951 14.9999 13.9951C14.6327 13.9951 14.335 13.6973 14.3349 13.3301Z"}));function Me(){const{eligible:o,markAsViewed:i}=K(),x=f().environmentId,{data:p,isLoading:m}=A(),r=p?.find(t=>t.id===x),v=p?.some(t=>t.setup.length>0)??!1,{data:u,isLoading:d}=ge(),j=u??!1,g=_(),N=$(),w=n.useMemo(()=>[{id:"step-1",link:"/codex/settings/environment/create",checked:!0,label:e.jsx(S,{id:"codex.onboarding.step-1",defaultMessage:"Set up your first environment"})},{id:"step-2",checked:j,label:e.jsx(S,{id:"codex.onboarding.step-2",defaultMessage:"Create your first task"})},{id:"step-3",checked:v,link:`/codex/settings/environment/${r?.id}/edit#setup-script`,label:e.jsx(S,{id:"codex.onboarding.step-3",defaultMessage:"Install dependencies for the ‘{environmentName}’ environment",values:{environmentName:r?.label}})}],[v,r,j]),l=w.every(t=>t.checked);n.useEffect(()=>{l&&i()},[l,i]);const T=g||!o||m||d||!r||l;return e.jsx(O,{children:T?null:e.jsx(D.div,{className:"fixed end-6 bottom-6 z-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:N?1e-5:.5},children:e.jsxs("div",{className:"bg-token-bg-primary border-token-border-default flex w-[272px] flex-col gap-4 rounded-xl border p-4 shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(S,{id:"k3HHpd",defaultMessage:"Finish setting up Codex"})})}),e.jsx("div",{className:"flex flex-col gap-3",children:w.map((t,a)=>{const c=!t.checked&&w.filter(k=>!k.checked).length===1&&w.findIndex(k=>!k.checked)===a,b=e.jsxs("div",{className:"flex items-start gap-3 select-none",children:[e.jsx("div",{className:"mt-0.5",children:t.checked?e.jsx(Q,{className:"icon-md text-token-text-tertiary"}):e.jsx("span",{className:"icon-md border-token-text-secondary inline-block h-4 w-4 rounded-full border bg-transparent"})}),e.jsx("span",{className:ne("text-sm",t.checked?"text-token-text-tertiary line-through":"text-token-text-primary"),children:t.label}),t.link&&!t.checked&&e.jsx(ye,{className:"icon text-token-text-primary"})]},t.id);return t.link&&!t.checked?e.jsx(U,{to:t.link,onClick:()=>{c&&i()},children:b},t.id):b})})]})})})}function _e(){const o=y(),i=Y(),x=Ee(),p=Z(J.workspaceId),{eligible:m}=X(),r=ee();we();const v=M(o,"547652119");return f(u=>u.showReactQueryDevtools),i?v?e.jsx(E,{to:"/codex/failwhale"}):r==="DISABLED"?e.jsx(E,{to:"/",replace:!0}):m?e.jsx(E,{to:"/codex/onboarding"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{page:"codex"},p),!1,e.jsx(ce,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(me,{children:e.jsx(ue,{hideNotificationBell:!0})}),e.jsx(re,{children:e.jsx(Pe,{})})]})})]}):x?e.jsx(de,{}):e.jsx(E,{to:"/"})}const Pe=()=>{const o=f(({setPromptDraft:s})=>s),i=f(({setTasksFilter:s})=>s),x=f(s=>s.setEnvironmentId),p=f(s=>s.setBranch),{data:m}=A(),r=H(),v=f(s=>s.lastViewedTaskId),[u]=n.useState(!!v),[d,j]=n.useState(!1),g=n.useRef(u),N=n.useRef(null),w=y(),l=M(w,"1406552515"),T=f(({promptDraft:s})=>s),t=oe(),a=n.useMemo(()=>t?new G(z()):new se,[t]),c=n.useRef(!1);n.useEffect(()=>{r.state?.focusComposer&&!c.current&&!l&&(a.focus(),c.current=!0)},[r.state?.focusComposer,a,l]),n.useEffect(()=>{a.setText(l?"":T)},[a,l]);const b=n.useRef(null),k=I(({setIsExpanded:s})=>s),P=I(s=>s.isExpanded),L=ie(a.store,({isFocused:s})=>s);return W(()=>{u&&k(!1)},[u]),W(()=>{const s=N.current;if(!s)return;const h=()=>{const C=s.scrollTop>0;if(j(C),g.current)return;const R=a.isEmpty()&&!a.store.getState().controlsDisabled&&!L&&P&&C;g.current=R,k(!R)};return s.addEventListener("scroll",h),()=>s.removeEventListener("scroll",h)},[P,L,k,a]),n.useEffect(()=>a.subscribe("focus",()=>{g.current=!1}),[a]),n.useEffect(()=>a.subscribe("blur",s=>{s.relatedTarget instanceof HTMLElement&&b.current?.contains(s.relatedTarget)||d&&(g.current=!0,k(!1))}),[a,d,k]),n.useEffect(()=>a.subscribe("change",()=>{o(a.getContentToSend().content)}),[a,o]),n.useEffect(()=>{const s=new URLSearchParams(r.search),h=s.get("prompt");h&&a.setText(h);const C=s.get("tab");C==="archived"?i("archived"):C==="all"&&i("current")},[r.search,a,i]),n.useEffect(()=>{const h=new URLSearchParams(r.search).get("environment");h&&m?.some(C=>C.id===h)&&x(h)},[r.search,m,x]),n.useEffect(()=>{const h=new URLSearchParams(r.search).get("branch");h&&p(h)},[r.search,p]),e.jsxs(q.Provider,{value:a,children:[e.jsx("div",{className:"h-full w-full overflow-y-auto",ref:N,style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"z-0 mx-auto flex w-full flex-col md:w-3xl",children:[e.jsx(fe,{}),e.jsxs("div",{className:"bg-token-bg-primary sticky top-0 z-50 flex flex-col items-center",children:[e.jsx("h1",{className:"mb-4 pt-4 text-2xl 2xl:mb-8 2xl:pt-8 2xl:text-3xl [@media(max-height:550px)]:hidden",children:e.jsx(S,{id:"wham.home.title",defaultMessage:"What are we coding next?"})}),e.jsx("div",{ref:b,className:"w-full pt-px max-md:px-3",children:e.jsx(Ce,{disabled:l,children:e.jsx(le,{disableAutoFocus:u||l,isExpandedByDefault:!l,isBigBoxMode:!l,onSubmit:()=>{a.eraseContent(),o("")},onSuccess:()=>{he.set(s=>s+1)}})})}),e.jsx(Se,{})]}),e.jsx(Te,{})]})}),e.jsx(Me,{})]})};export{_e as W};
//# sourceMappingURL=d69kjsifgv1n6k1d.js.map
