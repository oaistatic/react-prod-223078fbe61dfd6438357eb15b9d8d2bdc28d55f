import{i as H,j as s,M as K,c as Ss,e as We,a5 as J,r as p,a6 as Ie,a as Ct,b as Se,d as mn,u as bt,o as pn,ao as xn}from"./b8ijctzpgh0s7wpx.js";import{C as hn,a as gn}from"./m27qwee0va0l7e3n.js";import{eg as ws,uL as ze,jr as L,js as G,mo as qe,uM as _s,am as vt,al as $e,eI as xe,E as Cn,dN as bn,uN as vn,eD as yn,n1 as En,qx as Jt,qu as Tn,eL as Sn,uO as wn,uP as _n,uQ as As,dY as $,fv as yt,gC as An,ag as es,dI as Mn,aX as ie,mQ as ae,eJ as E,bH as ts,uR as jn,eO as Dn,bI as ss,gv as kn,gw as In,gy as Nn,gz as On,at as Rn,uS as Fe,O as Pn,aM as Ln,f3 as Bn,mq as Hn,dq as Ms,uf as P,uT as Un,uU as js,uV as Fn,uW as qn,d as $n,uX as mt,uY as Gn,uZ as Kn,u_ as Wn,mF as Ae,u$ as zn,mn as Vn,v0 as Qn,e5 as Yn,ly as Xn,v1 as Zn,c as Jn,v2 as eo,v3 as to,no as so,v4 as no,v5 as oo,v6 as ao,eF as ro,eG as io,eH as lo,oj as ns,v7 as co,v8 as uo,g as fo,v9 as mo,qh as po,va as xo,jZ as ho,vb as os,eK as as,vc as rs,vd as Ue,ve as is}from"./krbmwir12ubt4od1.js";import{u as Ds}from"./ku4zsoy6w4wkp690.js";import{gh as Et,ab as go,a7 as Co,ac as pt,db as ks,y as bo,dw as vo,dx as yo,dg as Eo,di as To,B as Ge,gT as So,dp as wo,m as xt,n as Is,h as ls,c as oe,ak as Tt,b as F,dr as Ns,ad as _o,e as ht,f as Ao,cQ as Mo,j as Ve,b1 as Qe,h6 as jo,bh as cs,bS as Do,F as ge,u as ko,S as Io,ew as No,z as Oo}from"./citrwydz0bgriwlc.js";import{O as Ro,b as he,c as Po,s as Lo,u as Os,g as Bo,A as Ho,a as Uo,f as ds,C as ye,D as Fo}from"./grmx1v2b0e1c1pfw.js";import{e as qo}from"./bhqc37jb73aufzkm.js";import{C as $o}from"./n8y79r98tvk4ovf6.js";import{e as Go,a as Ko,b as Wo,g as zo}from"./by50z05oxjtbvc0n.js";import{C as Ke,e as pe,U as us}from"./eqsdgkbw87fpj3r7.js";import{a as Vo}from"./noq8k3whf0dyc5h2.js";import{D as Qo}from"./5l7gzqkfu3rktsj8.js";import{i as Yo}from"./h6aag2lelyp3pu40.js";import{C as Xo}from"./h3axfhhn58bmthc9.js";import{P as fs}from"./hbpbckirom363mgh.js";import{a as Zo,g as Jo}from"./hf1qeqo8wh44t1id.js";import{g as ea,d as lt,a as ct,S as ta}from"./nv8u6v964bkr3z82.js";import{r as sa}from"./bt7o8eyltdx74vk0.js";import{N as na}from"./jy1u8exw8iz2slve.js";import{S as oa}from"./c23qlyb7rng4ydyc.js";import{s as dt,B as aa}from"./k00srulxk3kjmgxy.js";import{L as ra}from"./b4v20hsjdnh8a64d.js";import{u as ia}from"./nvghija6qp2cunds.js";import{u as ms}from"./k5qjx4jdow04k7d2.js";import{i as ps}from"./ocq21rw37s5jtm4i.js";import{u as gt,f as la,n as ca,g as da}from"./kwgbehxqut2f64bk.js";var Rs=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(Rs||{});const ua=({isOpen:t,dismissModal:e,closeTextdocEditor:n,textdocVersion:o,clientThreadId:a})=>{const r=H(),i=ws(a),c=Ds(a),x=Et(),d=ze(o?.textdocId),l=async u=>{L.logButtonClick(G.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!(o?.versionInt==null||x)&&(c({sourceEvent:u,promptMessage:ks("",{canvas:{user_created_textdocs:o!=null&&o.status===_s.ATTACHED_PENDING&&d!=null?[{user_created_temp_textdoc_id:o.textdocId,type:o.type,title:o.title,content:o.content,create_source:d.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:o.textdocId}}),completionMetadata:i?{conversationMode:i}:void 0}),d&&qe.markAsSent(d.tempTextdocId),e(),n())};return s.jsx(go,{testId:"modal-confirm-close-editor",isOpen:t,size:"custom",className:"max-w-xl",onClose:e,type:"warning",hideSeparator:!0,title:s.jsx("span",{className:"text-xl",children:s.jsx(K,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:s.jsx(pt.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:l}),secondaryButton:s.jsx(pt.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Don’t save and close"}),color:"secondary",onClick:()=>{L.logButtonClick(G.CLOSE_WITHOUT_SAVING),d&&qe.removeTempTextdoc(d.tempTextdocId),e(),n()}}),showCloseButton:!0,closeButton:s.jsx(Co,{onClick:e}),children:s.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:s.jsx(K,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})},Ye="https://persistent.oaistatic.com/canvas/nux-videos/",fa=`${Ye}canvas_writing.mp4`,ma=`${Ye}canvas_coding.mp4`,pa=`${Ye}canvas_writing_hero.jpg`,xa=`${Ye}canvas_coding_hero.jpg`,ha="https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it",ga=t=>{"use forget";const e=Ss.c(27),{onClose:n,title:o,description:a,asset:r,size:i}=t,c=H(),x=r===0,d=i===1?252:218;let l;e[0]!==d?(l={height:d},e[0]=d,e[1]=l):l=e[1];const u=x?pa:xa,C=x?fa:ma;let f;e[2]!==u||e[3]!==C?(f=s.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"h-full max-w-none",poster:u,src:C}),e[2]=u,e[3]=C,e[4]=f):f=e[4];let y;e[5]!==l||e[6]!==f?(y=s.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary text-token-text-secondary relative flex w-full items-center justify-center overflow-hidden border-b",style:l,children:f}),e[5]=l,e[6]=f,e[7]=y):y=e[7];let h;e[8]!==o?(h=s.jsx(vo,{className:"text-center text-xl leading-6 font-semibold",children:s.jsx(K,{...o})}),e[8]=o,e[9]=h):h=e[9];let v;e[10]!==a?(v=s.jsx(yo,{className:"text-token-text-secondary text-center text-sm",children:s.jsx(K,{...a})}),e[10]=a,e[11]=v):v=e[11];let m;e[12]!==h||e[13]!==v?(m=s.jsxs("div",{className:"flex flex-col gap-2",children:[h,v]}),e[12]=h,e[13]=v,e[14]=m):m=e[14];let b;e[15]!==c?(b=c.formatMessage(Te.button),e[15]=c,e[16]=b):b=e[16];let g;e[17]!==n||e[18]!==b?(g=s.jsx(pt.Button,{onClick:n,title:b,color:"primary"}),e[17]=n,e[18]=b,e[19]=g):g=e[19];let S;e[20]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsxs(Cn,{href:ha,className:"flex items-center gap-1 font-medium",children:[s.jsx(K,{...Te.learnMore}),s.jsx(bn,{className:"icon-sm"})]}),e[20]=S):S=e[20];let _;e[21]!==g||e[22]!==m?(_=s.jsxs("div",{className:"flex flex-col items-center gap-4 px-10 py-8",children:[m,g,S]}),e[21]=g,e[22]=m,e[23]=_):_=e[23];let T;return e[24]!==_||e[25]!==y?(T=s.jsxs("div",{className:"flex flex-col items-center focus:outline-hidden",children:[y,_]}),e[24]=_,e[25]=y,e[26]=T):T=e[26],T},Ca=t=>{"use forget";const e=Ss.c(11),{textdocType:n}=t,{markAsViewed:o}=vt($e.hasDismissedCanvasContextualOnboarding),a=bo()?.document.body;let r,i,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(r={opacity:.75,scale:.9},i={opacity:1,scale:1},c={type:"spring",bounce:.2,duration:.56},e[0]=r,e[1]=i,e[2]=c):(r=e[0],i=e[1],c=e[2]);const x=xe(n)?1:0,d=xe(n)?Te.contextualModalTitleCoding:Te.contextualModalTitleWriting,l=xe(n)?Te.contextualModalDescriptionCoding:Te.contextualModalDescriptionWriting;let u;e[3]!==o||e[4]!==x||e[5]!==d||e[6]!==l?(u=s.jsx(J.div,{initial:r,animate:i,transition:c,className:"popover border-token-border-default bg-token-main-surface-primary fixed end-4 bottom-4 z-50 max-w-sm overflow-hidden rounded-2xl border shadow-xl",children:s.jsx(ga,{onClose:o,asset:x,size:0,title:d,description:l})}),e[3]=o,e[4]=x,e[5]=d,e[6]=l,e[7]=u):u=e[7];let C;return e[8]!==a||e[9]!==u?(C=s.jsx(Eo,{open:!0,defaultOpen:!0,modal:!1,children:s.jsx(To,{container:a,children:u})}),e[8]=a,e[9]=u,e[10]=C):C=e[10],C},Te=We({contextualModalTitleWriting:{id:"Pi+0RT",defaultMessage:"Draft and refine on the spot"},contextualModalDescriptionWriting:{id:"Jv0f02",defaultMessage:"Make it shorter. Add an emoji. Translate to kindergartener. ChatGPT can do it all, right on the canvas."},contextualModalTitleCoding:{id:"Zi5Ty0",defaultMessage:"Refine and debug on the spot"},contextualModalDescriptionCoding:{id:"XnaO2x",defaultMessage:"Refactor code. Translate to Python. Check for bugs. ChatGPT can do it all, right on the canvas."},button:{id:"7bNl4/",defaultMessage:"Got it"},learnMore:{id:"vs1lx2",defaultMessage:"Learn more about canvas"}}),ba=({isTextdocStreaming:t,isRequestActive:e,value:n,comments:o})=>{const[a,r]=p.useState(!1);return p.useEffect(()=>{t&&a&&(r(!1),Ke.reset())},[n,o]),p.useEffect(()=>{e||(r(!1),Ke.reset())},[e]),[a,r]};function va({onClickRestore:t,onClickResetLatest:e}){const n=H();return s.jsx(J.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:s.jsx(J.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:s.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[s.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[s.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:n.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),s.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:n.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[s.jsx(Ge,{as:"button",color:"primary",onClick:t,children:n.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),s.jsx(Ge,{as:"button",color:"secondary",onClick:e,children:n.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const ya={type:"spring",bounce:.2,duration:.56},Ea=({clientThreadId:t,turn:e})=>{const n=So();return s.jsxs(J.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[s.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),s.jsx(J.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:ya,children:s.jsx(Xo,{clientThreadId:t,onRequestCompletion:wo,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:!0,isFinalUserTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:n})})]},"user-message")},Ta=({clientThreadId:t})=>{const{lastUserTurn:e,lastAssistantTurn:n}=xt(t,a=>{const r=Is.getConversationTurns(a);let i=null,c=null;for(let x=r.length-1;x>0;x--){const d=r[x];if(!i&&d.role===ls.User?i=d:!c&&d.role===ls.Assistant&&(c=d),i&&c)break}return{lastUserTurn:i,lastAssistantTurn:c}}),o=e&&!n?.messages.some(a=>a.recipient?.startsWith(vn));return s.jsx(Ie,{initial:!1,children:o&&s.jsx(Ea,{turn:e,clientThreadId:t})})},Sa=({isRequestActive:t=!1,clientThreadId:e,readonlyReason:n,onCancel:o,onSubmit:a,onSubmitAccelerator:r,acceleratorActions:i=[]})=>{const[c,x]=p.useState(!1),[d,l]=p.useState(""),[u,C]=p.useState(!0),f=H(),[y,h]=p.useState(!1),v=yn(),m=g=>{a?.(g,d),l("")},b=g=>{if(g.nativeEvent.isComposing)return;const{metaKey:S,shiftKey:_,key:T}=g;T==="Enter"&&d.trim()&&!(_||S)&&(m(g),g.preventDefault())};return s.jsxs(s.Fragment,{children:[c&&!v&&s.jsx(Ro,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),s.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:s.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[s.jsx(Ta,{clientThreadId:e}),s.jsx("div",{className:"flex flex-auto items-start",children:s.jsx("div",{className:oe("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":u,"rounded-2xl":!u,"bg-transparent":y}),children:s.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[s.jsx(Yo,{placeholder:f.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:d,className:oe("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":y}),maxRows:4,onChange:({target:{value:g}})=>l(g),onKeyDown:b,onHeightChange:(g,{rowHeight:S})=>C(Math.floor(g/S)<=1)}),d?s.jsx(J.button,{className:oe("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:m,children:s.jsx(En,{className:"text-token-text-primary h-8 w-8"})}):(i?.length??0)>0&&s.jsx(Qo,{disableHint:!0,isVisuallyHidden:n?.isReadonly&&!n.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:i,onCancel:o,onExpandedChange:g=>{v||h(g),x(g)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function wa(t,e){const n=new Set(t.map(c=>c.id)),o=new Set(e.map(c=>c.id)),a=t.filter(c=>!o.has(c.id)).map(c=>({...c,diffStatus:Jt.REMOVED})),r=e.filter(c=>!n.has(c.id)).map(c=>({...c,diffStatus:Jt.ADDED})),i=t.filter(c=>o.has(c.id));return a.concat(r,i)}const _a=t=>{const{textdocId:e}=t,n=Tn(o=>o?.resolveTempTextdocId[e]??e);return p.useMemo(()=>({...t,textdocId:n}),[n,t])};async function Aa({textdocId:t,newTitle:e}){e!=null&&await F.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:t}},requestBody:{title:e}}).catch(n=>{Tt.addError("renameCanvasTitle Error:",n)})}const Ma=({serverThreadId:t,textdocVersion:e,initialTitle:n="Untitled Document",isEditingTitle:o,setIsEditingTitle:a})=>{const r=Ct(),{mutateAsync:i}=Se({mutationKey:[t,"textdocs"],mutationFn:Aa,onMutate:async({textdocId:m,newTitle:b})=>{await r.cancelQueries({queryKey:[t,"textdocs"]});const g=r.getQueryData([t,"textdocs"]);return r.setQueryData([t,"textdocs"],S=>{if(!S)return S;const _=new Map(S.persistedTextdocVersionById),T=_.get(m);if(T){const N={...T,title:b??""};_.set(m,N)}const j=S.persistedTextdocVersions.map(N=>N.textdocId===m?{...N,title:b??""}:N),k=new Map(S.persistedTextdocById),R=k.get(m);if(R){const N={...R,title:b??""};k.set(m,N)}return{...S,persistedTextdocVersionById:_,persistedTextdocVersions:j,persistedTextdocById:k}}),{previousTextDocData:g}},retry:2,onError:(m,b,g)=>{g?.previousTextDocData&&r.setQueryData([t,"textdocs"],g.previousTextDocData),Tt.addError("Error updating title:",m)},onSettled:()=>{r.invalidateQueries({queryKey:[t,"textdocs"]})}}),c=async m=>{e&&await i({textdocId:e.textdocId??"",newTitle:m})},[x,d]=p.useState(n),l=p.useRef(null),u=p.useRef(x),C=p.useRef(!1);p.useEffect(()=>{o&&l.current&&(l.current.focus(),l.current.select())},[o]);const f=m=>{d(m.target.value)},y=()=>{u.current=x},h=async()=>{C.current||await c(x),C.current=!1,a(!1)},v=m=>{(m.key==="Enter"||m.key==="Escape")&&m.preventDefault(),m.key==="Enter"?m.currentTarget.blur():m.key==="Escape"&&(d(u.current),C.current=!0,m.currentTarget.blur())};return s.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden",ref:l,value:x,onChange:f,onFocus:y,onBlur:h,onKeyDown:v,style:{fontSize:"1.125rem",fontWeight:"bold",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function ja(t){const{voiceName:e}=Sn(),n=t?()=>Da(t.textdocId,e,Jo()):null,o=`${t?.textdocId}.${t?.versionInt}.${e}`;return Zo(n,o)}function Da(t,e,n){return F.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:t},query:{voice:e,format:n}},skipJsonTransform:!0})}const ka=({textdocVersion:t,isPersisting:e=!1,isTextdocAttachedPending:n,isTextdocStreaming:o,hasDebug:a,shouldShowPlayButton:r=!1,hideRenameButton:i=!1,toggleDebugView:c,isDebugVisible:x,toggleConsoleVisibility:d,isConsoleOpen:l,clientThreadId:u})=>{const C=H();wn(),ja(t);const[f,y]=p.useState(!1),h=t?.title??"",v=Ns(u)??"",m=ze(t?.textdocId),b=!h||m?.status===_n.INFERRING,g=()=>{y(!0)},[S,_]=p.useState(!1),{container:T,triggerRef:j}=As({isOpen:S,onClose:()=>_(!1)}),k=[!m&&!i&&!o?s.jsx($.Item,{icon:yt,onClick:g,children:C.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?s.jsx($.Item,{icon:An,onClick:d,children:l?C.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):C.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(k.length===0)return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:s.jsx(he.Title,{className:"@[0px]:hidden @[150px]:block",children:b?s.jsx("div",{className:"w-52",children:s.jsx(fs,{lines:1,size:"base",width:100,widthVariance:0})}):h})}),e&&s.jsx(es,{size:12,className:"text-token-text-tertiary ps-1"})]});const R=t&&s.jsx($.Portal,{container:T,children:s.jsx($.Content,{onCloseAutoFocus:N=>N.preventDefault(),children:k})});return s.jsx(s.Fragment,{children:f?s.jsx(Ma,{serverThreadId:v,textdocVersion:t,initialTitle:h,isEditingTitle:f,setIsEditingTitle:y}):s.jsxs(s.Fragment,{children:[!1,s.jsxs($.Root,{open:S,onOpenChange:_,children:[s.jsxs($.Trigger,{ref:j,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] bg-transparent! pe-2",children:[s.jsx(he.Title,{className:"max-w-[270px] truncate overflow-hidden",children:b?s.jsx("div",{className:"w-52",children:s.jsx(fs,{lines:1,size:"base",width:100,widthVariance:0})}):h}),s.jsx("div",{className:"flex items-center ps-1",children:e?s.jsx(es,{size:12,className:"text-token-text-tertiary"}):s.jsx(Mn,{className:"icon-sm text-token-text-tertiary"})})]}),R]})]})})};function Ia({textdocVersion:t,clientThreadId:e}){const{handleCopy:n,Icon:o,copyLabel:a}=Po({textdocVersion:t,clientThreadId:e});return s.jsx(ie,{label:a,children:s.jsx(ae,{icon:o,onClick:n})})}const xs={[E.CODE_BASH]:{filenameExtension:"sh",blobType:"text/x-shellscript"},[E.CODE_ZSH]:{filenameExtension:"zsh",blobType:"text/x-shellscript"},[E.CODE_JAVASCRIPT]:{filenameExtension:"js",blobType:"application/javascript"},[E.CODE_TYPESCRIPT]:{filenameExtension:"ts",blobType:"application/typescript"},[E.CODE_HTML]:{filenameExtension:"html",blobType:"text/html"},[E.CODE_CSS]:{filenameExtension:"css",blobType:"text/css"},[E.CODE_PYTHON]:{filenameExtension:"py",blobType:"text/x-python"},[E.CODE_JSON]:{filenameExtension:"json",blobType:"application/json"},[E.CODE_SQL]:{filenameExtension:"sql",blobType:"application/sql"},[E.CODE_GO]:{filenameExtension:"go",blobType:"text/x-go"},[E.CODE_YAML]:{filenameExtension:"yaml",blobType:"application/x-yaml"},[E.CODE_JAVA]:{filenameExtension:"java",blobType:"text/x-java-source"},[E.CODE_RUST]:{filenameExtension:"rs",blobType:"text/rust"},[E.CODE_CPP]:{filenameExtension:"cpp",blobType:"text/x-c++src"},[E.CODE_SWIFT]:{filenameExtension:"swift",blobType:"text/swift"},[E.CODE_PHP]:{filenameExtension:"php",blobType:"application/x-httpd-php"},[E.CODE_XML]:{filenameExtension:"xml",blobType:"application/xml"},[E.CODE_RUBY]:{filenameExtension:"rb",blobType:"text/x-ruby"},[E.CODE_HASKELL]:{filenameExtension:"hs",blobType:"text/x-haskell"},[E.CODE_KOTLIN]:{filenameExtension:"kt",blobType:"text/x-kotlin"},[E.CODE_CSHARP]:{filenameExtension:"cs",blobType:"text/x-csharp"},[E.CODE_C]:{filenameExtension:"c",blobType:"text/x-csrc"},[E.CODE_OBJECTIVEC]:{filenameExtension:"m",blobType:"text/x-objectivec"},[E.CODE_R]:{filenameExtension:"r",blobType:"text/plain"},[E.CODE_LUA]:{filenameExtension:"lua",blobType:"text/x-lua"},[E.CODE_DART]:{filenameExtension:"dart",blobType:"text/x-dart"},[E.CODE_SCALA]:{filenameExtension:"scala",blobType:"text/x-scala"},[E.CODE_PERL]:{filenameExtension:"pl",blobType:"text/x-perl"},[E.CODE_COMMONLISP]:{filenameExtension:"lisp",blobType:"text/x-common-lisp"},[E.CODE_CLOJURE]:{filenameExtension:"clj",blobType:"text/x-clojure"},[E.CODE_OCAML]:{filenameExtension:"ml",blobType:"text/x-ocaml"},[E.CODE_POWERSHELL]:{filenameExtension:"ps1",blobType:"text/x-powershell"},[E.CODE_VERILOG]:{filenameExtension:"v",blobType:"text/x-verilog"},[E.CODE_DOCKERFILE]:{filenameExtension:"Dockerfile",blobType:"text/x-dockerfile"},[E.CODE_VUE]:{filenameExtension:"vue",blobType:"text/x-vue"},[E.CODE_REACT]:{filenameExtension:"jsx",blobType:"application/javascript"},[E.CODE_OTHER]:{filenameExtension:"txt",blobType:"text/plain"},[E.DOCUMENT]:{filenameExtension:"md",blobType:"text/markdown"},[E.LOADING]:{filenameExtension:"txt",blobType:"text/plain"}};var ut,hs;function Na(){if(hs)return ut;hs=1;var t=sa(),e=t(function(n,o,a){return n+(a?"_":"")+o.toLowerCase()});return ut=e,ut}var Oa=Na();const ft=mn(Oa);function Ra({textdocVersion:t,disabled:e}){const n=H(),o=n.formatMessage({id:"canvas.download-button",defaultMessage:"Download"}),a=_o(),r=n.formatMessage({id:"canvas.downloadFileError",defaultMessage:"Failed to download file. Please try again later."}),{mutate:i,isPending:c}=Se({mutationFn:async({textdocId:l,exportType:u})=>{const C=await F.safePost("/export_doc/canvas",{requestBody:{textdoc_id:l,export_type:u},skipJsonTransform:!0});if(!C.ok)throw new Error("Failed to download file");return C},onSuccess:async(l,{exportType:u})=>{const C=await l.blob(),f=l.headers.get("Content-Disposition"),y=ea(f)??`${ft(t.title)}.${u}`;lt(C,y)},onError:l=>{a.danger(r),Tt.addError(l)}}),x=async l=>{if(t.type!==E.LOADING&&t.type===E.DOCUMENT){let u;switch(l){case"md":u="chatgpt_canvas_md_download";break;case"pdf":u="chatgpt_canvas_pdf_download";break;case"docx":u="chatgpt_canvas_docx_download";break}if(ht.logEventWithStatsig("ChatGPT Canvas Download",u),l==="pdf"||l==="docx")i({textdocId:t.textdocId,exportType:l});else if(l==="md"){const{filenameExtension:C,blobType:f}=xs[t.type],y=await Lo(t.content),h=new Blob([y],{type:f});lt(h,`${ft(t.title)}.${C}`)}}},d=()=>{const{filenameExtension:l,blobType:u}=xs[t.type];if(t.type===E.LOADING)return;ht.logEventWithStatsig("ChatGPT Canvas Download","chatgpt_canvas_code_download",{blobType:u});const C=new Blob([t.content],{type:u});lt(C,`${ft(t.title)}.${l}`)};return t.type===E.DOCUMENT?s.jsxs($.Root,{open:!c&&!e?void 0:!1,children:[s.jsx($.BasicTrigger,{className:"hover:bg-transparent focus-visible:bg-transparent",children:s.jsx(ie,{label:o,children:s.jsx(ae,{icon:ts,disabled:c||e})})}),s.jsxs($.Content,{align:"end",children:[s.jsx($.Item,{onClick:l=>{l.preventDefault(),x("pdf")},children:n.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),s.jsx($.Item,{onClick:l=>{l.preventDefault(),x("docx")},children:n.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),s.jsx($.Item,{onClick:l=>{l.preventDefault(),x("md")},children:n.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})]}):s.jsx(ie,{label:o,children:s.jsx(ae,{icon:ts,disabled:c||e,onClick:d})})}function Pa({disabled:t=!1,isShowingChanges:e,onMouseEnter:n,onClick:o,onEsc:a}){const r=H(),i=p.useRef(null);return p.useEffect(()=>{if(e){const c=x=>{x.key==="Escape"&&(a?.(),i.current&&i.current===document.activeElement&&i.current.blur())};return window.document.addEventListener("keydown",c),()=>{window.document.removeEventListener("keydown",c)}}},[e,a]),s.jsx(ie,{label:!t&&r.formatMessage(e?gs.hideChanges:gs.showChanges),children:s.jsx(ae,{icon:oa,ref:i,disabled:t,onClick:o,onMouseEnter:n,className:oe("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",e&&na)})})}const gs=We({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}});function La({disabled:t=!1,hasPreviousVersion:e,hasNextVersion:n,hideShowChanges:o,isShowingChanges:a,onHoverPrevious:r,onHoverShowChanges:i,onToggleShowChanges:c,onClickPrevious:x,onClickNext:d}){const l=H();return s.jsxs("div",{className:"flex items-center",children:[s.jsx(Ie,{children:!o&&s.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",bounce:.24,duration:.4},children:s.jsx(Pa,{disabled:t||!e,isShowingChanges:a,onMouseEnter:i,onClick:c,onEsc:c})})}),s.jsx(ie,{label:e&&l.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:s.jsx(ae,{disabled:t||!e,icon:jn,onMouseOver:r,onClick:x})}),s.jsx(ie,{label:n&&l.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:s.jsx(ae,{disabled:t||!n,icon:Dn,onClick:d})})]})}function Ba(t){for(const e of Ha){const n=t.match(e);if(n)return n[0]}return null}const Ha=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],Ua=`${ta}...`;function Ee(t){return["canvas","textdoc","share",t]}function Fa({isLoading:t,isPublishedVersionLatest:e,sharedTextdoc:n,textdocVersion:o,title:a}){const{textdocId:r}=o,[i,c]=p.useState(!1),x=Ba(o.content),d=(T,j)=>{T&&Pn(T,void 0,j).then(()=>{c(!0),setTimeout(()=>{c(!1)},1500)}).catch(()=>{})},l=Ct(),{mutate:u,isPending:C}=Se({scope:{id:r},mutationFn:T=>F.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:T}}}).then(j=>Fe(j.shared_textdoc)),onSuccess:T=>{l.setQueryData(Ee(r),T),d(ct(T.sharedTextdocId))}}),{mutate:f,isSuccess:y}=Se({scope:{id:r},mutationFn:T=>F.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:T}}}).then(j=>Fe(j.shared_textdoc)),onSuccess:T=>{l.setQueryData(Ee(r),T)}}),{mutate:h}=Se({scope:{id:r},mutationFn:({sharedTextdocId:T,access:j})=>F.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:T}},requestBody:{shared_textdoc_access:j}}).then(k=>Fe(k.shared_textdoc)),onMutate:({access:T})=>{const j=Ee(r),k=l.getQueryData(j);return l.setQueryData(j,k&&{...k,access:T}),{previousAccess:k?.access}},onSuccess:T=>{l.setQueryData(Ee(r),T)},onError:(T,j,k)=>{const R=Ee(r),N=l.getQueryData(R);l.setQueryData(R,N&&{...N,access:k?.previousAccess})}}),v=p.useRef(null),m=T=>{v.current?.focus(),n?(L.logButtonClick(G.COPY_SHARE_LINK,Me(o)),d(ct(n.sharedTextdocId),T)):(L.logButtonClick(G.CREATE_SHARE_LINK,Me(o)),u(r))},b=T=>{n&&(L.logButtonClick(T===Ln.PUBLIC?G.UPDATE_SHARE_LINK_PUBLIC:G.UPDATE_SHARE_LINK_PRIVATE,Me(o)),h({sharedTextdocId:n.sharedTextdocId,access:T}))},g=n?ct(n.sharedTextdocId):void 0,S=()=>{n&&(L.logButtonClick(G.UPDATE_SHARE_LINK_TO_LATEST,Me(o)),f(n.sharedTextdocId))},_=x||n?.isAnonifyApiKeyDetected;return s.jsx(aa,{inputRef:v,isLoading:t,isPublishedVersionLatest:e,sharedObject:n&&{id:n.sharedTextdocId,title:a,access:n.access,versionInt:n.versionInt,isModerationBlocked:n.isModerationBlocked,isAnonifyApiKeyDetected:n.isAnonifyApiKeyDetected},title:a,shareTextPlaceholder:Ua,shareUrl:g,isCopySuccessful:i,didPublishUpdates:y,isCreateLinkRequestInProgress:C,handleUpdateLatestSharedVersion:S,handlePrivacyChange:b,handlePrimaryButtonClick:m,maybeRenderWarndingContent:()=>s.jsx(s.Fragment,{children:_&&s.jsx($a,{})})})}function Me(t){return{textdocType:t.type,textdocId:t.textdocId}}function qa({textdocVersion:t,isDisabled:e,title:n}){const o=Ao(),a=H(),r=t?.textdocId,i=vt($e.hasSeenCanvasShareButtonNux),{data:c,isLoading:x}=bt({enabled:!!r&&!e,queryKey:Ee(r),queryFn:()=>!r||r.startsWith(Hn)?Promise.resolve(null):F.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(b=>b.shared_textdoc&&Fe(b.shared_textdoc))}),[d,l]=p.useState(!1),{triggerRef:u,container:C}=As({isOpen:d,onClose:()=>l(!1)}),f=o?.isWorkspaceAccount()&&!o?.features.includes(Mo.WorkspaceShareLinks);if(e||f||!t)return s.jsx(ie,{label:f?a.formatMessage(dt.workspaceSharingDisabled):a.formatMessage(dt.share),children:s.jsx(ae,{disabled:!0,icon:ss})});const y=()=>{L.logButtonClick(G.OPEN_SHARE_MENU,Me(t))},h=c?.versionInt===t.versionInt&&c?.title===t.title,v=({className:b})=>s.jsxs("div",{className:"relative h-fit w-fit",children:[s.jsx(ss,{className:b}),!h&&c&&s.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]}),m=s.jsxs(kn,{open:d,onOpenChange:l,children:[s.jsx(ie,{label:a.formatMessage(dt.share),children:s.jsx(In,{ref:u,asChild:!0,children:s.jsx(ae,{icon:v,onClick:y})})}),s.jsx(Ie,{children:d&&s.jsx(Nn,{forceMount:!0,container:C,children:s.jsx(On,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:s.jsx(Fa,{title:n,sharedTextdoc:c,isLoading:x,isPublishedVersionLatest:h,textdocVersion:t})})})})]});return!i.isLoading&&i.eligible?s.jsx(Rn,{announcementKey:$e.hasSeenCanvasShareButtonNux,show:!0,side:"bottom",align:"end",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:s.jsx(K,{id:"oHutKI",defaultMessage:"Share {title}",values:{title:n}}),description:s.jsx(K,{id:"oQuH7b",defaultMessage:"Easily share your content with others — your chat stays private."}),onDismiss:i.markAsViewed,sideOffset:0,children:m}):m}function $a(){return s.jsx(Bn,{type:"danger",className:"w-auto md:p-3",children:s.jsx(K,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}const Ga=({clientThreadId:t,isHistoricalVersion:e,textdocVersion:n,readonlyReason:o,hasDebug:a,isEmbedded:r,isPersisting:i,isShowingChanges:c,hideRunCode:x=!1,hideHistoryActions:d=!1,hideRenameButton:l=!1,onHoverPrevious:u,onHoverShowChanges:C,onToggleShowChanges:f,onClickPrevious:y,onClickNext:h,onClickCodePreview:v,onClose:m,toggleDebugView:b,toggleConsoleVisibility:g,isCodeRunning:S,isTextdocAttachedPending:_,isTextdocStreaming:T,isConsoleOpen:j,isDebugVisible:k})=>{const R=H(),N=Ms(),W=ze(n?.textdocId),U=n?.title??"",{isCodePreviewable:z,isCodeExecutable:I,hasCanvasCodeExecution:D}=Os(n),le=!x&&(z||I),A=n?.versionInt,B=A!=null&&A>1,V=e,ce=!d,ee=z&&S,Q=n==null||W!=null||e||o.isStreaming,Y=n==null||o.isStreaming,de=Ve(),Ce=Qe(de,"452089807");return s.jsxs(he.Header,{className:oe("@container",z&&S&&"bg-transparent!"),children:[s.jsx(he.CloseButton,{onClick:m}),s.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:s.jsx(ka,{hasDebug:a,isConsoleOpen:j,isDebugVisible:k,toggleConsoleVisibility:g,toggleDebugView:b,isPersisting:i,textdocVersion:n,isTextdocAttachedPending:_,isTextdocStreaming:T,shouldShowPlayButton:le,hideRenameButton:l,clientThreadId:t})}),s.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[ce&&s.jsx(La,{hideShowChanges:ee,disabled:o.isStreaming,hasNextVersion:V,hasPreviousVersion:B,isShowingChanges:c,onHoverPrevious:u,onHoverShowChanges:C,onToggleShowChanges:f,onClickPrevious:y,onClickNext:h}),s.jsx(Ia,{clientThreadId:t,textdocVersion:n}),Ce&&n&&n.type!==E.LOADING&&W==null&&s.jsx(Ra,{disabled:Y,textdocVersion:n}),s.jsx(qa,{isDisabled:Q,textdocVersion:n,title:U}),le&&s.jsx(Go,{clientThreadId:t,isCodePreviewable:z,isDisabled:!D||o.isTextdocStreaming&&!S,disabledTooltip:D?void 0:R.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:v,isCodeRunning:S,textdocType:n?.type}),!r&&!N&&s.jsx(ra,{})]})]})},Ka=/\s/,Wa=30;function Cs(t,e){const n=t.indexOf(e);return n===-1?!1:t.indexOf(e,n+e.length)===-1}function me(t,e){return Ka.test(t[e])}function bs(t,e,n=!1){if(e===0||n&&me(t,e-1))return e;for(;e>0&&me(t,e-1);)e--;for(;e>0&&!me(t,e-1);)e--;return me(t,e)&&e++,e}function vs(t,e,n=!1){if(e===t.length||n&&me(t,e))return e;for(;e<t.length&&me(t,e);)e++;for(;e<t.length&&!me(t,e);)e++;return me(t,e-1)&&e--,e}function za(t,e,n=!0,o=Wa){if(t.start<0||t.end>e.length||t.start>t.end)throw new Error("Invalid commentSourceRange provided.");const a=e.substring(t.start,t.end);let r=t.start,i=t.end;n&&(r=bs(e,r,!0),i=vs(e,i,!0));let c=e.substring(r,t.start),x=e.substring(t.end,i),d=`${c}${a}${x}`;if(Cs(e,d)&&(o==null||d.length>=o))return{before:c,after:x,allSurrounding:d};let l=r,u=i,C=!0;for(;C&&(o==null||d.length<o);){let f=!1;const y=l>0?bs(e,l):l;y<l&&(l=y,f=!0);const h=u<e.length?vs(e,u):u;if(h>u&&(u=h,f=!0),f){const v=e.substring(l,t.start),m=e.substring(t.end,u),b=`${v}${a}${m}`;if(Cs(e,b)&&(o==null||b.length>=o))return{before:v,after:m,allSurrounding:b};c=v,x=m,d=b}else C=!1}return{before:c,after:x,allSurrounding:d}}const je="# Context",De="# Instructions";function ke(t,e,n){if(e==null||n==null)return`The user is referring to the entire text of "${t}".`;const o=`
## Selected Text
The user has selected this text in "${t}" in particular:
${e}
`.trim();return n.allSurrounding===e?o:`
${o}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function Ps(t,e){return t==null||e==null?"entire document":t===e.allSurrounding?"selected text":"surrounding context"}function Ls(t){return`For the update pattern, create a regex which exactly matches the ${t}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${t}. The only exception to this rule is if the ${t} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function Va(t,e,n,o){if(!xe(e)&&n&&o){const a=Ps(n,o);return`
${je}
The user requests that you directly edit the document.

${ke(t,n,o)}

${De}
Use the update_textdoc tool to make this edit. ${Ls(a)}`.trim()}return`
${je}
The user requests that you directly edit the document.

${ke(t,n,o)}

${De}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function Qa(t,e,n){return`
${je}
The user requests that you add comments about some text.

${ke(t,e,n)}

${De}
Do not respond to the user's question directly, just leave comments.`.trim()}function Ya(t,e){return xe(t)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${Ls(e)}`}function Xa(t,e,n,o){const a=Ps(n,o),r=Ya(e,a);return`
${je}
${ke(t,n,o)}

${De}
The user would like you perform one of the following actions:
- Update the ${a} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${a} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Za(t,e,n){return`
${je}
${ke(t,e,n)}

${De}
The user would like you to create a new textdoc.
`.trim()}function Ja(t,e,n,o=null,a=null){switch(n){case pe.ASK:return Xa(t,e,o,a);case pe.CREATE_TEXTDOC:return Za(t,o,a);case pe.EDIT:return Va(t,e,o,a);case pe.COMMENT:return Qa(t,o,a)}}function er(t){switch(t){case P.ACCELERATOR:case P.CONSOLE:case P.ACCEPT_COMMENT:case P.HIVE_SPEAKER_EDIT:return!0;case P.ASK_CHATGPT:case P.FULL_SCREEN_SUBMIT:return!1}}function tr(t,e){switch(e){case P.ASK_CHATGPT:case P.ACCEPT_COMMENT:case P.FULL_SCREEN_SUBMIT:return t.formatMessage(sr.askChatGPT);case P.ACCELERATOR:case P.CONSOLE:case P.HIVE_SPEAKER_EDIT:return}}const Bs=(t,e)=>{const n=H(),o=ws(t),a=Ds(t),r=Et();return p.useCallback(async({content:i,sourceRange:c,action:x,userMessageType:d,acceleratorMetadata:l,selectionMetadata:u,sourceEvent:C})=>{if(e?.versionInt==null||r)return;const{textdocId:f,type:y,versionInt:h,content:v}=e;let m,b=null;c&&c.start!==c.end&&(m=v.slice(c.start,c.end),b=za(c,v));const g=Ja(f,y,x,m,b),_=jo(g,{exclude_after_next_user_message:!0});a({sourceEvent:C,promptMessage:ks(i,{canvas:{textdoc_id:f,textdoc_type:y,version:h,textdoc_content_length:v.length,user_message_type:d,accelerator_metadata:l,selection_metadata:u},is_visually_hidden_from_conversation:er(d),targeted_reply:m,targeted_reply_label:tr(n,d),open_in_canvas_view:{type:"canvas_textdoc",id:f}}),completionMetadata:o?{conversationMode:o}:void 0,appendMessages:[_]})},[e,r,a,o,n])},sr=We({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),nr=t=>{const e=Ve(),n=Qe(e,"80186230"),o=Ms(),{eligible:a,isLoading:r,markAsViewed:i}=vt(t);return{markAsViewed:i,eligible:!o&&a&&n,isLoading:r}};function or(){return nr($e.hasDismissedCanvasContextualOnboarding)}function ar(t){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,n=new Set,o=t.matchAll(e);for(const a of o){const r=a[2];try{let i=r;i.startsWith("www.")&&(i="http://"+r),new URL(i),n.add(r)}catch{}}return n}const rr=async({lastVersion:t,textdocId:e,content:n,comments:o})=>{const a=Un(o,n);return(await F.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:t,content:n,comments:a}})).version},ir=()=>{const t=p.useRef([]),e=p.useRef(null),{mutateAsync:n,isPending:o}=Se({mutationKey:["canvas","textdoc","persist"],mutationFn:rr});return[p.useCallback(async(r,i,c)=>{const x=new AbortController,l=(async()=>{const[y]=t.current;try{await y?.promise}catch(h){L.logError("Saving document",h)}if(!x.signal.aborted)try{const h=Math.max(e.current??0,r.versionInt??js);let v="";try{ps(i)?v=i():v=i}catch(S){L.logError("Serializing document",S)}let m=[];try{ps(c)?m=c():m=c}catch(S){L.logError("Adjusting comments",S)}const{textdocId:b}=r;Fn({textdocId:b,basedOnVersionInt:h,content:v,comments:m});const g=await n({textdocId:b,lastVersion:h,content:v,comments:m});qn({textdocId:b,basedOnVersionInt:h,newVersion:g}),e.current=g}catch(h){L.logError("Error saving document",h)}finally{t.current.shift()}})(),u={abort:()=>x.abort(),promise:l},[C,f]=t.current;return f&&(f.abort(),t.current=C?[C]:[]),t.current=C?[C,u]:[u],l},[n]),t,o]},lr=3e3,cr=t=>{const[e,n,o]=ir(),a=H(),r=p.useRef(null),i=p.useCallback($n(async(d,l,u)=>{if(!mt(d))return e(d,l,u);qe.replaceTempTextdocContent(d.textdocId,typeof l=="string"?l:l())},lr,{leading:!1}),[e]),c=Gn(t);return p.useEffect(()=>{if(!c)return;const d=cs(window,{pagehide:()=>i.flush(),beforeunload:u=>{i.flush(),u.returnValue=a.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),l=cs(document,{visibilitychange:()=>i.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&i.flush(),r.current="mouse"}});return()=>{r.current=null,l(),d()}},[a,c,i]),p.useEffect(()=>()=>{i.flush()},[t,i]),Kn(async()=>{await i.flush(),await Promise.allSettled(n.current?.map(({promise:d})=>d)??[])}),[p.useCallback((d,l,u)=>{const{textdocId:C}=d;return mt(d)||Wn(C),i(d,l,u)},[i]),i.flush,o||c]};function dr(t,e,n){const o=Ct(),a=n!=null&&e!=null,{data:r,error:i,fetchNextPage:c,hasNextPage:x,isFetching:d}=pn(ys(t,e,a)),l=p.useCallback(async()=>{const h=e!=null;await o.prefetchInfiniteQuery(ys(t,e,h))},[o,t,e]);p.useEffect(()=>{const h=e;return()=>{o.removeQueries({queryKey:Hs(t,h),exact:!0})}},[o,t,e]);const[u,C,f,y]=p.useMemo(()=>{if(r&&n){const v=r.pages.flatMap(b=>b),m=v.findIndex(b=>"beforeVersion"in n?(b.versionInt??js)<n.beforeVersion:b.versionInt===n.version);if(m!==-1)return[m===v.length-1,v[m],m>0?v[m-1]:null,m<v.length-1?v[m+1]:null]}const h=r?.pages.flatMap(v=>v)??[];return[!0,null,null,h.length===0?null:h[0]]},[r,n]);return p.useEffect(()=>{!d&&a&&x&&u&&c()},[d,a,x,u,c]),p.useEffect(()=>{!C&&i&&Ae(t)},[C,i,t]),{historicalTextdocVersion:C,nextHistoricalTextdocVersion:f,prefetchHistoricalTextdocVersion:l,previousHistoricalTextdocVersion:y}}function Hs(t,e=null){return["textdocHistory",t,e]}function ys(t,e,n=!0){return{queryKey:Hs(t,e),queryFn:({pageParam:o})=>ur(t,o),initialPageParam:e??void 0,getNextPageParam:o=>{const a=Do(o)?.versionInt;if(a&&a>1)return a},enabled:n,staleTime:1/0,retry:2}}async function ur(t,e){return e===void 0||e<=1?[]:(await F.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:e}}})).previous_doc_states.map(({id:o,version:a,textdoc_type:r,title:i,content:c,updated_at:x,comments:d,metadata:l})=>({textdocId:o,versionInt:a,messageId:null,title:i,type:Qn(r),content:c,status:_s.COMPLETE,createdAt:Vn(x),comments:zn(d,c),metadata:{content_references:l?.content_references}}))}const fr=(t,e,n=1)=>{xn(t.scrollTop,e,{duration:n,ease:"easeInOut",onUpdate:o=>{t.scrollTop=o}})},mr=ge.div`flex w-full grow flex-col gap-1 rounded-xl p-2 pe-5 text-sm`,pr=ge.input`ms-[-2px] w-auto rounded-none border-none bg-[#E5F3FF] p-0 px-0.5 text-sm font-semibold outline-none focus:outline-none`,xr=ge(J.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full origin-left border-b border-solid`,hr=ge(J.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full border-b border-dashed`,gr={initial:{scaleX:0,opacity:1},animate:{scaleX:1,opacity:0,transition:{scaleX:{duration:.85,ease:[.65,0,.35,1]},opacity:{delay:.85,duration:.1}}}},Cr={initial:{opacity:0},animate:{opacity:1,transition:{delay:.85,duration:.1}}};ge.div`ms-2 rounded-full px-2 py-0.5 text-xs font-medium`;const br=({speakerId:t,content:e,range:n,filterDecision:o,isEditing:a,isSaving:r,containerRef:i,measuredTextContainerRef:c,isEditingEnabled:x})=>{const d=p.useRef(null),{setSpeakers:l,setEditingSpeaker:u,hoveringSpeakerId:C,setHoveringSpeakerId:f,speakers:y,editingSpeaker:h,enableDebugger:v}=gt.getState(),m=gt(D=>D.currentTime),b=n.max==null?m===n.min:m>=n.min&&m<=n.max;p.useEffect(()=>{if(b&&d.current&&i.current){const D=i.current,le=d.current,A=D.getBoundingClientRect().top,V=le.getBoundingClientRect().top-A+D.scrollTop-20;fr(D,V,.3)}},[n.min,n.max,b,i]);const g=y.get(t),S=!!g?.storedName&&g.storedName!==g?.placeholderName||(g?.isEdited??!1),_=g?.name??g?.storedName??g?.placeholderName??"Unidentified Speaker",T=p.useRef(null),j=t===h?.id,k=t===C,[R,N]=p.useState(!1),[W,U]=p.useState(!1);p.useEffect(()=>{T.current&&(!j||!W||(T.current?.focus(),S&&(T.current.value=_)))},[S,j,W,_]),ko(()=>{if(c.current&&T.current){const D=c.current.offsetWidth;T.current.style.width=`${D}px`}},[h?.name]);const z=p.useCallback(()=>{if(!h||!g)return;u(null),U(!1),N(!1),f(null);const D=y.set(t,{...g,name:h.name?h.name:g.placeholderName,isEdited:!!h.name});l(D)},[h,g,u,f,y,t,l]),I=!a||r;return s.jsxs(mr,{ref:d,className:oe(b&&"animate-[hive-log-fadeout_0.3s_1.5s_forwards] bg-blue-500/10",!1,!1),children:[!1,s.jsxs("div",{className:"mb-[1px] flex w-full items-center justify-between",children:[x&&(j?s.jsx(pr,{ref:T,disabled:!W,onBlur:z,className:oe(!j&&"hidden w-0"),placeholder:g?.isEdited?void 0:g?.placeholderName,value:h?.name,onKeyDown:D=>{D.key==="Enter"&&z()},onChange:D=>u({id:t,name:D.target.value})}):s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{onClick:()=>{I||(u({id:t,name:S?_:""}),U(!0))},onMouseEnter:()=>{I||(f(t),N(!0))},onMouseLeave:()=>{I||(f(null),N(!1))},className:oe("relative flex font-semibold transition-colors",{"text-blue-400!":k&&!I},{"cursor-pointer":!I},{"text-token-text-tertiary":!I&&!S}),children:[_,!I&&!S&&s.jsxs(s.Fragment,{children:[s.jsx(xr,{...gr}),s.jsx(hr,{...Cr,className:oe(k&&!I&&"border-blue-400!")})]})]}),R&&!I&&s.jsx(yt,{className:"h-4 w-4 text-blue-400"}),!1]})),s.jsx("div",{className:"text-xs text-[#5D5D5D]",children:la(n.min)})]}),s.jsx("div",{className:"flex",children:e})]})},vr=t=>bt({queryKey:["hiveLog",t],queryFn:()=>F.safeGet("/hive/{hive_id}/transcript",{parameters:{path:{hive_id:t}}}),enabled:!!t,select:ca}),yr=()=>bt({queryKey:["hiveLogPrompts"],queryFn:()=>F.safeGet("/hive/prompts"),enabled:!0}),Er=(t,e)=>F.safePost("/hive/{hive_id}/speakers",{parameters:{path:{hive_id:t}},requestBody:{speakers:e}}),Tr=ge.div`invisible absolute start-0 top-0 rounded-md border px-0.5 text-sm font-semibold whitespace-pre`,Sr=(t,e)=>!e||!t?"":e.isEdited||t.name&&t.name!==e.placeholderName?t.name:e.placeholderName,Es=ge(J.div)`flex items-center gap-2`,Ts={initial:{opacity:0,y:-4},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-4,transition:{duration:.2}}},wr="ts",_r=({hiveId:t,clientThreadId:e,ts:n,textdocVersion:o})=>{const a=vr(t),r=yr(),i=H(),[c,x]=p.useState(!1),d=p.useRef(null),l=Ve(),u=Qe(l,"2986567482"),{isOpen:C,closeSidebar:f,openSidebar:y,setCurrentTime:h,speakers:v,setSpeakers:m,editingSpeaker:b,enableDebugger:g,setEnableDebugger:S,selectedFilters:_,setSelectedFilters:T}=gt();p.useEffect(()=>{n!==void 0&&(y(),h(n))},[n,y,h]);const j=p.useRef(null),[k,R]=p.useState(!1),N=Bs(e,o);if(a.isLoading||r.isLoading||a.isError||r.isError||!a.data||!r.data)return null;const W=b?v.get(b.id):null,U=Array.from(v.values()).some(({isEdited:A})=>A),z=()=>{const A=new Map(Array.from(v.entries()).map(([B,V])=>[B,{...V,name:void 0,isEdited:!1}]));m(A),x(!1)},I=A=>{if(!r.data.speaker_edits)return;const B=r.data.speaker_edits.replace("{speakers}",JSON.stringify(Array.from(v.entries())));return N({sourceEvent:A,action:pe.EDIT,content:B,userMessageType:P.HIVE_SPEAKER_EDIT,selectionMetadata:void 0})},D=async A=>{if(U){R(!0);try{const B=[];Array.from(v.entries()).forEach(([ee,Q])=>{!Q.isEdited||!Q.name||B.push({id:ee,updated_name:Q.name})});const V=await Er(t,B);if(!V)throw new Error("Failed to update hive content");const ce=new Map(v);for(const ee of V.updated_speakers){if(!ce.has(ee.id))continue;const Q=ce.get(ee.id);Q&&ce.set(ee.id,{...Q,storedName:ee.updated_name,isEdited:!1})}await I(A),m(ce),x(!1)}catch{}finally{R(!1)}}},le=a.data.filter(({filterDecision:A})=>!A||_?.includes(A));return s.jsxs("div",{className:oe("flex h-full w-full max-w-[360px] min-w-[240px] flex-col border-s border-gray-200",C?"visible":"invisible hidden"),children:[s.jsxs("div",{className:"flex h-14 w-full items-center justify-between border-b border-gray-200 p-4",children:[s.jsxs("div",{className:"text-token-text-secondary group/debug flex items-center gap-1.5 py-2 text-base font-medium",children:[s.jsx(K,{..._e[c?"edit":"transcript"]}),s.jsx(Yn,{children:s.jsx(K,{..._e.researchPreview})}),!1]}),s.jsx("div",{className:"flex h-10 items-center gap-2",children:s.jsx(Ie,{mode:"wait",children:c?s.jsxs(Es,{...Ts,children:[s.jsx(Ge,{onClick:z,color:"secondary",disabled:k,children:s.jsx(K,{..._e.cancelButton})}),s.jsx(Ge,{color:"primary",onClick:D,disabled:!U,loading:k,children:s.jsx(K,{..._e.saveButton})})]},"edit-buttons"):s.jsxs(Es,{...Ts,children:[u&&s.jsx(ie,{className:"h-10",label:i.formatMessage(_e.editButtonTooltip),children:s.jsx(ae,{icon:yt,onClick:()=>x(!0)})}),s.jsx(ae,{icon:Io,onClick:()=>f()})]},"non-edit-buttons")})})]}),!1,s.jsxs("div",{ref:d,className:"flex w-full flex-col gap-2 overflow-y-scroll p-2",children:[u&&b&&s.jsx(Tr,{ref:j,children:Sr(b,W)}),le.map(A=>s.jsx(br,{isEditingEnabled:u,measuredTextContainerRef:j,containerRef:d,isEditing:c,isSaving:k,...A},Ar(A)))]})]})},Ar=t=>{const{speakerId:e,content:n,range:o}=t;return`${e}-${o.min}-${o.max}-${n.slice(0,2)}`},_e=We({researchPreview:{id:"HiveLogSidebar.researchPreview",defaultMessage:"Research Preview"},edit:{id:"HiveLogSidebar.edit",defaultMessage:"Edit"},transcript:{id:"HiveLogSidebar.transcript",defaultMessage:"Transcript"},editButtonTooltip:{id:"HiveLogSidebar.editButtonTooltip",defaultMessage:"Edit speakers"},cancelButton:{id:"HiveLogSidebar.cancelButton",defaultMessage:"Cancel"},saveButton:{id:"HiveLogSidebar.saveButton",defaultMessage:"Save"}}),si=({isFullScreen:t=!1,isEmbedded:e=!1,hideHeader:n=!1,hideRunCode:o=!1,isReadonlyFromQueryParam:a=!1,hideRenameButton:r=!1,clientThreadId:i,focusedTextdoc:c,onClose:x,isAnimating:d=!1,width:l,hideBottomComposer:u=!1})=>{const C=Ve(),{textdocId:f,history:y,showChangesAtVersion:h=null,shouldRunCodeOnOpen:v=!1}=_a(c),m=H(),[b,g,S]=cr(f),{targetedContent:_}=Xn(),T=Zn(),[j,k]=p.useState(!1),[R,N]=p.useState(!1),W=Jn(f),U=eo(),z=xt(i,Is.getRequestId),I=No(z),{data:D,isLoading:le}=to(f,h),[A,B]=p.useState(!1),[V,ce]=p.useState(null),ee=so(i),Q=p.useRef(null),Y=W?.versions??[],de=Y[0]?.versionInt,{historicalTextdocVersion:Ce,nextHistoricalTextdocVersion:Us,previousHistoricalTextdocVersion:Fs,prefetchHistoricalTextdocVersion:St}=dr(f,de,y),wt=no();p.useEffect(()=>{Ke.reset()},[f]);const _t=Y.length>0?Y[Y.length-1]:null,Xe=Y.length>1?Y[Y.length-2]:null,At=Ns(i),{restoreHistoricalTextdocVersion:qs,optimisticRestoredTextdocVersion:$s}=oo(At,_t,Ce),be=y!=null,M=be?Ce:_t,te=h!=null,we=Bs(i,M),Mt=d?null:D,Ne=(()=>{if(d||M==null)return[];const w=ds(M.comments);return!te&&Ce!=null?Ce.comments:!te||D==null?w:D.contentBefore!==D.contentAfter?[]:wa(D.commentsBefore,D.commentsAfter)})(),q=M?.type??E.LOADING,Ze=ao(),jt=mt(M),ue=ro(M),Je=io(M),Dt=lo(M),Gs=Dt&&!e,Ks=ms(U),Ws=ms(I);p.useEffect(()=>{!jt&&Y.length===0&&Ze!==ns.NATIVE&&(!U&&Ks.current||!I&&Ws.current||!U&&!I)&&x?.()},[Y.length,U,I]);const{content:se,currentlyStreamingLineIndex:kt}=D?.contentBefore!=null&&!xe(q)?{content:D.contentBefore,currentlyStreamingLineIndex:null}:Bo(M,Xe),zs=co(At,Array.from(ar(se))),[Oe,et]=ba({value:se,isRequestActive:I,isTextdocStreaming:ue,comments:Ne}),It=uo(M),Nt=Ze===ns.LAST_TURN||Oe||S;p.useEffect(()=>{fo().sendMessage({type:Rs.Streaming,streaming:Nt})},[Nt]);const Vs=({getSerializedDocument:w,getAdjustedComments:O})=>{M&&b(M,w,O)},Qs=w=>{if(!M)return;const O=w.doc.toString();b(M,O,w.field(qo,!1)??[])},Ot=(w,O,ne,fe,ve)=>{et(!0),we({sourceEvent:w,action:ne,content:O,userMessageType:P.ASK_CHATGPT,sourceRange:fe,selectionMetadata:{selection_type:ve,selection_position_range:fe}})},Rt=({id:w})=>{It(w,rs.DISMISS),Ke.reset()},Pt=async(w,O)=>{et(!0);const{id:ne,at:fe,content:ve}=O;if(await It(ne,rs.ACCEPT)===!1)return et(!1);we({sourceEvent:w,content:ve,userMessageType:P.ACCEPT_COMMENT,sourceRange:fe,action:pe.EDIT,selectionMetadata:{selection_type:us.SELECTION,selection_position_range:fe}})},tt=(w,O,ne,fe)=>{const{action:ve}=fe;we({sourceEvent:w,action:ve,content:ne,sourceRange:O,userMessageType:P.ACCELERATOR,acceleratorMetadata:{action:ve,id:fe.id,prompt:ne},selectionMetadata:O!=null?{selection_type:us.SELECTION,selection_position_range:O}:void 0})},Ys=(w,O)=>{we({sourceEvent:w,action:pe.EDIT,content:O,userMessageType:P.FULL_SCREEN_SUBMIT})},Xs=mo(),Lt=w=>Xs?.[w]??w,st=()=>po(i),Zs=()=>{y?Ue(f,y):Ae(f)},X=Ko({streamingSource:Ze,isRestoring:$s!=null,isRequestActive:I,isTextdocStreaming:ue,isReadonlyFromQueryParam:a,isHistoricalVersion:be,isShowingChanges:te});let Re=null;const Bt=d||X.isReadonly||Oe,Pe=Et()||ee||a||jt,Ht=()=>d&&Ne.length>0?ye.ALL_HIDDEN:Pe?ye.COMMENTS_READONLY:X.isReadonly?X.isStreaming?ye.ENABLED:X.isReadonlyFromQueryParam||X.isShowingChanges||X.isHistoricalVersion?ye.COMMENTS_READONLY:ye.ALL_HIDDEN:ye.ENABLED,Js=p.useCallback(async w=>{const{suggestion:O}=await F.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:f}},requestBody:{content:w}});return O},[f]),Ut=t||d||a;let nt=[];switch(q){case E.LOADING:Re=s.jsx(Fo,{});break;case E.DOCUMENT:Re=s.jsx(Uo,{value:se,comments:Ne,previousValue:Xe?.content,getAutocompleteSuggestion:Js,previousComments:ds(Xe?.comments),isRewriting:Je,isAnimatingFromPreview:d,isSendDisabled:Pe,getStableCommentId:Lt,diff:Mt,isRequestActive:I,isDisabled:X.isReadonly||U,isWaitingForCommentResponse:Oe,hideAccelerators:Ut,hideToolbar:Bt,hideEditOverlay:d,commentsMode:Ht(),readonlyReason:X,onBlur:g,onSave:g,onChange:Vs,onCancelRequest:st,targetedContent:_,onAddComment:Ot,onAcceptComment:Pt,onDismissComment:Rt,onSubmitAccelerator:tt,onExitShowChanges:Zs,safeUrls:zs,width:l,modelCursor:Dt||ue&&!Je?M?.modelCursor:void 0,shouldResetSelection:M?.versionInt===1,metadata:W?.metadata}),nt=Vo;break;default:xe(q)&&(Re=s.jsx(Ho,{id:"codemirror",getStableCommentId:Lt,language:Wo(q),value:se,comments:Ne,hideAccelerators:Ut,commentsMode:Ht(),hideToolbar:Bt,onSubmitAccelerator:tt,currentlyStreamingLineIndex:kt??null,readonlyReason:X,isRequestActive:I,isSendDisabled:Pe,isWaitingForCommentResponse:Oe,onChange:Qs,onCancelRequest:st,onAddComment:Ot,onBlur:g,onSave:g,codemirrorRef:Q,onDismissComment:Rt,onAcceptComment:Pt,textdocDiff:Mt??void 0,modelCursor:ue&&kt==null?M?.modelCursor:void 0}),nt=$o)}const ot=p.useRef(null),Le=p.useRef(null),{hasCanvasCodeExecution:at,isCodeExecutable:Ft,isCodePreviewable:re}=Os(M),qt=at&&re,$t=at&&Ft,en=xo(),Gt=p.useCallback(()=>{!A&&(qt||$t)?(B(!0),ot.current?.runCode(q,se).finally(()=>B(!1))):(ot.current?.stopCode(),B(!1))},[qt,$t,A,se,q]),Kt=ho(()=>{Gt()});p.useEffect(()=>{v&&Kt()},[v,Kt]);const{eligible:tn,markAsViewed:sn}=or(),Z=M?.versionInt,nn=Z!=null&&Z>1,on=be,Be=Fs?.versionInt,rt=Us?.versionInt,an=()=>{te?y?Ue(f,y):Ae(f):(L.logButtonClick(G.SHOW_CHANGES,{textdocType:q,textdocId:f,versionInt:Z,latestVersionInt:de}),Z&&is(f,Z,y))},rn=()=>{L.logButtonClick(G.HISTORY_PREVIOUS,{textdocType:q,textdocId:f,versionInt:Z,latestVersionInt:de,isShowingChanges:te}),f&&Z&&nn&&Ue(f,{beforeVersion:Z},te&&Be!=null?Be:void 0)},ln=()=>{L.logButtonClick(G.HISTORY_NEXT,{textdocType:q,textdocId:f,versionInt:Z,latestVersionInt:de,isShowingChanges:te}),on&&(rt?Ue(f,{version:rt},te?rt:void 0):te&&de?is(f,de,null):Ae(f))},cn=Qe(C,"1804926979"),Wt=xt(i,da(f)),dn=ia(),zt=ze(M?.textdocId),un=!n&&s.jsx(Ga,{hideRunCode:o,clientThreadId:i,isHistoricalVersion:be,textdocVersion:M,readonlyReason:X,hasDebug:T,isEmbedded:e,isPersisting:S,isShowingChanges:te,isConsoleOpen:R,isDebugVisible:j,hideHistoryActions:a,hideRenameButton:r,onHoverPrevious:()=>{St(),Be&&wt(f,Be)},onHoverShowChanges:()=>{St(),Z&&wt(f,Z)},onToggleShowChanges:an,onClickPrevious:rn,onClickNext:ln,toggleDebugView:()=>k(w=>!w),toggleConsoleVisibility:()=>{R||ht.logEvent("Canvas Open Console Clicked"),N(w=>!w)},onClose:()=>{if(L.logButtonClick(G.CLOSE_TEXTDOC,{textdocType:M?.type}),sn(),zt&&!t){const{create_source:w,hasUserEdits:O,tempTextdocId:ne}=zt;if(O&&w!==as.USER_CREATED_COMPOSER){Yt(!0);return}qe.removeTempTextdoc(ne),w===as.USER_CREATED_COMPOSER&&dn.appendText(se)}x?.()},onClickCodePreview:Gt,isCodeRunning:A,isTextdocStreaming:ue,isTextdocAttachedPending:os(M)});let Vt=null;const He=!o&&at&&(Ft||re),it=zo(q,se);p.useEffect(()=>{He&&(it&&Le.current?.prepareEnvironment(it),re&&A&&!ue&&Oo(Le.current)?.updateCode(se))},[He,it,ue]);const Qt=M?.title??"";He&&(Vt=s.jsx(hn,{title:Qt,onChangeBackgroundColor:ce,visuallyHidden:!re||!A,disableNetworkRequests:!en,networkAccessDeniedMessage:m.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:re&&q!==E.CODE_HTML,isCodeUpdating:ue,ref:Le}));const[fn,Yt]=p.useState(!1),Xt=s.jsx(ua,{isOpen:fn,dismissModal:()=>Yt(!1),closeTextdocEditor:()=>{x?.()},textdocVersion:M,clientThreadId:i}),Zt=s.jsxs(s.Fragment,{children:[un,s.jsx(he.Content,{scrollToBottomMode:Gs?"bottom":"top",shouldScrollToTop:Je,isLoading:le,hideChildren:re&&A,overlay:Vt,children:Re}),He&&s.jsx(gn,{ref:ot,sandboxRef:Le,textdocId:f,textdocTitle:Qt,textdocContent:se,isTextdocAttachedPending:os(M),highlightLine:w=>Q.current?.highlightLine(w),isRequestActive:I,createTextdocTurn:we,isOpen:R,onOpenChange:N}),s.jsx(Ie,{children:be&&!a&&s.jsx(va,{onClickRestore:qs,onClickResetLatest:()=>Ae(f)})}),t&&!be&&!u&&!(A&&re)&&!Pe&&s.jsx(Sa,{isRequestActive:I,clientThreadId:i,onSubmitAccelerator:tt,onSubmit:Ys,onCancel:st,readonlyReason:X,acceleratorActions:nt}),!d&&!e&&tn&&s.jsx(Ca,{textdocType:q})]});if(cn&&Wt&&M){const O=new URLSearchParams(window.location.search).get(wr),ne=O==null?void 0:parseInt(O);return s.jsxs(s.Fragment,{children:[Xt,s.jsx(he,{previewBackgroundColor:V,isPreviewingCode:re&&A,children:s.jsxs("div",{className:"flex h-full",children:[s.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Zt}),s.jsx(_r,{hiveId:Wt,clientThreadId:i,textdocVersion:M,ts:ne})]})})]})}return s.jsxs(s.Fragment,{children:[Xt,s.jsx(he,{previewBackgroundColor:V,isPreviewingCode:re&&A,children:Zt})]})};export{Rs as C,si as T};
//# sourceMappingURL=hu7jamjectvubclw.js.map
