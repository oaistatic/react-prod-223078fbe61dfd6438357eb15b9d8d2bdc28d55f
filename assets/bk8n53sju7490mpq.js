import{ad as q,ab as Y,am as L,f as A,F as Se,O as J,j as O,b1 as re,B as S,aN as Be,e as k,ae as E,an as ce,b as U,ak as Ne,c as Z,eP as Pe}from"./citrwydz0bgriwlc.js";import{r as h,i as B,j as e,M as i,ac as ee,e as I,u as X,l as De,a as Ue,b as pe,f as Oe,p as Re}from"./b8ijctzpgh0s7wpx.js";import{g as Fe,d as we,e as We,a as qe,b as Ye,f as Ge,c as $e}from"./e8gr7b7eez1onpam.js";import{qz as Ce,fA as de,fE as _,qA as He,cu as Ie,fJ as oe,ln as te,qB as Ke,e as Qe,dU as Ve,bJ as Te,qC as Xe,qD as Je,c2 as Ze,fI as et,fK as tt,B as ue,aX as Le,bH as at,qE as F,dM as xe,bY as st,fv as nt,cs as _e,c3 as Ae,qF as it,dP as lt,bL as ot,lf as rt,f3 as ct,oN as dt,S as ut,ft as gt,dY as G,qG as mt,nh as pt,dI as xt,cX as ft}from"./krbmwir12ubt4od1.js";import{c as ht}from"./g980qmfqqvokan0y.js";import{a as jt,b as vt}from"./ck3bszc4vkmfqkbp.js";import{B as yt,S as bt}from"./g4a41y96wp2xjnoz.js";import{b as W,g as Q,d as V,e as fe,a as Mt,A as St}from"./fz34z4n2nuu0f63k.js";import{a as ke}from"./i7jya7stlyvnzya0.js";import{u as Bt,T as z,R as Nt,B as wt,X as Ct,Y as It,a as Tt,b as he,C as je,S as ve,M as Lt,d as _t,p as At}from"./nmunppho17ij7jm4.js";import{c as kt,E as Et}from"./c3pyruu10yojvm55.js";import{L as ge}from"./noo2d2kse83ez5bs.js";import"./otl51en3t0ec5n7s.js";import"./b4v20hsjdnh8a64d.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./dcml6fn13vfm1zv2.js";import"./nvghija6qp2cunds.js";import"./djd85tifm57yisqi.js";import"./h3krx8dg2s8o2yh5.js";import"./cfe0bfy5asp94vp2.js";import"./jkznwfhp8ahnvlot.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./k6ccgr4wxcppeg93.js";import"./dbalwdodzoo02ru2.js";import"./c2d9eukr2hh7n3q0.js";import"./eigi8l95ddhoqirr.js";import"./etmxhiuvgu79utu0.js";import"./ct6yhczwft8t5t9k.js";import"./nvnp6g5g3fqgfhec.js";import"./g64reurtt3avubtb.js";import"./cn2bawepofyjgkxo.js";import"./iki1bxy2syl3zwuv.js";import"./5zi2blh3j6mzx1uc.js";import"./l7parheddlw8ixo5.js";import"./ba1mte0dghirkk3l.js";import"./he8ni3xt3ac4tebf.js";import"./ocq21rw37s5jtm4i.js";import"./galyil7vygq0i5a6.js";import"./hp2r837n4h7dvq4u.js";import"./enswt24cmdi6maqa.js";import"./d3y72ugnrmac5z1v.js";import"./fcih4bwve8pyqvvh.js";import"./j2zbz2jpl151yhf4.js";var T=(t=>(t.FLEXIBLE="month",t.ANNUAL="year",t))(T||{});const zt=ht(T);function Pt({isOpen:t,onClose:n,initialTeamBillingType:a,renewalDate:s,accountId:l,billingDetails:d}){const[r,o]=h.useState(a),[c,u]=h.useState(!1),[p,g]=h.useState(!1),m=B(),v=q(),y=Ce(l),x=async()=>{g(!0);try{await y.mutateAsync({accountId:l,updatedPriceInterval:r==="month"?"month":"year",updatedSeats:void 0}),g(!1),v.success(m.formatMessage({id:"teamBilling.successfullyUpdatedSubscription",defaultMessage:"Your subscription was updated successfully"}),{hasCloseButton:!0}),u(!1),n()}catch{v.warning(m.formatMessage({id:"teamBilling.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0})}finally{g(!1)}},{flexibleBillingPlan:j,annualBillingPlan:N}=de(d.currency),P=r==="month"?j:N,R=()=>{u(!1),o(a),n()};return e.jsx(Y,{testId:"modal-teams-change-billing-schedule",type:"success",isOpen:t,onClose:R,size:"custom",className:"max-w-xl",noPadding:!0,title:c?m.formatMessage({id:"teamBilling.changeBillingScheduleConfirmTitle",defaultMessage:"Confirm changes"}):m.formatMessage({id:"teamBilling.changeBillingScheduleTitle",defaultMessage:"Change billing schedule"}),showCloseButton:!0,children:c?e.jsx(Ut,{selectedPlan:r,initialTeamBillingType:a,renewalDate:s,handleUpdate:x,isUpdating:p,selectedBillingPlan:P,onClose:R}):e.jsx(Dt,{setSelectedPlan:o,selectedPlan:r,initialTeamBillingType:a,setConfirmPage:u,renewalDate:s,flexibleBillingPlan:j,annualBillingPlan:N,onClose:R})})}function Dt({selectedPlan:t,setSelectedPlan:n,initialTeamBillingType:a,setConfirmPage:s,renewalDate:l,flexibleBillingPlan:d,annualBillingPlan:r,onClose:o}){const c=B();return e.jsxs("div",{className:"flex flex-col p-6",children:[e.jsx("div",{className:"grid grid-flow-row grid-cols-2",children:e.jsxs(Ie,{className:"col-span-2 grid gap-4 md:col-span-2 md:grid-cols-2",defaultValue:t,onValueChange:u=>{zt(u)&&n(u)},children:[e.jsx(oe,{billingType:"month",...d,selectedValue:t}),e.jsx(oe,{billingType:"year",...r,selectedValue:t})]})}),e.jsx("span",{className:"text-token-text-secondary mt-5 text-sm",children:e.jsx(i,{..._.changeEffectDate,values:{date:e.jsx(ee,{value:l,year:"numeric",month:"long",day:"numeric"})}})}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-2",children:[e.jsx(L,{title:c.formatMessage(_.cancel),color:"secondary",onClick:()=>o()}),e.jsx(L,{title:c.formatMessage(_.continueToPricePreview),disabled:t===a,color:"primary",onClick:()=>s(!0)})]})]})}function Ut({initialTeamBillingType:t,selectedPlan:n,renewalDate:a,handleUpdate:s,isUpdating:l,selectedBillingPlan:d,onClose:r}){const o=B();return e.jsxs("div",{className:"p-4",children:[e.jsx("span",{className:"text-sm",children:e.jsx(i,{..._.confirmPageChangeEffectDate,values:{current_plan:t==="month"?"Flexible (monthly)":"Annual",new_plan:n==="month"?"Flexible (monthly)":"Annual",date:e.jsx(ee,{value:a,year:"numeric",month:"long",day:"numeric"})}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 flex flex-col rounded-xl p-4",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...d.name})}),e.jsx("span",{className:"text-sm",children:e.jsx(i,{...d.cost,values:{monthlyCost:d.monthlyCost,discountedMonthlyCost:d.discountedMonthlyCost,currencyCode:o.formatMessage(d.currencyCode),currencySign:o.formatMessage(d.currencySign),s:(...c)=>e.jsx(He,{children:c})}})}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{...d.costStructure})})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(L,{title:o.formatMessage(_.cancel),color:"secondary",onClick:r}),e.jsx(L,{title:o.formatMessage(_.confirmChange),color:"primary",onClick:s,loading:l})]})]})}const Ot="https://q.surveysapp.org/jfe/form/SV_9vIX2bUyeLKgCZo";function Rt({isOpen:t,onClose:n}){const a=B(),s=q(),{data:l,isLoading:d}=te(),r=A(),o=Ke(r?.id),c=Qe(),[u,p]=h.useState(""),[g,m]=h.useState(!1),v=c?.email&&u.toLowerCase()==c.email.toLowerCase(),[y,x]=h.useState(l&&!l.will_renew);if(d||!r||!l)return null;const j=async()=>{m(!0);try{await o.mutateAsync(r.id),x(!0),window.open(`${Ot}?user_id=${c?.id}&account_id=${r.id}&plan_type=${l.plan_type}`,"_blank")}catch{s.warning(a.formatMessage(M.errorCancellingSubscription),{hasCloseButton:!0})}finally{m(!1)}};return e.jsx(Y,{testId:"modal-cancel-team-plan",type:"success",onClose:n,showCloseButton:!0,isOpen:t,className:"",title:e.jsx("span",{className:"text-lg",children:e.jsx(i,{...M.cancelPlan})}),children:y?e.jsxs("div",{children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(i,{...M.successfullyCanceled})}),l.active_until!=null&&e.jsx("p",{className:"text-token-text-primary text-sm",children:e.jsx(i,{...M.retainUntil,values:{expiryDate:new Date(l.active_until)}})}),e.jsx("div",{className:"mt-6 flex w-full flex-row justify-end",children:e.jsx(L,{title:a.formatMessage(M.doneButton),color:"primary",onClick:n,disabled:g})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("div",{className:"flex w-full items-center gap-4",children:[e.jsx(Ve,{src:r.data.profilePictureUrl,size:"large"}),e.jsxs("div",{className:"flex-col",children:[e.jsx("p",{className:"font-semibold",children:r.data.name}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{...M.membersCount,values:{count:l.seats_entitled}})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(i,{...M.areYouSure})}),e.jsxs("ul",{className:"text-token-text-secondary list-disc ps-5 text-sm",children:[e.jsx("li",{className:"my-2",children:e.jsx(i,{...M.dataUnavailable})}),l.active_until!=null&&e.jsx("li",{className:"my-2",children:e.jsx(i,{...M.retainUntil,values:{expiryDate:new Date(l.active_until)}})}),e.jsx("li",{className:"my-2",children:e.jsx(i,{...M.retainEmailAccess})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(i,{...M.enterEmailToConfirm})}),e.jsx(Te,{ariaLabel:a.formatMessage(M.enterEmailToConfirm),type:"text",name:"user-email",placeholder:"abcd@acme.com",onChange:N=>{p(N.target.value)}})]})]}),e.jsxs("div",{className:"mt-6 flex w-full flex-row justify-end",children:[e.jsx(L,{title:a.formatMessage(M.keepSubscriptionButton),onClick:n,disabled:g}),e.jsx(L,{title:a.formatMessage(M.cancelSubscriptionButton),onClick:j,disabled:!v,loading:g,color:"danger",className:"ms-2"})]})]})})}const M=I({dataUnavailable:{id:"cancelTeamPlanModal.dataUnavailable",defaultMessage:"All workspace data including chat history and settings will not be available."},cancelPlan:{id:"cancelTeamPlanModal.cancelPlan",defaultMessage:"Cancel subscription"},retainUntil:{id:"cancelTeamPlanModal.retainUntil",defaultMessage:"You will retain access to the workspace until the end of your billing cycle on {expiryDate, date, long}."},retainEmailAccess:{id:"cancelTeamPlanModal.retainEmailAccess",defaultMessage:"You will still be able to use ChatGPT with the other workspaces associated with this email address."},errorCancellingSubscription:{id:"cancelTeamPlanModal.errorCancellingSubscription",defaultMessage:"There was a problem cancelling your subscription."},areYouSure:{id:"cancelTeamPlanModal.areYouSure",defaultMessage:"Are you sure?"},enterEmailToConfirm:{id:"cancelTeamPlanModal.enterEmailToConfirm",defaultMessage:"Enter your Email address to confirm"},emailPlaceholder:{id:"cancelTeamPlanModal.emailPlaceholder",defaultMessage:"abcd@acme.com"},doneButton:{id:"cancelTeamPlanModal.doneButton",defaultMessage:"Done"},keepSubscriptionButton:{id:"cancelTeamPlanModal.keepSubscriptionButton",defaultMessage:"Keep subscription"},cancelSubscriptionButton:{id:"cancelTeamPlanModal.cancelSubscriptionButton",defaultMessage:"Cancel subscription"},successfullyCanceled:{id:"cancelTeamPlanModal.successfullyCanceled",defaultMessage:"You have successfully canceled your subscription."},membersCount:{id:"yourComponent.membersCount",defaultMessage:"{count, plural, one {# member} other {# members}}"}}),Ft=Se.p`text-base font-semibold mb-3 mt-3`;function Wt({isOpen:t,onClose:n,initialTeamBillingType:a,initialSeats:s,accountId:l,renewalDate:d,billingDetails:r}){const o=B(),c=q(),[u,p]=h.useState(s),[g,m]=h.useState(!1),[v,y]=h.useState(!1),{flexibleBillingPlan:x,annualBillingPlan:j}=de(r.currency),N=a===Xe.FLEXIBLE?x:j,P=Ce(l),R=async()=>{y(!0);try{await P.mutateAsync({accountId:l,updatedPriceInterval:void 0,updatedSeats:u}),y(!1),c.success(o.formatMessage({id:"teamBilling.successfullyUpdatedSubscription",defaultMessage:"Your subscription was updated successfully"}),{hasCloseButton:!0}),m(!1),n()}catch{c.warning(o.formatMessage({id:"teamBilling.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0})}finally{y(!1)}},ae=()=>{m(!1),p(s),n()};return e.jsx(Y,{testId:"modal-teams-manage-seats",type:"success",isOpen:t,onClose:ae,size:"custom",noPadding:!0,className:"max-w-2xl",showCloseButton:!0,title:g?o.formatMessage({id:"teamsManageSeatsModal.title",defaultMessage:"Manage seats"}):o.formatMessage({id:"teamsManageSeatsModalConfirmPage.title",defaultMessage:"Review"}),children:g?e.jsx(Yt,{numSeats:u,initialSeats:s,handleUpdate:R,isUpdating:v,renewalDate:d,accountId:l,selectedPlanBillingInfo:N,onClose:ae}):e.jsx(qt,{selectedPlan:a,selectedPlanBillingInfo:N,numSeats:u,initialSeats:s,setNumSeats:p,renewalDate:d,setConfirmPage:m,billingDetails:r})})}function qt({selectedPlan:t,selectedPlanBillingInfo:n,numSeats:a,initialSeats:s,setNumSeats:l,setConfirmPage:d,billingDetails:r,renewalDate:o}){const c=B(),u=Ze(isNaN(a)?0:a,s,et);return e.jsxs("div",{className:"grid grid-flow-row grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-5",children:[e.jsx(tt,{numSeats:a,minSeats:s,setNumSeats:l}),e.jsx(Ie,{className:"col-span-2 grid md:col-span-1 md:grid-cols-1",defaultValue:t,children:e.jsx(oe,{billingType:t,...n,selectedValue:t})})]}),e.jsxs("div",{className:"border-token-main-surface-tertiary bg-token-main-surface-secondary col-span-3 flex h-full flex-col overflow-hidden border-s p-6 md:col-span-1",children:[e.jsx(Ft,{children:e.jsx(i,{..._.summaryTitle})}),e.jsx(yt,{numSeats:u,selectedPlan:t,billingDetails:r,totalLabel:_.allPlansTotal,billDate:e.jsx(ee,{value:o,year:"numeric",month:"long",day:"numeric"})}),e.jsx(L,{title:c.formatMessage(C.continue),disabled:u===s,onClick:()=>d(!0),className:"w-full rounded-xl",color:"primary"})]})]})}function Yt({numSeats:t,initialSeats:n,renewalDate:a,handleUpdate:s,isUpdating:l,accountId:d,selectedPlanBillingInfo:r,onClose:o}){const c=B(),{data:u,isError:p,isLoading:g}=Je(d,t);if(g)return e.jsx("div",{className:"flex items-center justify-center py-32",children:e.jsx(J,{})});if(!(p||!u))return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.additionalSeats,values:{additionalSeats:t-n}})}),e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.additionalSeatsTotal,values:{currencySign:c.formatMessage(r.currencySign),totalCost:(u.total_amount/100).toFixed(2)}})})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{...C.proratedAmountMessage})}),e.jsx("span",{className:"bg-token-main-surface-secondary text-token-text-secondary mt-4 flex flex-col rounded-2xl p-4 text-sm",children:e.jsx(i,{...C.chargeMessage,values:{numSeats:t,date:e.jsx(ee,{value:a,year:"numeric",month:"long",day:"numeric"})}})}),e.jsx("hr",{className:"mt-4"}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.subtotal})}),e.jsx("span",{children:e.jsx(i,{...C.subtotalPrice,values:{currencySign:c.formatMessage(r.currencySign),totalCost:(u.amount_excluding_tax/100).toFixed(2)}})})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.tax})}),e.jsx("span",{children:e.jsx(i,{...C.taxAmount,values:{currencySign:c.formatMessage(r.currencySign),tax:(u.tax_amount/100).toFixed(2)}})})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.totalDueToday})}),e.jsx("span",{className:"font-semibold",children:e.jsx(i,{...C.totalDueTodayAmount,values:{currencySign:c.formatMessage(r.currencySign),totalCost:(u.total_amount/100).toFixed(2)}})})]}),e.jsx("hr",{className:"mt-4"}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(L,{title:c.formatMessage(_.cancel),color:"secondary",onClick:o,disabled:l}),e.jsx(L,{title:c.formatMessage(C.payNow),color:"primary",onClick:s,loading:l})]})]})}const C={continue:{id:"teamsManageSeatsModal.continue",defaultMessage:"Continue",description:"Continue button for manage seats modal"},payNow:{id:"teamsManageSeatsModal.payNow",defaultMessage:"Pay now",description:"Team manage seats modal pay now button"},tax:{id:"teamsManageSeatsModal.tax",defaultMessage:"Tax",description:"Tax label"},subtotal:{id:"teamsManageSeatsModal.subTotal",defaultMessage:"Subtotal",description:"Subtotal label"},proratedAmountMessage:{id:"teamsManageSeatsModal.proratedAmountMessage",defaultMessage:"Prorated amount until next billing cycle",description:"Informing user that they will be charged a prorated amount today"},chargeMessage:{id:"teamsManageSeatsModal.chargeMessage",defaultMessage:"You will be charged for {numSeats} total seats at your next renewal on {date}",description:"Number of additional seats being purchased"},additionalSeats:{id:"teamsManageSeatsModal.additionalSeats",defaultMessage:"{additionalSeats} additional {additionalSeats, plural, one {seat} other {seats}}",description:"Number of additional seats being purchased"},additionalSeatsTotal:{id:"teamsManageSeatsModal.additionalSeatsTotal",defaultMessage:"{currencySign}{totalCost}",description:"Summary total of selected plan"},subtotalPrice:{id:"teamsManageSeatsModal.subtotalPrice",defaultMessage:"{currencySign}{totalCost}",description:"Subtotal price for selected plan"},taxAmount:{id:"teamsManageSeatsModal.taxAmount",defaultMessage:"{currencySign}{tax}",description:"Tax amount"},totalDueToday:{id:"teamsManageSeatsModal.totalDueToday",defaultMessage:"Total due today",description:"Total due today label"},totalDueTodayAmount:{id:"teamsManageSeatsModal.totalDueTodayAmount",defaultMessage:"{currencySign}{totalCost}",description:"Total due today"}};function Gt({numInUse:t,numAllocated:n,isTeam:a,subscriptionWillRenew:s,subscriptionBillingPeriod:l,accountId:d,subscriptionRenewalDate:r,billingDetails:o}){const c=O(),u=re(c,"3954884439"),[p,g]=h.useState(!1),m=function(){g(!p)},v=l==="monthly"?T.FLEXIBLE:T.ANNUAL;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-start text-base",children:e.jsx(i,{...$t.description,values:{num:`${t}/${n}`,bold:y=>e.jsx("span",{className:"font-medium",children:y})}})}),a&&s&&u&&e.jsx(S,{color:"secondary",onClick:m,children:e.jsx(i,{id:"components.business.NumSeats.manageSeats",defaultMessage:"Manage seats"})})]}),p&&e.jsx(Wt,{isOpen:!0,onClose:m,initialTeamBillingType:v,initialSeats:n,accountId:d,renewalDate:r,billingDetails:o})]})}const $t=I({description:{defaultMessage:"<bold>{num}</bold> seats in use",id:"components.business.NumSeats.description"}});function Ht(t,n){const a=B(),s=q();return X({queryKey:["organization-invoices",{...t,options:n}],queryFn:async()=>await Be.getInvoices(t,n).catch(l=>{throw s.danger(a.formatMessage(Qt.invoicesLoadError,{error:l.message})),l}),enabled:"account_id"in t||"organization_id"in t})}function Kt(t){const n=A(),a=n?.id,s=n?.data.organizationId??void 0,l=n?.isEnterprisey();return Ht(l?{organization_id:s}:{account_id:a},t)}const Qt=I({invoicesLoadError:{id:"organizationBillingInfo.invoicesLoadError.0",defaultMessage:"Failed to load invoices. Contact support@openai.com if error persists."}}),ye="admin-credit-limit-alert-banner",Vt=()=>{const[t,n]=h.useState(!1),{data:a,isLoading:s,isError:l}=X({queryKey:["credit-pleas"],queryFn:async()=>{try{return await U.safeGet("/credits/pleas")}catch(g){Ne.addError("getCreditPleas: Error fetching credit pleas",{error:g})}}}),d=h.useMemo(()=>{const g=new Set;return a?.pleas?.forEach(m=>{g.add(m.user.id)}),g.size},[a]),r=h.useMemo(()=>{const g=a?.pleas?.map(v=>v.id);if(!g||g.length===0)return null;const m=[...g].sort();return btoa(m.join(","))},[a]),o=h.useMemo(()=>localStorage.getItem(ye),[]),c=d>0&&!s&&!l&&r&&r!==o&&!t;h.useEffect(()=>{!c||!r||k.logEventWithStatsig("ChatGPT Credits: Admin Credit Limit Alert Banner Shown","chatgpt_credits_admin_credit_limit_alert_banner_shown",{numBlockedUsers:d,newEncodedIdSet:r})},[c,r,d]);const u=O(),p=h.useCallback(()=>{r&&localStorage.setItem(ye,r),n(!0),k.logEventWithStatsig("ChatGPT Credits: Admin Credit Limit Alert Banner Dismissed","chatgpt_credits_admin_credit_limit_alert_banner_dismissed",{numBlockedUsers:d,newEncodedIdSet:r})},[r,d]);return c?e.jsx(ue,{primaryCtaText:e.jsx(i,{...se.addCredits}),onPrimaryCtaClick:()=>E(u,ke),onDismiss:p,content:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"flex items-center gap-2 font-bold",children:e.jsx(i,{...se.licenseLimitWarning})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(i,{...se.licenseLimitWarningDetails,values:{numBlockedUsers:d}})})]})]})}):null},se=I({addCredits:{id:"organizationBillingInfo.addCredits",defaultMessage:"Add credits"},licenseLimitWarning:{id:"organizationBillingInfo.licenseLimitWarning",defaultMessage:"Some teammates are blocked"},licenseLimitWarningDetails:{id:"organizationBillingInfo.licenseLimitWarningDetails",defaultMessage:"{numBlockedUsers, plural, one {# user hit their limit and needs} other {# users hit their limits and need}} credits to continue. Add credits to unblock {numBlockedUsers, plural, one {them} other {them}}."}}),Xt=!1;function $(t,{toastId:n="chatgpt.workspaceBilling.defaultErrorToastId",message:a}={}){return Bt(async(...s)=>await t(...s),{toastId:n,message:a})}const ne=5,ie=Se.div`loading-results-shimmer rounded-sm`;function Jt({usageData:t,...n}){return e.jsxs("div",{className:"mt-6 w-full",children:[t.status==="success"&&e.jsx(Zt,{...n,usageData:t.data}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-[28px] w-[230px] opacity-50"}),e.jsx(ie,{className:"my-2 h-[20px] w-full"}),e.jsx(ie,{className:"mb-[4px] h-[20px] w-[350px] opacity-50"})]}),t.status==="error"&&e.jsx("div",{className:"h-[90px]",children:e.jsx(ce,{className:"text-token-interactive-label-danger-secondary-default"})})]})}function Zt({usageData:t,overageLimit:n,denominator:a}){const{total_usage:s,usage_detail:l,current_balance:d}=t,r=B(),[o,c]=h.useState();let u=l,p=[];const g=r.formatMessage(H.otherBarLabel);u.length>ne&&(p=u.slice(ne-1),u=[...u.slice(0,ne-1),{label:g,amount:p.reduce((x,{amount:j})=>x+j,0)}]);const m=r.formatMessage(H.currentBalanceBarLabel),y=[{...u.reduce((x,{label:j,amount:N})=>({...x,[j]:N}),{}),[m]:d}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center gap-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-xl",children:[e.jsx("span",{className:Z("font-medium",s>0&&s>=a?"text-token-interactive-label-danger-secondary-default":"text-token-text-primary"),children:z.format(s)}),e.jsx("span",{children:"/"}),e.jsx("span",{children:z.format(a)})]}),e.jsx("span",{children:e.jsx(i,{...H.creditsUsed,values:{percentage:(a===0?0:s/a).toLocaleString(void 0,{style:"percent"})}})})]}),n!=null&&s>=a+n&&e.jsxs("div",{className:"text-token-interactive-label-danger-secondary-default bg-token-bg-status-error flex items-center gap-1 rounded-md p-1 text-xs",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(i,{...H.overageLimitReachedWarning})]})]}),s!==0&&a!==0&&e.jsx(Nt,{className:"relative z-1 my-2",width:"100%",height:20,children:e.jsxs(wt,{data:y,layout:"vertical",margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx(Ct,{type:"number",hide:!0,domain:[0,a]}),e.jsx(It,{type:"category",hide:!0}),e.jsx(Tt,{isAnimationActive:!1,content:e.jsx(ea,{hoveredSegment:o,totalUsage:s,denominator:a,additionalSeries:o===g?p:void 0}),cursor:!1}),u.map(({label:x},j)=>{const N=j===0,P=j===u.length-1&&d<=0;return e.jsx(he,{dataKey:x,stackId:"a",id:x,isAnimationActive:!1,onMouseOver:()=>c(x),onMouseOut:()=>c(void 0),radius:N?P?[4,4,4,4]:[4,0,0,4]:P?[0,4,4,0]:void 0,children:e.jsx(je,{fill:ve[j],opacity:o&&x!==o?.8:1,className:"transition-opacity duration-200 ease-in-out"})},x)}),d>0&&e.jsx(he,{dataKey:m,stackId:"a",isAnimationActive:!1,onMouseOver:()=>c(m),onMouseOut:()=>c(void 0),radius:[0,4,4,0],children:e.jsx(je,{fill:Lt,opacity:.15})})]})}),e.jsx("div",{className:"text-token-text-primary flex w-full flex-wrap items-center justify-start text-sm",children:u.map(({label:x},j)=>e.jsxs("div",{className:"me-6 mb-1 flex cursor-default items-center",title:x,children:[e.jsx("div",{className:"me-1 h-2 w-2 rounded-[1px]",style:{backgroundColor:ve[j]}}),e.jsx("span",{className:"me-1 max-w-32 overflow-hidden text-ellipsis whitespace-nowrap",children:x})]},x))})]})}const ea=({active:t,payload:n,hoveredSegment:a,totalUsage:s,denominator:l,additionalSeries:d})=>{if(!(t&&n&&a))return null;const r=({amount:c})=>e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:z.format(c)})," (",(c/Math.max(l,s)).toLocaleString(void 0,{style:"percent"}),")"]}),o=n[0].payload[a];return e.jsxs("div",{className:"border-token-border-heavy bg-token-bg-primary relative z-100 flex flex-col gap-1 rounded-lg border p-2 shadow-md",children:[e.jsxs("div",{children:[e.jsx("div",{children:a}),e.jsx("div",{children:e.jsx(r,{amount:o})})]}),d&&e.jsx("div",{className:"border-token-border-default mt-1 border-t pt-1",children:d.map(({label:c,amount:u})=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:c}),e.jsx(r,{amount:u})]},c))})]})},H=I({creditsUsed:{id:"organizationBillingInfo.creditUsageSettings.creditsUsed",defaultMessage:"credits used ({percentage})"},otherBarLabel:{id:"organizationBillingInfo.creditUsageSettings.otherBarLabel",defaultMessage:"Other"},currentBalanceBarLabel:{id:"organizationBillingInfo.creditUsageSettings.currentBalanceBarLabel",defaultMessage:"Remaining credits"},overageLimitReachedWarning:{id:"organizationBillingInfo.creditUsageSettings.overageLimitReachedWarning",defaultMessage:"Limit reached"}});function ta({cycle:t}){const n=B(),a=A(),[s,l]=h.useState(!1),d=!a?.id,r=async()=>{if(!d){k.logEventWithStatsig("ChatGPT Credits: Download Usage Report Clicked","chatgpt_credits_download_usage_report_clicked",{workspaceId:a.id,workspaceName:a.name,startDate:t.start.toISOString(),endDate:t.end.toISOString()}),l(!0);try{const o=await U.safeGet("/subscriptions/{workspace_id}/usage/export",{parameters:{path:{workspace_id:a.id},query:{start_date:t.start.toISOString(),end_date:t.end.toISOString()}}});_t({data:o.csv_content??"No results for the given date range",mimeType:"text/csv",filename:n.formatMessage(K.filename,{workspaceName:a.name??"Workspace",startDate:F(t.start,"MMM d"),endDate:F(t.end,"MMM d"),most_recent_result:F(o.most_recent_result?At(o.most_recent_result):new Date,"MMM d")})}),k.logEventWithStatsig("ChatGPT Credits: Download Usage Report Complete","chatgpt_credits_download_usage_report_complete",{workspaceId:a.id,workspaceName:a.name})}finally{l(!1)}}};return e.jsx(Le,{label:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-token-bg-primary text-sm",children:e.jsx(i,{...K.buttonTooltipTitle})}),e.jsx("div",{className:"text-token-bg-secondary text-xs",children:e.jsx(i,{...K.buttonTooltipDescription})})]}),side:"bottom",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(S,{className:"text-token-text-secondary font-normal",color:"ghost",loading:s,icon:at,disabled:d,onClick:r,children:e.jsx(i,{...K.buttonText})})})}const K=I({buttonText:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.buttonText",defaultMessage:"Download report"},buttonTooltipTitle:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.buttonTooltipTitle",defaultMessage:"Download usage as a CSV"},buttonTooltipDescription:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.buttonTooltipDescription",defaultMessage:"Last 24 hours of data is not included"},filename:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.filename",defaultMessage:"{workspaceName} Credit Usage Report ({startDate} - {endDate} as of {most_recent_result}).csv"}});function Ee({value:t,name:n,onChange:a,className:s,placeholder:l,onPressEnter:d}){return e.jsx(Te,{inputClassName:"pe-14",className:Z(s),ariaLabel:!1,placeholder:l,type:"number",name:n,value:t?.toString()??"",onChange:r=>{const o=r.target.valueAsNumber;a?.(Number.isNaN(o)?null:o)},onPressEnter:d,insideContainerChildren:e.jsx("div",{className:"absolute end-0 top-1/2 -translate-y-1/2",children:e.jsx(i,{...aa.unitDisplay})})})}const aa=I({unitDisplay:{id:"organizationBillingInfo.creditUsageSettings.unitDisplay",defaultMessage:"credits"}});function sa({closeModal:t,recipients:n,onSaveRecipients:a,thresholds:s,onSaveThresholds:l,isEnterprisey:d}){const r=A(),[o,c]=h.useState(),u=async v=>{await a(v),k.logEventWithStatsig("ChatGPT Credits: Save Additional Alert Recipients","chatgpt_credits_save_additional_alert_recipients",{workspaceId:r?.id,workspaceName:r?.name,recipientCount:v.length}),c(v)},[p,g]=h.useState(),m=async v=>{const y=v.slice().sort((x,j)=>x.credits-j.credits);await l(y),g(y)};return e.jsx(na,{closeModal:t,recipients:o??n,onSaveRecipients:u,thresholds:p??s,onSaveThresholds:m,isEnterprisey:d})}function na({closeModal:t,recipients:n,onSaveRecipients:a,thresholds:s,onSaveThresholds:l,isEnterprisey:d}){const r=B(),o=O(),c=A(),u=c?.isTeam()??!1;return e.jsx(me,{title:e.jsx(i,{...b.baseTitle}),primaryButton:e.jsx(S,{className:"min-w-[80px]",onClick:()=>E(o,({closeModal:p})=>e.jsx(be,{closeModal:p,editingThreshold:void 0,onSaveThreshold:g=>l([...s,g])})),children:e.jsx(i,{...b.newAlertButton})}),secondaryButton:!u&&e.jsx(S,{color:"secondary",onClick:()=>E(o,({closeModal:p})=>e.jsx(ia,{closeModal:p,initialRecipients:n,onSaveRecipients:a})),children:e.jsx(i,{...b.editRecipientsButton})}),closeModal:t,footerIsSpacedBetween:!0,children:e.jsxs("div",{className:"min-h-[250px]",children:[e.jsx("div",{className:"text-token-text-secondary mb-3 text-sm",children:e.jsx(i,{...b.alertDescription})}),e.jsx(le,{children:e.jsx(i,{...b.allCreditsUsedThreshold})}),d&&e.jsx(le,{children:e.jsx(i,{...b.overageLimitReachedThreshold})}),s.map((p,g)=>e.jsxs(le,{children:[e.jsx("span",{className:"w-0 grow",children:e.jsx(i,{...b.alertThresholdDescription,values:{thresholdString:z.format(p.credits),threshold:p.credits}})}),e.jsx(xe,{label:r.formatMessage(b.alertThresholdDeleteButtonLabel),onClick:async()=>{const m=s.slice();m.splice(g,1),k.logEventWithStatsig("ChatGPT Credits: Remove Alert Threshold","chatgpt_credits_remove_alert_threshold",{workspaceId:c?.id,workspaceName:c?.name,threshold:p.credits}),await l(m)},icon:e.jsx(st,{})}),e.jsx(xe,{label:r.formatMessage(b.alertThresholdEditButtonLabel),onClick:()=>E(o,({closeModal:m})=>e.jsx(be,{closeModal:m,editingThreshold:s[g],onSaveThreshold:async v=>{const y=s.slice();y.splice(g,1),await l([...y,v])}})),icon:e.jsx(nt,{})})]},g))]})})}function le({children:t}){return e.jsxs("div",{className:"border-token-border-default flex h-[54px] flex-row items-center justify-start gap-2 border-b text-sm font-medium",children:[e.jsx(bt,{className:"bg-token-bg-secondary rounded-lg p-1"}),e.jsx("div",{className:"flex grow flex-row items-center gap-1",children:t})]})}function ia({closeModal:t,initialRecipients:n,onSaveRecipients:a}){const[s,l]=h.useState(()=>n.map(u=>kt(u.value))),[d,r]=h.useState(!1),o=s.every(u=>u.isValid),c=async()=>{if(o)try{r(!0),await a(s.map(u=>({type:"email",value:u.value}))),t()}finally{r(!1)}};return e.jsxs(me,{title:e.jsx(i,{...b.recipientsTitle}),primaryButton:e.jsx(S,{loading:d,onClick:c,disabled:!o,className:"min-w-[80px]",children:e.jsx(i,{...b.saveButton})}),secondaryButton:e.jsx(S,{color:"secondary",onClick:t,children:e.jsx(i,{...b.backButton})}),closeModal:t,children:[e.jsx(ue,{type:"info",icon:e.jsx(_e,{className:"text-token-text-secondary icon-sm"}),content:e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(i,{...b.recipientsHelpText})})}),e.jsx(ge,{className:"mt-4 mb-2 block font-medium",htmlFor:"add-member-emails",id:"add-emails-label",children:e.jsx(i,{...b.recipientsFieldLabel})}),e.jsx(Et,{value:s,onChange:l})]})}function be({closeModal:t,editingThreshold:n,onSaveThreshold:a}){const s=A(),[l,d]=h.useState(n?.credits??null),[r,o]=h.useState(!1),c=l!=null&&Number.isInteger(l),u=async()=>{if(c)try{o(!0),k.logEventWithStatsig("ChatGPT Credits: Add Alert Threshold","chatgpt_credits_add_alert_threshold",{workspaceId:s?.id,workspaceName:s?.name,threshold:l}),await a({type:"absolute",credits:l}),t()}finally{o(!1)}};return e.jsxs(me,{title:e.jsx(i,{...b.thresholdTitle}),primaryButton:e.jsx(S,{className:"min-w-[80px]",loading:r,disabled:!c,onClick:u,children:e.jsx(i,{...b.saveButton})}),secondaryButton:e.jsx(S,{color:"secondary",onClick:t,children:e.jsx(i,{...b.backButton})}),closeModal:t,children:[e.jsx(ge,{htmlFor:"new-threshold-field",className:"mt-4 mb-2 block font-medium",children:e.jsx(i,{...b.thresholdFieldLabel})}),e.jsx(Ee,{value:l,name:"new-threshold-field",onChange:d,onPressEnter:u})]})}function me({title:t,primaryButton:n,secondaryButton:a,children:s,closeModal:l,footerIsSpacedBetween:d}){return e.jsx(Y,{testId:"modal-manage-alerts",isOpen:!0,onClose:l,type:"success",title:t,hideSeparator:!0,noPadding:!0,showCloseButton:!0,size:"large",footerClassName:"p-6 pt-0",primaryButton:n,secondaryButton:a,footerIsSpacedBetween:d,children:e.jsx("div",{className:"px-6 pb-6",children:s})})}const b=I({baseTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.title",defaultMessage:"Manage alerts"},editRecipientsButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.editRecipientsButton",defaultMessage:"Edit recipients"},newAlertButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.newAlertButton",defaultMessage:"New alert"},alertDescription:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertDescription",defaultMessage:"Specify when you wish to receive email alerts. Alerts are sent to all workspace owners by default."},allCreditsUsedThreshold:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.allCreditsUsedThreshold",defaultMessage:"All credits used"},overageLimitReachedThreshold:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.overageLimitReachedThreshold",defaultMessage:"Overage limit reached"},alertThresholdDescription:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdDescription",defaultMessage:"{thresholdString} {threshold, plural, one {credit} other {credits}} remaining"},alertThresholdDeleteButtonLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdDeleteButtonLabel",defaultMessage:"Delete"},alertThresholdEditButtonLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdEditButtonLabel",defaultMessage:"Edit"},thresholdTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.threshold.title",defaultMessage:"New usage alert"},thresholdFieldLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.threshold.fieldLabel",defaultMessage:"Alert when credit balance hits"},saveButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.saveButton",defaultMessage:"Save"},backButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.backButton",defaultMessage:"Back"},recipientsTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.title",defaultMessage:"Edit alert recipients"},recipientsHelpText:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.helpText",defaultMessage:"Email alerts are sent to workplace owners by default. Anyone can be added to receive alerts, but only owners can view or make changes on the billing page."},recipientsFieldLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.fieldLabel",defaultMessage:"Also send alerts to:"}});function la({currentLimit:t,closeModal:n,onSubmit:a,denominator:s}){const l=B(),[d,r]=h.useState(!1),[o,c]=h.useState(t),u=o!==t&&(o==null||Number.isInteger(o)&&o>=0),p=async()=>{if(u){r(!0);try{await a(o),n()}finally{r(!1)}}},g=(o??0)+s;return e.jsx(Y,{testId:"modal-overage-limit",isOpen:!0,onClose:()=>n(),type:"success",title:e.jsx(i,{...D.title}),hideSeparator:!0,noPadding:!0,showCloseButton:!0,size:"large",footerClassName:"p-6 pt-0",primaryButton:e.jsx(S,{className:"min-w-[80px]",loading:d,disabled:!u,onClick:p,children:e.jsx(i,{...D.saveButton})}),secondaryButton:e.jsx(S,{onClick:()=>c(null),color:"secondary",disabled:o==null,children:e.jsx(i,{...D.clearButton})}),children:e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{...ze})}),e.jsx(ge,{htmlFor:"overage-limit-field",className:"mt-4 mb-2 block font-medium",children:e.jsx(i,{...D.fieldLabel})}),e.jsx(Ee,{value:o,name:"overage-limit-field",onChange:c,onPressEnter:p,placeholder:l.formatMessage(D.emptyFieldPlaceholder)}),e.jsx("div",{className:Z("text-token-text-secondary pt-1 text-xs",o==null&&"invisible"),children:e.jsx(i,{...D.helpText,values:{newTotalAllowed:g,newTotalAllowedString:z.format(g)}})})]})})}const D=I({title:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.title",defaultMessage:"Add overage limit"},fieldLabel:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.fieldLabel",defaultMessage:"Overage limit"},emptyFieldPlaceholder:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.emptyFieldPlaceholder",defaultMessage:"None"},helpText:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.helpText",defaultMessage:"Advanced access will pause if your org exceeds {newTotalAllowedString} {newTotalAllowed, plural, one {credit} other {credits}} spent."},saveButton:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.saveButton",defaultMessage:"Save"},clearButton:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.clearButton",defaultMessage:"Clear"}}),ze=De({id:"organizationBillingInfo.creditUsageSettings.overageLimitDescription",defaultMessage:"Your org can continue to use advanced features and models beyond your plan. Add an overage limit to control this amount."}),Me="https://help.openai.com/en/articles/11487671 ";function oa(){const t=O(),n=A(),a=["subscription-settings",n?.organizationId],s=X({queryKey:a,queryFn:$(()=>U.safeGet("/subscriptions/{organization_id}/settings",{parameters:{path:{organization_id:n?.organizationId}}})),enabled:n?.organizationId!=null}),l=Ue(),{mutateAsync:d}=pe({mutationFn:$(x=>U.safePost("/subscriptions/{organization_id}/settings/limit",{parameters:{path:{organization_id:n?.organizationId}},requestBody:{overage_limit:x==null?x:{type:"absolute",credits:x}}})),onSuccess:()=>{l.invalidateQueries({queryKey:a}),l.invalidateQueries({queryKey:Fe(n?.organizationId)})}}),{mutateAsync:r}=pe({mutationFn:$(({recipients:x,thresholds:j})=>U.safePost("/subscriptions/{organization_id}/settings/alerts",{parameters:{path:{organization_id:n?.organizationId}},requestBody:{alert_recipients:x,alert_thresholds:j}})),onSuccess:()=>{l.invalidateQueries({queryKey:a})}}),c=we(0),u=n?.organizationId!=null&&c!=null&&c!=="pending",p=X({queryKey:["organization-usage",n?.organizationId,c!=="pending"&&c?.start,c!=="pending"&&c?.end],queryFn:$(()=>U.safeGet("/subscriptions/{organization_id}/usage",{parameters:{path:{organization_id:n?.organizationId},query:{start_date:u?c.start.toISOString():"Query Not Enabled",end_date:u?c.end.toISOString():"Query Not Enabled"}}})),enabled:u}),g=We();if(!u)return null;const m=s.data==null?"loading":s.data.overage_limit==null?"noLimit":"limitSet";let v=p.data?.current_balance??0;n?.isTeam()&&(v=Math.max(v,0));const y=(p.data?.total_usage??0)+v;return e.jsxs(e.Fragment,{children:[n?.isEnterprisey()&&!g&&v<=0&&e.jsx(ue,{title:e.jsx(i,{...w.inOverageBannerTitle}),content:e.jsx(i,{...w.inOverageBannerContent,values:{link:x=>e.jsx(Ae,{openNewTab:!0,href:Me,children:x},Me)}}),icon:e.jsx(_e,{}),type:"info"}),e.jsxs(W,{className:"border-token-border-default gap-0 rounded-xl border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("div",{children:[e.jsx(Q,{children:e.jsx(i,{...w.creditUsageSectionTitle})}),e.jsx(V,{className:"text-token-text-secondary mt-1 text-xs",children:e.jsx(i,{...w.daysLeft,values:{days:it(c.end,new Date)}})})]})}),y>0&&e.jsx(ta,{cycle:c})]}),e.jsx(Jt,{usageData:p,overageLimit:s.data?.overage_limit?.credits??null,denominator:y}),n?.isEnterprisey()&&e.jsxs("div",{className:"border-token-border-default mt-6 flex items-center gap-2 border-t pt-6",children:[e.jsxs("div",{className:"flex w-0 grow items-center gap-1 text-sm",children:[e.jsx("span",{className:"font-medium",children:e.jsx(i,{...w.overageLimitLabel})}),e.jsx(Le,{className:"flex items-center",label:e.jsx("span",{className:"text-token-bg-primary font-normal",children:e.jsx(i,{...ze})}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(lt,{className:"icon-sm text-token-text-secondary inline"})}),":",e.jsxs("span",{children:[m==="loading"&&e.jsx(J,{}),m==="noLimit"&&e.jsx(i,{...w.unsetOverageLimitAmount}),m==="limitSet"&&e.jsx(i,{...w.setOverageLimitAmount,values:{credits:z.format(s.data?.overage_limit?.credits??0),total:z.format((s.data?.overage_limit?.credits??0)+y)}})]})]}),e.jsx(S,{color:"secondary",className:"min-w-[80px]",disabled:m==="loading",onClick:()=>E(t,({closeModal:x})=>e.jsx(la,{currentLimit:s.data?.overage_limit?.credits??null,onSubmit:async j=>{k.logEventWithStatsig(j==null?"ChatGPT Credits: Overage Limit Cleared":"ChatGPT Credits: Overage Limit Set",j==null?"chatgpt_credits_overage_limit_cleared":"chatgpt_credits_overage_limit_set",{workspaceId:n.id,workspaceName:n.name,newLimit:j}),await d(j),x()},closeModal:x,denominator:y})),children:m==="noLimit"||m==="loading"?e.jsx(i,{...w.unsetOverageLimitButton}):e.jsx(i,{...w.setOverageLimitButton})})]}),n?.isTeam()&&e.jsx("div",{className:"border-token-border-default mt-6 flex items-center gap-2 border-t pt-6",children:e.jsxs("div",{className:"flex grow items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{children:e.jsx(i,{id:"organizationBillingInfo.additionalCredits",defaultMessage:"Add more credits"})}),e.jsx(V,{className:"text-token-text-secondary mt-1",children:e.jsx(i,{id:"organizationBillingInfo.additionalCreditsDescription",defaultMessage:"Give your team continued access after they hit their plan limits. Credits are valid for 12 months."})})]}),e.jsx(S,{color:"secondary",onClick:()=>E(t,ke),children:e.jsx(i,{id:"organizationBillingInfo.addCredits",defaultMessage:"Add credits"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"w-0 grow",children:[e.jsx(Q,{children:e.jsx(i,{...w.usageAlertLabel})}),e.jsx(V,{className:"text-token-text-secondary mt-1",children:e.jsx(i,{...w.usageAlertDescription})})]}),e.jsx(S,{color:"secondary",className:"min-w-[80px]",onClick:()=>E(t,({closeModal:x})=>e.jsx(sa,{closeModal:x,onSaveRecipients:async j=>{await r({recipients:j})},onSaveThresholds:async j=>{await r({thresholds:j})},recipients:s.data?.alert_recipients??[],thresholds:s.data?.alert_thresholds??[],isEnterprisey:n?.isEnterprisey()??!1})),children:e.jsx(i,{...w.usageAlertButton})})]})]})}const w=I({creditUsageSectionTitle:{id:"organizationBillingInfo.creditUsageSettings.creditUsageSectionTitle",defaultMessage:"Credit usage"},daysLeft:{id:"organizationBillingInfo.creditUsageSettings.daysLeft",defaultMessage:"Next cycle in {days} {days, plural, one {day} other {days}}"},inOverageBannerTitle:{id:"organizationBillingInfo.creditUsageSettings.inOverageBannerTitle",defaultMessage:"Your org is using credits beyond your plan"},inOverageBannerContent:{id:"organizationBillingInfo.creditUsageSettings.inOverageBannerContent",defaultMessage:"Access to advanced features and models is still available. Youâ€™ll receive a separate invoice at the end of the month. <link>Learn more</link>"},overageLimitLabel:{id:"organizationBillingInfo.creditUsageSettings.overageLimitLabel",defaultMessage:"Overage limit"},unsetOverageLimitAmount:{id:"organizationBillingInfo.creditUsageSettings.unsetOverageLimitAmount",defaultMessage:"None"},setOverageLimitAmount:{id:"organizationBillingInfo.creditUsageSettings.setOverageLimitAmount",defaultMessage:"{credits, plural, one {# credit} other {# credits}} ({total} total)"},unsetOverageLimitButton:{id:"organizationBillingInfo.creditUsageSettings.unsetOverageLimitButton",defaultMessage:"Add limit"},setOverageLimitButton:{id:"organizationBillingInfo.creditUsageSettings.setOverageLimitButton",defaultMessage:"Edit"},usageAlertLabel:{id:"organizationBillingInfo.creditUsageSettings.usageAlertLabel",defaultMessage:"Credit usage alerts"},usageAlertDescription:{id:"organizationBillingInfo.creditUsageSettings.usageAlertDescription",defaultMessage:"Send alerts to owners when credits are running low"},usageAlertButton:{id:"organizationBillingInfo.creditUsageSettings.usageAlertButton",defaultMessage:"Manage"}}),ra="https://help.openai.com/en/articles/8792536-manage-billing-on-the-chatgpt-team-subscription-plan",ca=(t,n)=>{const a=t?.isEdu(),s=t?.isTeam(),l=t?.isEnterprisey(),d=t?.isResellerHosted(),r=n?.non_profit_org_discount_applied,o=n.active_until!=null;if(a)return o?f.activeEduLicense:d?f.resellerHostedEduLicense:f.pendingEduLicense;if(l)return o?f.activeEnterpriseLicense:d?f.resellerHostedEnterpriseLicense:f.pendingEnterpriseLicense;if(r)return o?f.activeTeamLicenseNonProfitOrg:f.pendingTeamLicense;if(s)return o?f.activeTeamLicense:f.pendingTeamLicense;throw Ne.addError("getWorkspaceLicenseSubtitle: No license found",{subscription:n,currentAccount:t}),new Error("No license for workspace account.")};function da(){const{data:t,isLoading:n,isError:a}=te(),s=A(),l=O(),d=re(l,"2861925050");if(n)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(J,{})});if(a||!t||!s)return null;const r=t.active_until!=null,o=t?.seats_in_use>t?.seats_entitled,c=t.active_until?new Date(t.active_until):null,u=ca(s,t),p=s?.isTeam(),g=t?.billing_period==="monthly"?T.FLEXIBLE:T.ANNUAL,m=de(t.billing_currency),{discountedMonthlyCost:v,currencySign:y}=g===T.FLEXIBLE?m.flexibleBillingPlan:m.annualBillingPlan;return e.jsxs(e.Fragment,{children:[d&&p&&e.jsx(Vt,{}),e.jsxs(W,{className:"border-token-border-default gap-0 rounded-xl border",children:[e.jsxs("div",{className:"flex flex-col gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(i,{...u}),p&&e.jsx("div",{className:"rounded-sm bg-[#E0FFE7] px-1.5 py-1 text-sm font-medium text-[#24622B]",children:e.jsx(i,{...g===T.FLEXIBLE?f.monthly:f.annual})})]}),c&&e.jsx(V,{className:"text-token-text-secondary mt-1",children:s?.isEnterprisey()?e.jsx(i,{...f.licenseExpiry,values:{expiryDate:c}}):t.will_renew?e.jsx(i,{...f.renewalDate,values:{expiryDate:c}}):e.jsx(i,{...f.deactivateDate,values:{expiryDate:c}})})]}),e.jsx(ua,{})]}),p&&!t?.non_profit_org_discount_applied&&e.jsx("div",{className:"text-token-text-secondary h-[50px] text-sm",children:e.jsx(i,{...f.pricePerSeat,values:{symbol:e.jsx(i,{...y}),amount:v,currency:x=>e.jsx("span",{className:"align-top text-xl",children:x}),price:x=>e.jsx("span",{className:"text-token-text-primary ps-[1px] pe-1 align-bottom text-[42px] leading-none",children:x})}})})]}),e.jsx("hr",{}),r&&e.jsxs("div",{className:"p-6",children:[e.jsx(pa,{isTeam:p,accountId:s.id}),p&&o&&e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{...f.teamsAutochargeMessage,values:{link:x=>e.jsx(Ae,{className:"ps-1",openNewTab:!0,href:ra,children:x})}})})]})]}),d&&e.jsx(oa,{})]})}function ua(){const[t,n]=h.useState(!1),a=B(),s=q(),l=A(),{data:d}=te(),[r,o]=h.useState(!1),c=function(){o(!r)},[u,p]=h.useState(!1),g=O(),m=re(g,"1318146997");if(!l||!l.isTeam()||!d)return;const v=async()=>{n(!0);try{const x=await Be.fetchCustomerPortalUrl(l?.getWorkspaceId());location.href=x.url}catch{s.warning(a.formatMessage(f.stripeErrorWarning),{hasCloseButton:!0})}finally{n(!1)}},y=d?.billing_period==="monthly"?T.FLEXIBLE:T.ANNUAL;return e.jsxs(e.Fragment,{children:[e.jsxs(gt,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(S,{color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(i,{...f.manageLicenseBtn}),e.jsx(xt,{className:"icon-sm"})]})}),children:[e.jsx(G.Item,{icon:Ge,onClick:v,children:e.jsx(i,{...f.managePaymentMethod})}),d.will_renew&&m&&e.jsx(G.Item,{icon:mt,onClick:()=>p(!0),children:e.jsx(i,{...f.manageBillingSchedule})}),d?.will_renew&&e.jsx(G.Separator,{}),d?.will_renew&&e.jsx(G.Item,{icon:pt,color:"danger",onClick:()=>{c()},children:e.jsx(i,{...f.cancelSubscriptionBtn})})]}),d.active_until!=null&&e.jsx(Pt,{isOpen:u,onClose:()=>p(!1),initialTeamBillingType:y,renewalDate:new Date(d.active_until),accountId:l.id,billingDetails:{currency:d.billing_currency}}),e.jsx(Rt,{isOpen:r,onClose:c})]})}function ga({invoice:t}){const n=t?.status_transitions.paid_at!=null&&new Date(t.status_transitions.paid_at*1e3),a=t&&new Date(t.due_date*1e3),s=t&&new Date(t.created*1e3);return e.jsxs(St,{className:"items-center",children:[e.jsxs("div",{className:"flex grow flex-col gap-1",children:[e.jsx("span",{children:s?e.jsx(i,{...f.invoiceName,values:{createdDate:s}}):e.jsx(i,{...f.defaultInvoiceName})}),t?.paid&&n!=null?e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(i,{...f.paidInvoice,values:{invoiceDate:n}})}):t&&e.jsx("div",{className:"text-xs text-green-600",children:e.jsx(i,{...f.upcomingInvoice,values:{invoiceDate:a}})})]}),e.jsx("a",{href:t?.hosted_invoice_url,className:Z("mx-auto",t?.hosted_invoice_url===void 0&&"cursor-not-allowed opacity-20"),target:"_blank",rel:"noreferrer",children:e.jsx(ft,{className:"icon-sm text-green-600"})})]})}function ma(){const[t,n]=h.useState({limit:5}),{data:a,isError:s,isLoading:l}=Kt(t),d=t.startingAfter!=null||t.endingBefore!=null&&a?.has_more,r=t.endingBefore!=null||a?.has_more&&t.endingBefore==null;return l?e.jsx(W,{children:e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(J,{})})}):s||a==null?e.jsx(W,{children:e.jsx(ct,{children:e.jsx(i,{...f.noInvoices})})}):e.jsxs(W,{children:[e.jsx(Mt,{children:a.data.map(o=>e.jsx(ga,{invoice:o},o.id))}),e.jsxs("div",{className:"flex",children:[d&&e.jsx("button",{onClick:()=>{a&&n(o=>({...o,endingBefore:a.data[0].id,startingAfter:void 0}))},children:e.jsx(dt,{className:"icon-sm"})}),e.jsx("div",{className:"grow"}),r&&e.jsx("button",{onClick:()=>{a&&n(o=>({...o,startingAfter:a.data[a.data.length-1].id,endingBefore:void 0}))},children:e.jsx(ut,{className:"icon-sm"})})]})]})}function pa({isTeam:t,accountId:n}){const{data:a,isLoading:s,isError:l}=te();return l||!a||s||!a.billing_period||!a.active_until?null:e.jsx(Gt,{numInUse:a.seats_in_use,numAllocated:a.seats_entitled,isTeam:t,subscriptionWillRenew:a.will_renew,subscriptionBillingPeriod:a.billing_period,subscriptionRenewalDate:new Date(a.active_until),accountId:n,billingDetails:{currency:a.billing_currency}})}const xa=t=>t==="plan"||t==="invoices";function fa(){const t=ot(m=>m.currentWorkspace),n=B(),a=Oe(),s=we(),l=h.useMemo(()=>[{key:"plan",label:n.formatMessage(f.planTabName),children:e.jsx(fe,{children:e.jsx(da,{})})},{key:"invoices",label:n.formatMessage(f.invoicesTabName),children:e.jsx(fe,{children:e.jsx(ma,{})})}],[n]),[d]=Re(),r=d.get("tab"),[o,c]=h.useState(r&&xa(r)?r:l[0].key),u=m=>{c(m),a({pathname:window.location.pathname,search:new URLSearchParams({tab:m}).toString()})};if(!t?.organizationId)return null;const g=s!=null&&s!=="pending"&&s.start.getFullYear()!==s.end.getFullYear()?"MMM d, y":"MMM d";return e.jsxs(e.Fragment,{children:[e.jsx(rt,{children:e.jsx("title",{children:n.formatMessage(f.adminBrowserPageTitle)})}),e.jsx(qe,{title:n.formatMessage(f.title),subtitle:s&&(s==="pending"?e.jsx("div",{className:"loading-results-shimmer h-[24px] w-[300px] rounded-sm"}):e.jsx(i,{...f.subtitle,values:{start:F(s.start,g),end:F(s.end,g)}})),tabsHeader:e.jsx(jt,{items:l,activeTab:o,onTabChange:u})}),e.jsx(Ye,{children:e.jsx(vt,{items:l,activeTab:o})})]})}const f=I({adminBrowserPageTitle:{id:"organizationBillingInfo.adminBrowserPageTitle",defaultMessage:"ChatGPT - Admin | Billing"},title:{id:"organizationBillingInfo.title.1",defaultMessage:"Billing"},subtitle:{id:"organizationBillingInfo.subtitle",defaultMessage:"Current cycle: {start} - {end}"},activeEnterpriseLicense:{id:"organizationBillingInfo.activeEnterpriseLicense",defaultMessage:"Enterprise License"},pendingEnterpriseLicense:{id:"organizationBillingInfo.pendingEnterpriseLicense",defaultMessage:"Enterprise License (pending activation)"},resellerHostedEnterpriseLicense:{id:"organizationBillingInfo.resellerHostedEnterpriseLicense",defaultMessage:"Enterprise License"},activeEduLicense:{id:"organizationBillingInfo.activeEduLicense",defaultMessage:"Edu License"},pendingEduLicense:{id:"organizationBillingInfo.pendingEduLicense",defaultMessage:"Edu License (pending activation)"},resellerHostedEduLicense:{id:"organizationBillingInfo.resellerHostedEduLicense",defaultMessage:"Edu License"},activeTeamLicense:{id:"organizationBillingInfo.activeTeamLicense",defaultMessage:"Team Plan"},activeTeamLicenseNonProfitOrg:{id:"organizationBillingInfo.activeTeamLicenseNonProfitOrg",defaultMessage:"Team License (Non Profit Discount)"},pendingTeamLicense:{id:"organizationBillingInfo.pendingTeamLicense",defaultMessage:"Team Plan (pending activation)"},licenseExpiry:{id:"organizationBillingInfo.licenseExpiry",defaultMessage:"Active until {expiryDate, date, long}"},renewalDate:{id:"organizationBillingInfo.renewalDate",defaultMessage:"Renews on {expiryDate, date, long}"},deactivateDate:{id:"organizationBillingInfo.deactivateDate",defaultMessage:"Deactivates on {expiryDate, date, long}"},seatsInUse:{id:"organizationBillingInfo.seatsInUse",defaultMessage:"{numSeats} in use ({numSeatsPct})"},invoiceName:{id:"organizationBillingInfo.invoiceName",defaultMessage:"Invoice: {createdDate, date, long}"},defaultInvoiceName:{id:"organizationBillingInfo.defaultInvoiceName",defaultMessage:"Invoice"},paidInvoice:{id:"organizationBillingInfo.paidInvoice",defaultMessage:"Paid: {invoiceDate, date, long}"},upcomingInvoice:{id:"organizationBillingInfo.upcomingInvoice",defaultMessage:"Due: {invoiceDate, date, long}"},noInvoices:{id:"organizationBillingInfo.noInvoices",defaultMessage:"No invoices found"},manageSubscription:{id:"organizationBillingInfo.manageSubscription",defaultMessage:"Manage subscription"},cancelSubscriptionBtn:{id:"organizationBillingInfo.cancelSubscriptionBtn",defaultMessage:"Cancel subscription"},manageLicenseBtn:{id:"organizationBillingInfo.manageLicenseBtn",defaultMessage:"Manage plan"},managePaymentMethod:{id:"organizationBillingInfo.managePaymentMethod",defaultMessage:"Payment method"},manageBillingSchedule:{id:"organizationBillingInfo.manageSchedule",defaultMessage:"Billing schedule"},stripeErrorWarning:{id:"organizationBillingInfo.stripeErrorWarning",defaultMessage:"Error loading account information"},teamsAutochargeMessage:{id:"organizationBillingInfo.teamsAutochargeMessage",defaultMessage:"Your additional seats will be included on your next invoice. <link>Learn more</link>"},planTabName:{id:"organizationBillingInfo.planTabName",defaultMessage:"Plan"},invoicesTabName:{id:"organizationBillingInfo.invoicesTabName",defaultMessage:"Invoices"},pricePerSeat:{id:"organizationBillingInfo.pricePerSeat",defaultMessage:"<currency>{symbol}</currency><price>{amount}</price>/seat"},monthly:{id:"organizationBillingInfo.monthly",defaultMessage:"Monthly"},annual:{id:"organizationBillingInfo.annual",defaultMessage:"Annual"}}),hs=Pe(function(){return $e(),e.jsx(fa,{})});export{hs as default};
//# sourceMappingURL=bk8n53sju7490mpq.js.map
