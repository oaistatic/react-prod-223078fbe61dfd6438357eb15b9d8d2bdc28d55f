import{c as v,B as A,ab as De,e as h,b as D,O as ie,b5 as Ee,F as $,eP as Ne}from"./citrwydz0bgriwlc.js";import{j as e,a5 as ye,i as Q,r as m,M as c,e as G,u as B,d as Ae}from"./b8ijctzpgh0s7wpx.js";import{sX as O,sY as ve,dr as Ie,gn as Ge,qE as M,aQ as X,mG as Oe,sZ as ze,s_ as le,s$ as q,a3 as P,bL as Re,t0 as be,m_ as We,t1 as I,t2 as ee,t3 as te,t4 as de,gm as Me,mH as ae,t5 as ce,dI as qe,t6 as Pe,t7 as Be,t8 as ke,aX as He,cs as Fe,d as Ke,bJ as $e,cW as Qe,bX as F,cX as we,t9 as Ve,ta as Ye,lf as Xe,E as Ze}from"./krbmwir12ubt4od1.js";import{r as Je}from"./hp2r837n4h7dvq4u.js";import{R as _}from"./l3rtpckh3mar95pc.js";import{S as et}from"./kdg6x58wvl6ya91l.js";import{f as w,d as tt,V as at,u as st,O as Z}from"./nmunppho17ij7jm4.js";import{L as ot}from"./noo2d2kse83ez5bs.js";import{S as rt}from"./l7parheddlw8ixo5.js";import{S as nt}from"./ba1mte0dghirkk3l.js";import{u as it}from"./k5qjx4jdow04k7d2.js";import{b as lt,i as dt,u as ct,j as ut}from"./e8gr7b7eez1onpam.js";import"./ftxrqc0rwihsh5tn.js";import"./he8ni3xt3ac4tebf.js";import"./ocq21rw37s5jtm4i.js";import"./galyil7vygq0i5a6.js";import"./enswt24cmdi6maqa.js";import"./otl51en3t0ec5n7s.js";import"./b4v20hsjdnh8a64d.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./dcml6fn13vfm1zv2.js";import"./nvghija6qp2cunds.js";import"./djd85tifm57yisqi.js";import"./h3krx8dg2s8o2yh5.js";import"./cfe0bfy5asp94vp2.js";import"./jkznwfhp8ahnvlot.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./i7jya7stlyvnzya0.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./k6ccgr4wxcppeg93.js";import"./dbalwdodzoo02ru2.js";import"./c2d9eukr2hh7n3q0.js";import"./eigi8l95ddhoqirr.js";import"./etmxhiuvgu79utu0.js";import"./ct6yhczwft8t5t9k.js";import"./nvnp6g5g3fqgfhec.js";import"./g64reurtt3avubtb.js";import"./cn2bawepofyjgkxo.js";import"./iki1bxy2syl3zwuv.js";function je(){return" "}const T=O(ve(new Date,1)),N=new Date;function se({onLeft:t,leftDisabled:a,onRight:s,rightDisabled:o,children:r,className:l,borderLess:n=!1,surpressChildrenWrapper:i=!1}){return e.jsxs("div",{className:v("flex items-stretch",l),children:[e.jsx(A,{className:v("disabled:text-token-text-quaternary pe-1",!n&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:t,disabled:a,icon:Ie}),i?r:e.jsx("span",{className:v("flex grow items-center justify-center px-1 text-sm",!n&&"border-token-border-medium border-t border-b"),children:r}),e.jsx(A,{className:v("disabled:text-token-text-quaternary ps-1",!n&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:s,disabled:o,icon:Ge})]})}const mt=Je(12);function _e({referenceDate:t,setReferenceDate:a,earliestValidDate:s,latestValidDate:o,motionLayoutId:r}){return e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>a(ve(t,1),"subYear"),onRight:()=>a(Oe(t,1),"addYear"),leftDisabled:X(new Date)>=X(t)+1,rightDisabled:X(new Date)<=X(t),children:M(t,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:mt.map(l=>{const n=O(ze(t,l)),i=le(n,t),d=q(n,s)||P(n,o);return e.jsxs("button",{disabled:d,onClick:()=>a(n,"select"),className:v("relative h-8 w-full rounded-md",!d&&"hover:bg-token-surface-hover"),children:[i&&e.jsx(ye.div,{layoutId:r,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:v("relative z-10 transition-colors duration-75",i&&"text-token-main-surface-primary delay-75",!i&&"text-token-text-primary delay-0",d&&"text-token-text-quaternary"),children:M(n,"MMM")})]},l)})})]})}function gt({currentWorkspaceId:t,currentTab:a,onClose:s}){const o=Q(),[r,l]=m.useState(!1),[n,i]=m.useState(a==="gptsTab"?"gpt":"user"),[d,p]=m.useState("thisMonth"),[u,b]=m.useState(),L=Re(g=>g.currentWorkspace?.name)??t,j=new Date,f=be(new Date,1);return e.jsxs(De,{testId:"modal-export",isOpen:!0,onClose:()=>{s(),h.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(c,{...x.title}),showCloseButton:!0,primaryButton:e.jsx(A,{loading:r,onClick:async()=>{l(!0);try{const g=d==="customRange"?{period:u?.period??K.period,period_start:w(u?.referenceDate??K.referenceDate)}:xt(d);h.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:n,dateRangeType:d,period:g.period,periodStart:g.period_start});const E=await D.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:t},query:{...g,report_type:n}}});tt({data:E.csv_content,mimeType:"text/csv",filename:o.formatMessage(x.filename,{workspaceName:L,period:g.period,reportType:n,date:g.period_start})})}finally{l(!1)}s()},children:e.jsx(c,{...x.generateCsvButton})}),children:[e.jsxs(ot,{className:"font-medium",children:[e.jsx(c,{...x.dataTypeDropdownLabel}),e.jsx(We,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:n,onValueChange:g=>i(g),options:[{label:o.formatMessage(x.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(x.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(c,{...x.dateRangeLabel})}),e.jsxs(_.Root,{className:"flex flex-col gap-3",value:d,onValueChange:g=>{p(g),h.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:g})},children:[e.jsx(_.Item,{value:"thisMonth",label:e.jsx(c,{...x.thisMonthLabel,values:{date:M(j,"MMMM y")}}),children:e.jsx(_.Indicator,{})}),e.jsx(_.Item,{value:"lastMonth",label:e.jsx(c,{...x.lastMonthLabel,values:{date:M(I(j,1),"MMMM y")}}),children:e.jsx(_.Indicator,{})}),e.jsx(_.Item,{value:"thisWeek",label:e.jsx(c,{...x.thisWeekLabel,values:{date:`${M(ee(j),"MMM d")} – ${M(te(j),"MMM d")}`}}),children:e.jsx(_.Indicator,{})}),e.jsx(_.Item,{value:"lastWeek",label:e.jsx(c,{...x.lastWeekLabel,values:{date:`${M(ee(f),"MMM d")} – ${M(te(f),"MMM d")}`}}),children:e.jsx(_.Indicator,{})}),e.jsx(_.Item,{value:"customRange",label:e.jsx(pt,{customRange:u,setCustomRange:b,onClick:()=>p("customRange")}),children:e.jsx(_.Indicator,{})})]})]})}const K={period:"monthly",referenceDate:new Date};function pt({customRange:t,setCustomRange:a,onClick:s}){const o=(t??K).period,r=(t??K).referenceDate,l=o==="monthly"?de(r):te(r),n=({period:i,referenceDate:d})=>a((p=K)=>{const u=i??p.period,b=d??p.referenceDate,L=u==="monthly"?O:ee,j=P(b,N)?N:q(b,T)?T:b;return{period:u,referenceDate:L(j)}});return e.jsx(Me,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(A,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:s,children:[t?e.jsx(c,{...x.customRangeDisplay,values:{start:ce(t.referenceDate),end:ce(l)}}):e.jsx(c,{...x.chooseMonthOrWeekButton}),e.jsx("div",{className:"grow"}),e.jsx(qe,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(et,{className:"mb-4 rounded-md",value:o,onChange:i=>{n({period:i}),h.logEvent("Workspace Usage: Export Custom Period Changed",{period:i})},ariaLabel:x.customRangePeriodToggleAria,leftItem:{className:"rounded-md",ariaLabel:x.chooseDateMonthlyLabel,label:x.chooseDateMonthlyLabel,value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:x.chooseDateWeeklyLabel,label:x.chooseDateWeeklyLabel,value:"weekly"}}),o==="monthly"?e.jsx(_e,{referenceDate:r,setReferenceDate:(i,d)=>{n({referenceDate:i}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:d})},earliestValidDate:T,latestValidDate:N,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{n({referenceDate:I(r,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{n({referenceDate:ae(r,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:q(I(r,1),T),rightDisabled:P(ae(r,1),N),children:M(r,"MMMM y")}),e.jsx(ht,{referenceDate:r,setReferenceDate:i=>n({referenceDate:i})})]})]})})}const ht=({referenceDate:t,setReferenceDate:a})=>{const s=O(t),o=Pe({start:s,end:de(t)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(r=>{const l=Be(r,t),n=q(r,T)||P(r,new Date);return e.jsxs("button",{disabled:n,onClick:()=>{a(r),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:v("relative h-8 w-full rounded-full",!n&&"hover:bg-token-surface-hover"),children:[l&&e.jsx(ye.div,{layoutId:`workspaceUsage.exportModal.customRange.weekHighlight.${s.toISOString()}`,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:v("relative z-10 flex w-full justify-around transition-colors duration-75",l&&"text-token-main-surface-primary delay-75",!l&&"text-token-text-primary delay-0"),children:ke({start:r,end:te(r)}).map(i=>e.jsx("div",{className:v("w-0 grow",{"text-token-text-quaternary":!le(i,t)||P(i,new Date)||q(i,T)}),children:M(i,"d")},i.toISOString()))})]},r.toISOString())})})};function xt(t){const a=new Date;return t==="thisWeek"||t==="lastWeek"?{period:"weekly",period_start:w(ee(t==="thisWeek"?a:be(a,1)))}:{period:"monthly",period_start:w(O(t==="thisMonth"?a:I(a,1)))}}const x=G({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}});function Ue({startDate:t,statsSpec:a,data:s,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:a.map(({dataKey:r,label:l,helpText:n})=>{const i=s==null?"loading":s[r],d=o==null?"loading":o[r];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(c,{...l}),e.jsx(je,{}),n&&e.jsx(He,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(c,{...n})}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Fe,{className:"icon-sm inline"})})]}),e.jsx(at,{value:i,previousValue:d,hideTrend:le(t,new Date),className:"h-[28px]"})]},r)})})}function Te({handleSearch:t,clientEventSource:a,className:s}){const r=Q().formatMessage(ft.filterListInputLabel),l=m.useCallback(Ke(n=>{t(n),h.logEvent("Workspace Usage: Filter Searched",{queryLength:n.length,trigger:"debouncedTyping",source:a})},250),[]);return e.jsx($e,{className:v("max-w-[300px]",s),ariaLabel:r,placeholder:r,type:"text",name:"search",icon:Qe,iconPosition:"left",saveOnBlur:!0,value:"",onChange:n=>l(n.target.value.trim()),onPressEnter:n=>{const i=n?.trim()??"";t(i),h.logEvent("Workspace Usage: Filter Searched",{queryLength:i.length,trigger:"enterKey",source:a})}})}const ft=G({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),ue=20,me=[{cursor:void 0,queryId:void 0}];function Le({getQueryKey:t,loader:a,initialSortDirection:s,spec:o,getData:r,clientEventSource:l}){const[n,i]=m.useState(s),[d,p]=m.useState(me),[u,b]=m.useState(0),[L,j]=m.useState(),f=B({queryKey:t({order_by_field:n.metric,order_by_direction:n.direction,cursor:d[u]?.cursor,query_id:d[u]?.queryId,page_size:ue}),queryFn:({queryKey:y})=>a(y)}),g=f.data?r(f.data):"loading",E=it(g),C=g==="loading"&&E.current!=="loading",oe=C?E.current:g;m.useEffect(()=>{f.data?.next_cursor&&f.data?.query_id&&d.length===u+1&&p(y=>[...y,{cursor:f.data?.next_cursor,queryId:f.data?.query_id}])},[f.data,d,u]),m.useEffect(()=>{L==null&&f.data&&(f.data.total_count!=null?j(Math.ceil(f.data.total_count/ue)):j(1))},[f.data,d,L]);const Se=n.direction==="ASC"?nt:rt;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(F.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(F.Header,{children:o.map(({metric:y,label:S,defaultSortDirection:V="ASC"})=>e.jsxs(F.HeaderCell,{className:"text-sm font-medium text-nowrap",onClick:()=>{b(0),p(me),i(Y=>{let H;return y===Y.metric?H=Y.direction==="ASC"?"DESC":"ASC":H=V,h.logEvent("Workspace Usage: Table Sort Clicked",{metric:y,direction:H,source:l}),{direction:H,metric:y}})},children:[S,n.metric===y&&e.jsx(Se,{className:"icon-md text-token-icon-secondary ms-1 inline"})]},y))}),e.jsx(F.Body,{children:oe&&oe!=="loading"&&oe.map((y,S)=>e.jsx(F.Row,{children:o.map(({metric:V,render:Y},H)=>e.jsx(F.Cell,{className:v(C&&"pt-0 pb-0 [&]:border-0"),divClassName:v("items-center",H>0&&"text-token-text-secondary",!C&&"min-h-[40px]",C&&"h-0 overflow-hidden"),children:Y(y[V],y)},V))},S))})]}),g==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(ie,{})}),g!=="loading"&&g.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(c,{...yt.zeroStateMessage})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{onLeft:()=>{b(y=>{const S=y-1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:S,source:l}),S})},leftDisabled:u<=0,onRight:()=>{b(y=>{const S=y+1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:S,source:l}),S})},rightDisabled:d[u+1]==null,children:[u+1,"/",L??e.jsx(ie,{})]})})]})}const yt=G({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),z=(t,{toastId:a="chatgpt.usageAnalytics.defaultErrorToastId",message:s}={})=>st(t,{toastId:a,message:s});function ge(t,a){return B({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:t,startDate:a}],queryFn:z(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function vt([t,{workspaceId:a,...s}]){return D.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:a},query:s}})}const bt={direction:"DESC",metric:"active_users"};function Mt({currentWorkspaceId:t,startDate:a}){const[s,o]=m.useState(""),r=w(a),l=m.useCallback(u=>["workspace-analytics-gizmos-list",{workspaceId:t,start_date:r,filter_query:s,...u}],[r,s,t]),n=ge(t,r),i=w(I(a,1)),d=ge(t,i),p=z(vt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:a,data:n.data,previousData:d.data,statsSpec:kt}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(A,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...U.manageGPTs}),e.jsx(we,{className:"icon-sm"})]})})]}),e.jsx(Le,{getQueryKey:l,loader:p,getData:u=>u.gizmos,spec:jt,initialSortDirection:bt,clientEventSource:"gizmoList"},`${t}.${r}.${s}`)]})}const U=G({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},creatorEmailColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorEmail",defaultMessage:"Creator Email"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"}}),kt=[{dataKey:"total_gpt_count",label:U.totalGpts},{dataKey:"gpt_created",label:U.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:U.gptsActive,helpText:U.gptsActiveHelpText}],wt=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function pe(t){return typeof t=="number"?wt.format(t):null}const jt=[{metric:"gpt_name",label:e.jsx(c,{...U.nameColumnLabel}),render:(t,{config_type:a})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:t}),a==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(c,{...U.draftFlag})})]})},{label:e.jsx(c,{...U.creatorNameColumnLabel}),metric:"creator_name",render:t=>t},{metric:"messages",label:e.jsx(c,{...U.messagesColumnLabel}),render:pe,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(c,{...U.activeUsersColumnLabel}),render:pe,defaultSortDirection:"DESC"}];function _t({startDate:t,setStartDate:a}){return e.jsx(se,{onLeft:()=>{a(s=>{const o=I(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:w(o)}),o})},leftDisabled:q(I(t,1),T),onRight:()=>{a(s=>{const o=ae(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:w(o)}),o})},rightDisabled:P(ae(t,1),N),surpressChildrenWrapper:!0,children:e.jsx(Ut,{startDate:t,setStartDate:a})})}function Ut({startDate:t,setStartDate:a}){return e.jsx(Me,{triggerButton:e.jsx(A,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:M(t,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(_e,{referenceDate:t,setReferenceDate:(s,o)=>{const r=O(P(s,N)?N:q(s,T)?T:s);a(r),h.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:w(r)})},earliestValidDate:T,latestValidDate:N,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}var re,he;function Tt(){if(he)return re;he=1;var t=Ee(),a=Ve(),s=a(function(o,r,l){t(o,l,r)});return re=s,re}var Lt=Tt();const Ct=Ae(Lt);async function St({queryKey:[t,{workspaceId:a,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function Dt(t,a){return B({queryKey:["workspace-analytics-overview",{workspaceId:t,startDate:a}],queryFn:z(St)})}async function Et({queryKey:[t,{workspaceId:a,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function Nt(t,a){return B({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:t,startDate:a}],queryFn:z(Et)})}function At(t,a){return B({queryKey:["workspace-analytics-tool-overview",{workspaceId:t,startDate:a}],queryFn:z(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}function J(t,a,s){return m.useMemo(()=>{if(!a)return;const o=Ct(a,"date");return ke({start:t,end:de(t)}).map(r=>{const l=w(r),n=o[l];return n&&n.total>0?{date:n.date,total:n.total,values:n[s]??{}}:{date:l,blank:0}})},[t,a,s])}function It(t,a){const s=w(a),o=Dt(t,s),r=m.useMemo(()=>o.data?.active_user_data?.daily_data.map(({date:E,active_users:C})=>({date:E,total:C,values:{active_users:C}})),[o.data?.active_user_data?.daily_data]),l=J(a,r,"values"),n=J(a,o.data?.messages_data?.daily_data,"messages_by_model"),i=Nt(t,s),d=J(a,i.data?.daily_gizmo_messages_data,"messages_by_gpt"),p=At(t,s),u=J(a,p.data?.daily_tool_messages_data,"messages_by_tool"),b=Q(),L=m.useMemo(()=>l&&o.data?.active_user_data?{data:l,metrics:{active_users:{displayName:b.formatMessage(Gt.activeUsers)}},monthOverMonth:o.data.active_user_data.month_to_month_data}:"loading",[l,b,o.data?.active_user_data]),j=m.useMemo(()=>n&&o.data?.messages_data?{data:n,metrics:xe(o.data.messages_data.models),monthOverMonth:o.data.messages_data.month_to_month_data}:"loading",[n,o.data?.messages_data]),f=m.useMemo(()=>d&&i.data?.metrics&&i.data?.month_to_month_data?{data:d,metrics:Object.fromEntries(Object.entries(i.data.metrics).map(([E,C])=>[E,{displayName:C}])),monthOverMonth:i.data.month_to_month_data}:"loading",[d,i.data?.metrics,i.data?.month_to_month_data]),g=m.useMemo(()=>u&&p.data?.tool_list&&p.data?.month_to_month_data?{data:u,metrics:xe(p.data.tool_list),monthOverMonth:p.data.month_to_month_data}:"loading",[u,p.data?.month_to_month_data,p.data?.tool_list]);return{dailyActiveUsers:L,dailyMessages:j,dailyGizmoMessages:f,dailyToolMessages:g}}function xe(t){return Object.entries(t).sort(([,a],[,s])=>a-s).reduce((a,[s,o])=>(o>0&&(a[s]={displayName:s,total:o}),a),{})}const Gt=G({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Active users"}});function Ot({currentWorkspaceId:t,startDate:a}){const s=Q(),o=It(t,a),r=!Ye(a,O(new Date));return e.jsxs("div",{className:"mt-10",children:[e.jsx(Z,{title:R.activeUsersChartTitle,data:o.dailyActiveUsers,displayMoM:r,clientEventSource:"activeUsers",hideLegend:!0}),e.jsx(Z,{title:R.messagesChartTitle,data:o.dailyMessages,otherGroupLabel:s.formatMessage(R.otherModels),displayMoM:r,clientEventSource:"totalMessages"}),e.jsx(Z,{title:R.gptMessagesChartTitle,data:o.dailyGizmoMessages,otherGroupLabel:s.formatMessage(R.otherGizmos),displayMoM:r,clientEventSource:"gizmoMessages"}),e.jsx(Z,{title:R.toolMessagesChartTitle,data:o.dailyToolMessages,otherGroupLabel:s.formatMessage(R.otherTools),displayMoM:r,clientEventSource:"toolMessages"})]})}const R=G({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"}});function fe(t,a){return B({queryKey:["workspace-analytics-user-stats",{workspaceId:t,startDate:a}],queryFn:z(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function zt([t,{workspaceId:a,...s}]){return D.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:a},query:s}})}const Rt={direction:"DESC",metric:"messages"};function Wt({currentWorkspaceId:t,startDate:a}){const[s,o]=m.useState(""),r=w(a),l=m.useCallback(u=>["workspace-analytics-users-list",{workspaceId:t,start_date:r,filter_query:s,...u}],[r,s,t]),n=fe(t,r),i=w(I(a,1)),d=fe(t,i),p=z(zt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:a,data:n.data,previousData:d.data,statsSpec:qt}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"userList"}),e.jsx(A,{as:"link",to:"/admin",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...k.manageUsersLink}),e.jsx(we,{className:"icon-sm"})]})})]}),e.jsx(Le,{getQueryKey:l,loader:p,getData:u=>u.users,spec:Bt,initialSortDirection:Rt,clientEventSource:"userList"},`${t}.${r}.${s}`)]})}const k=G({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Claimed seats"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"}}),qt=[{dataKey:"purchased_seats",label:k.purchasedSeats},{dataKey:"claimed_seat",label:k.claimedSeats,helpText:k.claimedSeatsHelpText},{dataKey:"active_users",label:k.activeUsers,helpText:k.activeUsersHelpText},{dataKey:"pending_invites",label:k.pendingInvites}],Pt=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function ne(t){return typeof t=="number"?Pt.format(t):null}const Bt=[{metric:"name",label:e.jsx(c,{...k.nameColumnLabel}),render:t=>t},{metric:"email",label:e.jsx(c,{...k.emailColumnLabel}),render:t=>t},{metric:"messages",label:e.jsx(c,{...k.messagesColumnLabel}),render:ne,defaultSortDirection:"DESC"},{label:e.jsx(c,{...k.gptMessagesColumnLabel}),metric:"gpt_messages",render:ne,defaultSortDirection:"DESC"},{label:e.jsx(c,{...k.toolMessagesColumnLabel}),metric:"tool_messages",render:ne,defaultSortDirection:"DESC"}];function Ht(t){return Object.keys(t)}const Ft=$.div`border-b border-token-main-surface-tertiary`,Kt=$.div`flex space-x-4`,$t=$.div`flex justify-between mx-auto w-full max-w-4xl px-2 md:px-6 lg:px-10 py-6 lg:py-10 pb-4 md:pb-4 lg:pb-4`,Qt=$.div`flex`,Vt=$.h2`hidden md:block`,Ce={overviewTab:Ot,usersTab:Wt,gptsTab:Mt};function Yt(t){return B({queryKey:["workspace-analytics-last-updated",{workspaceId:t}],queryFn:z(({queryKey:[a,s]})=>D.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:s.workspaceId}}}))})}const Xt=Ht(Ce);function Zt({currentWorkspaceId:t,startDate:a,setStartDate:s,currentTab:o,setTab:r}){const l=Yt(t),[n,i]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(dt,{}),e.jsxs(Ft,{children:[e.jsxs($t,{children:[e.jsx(Vt,{children:e.jsx(c,{...W.title})}),e.jsxs(Qt,{children:[e.jsx(_t,{startDate:a,setStartDate:s}),e.jsx(A,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{i(!0),h.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(c,{...W.exportButton})}),n&&e.jsx(gt,{currentWorkspaceId:t,currentTab:o,onClose:()=>i(!1)})]})]}),e.jsxs("div",{className:"mx-auto flex w-full max-w-4xl items-center justify-between px-2 pt-2 md:px-6 lg:px-10",children:[e.jsx(Kt,{children:Xt.map(d=>e.jsx("a",{className:v("pb-2",o===d?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{r(d),h.logEvent("Workspace Usage: Tab Clicked",{tab:d})},children:e.jsx(c,{...W[d]})},d))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[l.data?e.jsxs("span",{children:[e.jsx(c,{...W.dataLastUpdatedLabel}),e.jsx(je,{}),l.data.last_updated_time?M(new Date(l.data.last_updated_time),"MMM d, yyyy"):e.jsx(c,{...W.dataLastUpdatedUnknown})]}):e.jsx(ie,{}),"·",e.jsx(Ze,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(c,{...W.helpCenterLinkText})})]})]})]})]})}function Jt({currentWorkspaceId:t}){const a=Q(),[s,o]=m.useState("overviewTab"),[r,l]=m.useState(O(new Date)),n=Ce[s];return m.useEffect(()=>{h.logPageView(),h.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsx("title",{children:a.formatMessage(W.title)})}),e.jsx(Zt,{currentWorkspaceId:t,startDate:r,setStartDate:l,currentTab:s,setTab:o}),e.jsx(lt,{children:e.jsx(n,{currentWorkspaceId:t,startDate:r})})]})}const W=G({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),Qa=Ne(function(){const a=ct();return ut(),e.jsx(Jt,{...a})});export{Qa as default};
//# sourceMappingURL=c6pdytc5lhy8tmnq.js.map
