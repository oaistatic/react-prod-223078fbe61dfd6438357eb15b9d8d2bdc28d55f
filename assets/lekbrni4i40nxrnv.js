import{ad as K,E as q,eR as B,eP as F}from"./citrwydz0bgriwlc.js";import{a as L,i as N,f as b,r as e,j as i,a9 as O,k as Q,D as U}from"./b8ijctzpgh0s7wpx.js";import{h as $,j as G,e as I,W as z,u as H,f as J}from"./omp8ie1vzl40ti1z.js";import{b as V,c as X}from"./nvghija6qp2cunds.js";import{P as Y}from"./ku4zsoy6w4wkp690.js";import{gM as Z,K as f,q as x}from"./krbmwir12ubt4od1.js";import{u as tt,W as st}from"./iq1x6sz8bwtm6i1f.js";import{u as rt}from"./nnffynscsbaol5fb.js";import{i as et}from"./eeyp7d7oqudhas3m.js";import"./k1h56nx2kjoqc52m.js";import"./djd85tifm57yisqi.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./n3fqqr9zf79bnmr6.js";import"./c23qlyb7rng4ydyc.js";import"./ju91cj9mp2lx2yuz.js";import"./ndqm17bbs5ambnrw.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./dbalwdodzoo02ru2.js";import"./ji5qoh13hkjncrxd.js";import"./mtbwfu1a5yslb3p2.js";import"./jmanj1myc9r62cus.js";import"./eeruhkv4a43aueaw.js";import"./k00srulxk3kjmgxy.js";import"./iki1bxy2syl3zwuv.js";import"./bdclq6pa102whxi1.js";import"./be0n9593bbjhdouz.js";import"./gbxx25eoj7wtyna0.js";import"./bzsolvz1ulyrc61b.js";import"./pc2givv05uuq8g6l.js";import"./jr954f5murhu609u.js";import"./gaxh4csbc95s5l26.js";import"./e74336rl4x47z2ei.js";import"./h3axfhhn58bmthc9.js";import"./eg629yaevviy8e7x.js";import"./k5qjx4jdow04k7d2.js";import"./o6iizogkfybkxcpa.js";import"./ct6yhczwft8t5t9k.js";import"./etmxhiuvgu79utu0.js";import"./by1c2a5hsj4exnt8.js";import"./l4etgojhnqjuqlgi.js";import"./belvvj76e8q0tm6q.js";import"./eobw6ahe02v4g6se.js";import"./gvs1s366o5iglka3.js";import"./eprrfci9x6sa3hga.js";import"./n0ud0ko19kosxgev.js";import"./lik51q5yy8pdcusl.js";import"./he8ni3xt3ac4tebf.js";import"./n4yg932g6pqv5x7h.js";import"./m4qet7ipn6ha09it.js";import"./cfe0bfy5asp94vp2.js";import"./nfkxdwnvdjy1s4sn.js";import"./cwi4lsxreiklxbjv.js";function ot({taskId:s,onClose:u}){const n=L(),l=K(),a=N(),m=b(),{data:t,error:y}=$(s);G(s);const w=I(({getTurnsForTask:r})=>r(s)),c=q(),p=e.useMemo(()=>c?new Y(V()):new Z,[c]),_=e.useSyncExternalStore(r=>p.subscribe("change",r),()=>!p.isEmpty(),()=>!1),[k,d]=e.useState([]),[S,C]=e.useState(!1),{focusedAssistantTurn:o,setFocusedAssistantTurnId:M}=tt({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),P=t?.task?.current_turn_id,g=!!t?.task.has_unread_turn&&P===t.current_assistant_turn?.id,h=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!c)return;const r=t?.task?.title;if(r){const R=document.title;return document.title=r,()=>{document.title=R}}},[c,t?.task?.title]),e.useEffect(()=>{g&&h&&z.markTurnAsRead(s).then(()=>{n.invalidateQueries({queryKey:["wham","tasks"]}),n.invalidateQueries({queryKey:["wham","task",s]})})},[g,h,s,n]),rt(),H([{key:"newTask",action:()=>m("/codex",{state:{focusComposer:!0}}),actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[f.Mod,f.Shift,"o"]},{key:"closeTask",action:()=>m("/codex"),actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[f.Escape]}]);const T=k.length>0,D=e.useCallback(({force:r=!1}={})=>{if(r||!T&&!_){d([]),u();return}C(!0)},[u,T,_]),W=o?et(o.turn_status):!1,A=o?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||o?.id===t?.current_assistant_turn?.id,E=t?.current_diff_task_turn?.id===o?.id||o?.sibling_turn_ids?.includes(t?.current_diff_task_turn?.id??""),j=!t?.current_diff_task_turn,v=W&&A&&(E||j);return y?(l.danger(a.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),i.jsx(O,{to:"/codex"})):i.jsx(X.Provider,{value:p,children:i.jsx(st,{permissions:"write",taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:S,setConfirmClose:C,task:t?.task,focusedAssistantTurn:o,pastTurns:w,clearComments:()=>d([]),setComments:d,comments:k,canFollowUp:v,handleClose:D,setFocusedAssistantTurnId:M})})}function nt(){const s=b(),u=Q(),{taskId:n}=U();J();const l=u.state??{},{backgroundLocation:a}=l,m=e.useCallback(()=>{s(a?-1:"/codex")},[a,s]);return n?i.jsx(B,{children:i.jsx(ot,{taskId:n,onClose:m})}):null}const as=()=>[{title:"Codex"}],is=F(function(){return i.jsx(nt,{})});export{is as default,as as meta};
//# sourceMappingURL=lekbrni4i40nxrnv.js.map
