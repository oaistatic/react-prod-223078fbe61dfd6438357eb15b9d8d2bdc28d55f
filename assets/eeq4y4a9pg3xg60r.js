import{r,j as t,M as b}from"./b8ijctzpgh0s7wpx.js";import{c as F,l as H,a_ as A,n as I,db as R,e as p,a$ as z,cx as B,bj as G,B as w,F as U,ch as K}from"./citrwydz0bgriwlc.js";import{dq as V,ie as D,ig as J,ih as L,ii as O}from"./krbmwir12ubt4od1.js";import{a as W}from"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";const $=r.forwardRef(function(s,i){const{className:c,...d}=s;return t.jsxs("div",{className:"grid",children:[t.jsx("textarea",{className:F("col-start-1 col-end-2 row-start-1 row-end-2 w-full resize-none overflow-hidden p-0",c),ref:i,...d}),t.jsxs("span",{className:"invisible col-start-1 col-end-2 row-start-1 row-end-2 p-0 break-all whitespace-pre-wrap",children:[s.value," "]})]})});function q({initialText:o,clientThreadId:s,currentLeaf:i,onExitEdit:c,onRequestCompletion:d,disabled:y,attachments:l}){const[u,C]=r.useState(o??""),m=r.useRef(null),M=V(),h=W(),g=u.trim()==="",{value:v}=H("1988730211"),N=r.useCallback(e=>{C(e.currentTarget.value)},[]),x=r.useCallback(e=>{if(g)return;const a={},n=D();l&&(a.attachments=l),n&&(a.__internal={search_settings:n});const S=Array.from(h),{systemHints:T,extraStreamParams:P}=v?J(S):{systemHints:S,extraStreamParams:{}},j=A(s),_=I.getParentNode(j,i).message.id;d({sourceEvent:e,parentMessageId:_,promptMessage:R(u,Object.keys(a).length>0?a:void 0),extraStreamParams:P,completionMetadata:{conversationMode:j?.mode,systemHints:T}}),c(),p.logEvent("Change Active Node",{intent:"edit_save"})},[g,l,s,h,v,d,c,i,u]),f=r.useCallback(()=>{z(s,e=>{B.setCurrentBranch(e,i)}),p.logEvent("Change Active Node",{intent:"edit_cancel"}),c(),p.logEvent("Cancel Edit Prompt",{threadId:G(s)})},[i,c,s]);r.useEffect(()=>{const e=m.current;if(e){e.focus();const a=e.value.length;e.setSelectionRange(a,a)}},[]),r.useEffect(()=>{const e=m.current,a=n=>{n.isComposing||(n.key==="Enter"&&n.metaKey?x(n):n.key==="Escape"&&f())};return e&&e.addEventListener("keydown",a),()=>{e&&e.removeEventListener("keydown",a)}},[f,x]);const E=l&&l.length>0&&t.jsx(Q,{children:l.map(e=>t.jsx(L,{width:M?"normal":"wide",file:e.name,contextConnectorInfo:O(e.context_connector_info)},e.id))}),k=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx($,{ref:m,value:u,onChange:N,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[E,k,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(w,{as:"button",color:"secondary",onClick:f,children:t.jsx(b,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(w,{as:"button",onClick:x,disabled:y||g,children:t.jsx(b,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const Q=U.div`flex gap-2 flex-wrap`;function oe({message:o,...s}){return t.jsx(q,{currentLeaf:o.id,initialText:K(o),attachments:o.metadata?.attachments,...s})}export{oe as TextMessageEditor};
//# sourceMappingURL=eeq4y4a9pg3xg60r.js.map
