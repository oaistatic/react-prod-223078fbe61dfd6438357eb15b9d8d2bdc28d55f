import{r as l,j as t,i as E,o as A,M as K}from"./b8ijctzpgh0s7wpx.js";import{gw as T,aX as P,dI as V,ds as q,gn as _,c2 as H,K as Z,q as O,lp as W,eo as G,bJ as L,lq as U}from"./krbmwir12ubt4od1.js";import{e as Y,u as z,C as J,W as X}from"./omp8ie1vzl40ti1z.js";import{c as b}from"./citrwydz0bgriwlc.js";import{I as $}from"./mtbwfu1a5yslb3p2.js";const Q=e=>l.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},l.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));function ee({triggerText:e,toolTip:a,ariaLabel:r,Icon:c,truncate:o=!0}){return t.jsx(T,{className:"border-token-border-default text-token-text-primary bg-token-bg-primary hover:bg-token-bg-tertiary rounded-full border px-2 py-1","aria-label":r,children:t.jsx(P,{label:a,className:"text-sm font-medium",children:t.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[c,t.jsx("span",{className:b("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:e}),t.jsx(V,{"aria-hidden":!0,className:"icon-sm"})]})})})}function te({children:e,className:a,onClick:r,isSelected:c,isActive:o,isVirtualHover:d=!1,label:f,isDisabled:n,tooltipLabel:i,isSubMenuTrigger:u,noDefaultHoverState:h,as:v="button",truncateLabel:x,infoIcon:p,infoLink:M,icon:g,...w}){const j=E();let m=t.jsx(t.Fragment,{});e?m=t.jsx("div",{className:"flex flex-1 items-center gap-4",children:e}):f&&(m=t.jsxs("div",{className:b("flex items-center gap-3",x?"w-0 flex-1":"w-full"),children:[g&&(l.isValidElement(g)?g:t.jsx(se,{icon:g})),f&&t.jsx("div",{className:b("flex flex-col items-start px-1 py-1",n&&"text-token-text-quaternary pointer-events-none",x&&"w-full"),children:t.jsx("div",{className:b("flex items-center gap-2 text-start text-sm",x&&"w-full"),children:f})})]}),i&&(m=t.jsx(P,{sideOffset:-10,label:i,className:"w-full",children:m})));const N=t.jsxs("div",{className:"min-w-5 items-center justify-center",children:[c&&t.jsx(q,{className:b("icon-md","color:var(--tint-color,#0285FF)"),"aria-label":j.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),p&&M&&t.jsx("a",{href:M,target:"_blank",rel:"noopener noreferrer",children:p}),u&&t.jsx(_,{className:"icon text-token-text-tertiary w-7","aria-label":j.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),k=b("flex cursor-pointer items-center gap-4 rounded-lg px-2 py-1.5 pe-3",o&&"bg-black/5 dark:bg-white/5",!h&&"hover:bg-black/5 dark:hover:bg-white/5",d&&"bg-black/5 dark:bg-white/5",a);if(v==="div"){const C=w;return t.jsxs("div",{...C,className:k,children:[m,N]})}const B=w;return t.jsxs("button",{type:"button",...B,onClick:C=>{C.persist(),requestAnimationFrame(()=>{r?.(C)})},className:k,children:[m,N]})}function se({icon:e}){const a=e;return t.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:t.jsx(a,{className:"h-5 w-5 shrink-0","aria-label":""})})}const S="wham-environment-popover-event";function re(e,a,r){l.useEffect(()=>{function o(d){d.detail.popover!==e&&r()}return window.addEventListener(S,o),()=>{window.removeEventListener(S,o)}},[e,r]);const c=l.useCallback(o=>{window.dispatchEvent(new CustomEvent(S,{detail:{popover:o}}))},[]);l.useEffect(()=>{a&&c(e)},[a,c,e])}const ae=({items:e,onSelect:a,keyExtractor:r})=>{const[c,o]=l.useState(null),[d]=l.useState(new Map);return{hoveredId:c,setHoveredId:o,getItemRef:n=>i=>{const u=r(n);return i&&d.set(u,i),()=>{d.delete(u)}},itemRefs:d,onKeyDown:n=>{const i=n.key==="ArrowDown"||n.key==="n"&&n.ctrlKey,u=n.key==="ArrowUp"||n.key==="p"&&n.ctrlKey;if(!(i||u||n.key==="Enter"))return;if(n.preventDefault(),n.key==="Enter"){c&&a(c);return}const h=e.findIndex(p=>r(p)===c),v=H(h-(u?1:-1),0,e.length-1),x=r(e[v]);d.get(x)?.scrollIntoView({behavior:"instant",block:"nearest"}),o(x)}}};function I(e){return e.length>18?`â€¦${e.slice(-18)}`:e}function de({environment:e}){const a=E(),{branch:r,setBranch:c}=Y(),[o,d]=l.useState(""),[f,n]=l.useState(!1),i=l.useRef(null),u=()=>n(!1),h=l.useRef(e.repos[0]??null);return l.useEffect(()=>{(h.current!==e.repos[0]||!r)&&(h.current=e.repos[0],c(R(e)))},[r,c,e]),re("branch",f,()=>n(!1)),z([{key:"whamBranches",action:()=>n(!0),actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:O.Chat,keyboardBinding:[Z.Mod,"b"]}]),t.jsx("div",{className:"items-center rounded-full",children:t.jsxs(W,{open:f,onOpenChange:n,children:[t.jsx(ee,{triggerText:I(r??"")??a.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:I(r??"")===r||f?"":r?.length?r:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:t.jsx(Q,{"aria-hidden":!0,className:"icon-sm"}),truncate:!1}),t.jsx(J,{align:"start",sideOffset:12,isOpen:f,closePopover:u,popoverContentRef:i,children:t.jsx(ne,{environment:e,repoId:h,searchQuery:o,setSearchQuery:d,setBranch:c,selectedBranch:r??"",closePopover:u})})]})})}function ne({environment:e,repoId:a,setBranch:r,selectedBranch:c,searchQuery:o,setSearchQuery:d,closePopover:f}){const n=E(),i=l.useRef(null),u=G(o,300),{data:h,isLoading:v,fetchNextPage:x,hasNextPage:p,isFetchingNextPage:M,error:g}=A({queryKey:["searchBranches",a.current,u],enabled:!!a.current,initialPageParam:null,queryFn:({pageParam:s})=>X.searchBranchesByRepository(a.current??"",u,U,s??null),getNextPageParam:s=>s?.cursor??null}),w=l.useMemo(()=>{const s=h?.pages?.flat().map(D=>D.items.flatMap(F=>F.branch))?.flat()??[],y=R(e);return y&&!s.includes(y)&&s.unshift(y),s},[h,e]),j=s=>{r(s),f()},m=l.useMemo(()=>o?.trim()?w.filter(s=>s.toLowerCase().includes(o.toLowerCase())):w??[],[o,w]),{hoveredId:N,setHoveredId:k,onKeyDown:B,getItemRef:C}=ae({items:m,keyExtractor:s=>s,onSelect:j});return l.useEffect(()=>{i.current&&i.current.focus()},[]),t.jsxs("div",{className:"bg-token-bg-primary flex max-h-[245px] w-72 flex-col gap-2 rounded-lg p-2 md:max-h-[400px]",onClick:s=>{s.stopPropagation()},children:[t.jsx(L,{ref:i,className:"w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",type:"text",autoComplete:"off",name:"search-branch",value:o,onKeyDown:B,onChange:s=>d(s.target.value),placeholder:n.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Enter a branch"}),ariaLabel:n.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),t.jsxs("div",{className:"min-h-18 w-full overflow-y-auto",children:[m?.map(s=>{const y=s===c;return t.jsx(te,{className:"w-full",as:"button",onMouseEnter:()=>k(s),isVirtualHover:N===s,ref:C(s),onClick:()=>{j(s)},isSelected:y,label:s},s)}),g?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(K,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,t.jsx($,{hasNextPage:p,fetchNextPage:x,isFetchingNextPage:M||v})]})]})}function R(e){for(const a of e.repos){const r=e.repo_map?.[a];if(r?.default_branch)return r.default_branch}return"main"}export{ee as C,Q as S,te as a,de as b,ae as c,R as g,re as u};
//# sourceMappingURL=ji5qoh13hkjncrxd.js.map
