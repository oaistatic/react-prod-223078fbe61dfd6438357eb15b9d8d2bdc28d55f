const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/eksn1ctdegzk1rqe.js","assets/b8ijctzpgh0s7wpx.js","assets/citrwydz0bgriwlc.js","assets/root-gxczc0vy.css","assets/krbmwir12ubt4od1.js","assets/conversation-small-dfayqh3x.css","assets/er3uzu01hefrnojy.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{c as N,dr as V,m as q,Q as K,bk as Q,_ as U}from"./citrwydz0bgriwlc.js";import{r as t,j as n,a5 as M}from"./b8ijctzpgh0s7wpx.js";import{P as Y,u as Z}from"./ku4zsoy6w4wkp690.js";import{b as $,c as B}from"./nvghija6qp2cunds.js";import{bz as J,bA as c,jM as X,jN as ee,io as te,jO as ne,bv as re,bx as k,jP as oe,ib as y,ga as se,jQ as ae,iC as ie,ja as ce,jb as ue}from"./krbmwir12ubt4od1.js";import{P as le}from"./jkznwfhp8ahnvlot.js";import{I as de}from"./pc9qsszhmtx9pu7o.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./djd85tifm57yisqi.js";import"./megablgldkh4lap1.js";import"./hbpbckirom363mgh.js";import"./izdon3syh095bs23.js";import"./dweroubxngal4vlb.js";import"./i7jya7stlyvnzya0.js";import"./cb2t82g498wwhuc2.js";import"./ndwtlsjk3xm27wkq.js";import"./dcml6fn13vfm1zv2.js";import"./o0ebhsapkoy5qkg1.js";import"./k7nub2yuxq70se07.js";import"./k6ccgr4wxcppeg93.js";import"./dbalwdodzoo02ru2.js";import"./dera5bljhpg5ja89.js";import"./hs2fsda156wfk7fz.js";function me(){const[e,r]=t.useState({undoStack:[],currentIndex:-1});function o(s){r(h=>({undoStack:[...h.undoStack.slice(0,h.currentIndex+1),s],currentIndex:h.currentIndex+1}))}function a(){r(s=>({undoStack:s.undoStack,currentIndex:Math.max(s.currentIndex-1,-1)}))}function d(){r(s=>({undoStack:s.undoStack,currentIndex:Math.min(s.currentIndex+1,s.undoStack.length-1)}))}function m(){r({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:o,canUndoDrawing:e.currentIndex>=0,undoDrawing:a,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:d,clearAllDrawings:m}}const he=0,fe=48;function ge({imageAsset:e,children:r,containerDimensions:o,isLoadingNewImage:a}){return n.jsxs(M.div,{className:"absolute",style:pe(e,o),...J,children:[r,n.jsx("div",{className:N("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",a?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function pe(e,r){const{width:o,height:a}=e,{width:d,height:m}=r,s=d-2*he,h=m-2*fe,f=o/a,u=s/h,l=f>u,x=l?s:h*f,I=l?s/f:h;return{top:"50%",left:"50%",width:x,height:I,transform:"translate(-50%, -50%)"}}const xe=({onEscape:e})=>{t.useEffect(()=>{function r(o){o.key==="Escape"&&e()}return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[e])},Ie=K(()=>U(()=>import("./eksn1ctdegzk1rqe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),R=126,we=63,Se=136,Ce=50;function De({width:e,height:r,delay:o=Ce}){const[a,d]=t.useState(!1);return t.useEffect(()=>{const m=setTimeout(()=>{d(!0)},o);return()=>{clearTimeout(m)}},[o]),a?n.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:r,aspectRatio:`${e} / ${r}`},children:n.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function Ye({image:e,isLoadingNewImage:r,clientThreadId:o,onClose:a,messageId:d,onRequestCompletion:m,editorControls:s,footer:h}){const f=V(o),[u,l]=t.useState(c.Default),[x,I]=t.useState({width:window.innerWidth,height:window.innerHeight-R}),P=X(),[_,T]=t.useState(!1),S=me(),{currentDrawnShape:w,onNewDrawnShape:L,clearAllDrawings:G}=S,C=t.useRef(null),O=t.useMemo(()=>new Y($()),[]),D=t.useRef(void 0),g=t.useMemo(()=>ee({pointer:e,conversationId:f,messageId:d,source:"editor"}),[e,d,f]),W=te(i=>{const{width:p,height:b}=i.contentRect;I({width:p,height:P?b-we:b-R})});xe(t.useMemo(()=>({onEscape:()=>{u===c.Selecting?l(c.Default):a()}}),[u,a])),ne(t.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>l(c.Default),getImageData:()=>C.current?.getImageData()}),[e,w])),t.useEffect(()=>{u!==c.Selecting&&G()},[u]),t.useEffect(()=>{l(c.Default)},[e]);const j=Z(o),v=t.useCallback(i=>{l(c.Default),j(i),a()},[j,a]),E=t.useMemo(()=>m||v,[m,v]),[H]=q(o,i=>[i?.modelId]),A=re({imageAssetPointer:e,serverThreadId:f}),z=t.useCallback(()=>{l(c.Selecting),k.inpaintClick({analyticsContext:g})},[g]),F=t.useCallback(i=>{const p=i.deltaY<0?"in":"out";i.ctrlKey&&D.current!==p&&(k.zoom({zoomType:p,analyticsContext:g}),D.current=p)},[g]);return n.jsx(oe.Provider,{value:g,children:n.jsxs("div",{ref:W,className:"flex h-full w-full flex-col items-center justify-between",onWheel:F,children:[s??n.jsx(de,{clientThreadId:o,imageAsset:e,mode:u,setMode:l,inpaintingDrawingState:S,isLoadingNewImage:r,onClose:a,onInpaintClick:z,messageId:d,serverThreadId:f}),n.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:n.jsxs(ge,{imageAsset:e,containerDimensions:x,isLoadingNewImage:r,children:[A&&u!==c.Selecting&&n.jsx("img",{alt:y(e),className:"absolute inset-0 z-1 opacity-0",src:A}),!_&&n.jsx(De,{width:e.width,height:e.height}),n.jsx(se,{className:"h-full w-full",alt:y(e),onLoad:()=>{T(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),n.jsx("div",{className:N("absolute inset-0",u===c.Selecting?"":"hidden"),children:n.jsx(Ie,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:Se,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:L})})]})}),n.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:n.jsx(M.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??n.jsx(ae,{value:{isImageGenEditor:!0,isInpainting:u===c.Selecting,onCancelInpaint:()=>l(c.Default)},children:n.jsx(B.Provider,{value:O,children:n.jsx(le,{clientThreadId:o,isNewThread:Q(o),currentModelId:H??ie(void 0).id,onContinueGenerating:i=>E(ue(i)),onRequestCompletion:async i=>E(await ce(i)),hideHeader:!0})})})})})]})})}export{Ye as ImageGenNewEditor,De as ShimmerLoader};
//# sourceMappingURL=dlsoz00g3d1kx3ut.js.map
