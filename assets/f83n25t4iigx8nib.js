import{r as m,j as o,a6 as w,M as h}from"./b8ijctzpgh0s7wpx.js";import{m as I,h as E,cs as T,e as C,c as F,n as S}from"./citrwydz0bgriwlc.js";import{da as D,db as N,dc as $,dd as U,de as A,df as O,d8 as W}from"./krbmwir12ubt4od1.js";import{F as z}from"./l4etgojhnqjuqlgi.js";import{AnimatedContainer as k}from"./gs2gd7npjkk979ej.js";import"./ku4zsoy6w4wkp690.js";import"./k1h56nx2kjoqc52m.js";import"./exvo283q5zxd2q6r.js";import"./jekpe1ukp5thtucq.js";import"./enswt24cmdi6maqa.js";function g(t,e){const l=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),c=t.match(l);return c&&c[1]?c[1].trim():t}function B(t){if(t===void 0)return;const e="Content Snippet:",l=t.indexOf(e);return l===-1?t:t.substring(l+e.length).trim()}function L(t,e){e.text=B(t.contents),t.documentId?.includes("ks--slack")?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=g(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=g(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=g(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function ee({turnIndex:t,clientThreadId:e}){const[l,c]=I(e,i=>[S.getTurnContentReferences(i,t),S.getConversationTurnAtIndex(i,t).messages]),f=D(e),n=m.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),x=m.useMemo(()=>{const i=[],r=new Set;return l.forEach(s=>{s.type==="file"&&!r.has(s.id)?(i.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text}),r.add(s.id)):s.type==="file_navlist"&&s.items.forEach(u=>{r.has(u.id)||(i.push({name:u.name,cloud_doc_url:u.cloud_doc_url,text:u.description,id:u.id,lastModifiedTime:u.last_modified_time}),r.add(u.id))})}),i},[l]),d=N(f),p=m.useMemo(()=>{if(!d)return[];const i=[],r=new Set;for(const s of c)if(s.author.role===E.Tool&&s.author.name==="file_search"&&s.content.content_type===T.TetherBrowsingDisplay){const u=$(s.content.result),b=s.metadata?.cloud_doc_urls??[];u.chunks.forEach((a,v)=>{if(!a.documentId||r.has(a.documentId))return;r.add(a.documentId);let _;a.metadata.cloud_doc_url?_=a.metadata.cloud_doc_url.toString():v<b.length?_=b[v]:a.documentId.endsWith("--google")&&(_=`https://drive.google.com/file/d/${a.documentId.split("--")[1]}`);const y=a.metadata["File last modified at"]??a.metadata["File created at"],j={id:a.documentId,name:a.title,cloud_doc_url:_,text:a.contents,lastModifiedTime:y?y.toString():void 0};L(a,j),i.push(j)})}return i},[d,c]);return o.jsx(w,{children:o.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[o.jsx(M,{title:o.jsx(h,{id:"dlVlo6",defaultMessage:"Citations"}),items:x,clientThreadId:e,sectionId:"citations",analyticsMetadata:n}),o.jsx(M,{title:o.jsx(h,{id:"njZblE",defaultMessage:"Search Results"}),items:p,clientThreadId:e,sectionId:"search-results",analyticsMetadata:n})]})})}function M({title:t,items:e,scrollToHeader:l,shouldAnimateScroll:c,clientThreadId:f,analyticsMetadata:n,sectionId:x}){const d=m.useRef(null),p=m.useMemo(()=>n?{...n,sectionId:x,numResultsInSection:e.length}:void 0,[n,e.length,x]);return m.useEffect(()=>{d.current&&l&&setTimeout(()=>{d.current&&d.current.scrollIntoView({behavior:c?"smooth":"instant"})},300)},[l,c]),!e||e.length===0?null:o.jsxs("div",{ref:d,children:[o.jsx(k,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),o.jsx("div",{className:"flex flex-col px-3 py-2",children:e.map((i,r)=>o.jsx(k,{index:r,children:o.jsx(P,{positionInSection:r,item:i,analyticsMetadata:p,clientThreadId:f},r)},`${t}-${r}`))})]})}function P({item:t,analyticsMetadata:e,positionInSection:l,clientThreadId:c}){const f=U(),n=A(t.cloud_doc_url??""),x=n?.type??o.jsx(h,{id:"bqY3sN",defaultMessage:"File"}),d=n?.Icon??O,[p,i]=m.useState(!1),r=m.useCallback(()=>{e&&C.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:l,sourceType:n?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,n?.type,l]),s=m.useCallback(()=>{e&&C.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...e,positionInSection:l,sourceType:n?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,n?.type,l]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:r,className:F("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",p&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[d&&o.jsx(d,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),x]}),o.jsx("div",{className:"line-clamp-2 text-sm font-semibold break-words",children:t.name}),(t.text??t.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(W,{date:new Date(t.lastModifiedTime)}),t.text&&" â€” "]}),t.text]}),f?null:o.jsx(z,{className:F("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",p&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:c,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:p,setIsFollowupMenuOpen:i,trackFileSourceFollowup:s})]})})}export{ee as ChatScreenRetrievalResultsFlyoutContent,M as SourcesListGroup};
//# sourceMappingURL=f83n25t4iigx8nib.js.map
